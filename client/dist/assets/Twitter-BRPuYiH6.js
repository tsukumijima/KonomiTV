import{af as l,y as d,u as w,a7 as s,M as n}from"./index-C90hjLTU.js";const f=l("twitter",{state:()=>({is_logged_in_twitter:!1,selected_twitter_account:null,account_api_activity:{}}),actions:{async update(){const i=d(),e=w();if(await i.fetchUser()!==null)if(i.is_logged_in===!0){if(i.user&&i.user.twitter_accounts.length>0){this.is_logged_in_twitter=!0,(e.settings.selected_twitter_account_id===null||!i.user.twitter_accounts.some(a=>a.id===e.settings.selected_twitter_account_id))&&(e.settings.selected_twitter_account_id=i.user.twitter_accounts[0].id);const t=i.user.twitter_accounts.findIndex(a=>a.id===e.settings.selected_twitter_account_id);this.selected_twitter_account=i.user.twitter_accounts[t],this.selected_twitter_account&&this.resetAccountAPIActivity(this.selected_twitter_account.screen_name)}}else this.is_logged_in_twitter=!1,this.selected_twitter_account=null,this.account_api_activity={}},markAccountAPIActivity(i){i!==""&&(this.account_api_activity={...this.account_api_activity,[i]:!0})},resetAccountAPIActivity(i){i!==""&&(this.account_api_activity={...this.account_api_activity,[i]:!1})}}});class o{static async auth(e){const r=await s.post("/twitter/auth",e);if(r.type==="error"){switch(r.data.detail){case"No valid cookies found in the provided cookies.txt":{n.error("Cookie データのフォーマットが不正です。Netscape 形式の Cookie データを入力してください。");break}case"Failed to get user information":{n.error("Twitter アカウント情報の取得に失敗しました。");break}default:{s.showGenericError(r,"Twitter アカウントとの連携に失敗しました。");break}}return!1}return!0}static async logoutAccount(e){const r=await s.delete(`/twitter/accounts/${e}`);return r.type==="error"?(s.showGenericError(r,"Twitter アカウントとの連携を解除できませんでした。"),!1):!0}static async keepAlive(e){const r=await s.post(`/twitter/accounts/${e}/keep-alive`);if(r.type==="error"){s.showGenericError(r,"ヘッドレスブラウザへの Keep-Alive 送信に失敗しました。");return}o.recordAccountActivity(e)}static async sendTweet(e,r,t){const a=new FormData;a.append("tweet",r);for(const u of t)a.append("images",u);const c=await s.post(`/twitter/accounts/${e}/tweets`,a,{headers:{"Content-Type":"multipart/form-data"},timeout:10*60*1e3});return c.type==="error"?typeof c.data.detail=="string"?Number.isNaN(c.status)?{message:`ツイートの送信に失敗しました。(${c.data.detail})`,is_error:!0}:{message:`ツイートの送信に失敗しました。(HTTP Error ${c.status} / ${c.data.detail})`,is_error:!0}:{message:`ツイートの送信に失敗しました。(HTTP Error ${c.status})`,is_error:!0}:c.data.is_success===!1?{message:c.data.detail,is_error:!0}:(o.recordAccountActivity(e),{message:c.data.detail,is_error:!1})}static async retweet(e,r){const t=await s.put(`/twitter/accounts/${e}/tweets/${r}/retweet`,void 0);return t.type==="error"?(s.showGenericError(t,"ツイートをリツイートできませんでした。"),null):t.data.is_success===!1?(n.error(t.data.detail),null):(o.recordAccountActivity(e),t.data)}static async cancelRetweet(e,r){const t=await s.delete(`/twitter/accounts/${e}/tweets/${r}/retweet`);return t.type==="error"?(s.showGenericError(t,"リツイートを取り消せませんでした。"),null):t.data.is_success===!1?(n.error(t.data.detail),null):(o.recordAccountActivity(e),t.data)}static async favorite(e,r){const t=await s.put(`/twitter/accounts/${e}/tweets/${r}/favorite`,void 0);return t.type==="error"?(s.showGenericError(t,"ツイートをいいねできませんでした。"),null):t.data.is_success===!1?(n.error(t.data.detail),null):(o.recordAccountActivity(e),t.data)}static async cancelFavorite(e,r){const t=await s.delete(`/twitter/accounts/${e}/tweets/${r}/favorite`);return t.type==="error"?(s.showGenericError(t,"いいねを取り消せませんでした。"),null):t.data.is_success===!1?(n.error(t.data.detail),null):(o.recordAccountActivity(e),t.data)}static async getHomeTimeline(e,r){const t=await s.get(`/twitter/accounts/${e}/timeline`,{params:{cursor_id:r}});return t.type==="error"?(s.showGenericError(t,"ホームタイムラインを取得できませんでした。"),null):"is_success"in t.data&&t.data.is_success===!1?(n.error(t.data.detail),null):(o.recordAccountActivity(e),t.data)}static async searchTweets(e,r,t){const a=await s.get(`/twitter/accounts/${e}/search`,{params:{query:r,cursor_id:t}});return a.type==="error"?(s.showGenericError(a,"ツイートの検索に失敗しました。"),null):"is_success"in a.data&&a.data.is_success===!1?(n.error(a.data.detail),null):(o.recordAccountActivity(e),a.data)}static recordAccountActivity(e){if(e==="")return;f().markAccountAPIActivity(e)}}export{o as T,f as u};
