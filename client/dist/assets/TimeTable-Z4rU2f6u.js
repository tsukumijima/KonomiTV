import{H as _a,N as ba,S as ka}from"./SPHeaderBar-Dwp6a3LQ.js";import{R as Sa}from"./ReservationDetailDrawer-BvTl7BKV.js";import{T as _e,a as Ta}from"./TimeTableSettings-DBXbpFS3.js";import{d as Oe,G as c,U as pe,w as dt,j as zt,k as ge,r as tt,f as fe,h as J,b as $,B as Qe,t as xe,o as Y,_ as Ae,af as wa,u as at,q as S,ag as Ue,N as F,s as be,a8 as Da,x as lt,z as mt,c as Q,e as de,P as We,n as et,a as r,p as Mt,V as Z,a2 as He,F as ye,g as Ie,ad as xa,ah as Vt,D as Ce,E as Te,O as Ve,X as Je,ai as ft,aj as nt,ak as Ca,al as Fe,T as Me,am as Ze,an as Pa,l as vt,Y as ze,ao as Ft,ap as Gt,Q as he,aq as jt,ar as Ha,as as Ma,at as qt,au as Va,av as Ba,aw as Ra,ax as Ia,ay as Oa,az as Aa,aA as $a,I as Ea,aB as Ya,aC as Na,aD as Wa,aE as La,aF as Ua,J as za,aG as Fa,aH as Ga,aI as ja,M as ct}from"./index-BwZ9zzz0.js";import{u as qa,P as Xa}from"./ChannelsStore-CS-N4Zdn.js";import{u as Ka,R as Le,I as Bt}from"./ServerSettingsStore-B3yrK2_n.js";import{c as qe,d as Rt}from"./VSelect-CkFu0EQK.js";import{V as Qa,c as Ja}from"./ssrBoot-9lPhdD8P.js";import{M as Xt}from"./VAvatar-J6NPa62J.js";import{b as Za}from"./VTextField-C85TyjR9.js";import"./VSwitch-CqUSXHTX.js";import"./VChip-BJgP-U70.js";import"./VSlider-DXIZgjgt.js";import"./VDialog-C14Tby68.js";import"./VCard-DnZOakur.js";const el={class:"timetable-channel-header__logo-wrapper"},tl=["src","alt"],al={class:"timetable-channel-header__info"},ll={class:"timetable-channel-header__number"},nl={class:"timetable-channel-header__name"},il=Oe({__name:"TimeTableChannelHeader",props:{channel:{},width:{},height:{},resizeTrigger:{}},setup(e){const a=e,v=c(()=>Math.round(Math.min(46,Math.max(32,a.width*.27)))),s=c(()=>Math.round(v.value*(3/4))),t=c(()=>Math.min(14,Math.max(13,a.width*.06))),m=c(()=>(a.resizeTrigger,Math.min(13.5,Math.max(pe.isSmartphoneVertical()?10:12,a.width*.08)))),u=c(()=>`${a.channel.name} を視聴`);return(n,i)=>{const o=tt("router-link"),f=zt("ftooltip");return dt((Y(),ge(o,{class:"timetable-channel-header",to:`/tv/watch/${e.channel.display_channel_id}`,style:fe({width:`${e.width}px`,height:`${e.height}px`,"--timetable-channel-logo-width":`${v.value}px`,"--timetable-channel-logo-height":`${s.value}px`,"--timetable-channel-number-size":`${t.value}px`,"--timetable-channel-name-size":`${m.value}px`})},{default:J(()=>[$("div",el,[$("img",{class:"timetable-channel-header__logo",loading:"lazy",decoding:"async",src:`${Qe(pe).api_base_url}/channels/${e.channel.id}/logo`,alt:e.channel.name},null,8,tl)]),$("div",al,[$("span",ll,xe(e.channel.channel_number),1),$("span",nl,xe(e.channel.name),1)])]),_:1},8,["to","style"])),[[f,u.value,void 0,{bottom:!0}]])}}}),sl=Ae(il,[["__scopeId","data-v-6ab34174"]]),Kt=["ピン留め","地デジ","BS","CS","CATV","SKY","BS4K"],ol=new Map([["地デジ","GR"],["BS","BS"],["CS","CS"],["CATV","CATV"],["SKY","SKY"],["BS4K","BS4K"]]),Ge=wa("timetable",()=>{const e=at(),a=qa(),v=S(null),s=S(w()),t=Ue([]),m=S(null),u=S(!1),n=S(!1),i=S(!1),o=S(0),f=S(null);function h(){const y=F(),O=w();if(s.value.isSame(O,"day")===!1)return!1;let d=y.hour();return d<4&&(d+=24),d>=17}function P(){const y=F(),O=w();if(s.value.isSame(O,"day")===!1)return null;const d=y.startOf("hour").subtract(1,"hour"),R=q();return d.isBefore(R)?R:d}function q(){return i.value?s.value.add(12,"hour"):s.value}function T(y){return y.subtract(1,"millisecond").subtract(4,"hour").startOf("day").add(4,"hour")}function w(){const y=F();let O=y.hour(4).minute(0).second(0).millisecond(0);return y.hour()<4&&(O=O.subtract(1,"day")),O}function C(y,O=!1){return O?y.add(36,"hour"):y.add(1,"day")}const M=c(()=>i.value?s.value.add(12,"hour"):s.value),g=c(()=>{const y=new Set;if(a.is_channels_list_initial_updated===!1)return y;for(const O of a.channels_list_with_pinned.keys()){if(O==="ピン留め"){const d=a.channels_list_with_pinned.get("ピン留め");if(d===void 0||d.length===0)continue}y.add(O)}return y});function N(){return v.value===null?j():g.value.has(v.value)?null:j()}function j(){if(g.value.has("ピン留め"))return"ピン留め";if(g.value.has("地デジ"))return"地デジ";for(const y of Kt)if(g.value.has(y))return y;return"地デジ"}async function G(y,O,d,R){i.value=h(),f.value=P();const I=y??q(),K=O??C(I,i.value),ne=d??v.value??"地デジ",se=ne==="ピン留め"?R??e.settings.pinned_channel_ids:void 0,ve=ol.get(ne),re=await Xa.fetchTimeTable(I,K,ve,se);return re===null?!1:(t.value=re.channels,m.value={earliest:F(re.date_range.earliest),latest:F(re.date_range.latest)},!0)}async function X(){u.value=!0,n.value=!1;try{if(await a.update(),s.value=w(),v.value=j(),await G()===!1){u.value=!1;return}n.value=!0}finally{u.value=!1}}async function z(y){u.value=!0;try{s.value=y,await G()}finally{u.value=!1}}async function te(y){u.value=!0;try{v.value=y,await G()}finally{u.value=!1}}function _(){let O=F().hour();return O<4&&(O+=24),O>=17}async function B(){if(m.value===null)return;const y=w(),O=_();let d;if(i.value)d=s.value.subtract(1,"day");else if(O){const I=s.value.subtract(1,"day");I.isSame(y.add(1,"day"),"day")?d=y:d=I}else d=s.value.subtract(1,"day");const R=T(m.value.earliest);d.isBefore(R,"day")||await z(d)}async function L(){if(m.value===null)return;let y;i.value?y=s.value.add(2,"day"):y=s.value.add(1,"day");const O=T(m.value.latest);y.isAfter(O,"day")||await z(y)}async function ee(){const y=w();s.value.isSame(y,"day")===!1&&await z(y)}function oe(y){o.value=y}const ie=c(()=>{if(m.value===null)return!1;const y=w(),O=_();let d;if(i.value)d=s.value.subtract(1,"day");else if(O){const I=s.value.subtract(1,"day");I.isSame(y.add(1,"day"),"day")?d=y:d=I}else d=s.value.subtract(1,"day");const R=T(m.value.earliest);return d.isSameOrAfter(R,"day")}),ae=c(()=>{if(m.value===null)return!1;let y;i.value?y=s.value.add(2,"day"):y=s.value.add(1,"day");const O=T(m.value.latest);return y.isSameOrBefore(O,"day")});function U(){t.value=[],m.value=null,u.value=!1,n.value=!1,i.value=!1,o.value=0,f.value=null,v.value=null}return be(()=>e.settings.pinned_channel_ids,async(y,O)=>{v.value==="ピン留め"&&n.value!==!1&&Da(y,O)===!1&&await G()},{deep:!0}),be(()=>a.channels_list_with_pinned,async()=>{if(n.value===!1)return;const y=N();y!==null&&await te(y)},{deep:!0}),{selected_channel_type:v,selected_date:s,channels_data:t,date_range:m,is_loading:u,is_initial_load_completed:n,is_36hour_display:i,date_display_offset:o,scroll_top_limit_time:f,available_channel_types:g,display_start_time:M,can_go_previous_day:ie,can_go_next_day:ae,getBroadcastDate:T,getTodayStartTime:w,getDayEndTime:C,getDisplayStartTime:q,setDateDisplayOffset:oe,fetchTimeTableData:G,initialLoad:X,changeDate:z,changeChannelType:te,goToPreviousDay:B,goToNextDay:L,goToCurrentTime:ee,reset:U}}),rl=Oe({__name:"TimeTableCurrentTimeLine",props:{hourHeight:{},totalWidth:{},channelHeaderHeight:{}},setup(e){const a=e,v=Ge(),s=S(F());let t=null,m=null;const u=c(()=>{const i=s.value,o=v.getDisplayStartTime(),f=v.getDayEndTime(o,v.is_36hour_display);return i.isSameOrAfter(o)&&i.isBefore(f)}),n=c(()=>{if(!u.value)return 0;const i=v.getDisplayStartTime();return _e.calculateCurrentTimeY(s.value,i,a.hourHeight,a.channelHeaderHeight)-a.channelHeaderHeight});return lt(()=>{const i=F(),o=i.add(1,"minute").startOf("minute"),f=Math.max(0,o.valueOf()-i.valueOf());m=setTimeout(()=>{s.value=F(),t=setInterval(()=>{s.value=F()},60*1e3)},f)}),mt(()=>{m!==null&&clearTimeout(m),t!==null&&clearInterval(t)}),(i,o)=>u.value?(Y(),Q("div",{key:0,class:"timetable-current-time-line",style:fe({top:`${n.value}px`,width:`${e.totalWidth}px`})},[...o[0]||(o[0]=[$("div",{class:"timetable-current-time-line__indicator"},null,-1),$("div",{class:"timetable-current-time-line__line"},null,-1)])],4)):de("",!0)}}),ul=Ae(rl,[["__scopeId","data-v-8d4f4a9f"]]),cl={class:"timetable-program-cell__content"},dl={class:"timetable-program-cell__header"},vl={class:"timetable-program-cell__start-minute"},ml={key:0,class:"timetable-program-cell__reservation-icon"},fl={key:0,class:"timetable-program-cell__recording-icon"},hl=["innerHTML"],gl=["innerHTML"],pl={key:0,class:"timetable-program-cell__actions"},yl="fluent:timer-16-filled",_l="mdi:timer-pause-outline",bl=Oe({__name:"TimeTableProgramCell",props:{program:{},channel:{},hourHeight:{},channelWidth:{},fullChannelWidth:{},viewportHeight:{},channelHeaderHeight:{},isScrollAtBottom:{type:Boolean},isSubchannel:{type:Boolean},isSplit:{type:Boolean},isSelected:{type:Boolean},isPast:{type:Boolean},is36HourDisplay:{type:Boolean},isNextReserved:{type:Boolean},resizeTrigger:{}},emits:["click","show-detail","quick-reserve"],setup(e,{emit:a}){const v=new Map;function s(d,R){const I=d.title,K=d.description;if(I===null||K===null)return We.decorateProgramInfo(d,R);const ne=v.get(d.id);if(ne===void 0||ne.raw_title!==I||ne.raw_description!==K){const ve=We.decorateProgramInfo(d,"title"),re=We.decorateProgramInfo(d,"description");v.set(d.id,{raw_title:I,raw_description:K,title:ve,description:re})}const se=v.get(d.id);return se===void 0?We.decorateProgramInfo(d,R):R==="title"?se.title:se.description}const t=e,m=a,u=at(),n=Ge(),i=S(!1),o=S(null),f=S(0),h=c(()=>(t.resizeTrigger,pe.isTouchDevice()?t.isSelected:t.isSelected||u.settings.timetable_hover_expand&&i.value)),P=c(()=>t.program.reservation!==null),q=c(()=>{var d;return((d=t.program.reservation)==null?void 0:d.status)==="Recording"}),T=c(()=>{var d;return((d=t.program.reservation)==null?void 0:d.status)==="Disabled"}),w=c(()=>{var d;return((d=t.program.reservation)==null?void 0:d.recording_availability)==="Partial"}),C=c(()=>{var d;return((d=t.program.reservation)==null?void 0:d.recording_availability)==="Unavailable"}),M=c(()=>u.settings.timetable_dim_shopping_programs===!1?!1:We.isShoppingProgram(t.program)),g=c(()=>C.value?"rgb(var(--v-theme-error))":w.value?"rgb(var(--v-theme-warning))":T.value?"rgb(var(--v-theme-text-darken-2))":"rgb(var(--v-theme-secondary))"),N=c(()=>T.value?_l:yl),j=c(()=>P.value?T.value?"mdi:timer-play-outline":"mdi:timer-pause-outline":"mdi:timer-plus-outline"),G=c(()=>{if(t.resizeTrigger,!P.value)return"録画予約";const d=u.settings.timetable_channel_width==="Narrow",R=u.settings.timetable_channel_width!=="Wide",I=pe.isSmartphoneVertical()&&R||(pe.isSmartphoneHorizontal()||pe.isTabletVertical())&&d;return T.value?I?"有効化":"予約を有効化":I?"無効化":"予約を無効化"}),X=c(()=>F(t.program.start_time).minute().toString().padStart(2,"0")),z=c(()=>{var I,K;const d=(K=(I=t.program.genres)==null?void 0:I[0])==null?void 0:K.major;return _e.getGenreColors(d,u.settings.timetable_genre_colors).highlight}),te=c(()=>{var I,K;if(C.value)return"#f8d7da";if(w.value)return"#fff3cd";const d=(K=(I=t.program.genres)==null?void 0:I[0])==null?void 0:K.major;return _e.getGenreColors(d,u.settings.timetable_genre_colors).background}),_=c(()=>{const d=F(t.program.start_time),R=n.getDisplayStartTime();return _e.calculateProgramY(d,R,t.hourHeight,t.channelHeaderHeight)-t.channelHeaderHeight}),B=c(()=>(t.is36HourDisplay?36:24)*t.hourHeight),L=c(()=>{const d=_e.calculateProgramHeight(t.program.duration,t.hourHeight);return _.value+d>B.value?Math.max(0,B.value-_.value):Math.max(d,20)}),ee=c(()=>{const d=t.fullChannelWidth??t.channelWidth,R=t.isSplit===!0&&t.channelWidth<d,I=h.value&&f.value>0?f.value:L.value,K=t.isSubchannel&&R?t.channelWidth:0,ne=h.value&&R?0:K,se=h.value&&R?d:t.channelWidth,ve={top:`${_.value}px`,left:`${ne}px`,width:`${se}px`,minHeight:`${L.value}px`,"--timetable-cell-height":`${I}px`,"--timetable-program-base-background":te.value,"--timetable-program-base-highlight":z.value};if(h.value||(ve.height=`${L.value}px`),h.value&&t.viewportHeight>0&&t.isScrollAtBottom===!0){const re=f.value>0?f.value:L.value,we=Math.max(0,B.value-t.viewportHeight),le=we+t.viewportHeight,ke=_.value+re,me=_.value+L.value>=B.value-1;if(ke>le&&me){const k=ke-le,b=Math.max(0,_.value-we),D=Math.min(k,b);D>0&&(ve.transform=`translateY(-${D}px)`)}}return ve}),oe=c(()=>s(t.program,"title")),ie=c(()=>s(t.program,"description"));function ae(){m("click")}function U(){i.value=!0}function y(){i.value=!1}function O(){m("quick-reserve")}return be(h,async d=>{if(d===!1){f.value=0;return}await He(),o.value!==null&&(f.value=Math.max(o.value.getBoundingClientRect().height,L.value))}),(d,R)=>{const I=tt("Icon");return Y(),Q("div",{class:et(["timetable-program-cell",{"timetable-program-cell--selected":e.isSelected,"timetable-program-cell--expanded":h.value,"timetable-program-cell--past":e.isPast,"timetable-program-cell--subchannel":e.isSubchannel,"timetable-program-cell--reserved":P.value,"timetable-program-cell--recording":q.value,"timetable-program-cell--partial":w.value,"timetable-program-cell--unavailable":C.value,"timetable-program-cell--disabled":T.value,"timetable-program-cell--shopping":M.value,"timetable-program-cell--next-reserved":P.value&&e.isNextReserved}]),ref_key:"cellRef",ref:o,style:fe(ee.value),onClick:ae,onMouseenter:U,onMouseleave:y},[R[2]||(R[2]=$("div",{class:"timetable-program-cell__highlight"},null,-1)),$("div",cl,[$("div",dl,[$("span",vl,xe(X.value),1),P.value?(Y(),Q("div",ml,[r(I,{icon:N.value,width:"14px",style:fe({color:g.value})},null,8,["icon","style"]),q.value?(Y(),Q("div",fl)):de("",!0),w.value?(Y(),ge(I,{key:1,icon:"fluent:warning-16-filled",width:"12px",class:"timetable-program-cell__warning-icon"})):de("",!0),C.value?(Y(),ge(I,{key:2,icon:"fluent:dismiss-circle-16-filled",width:"12px",class:"timetable-program-cell__error-icon"})):de("",!0)])):de("",!0)]),$("div",{class:"timetable-program-cell__title",innerHTML:oe.value},null,8,hl),$("div",{class:"timetable-program-cell__description",innerHTML:ie.value},null,8,gl),h.value?(Y(),Q("div",pl,[r(Z,{variant:"flat",size:"small",class:"timetable-program-cell__action-button",onClick:R[0]||(R[0]=Mt(K=>d.$emit("show-detail"),["stop"]))},{default:J(()=>[r(I,{icon:"fluent:info-12-regular",width:"16px"}),R[1]||(R[1]=$("span",null,"番組詳細",-1))]),_:1}),e.isPast?de("",!0):(Y(),ge(Z,{key:0,variant:"flat",size:"small",class:et(["timetable-program-cell__action-button",{"timetable-program-cell__action-button--reserved":P.value&&!T.value,"timetable-program-cell__action-button--disabled-reservation":T.value}]),onClick:Mt(O,["stop"])},{default:J(()=>[r(I,{icon:j.value,width:"16px"},null,8,["icon"]),$("span",null,xe(G.value),1)]),_:1},8,["class"]))])):de("",!0)])],38)}}}),It=Ae(bl,[["__scopeId","data-v-8603e6bf"]]),kl={class:"timetable-time-scale"},Sl=["data-hour"],Tl={class:"timetable-time-scale__label"},wl={key:0,class:"timetable-time-scale__date"},Dl={class:"timetable-time-scale__hour-number"},xl=Oe({__name:"TimeTableTimeScale",props:{hourHeight:{},is36HourDisplay:{type:Boolean}},setup(e){const a=e,v=at(),s=Ge(),t=c(()=>{const i=a.is36HourDisplay?36:24,o=s.display_start_time,f=[];for(let h=0;h<i;h++)f.push(o.add(h,"hour"));return f});function m(i){const o=i.hour();return v.settings.use_28hour_clock&&o>=0&&o<=3?(o+24).toString().padStart(2,"0"):o.toString().padStart(2,"0")}function u(i){const o=i.hour(),f=s.display_start_time;return!([0,4,8,12,16,20].includes(o)===!1||a.is36HourDisplay&&o===4&&f.hour()===4)}function n(i){return`${i.month()+1}/${i.date()}`}return(i,o)=>(Y(),Q("div",kl,[(Y(!0),Q(ye,null,Ie(t.value,f=>(Y(),Q("div",{class:"timetable-time-scale__hour",key:f.valueOf(),style:fe({height:`${a.hourHeight}px`}),"data-hour":f.hour()},[$("div",Tl,[u(f)?(Y(),Q("span",wl,xe(n(f)),1)):de("",!0),$("span",Dl,xe(m(f)),1),o[0]||(o[0]=$("span",{class:"timetable-time-scale__hour-label"},"時",-1))])],12,Sl))),128))]))}}),Cl=Ae(xl,[["__scopeId","data-v-fe795608"]]),Pl={class:"timetable-grid__channel-headers"},Hl={class:"timetable-grid__content"},Ml=2,Vl=3,Bl=.5,Rl=60,Il=2,Ol=500,Al=120,Ot=.95,Xe=.5,Ke=5,$l=100,El=Oe({__name:"TimeTableGrid",props:{channels:{},is36HourDisplay:{type:Boolean},canGoPreviousDay:{type:Boolean},canGoNextDay:{type:Boolean}},emits:["time-slot-change","date-display-offset-change","show-program-detail","quick-reserve","go-to-next-day","go-to-previous-day"],setup(e,{expose:a,emit:v}){const s=e,t=v,m=at(),u=Ge(),n=S(null),i=S(null),o=S(!1),f=S(!1);let h=0;const P=S(0),q=S(!1),T=S(0),w=S(0),C=S(0),M=S(0),g=S(null);let N=null,j=null;const G=S(0),X=new Set;let z=null,te=null,_=null;const B=S(0),L=S(0),ee=S(!1),oe=S(!1),ie=S(!1),ae=S(null),U=S(0),y=S(0),O=S(0),d=S(0),R=S(!1),I=S(!1),K=S(0),ne=S(0),se=S(0),ve=S(0),re=S(0),we=S(0),le=S(null),ke=c(()=>(B.value,_e.getDeviceType())),me=c(()=>_e.getChannelWidth(m.settings.timetable_channel_width,ke.value)),k=c(()=>_e.getHourHeight(m.settings.timetable_hour_height,ke.value)),b=c(()=>ke.value==="Smartphone"?Vl:Ml),D=c(()=>_e.getChannelHeaderHeight(me.value)),ue=c(()=>(B.value,_e.getTimeScaleWidth(ke.value,pe.isSmartphoneVertical()))),A=c(()=>s.channels.length*me.value),$e=c(()=>(s.is36HourDisplay?36:24)*k.value);function Ee(l){return l.subchannels===null||l.subchannels.length===0?!1:l.subchannels.some(p=>p.programs.length>0)}const De=new Map,Be=new Map;function Ye(l){if(l==null)return{start:0,end:0};const p=De.get(l.id);if(p!==void 0)return p;const H={start:F(l.start_time).valueOf(),end:F(l.end_time).valueOf()};return De.set(l.id,H),H}function ht(l,p){const H=Ye(l);return p.some(x=>{const W=Ye(x);return W.start<H.end&&W.end>H.start})}function it(l,p,H){const x=`${p.id}:${H?"sub":"main"}`,W=Be.get(x);if(W!==void 0)return W;const V=yt(l);if(V.length===0)return Be.set(x,!1),!1;if(H){const ce=ht(p,l.programs);return Be.set(x,ce),ce}const E=ht(p,V);return Be.set(x,E),E}function gt(l,p,H){return it(l,p,H)?me.value/2:me.value}function Re(l){const p=k.value*b.value;T.value=Math.max(0,l-p),w.value=l+P.value+p}function la(l){const H=k.value*b.value*Bl,x=l+P.value;return P.value<=0||w.value===0||l<T.value+H||x>w.value-H?(Re(l),!0):!1}function pt(l){const p=Ye(l),H=(p.start-G.value)/(1e3*60*60)*k.value;return(p.end-G.value)/(1e3*60*60)*k.value>=T.value&&H<=w.value}function na(l){return l.subchannels===null?[]:l.subchannels}function yt(l){return l.subchannels===null?[]:l.subchannels.flatMap(p=>p.programs)}function _t(l){return F(l.end_time).isBefore(F())}function bt(l,p,H){const x=H?yt(l):l.programs,W=F(p.end_time).valueOf(),V=x.find(E=>F(E.start_time).valueOf()===W);return V!==void 0&&V.reservation!==null}function kt(){if(n.value===null)return;C.value;const l=M.value;h=l;const p=n.value.clientHeight-D.value;P.value!==p&&(P.value=p);const H=n.value.scrollHeight-n.value.clientHeight,x=l>=H-1;q.value!==x&&(q.value=x),la(l)&&Ne();const V=l>H-100&&s.canGoNextDay,E=l<100&&s.canGoPreviousDay;o.value!==V&&(o.value=V),f.value!==E&&(f.value=E);const ce=u.getDisplayStartTime(),Se=Math.floor(l/k.value);let ot=ce.add(Se,"hour").hour();ot<4&&(ot+=24);const ga=Math.floor((ot-4)/4)*4+4,rt=Math.max(4,Math.min(24,ga));if(N!==rt&&(t("time-slot-change",rt),N=rt),s.is36HourDisplay){const pa=m.settings.use_28hour_clock?4:0;let je=ce.hour(pa).minute(0).second(0).millisecond(0);je.isSameOrBefore(ce)&&(je=je.add(1,"day"));const ya=(je.valueOf()-ce.valueOf())/(1e3*60*60)*k.value,ut=l>=ya?1:0;j!==ut&&(t("date-display-offset-change",ut),j=ut)}else j!==0&&(t("date-display-offset-change",0),j=0);St()}function ia(){g.value===null&&(g.value=requestAnimationFrame(()=>{g.value=null,kt()}))}function Ne(){_===null&&(_=requestAnimationFrame(()=>{_=null,Tt()}))}function St(){te===null&&(te=requestAnimationFrame(()=>{te=null,sa()}))}function Tt(){n.value!==null&&(z!==null&&(z.disconnect(),X.clear()),z=new IntersectionObserver(l=>{for(const p of l){const H=p.target,x=p.rootBounds;if(x===null)continue;const W=p.intersectionRect.top<=x.top,V=p.intersectionRect.height<p.boundingClientRect.height,E=x.height<p.boundingClientRect.height;if(p.isIntersecting&&W&&(V||E))X.add(H),H.classList.add("timetable-program-cell--fixed");else{X.delete(H),H.classList.remove("timetable-program-cell--fixed");const Se=H.querySelector(".timetable-program-cell__content");Se!==null&&(Se.style.paddingTop="")}}St()},{root:n.value,rootMargin:`-${D.value}px 0px 0px 0px`,threshold:[0,1]}),n.value.querySelectorAll(".timetable-program-cell").forEach(l=>{z==null||z.observe(l)}))}function sa(){if(n.value===null||X.size===0)return;const l=n.value.getBoundingClientRect().top+D.value;X.forEach(p=>{const H=p.querySelector(".timetable-program-cell__content");if(H===null)return;const x=p.getBoundingClientRect().top,W=l-x;if(W<=0){H.style.paddingTop="";return}const V=p.style.getPropertyValue("--timetable-cell-height"),E=V?Number.parseFloat(V):p.getBoundingClientRect().height,ce=Math.max(0,E-Rl),Se=p.classList.contains("timetable-program-cell--reserved")?3:0,Ht=Math.min(W,ce);H.style.paddingTop=`${Il+Math.max(Ht-Se,0)}px`})}let Pe=null;function wt(){Pe!==null&&clearTimeout(Pe),Pe=window.setTimeout(()=>{B.value++,Pe=null},$l)}function Dt(){L.value=performance.now()}function oa(){n.value!==null&&(C.value=n.value.scrollLeft,M.value=n.value.scrollTop,ia())}function xt(l){n.value!==null&&(le.value!==null&&(cancelAnimationFrame(le.value),le.value=null),l.deltaX!==0&&(l.preventDefault(),n.value.scrollLeft+=l.deltaX),l.shiftKey&&l.deltaY!==0?(l.preventDefault(),n.value.scrollLeft+=l.deltaY):l.deltaY!==0&&l.deltaX===0&&(l.preventDefault(),n.value.scrollTop+=l.deltaY))}function ra(l){var E;if(l.pointerType==="mouse"===!1)return;const H=((E=l.sourceCapabilities)==null?void 0:E.firesTouchEvents)===!0,W=performance.now()-L.value<=Ol;if(H||W||n.value===null)return;const V=l.target;V.closest(".v-btn")||V.closest("a")||(oe.value=!0,ee.value=!1,R.value=!1,U.value=l.clientX,y.value=l.clientY,O.value=n.value.scrollLeft,d.value=n.value.scrollTop,le.value!==null&&(cancelAnimationFrame(le.value),le.value=null),ne.value=0,se.value=0,ve.value=performance.now(),re.value=l.clientX,we.value=l.clientY)}function ua(l){if(l.pointerType!=="mouse"||oe.value===!1||n.value===null)return;const p=U.value-l.clientX,H=y.value-l.clientY;if((Math.abs(p)>Ke||Math.abs(H)>Ke)&&ee.value===!1&&n.value!==null&&(ee.value=!0,R.value=!0,n.value.setPointerCapture(l.pointerId),ie.value=!0,ae.value=l.pointerId),ee.value===!1)return;l.preventDefault(),(Math.abs(p)>Ke||Math.abs(H)>Ke)&&(R.value=!0),n.value.scrollLeft=O.value+p,n.value.scrollTop=d.value+H;const x=performance.now(),W=x-ve.value;if(W>0){const V=l.clientX-re.value,E=l.clientY-we.value;ne.value=-V/W*16,se.value=-E/W*16}ve.value=x,re.value=l.clientX,we.value=l.clientY}function Ct(l){if(l.pointerType==="mouse"&&oe.value!==!1){if(oe.value=!1,ee.value=!1,n.value!==null&&ie.value&&ae.value!==null)try{n.value.releasePointerCapture(ae.value)}catch{}ie.value=!1,ae.value=null,R.value?(da(),I.value=!0,K.value=performance.now()):(I.value=!1,K.value=0)}}function ca(l){if(I.value===!1)return;performance.now()-K.value<=Al&&(l.preventDefault(),l.stopPropagation()),I.value=!1}function da(){if(n.value===null||Math.abs(ne.value)<Xe&&Math.abs(se.value)<Xe)return;const l=()=>{if(n.value!==null){if(ne.value*=Ot,se.value*=Ot,n.value.scrollLeft+=ne.value,n.value.scrollTop+=se.value,Math.abs(ne.value)<Xe&&Math.abs(se.value)<Xe){le.value=null;return}le.value=requestAnimationFrame(l)}};le.value=requestAnimationFrame(l)}function Pt(l){i.value===l.id?i.value=null:i.value=l.id}function va(l){if(n.value===null)return;const H=u.getDisplayStartTime().hour();let W=(l===24?0:l)-H;W<0&&(W+=24);const V=W*k.value;n.value.scrollTo({top:V,behavior:"smooth"})}function ma(){const l=u.scroll_top_limit_time;if(l===null)return 0;const p=u.getDisplayStartTime(),x=(l.valueOf()-p.valueOf())/(1e3*60*60);return Math.max(0,x*k.value)}function st(l=!0,p=!1){if(n.value===null)return;const H=F(),x=u.getDisplayStartTime(),W=ma(),ce=(H.subtract(30,"minute").valueOf()-x.valueOf())/(1e3*60*60),Se=Math.max(W,ce*k.value);if(p){n.value.scrollTo({top:Se,behavior:l?"smooth":"instant"});return}if(W===0){n.value.scrollTo({top:0,behavior:"instant"});return}n.value.scrollTo({top:W,behavior:"instant"}),l&&setTimeout(()=>{n.value!==null&&n.value.scrollTo({top:Se,behavior:"smooth"})},50)}function fa(){n.value!==null&&n.value.scrollTo({top:0,behavior:"instant"})}function ha(){if(n.value===null)return;const l=n.value.scrollHeight-n.value.clientHeight;n.value.scrollTo({top:l,behavior:"instant"})}return a({scrollToHour:va,scrollToCurrentTime:st,scrollToStart:fa,scrollToEnd:ha}),lt(async()=>{window.addEventListener("resize",wt),n.value!==null&&n.value.addEventListener("wheel",xt,{passive:!1}),window.addEventListener("touchstart",Dt,{passive:!0}),await He(),n.value!==null&&(C.value=n.value.scrollLeft,M.value=n.value.scrollTop,kt(),Tt()),setTimeout(()=>{st(),Re(h)},100)}),xa(()=>{window.removeEventListener("resize",wt),window.removeEventListener("touchstart",Dt),Pe!==null&&(clearTimeout(Pe),Pe=null),n.value!==null&&n.value.removeEventListener("wheel",xt),g.value!==null&&cancelAnimationFrame(g.value),te!==null&&cancelAnimationFrame(te),_!==null&&cancelAnimationFrame(_),z!==null&&(z.disconnect(),z=null,X.clear()),le.value!==null&&cancelAnimationFrame(le.value)}),mt(()=>{le.value!==null&&cancelAnimationFrame(le.value)}),be(()=>s.channels,async(l,p)=>{De.clear(),Be.clear(),Re(h),Ne(),p.length===0&&l.length>0&&(await He(),setTimeout(()=>{st(),Ne()},100))},{deep:!1}),be([k,P],()=>{Re(h),Ne()}),be(D,()=>{Ne()}),be(()=>u.display_start_time,l=>{G.value=l.valueOf()},{immediate:!0}),(l,p)=>{const H=tt("Icon");return Y(),Q("div",{class:"timetable-grid",style:fe({"--timetable-channel-header-height":`${D.value}px`})},[$("div",{class:et(["timetable-grid__scroll-area",{"timetable-grid__scroll-area--dragging":ee.value}]),ref_key:"scrollAreaRef",ref:n,onScroll:oa,onPointerdown:ra,onPointermove:ua,onPointerup:Ct,onPointercancel:Ct,onClickCapture:ca},[$("div",{class:"timetable-grid__layout",style:fe({width:`${ue.value+A.value}px`,height:`${D.value+$e.value}px`})},[$("div",{class:"timetable-grid__header-row",style:fe({height:`${D.value}px`})},[$("div",{class:"timetable-grid__corner",style:fe({width:`${ue.value}px`})},null,4),$("div",Pl,[(Y(!0),Q(ye,null,Ie(e.channels,x=>(Y(),ge(sl,{key:x.channel.id,channel:x.channel,width:me.value,height:D.value,resizeTrigger:B.value},null,8,["channel","width","height","resizeTrigger"]))),128))])],4),$("div",{class:"timetable-grid__body-row",style:fe({height:`${$e.value}px`})},[$("div",{class:"timetable-grid__time-scale",style:fe({width:`${ue.value}px`})},[r(Cl,{hourHeight:k.value,is36HourDisplay:s.is36HourDisplay},null,8,["hourHeight","is36HourDisplay"])],4),$("div",Hl,[(Y(!0),Q(ye,null,Ie(e.channels,(x,W)=>(Y(),Q("div",{class:"timetable-grid__channel-column",key:x.channel.id,style:fe({left:`${W*me.value}px`,width:`${me.value}px`,height:`${$e.value}px`})},[$("div",{class:"timetable-grid__channel-background",style:fe({height:`${$e.value}px`})},null,4),(Y(!0),Q(ye,null,Ie(x.programs,V=>(Y(),Q(ye,{key:V.id},[pt(V)?(Y(),ge(It,{key:0,program:V,channel:x.channel,hourHeight:k.value,channelWidth:gt(x,V,!1),fullChannelWidth:me.value,isSplit:it(x,V,!1),viewportHeight:P.value,channelHeaderHeight:D.value,isScrollAtBottom:q.value,isSelected:i.value===V.id,isPast:_t(V),is36HourDisplay:s.is36HourDisplay,isNextReserved:bt(x,V,!1),resizeTrigger:B.value,onClick:E=>Pt(V),onShowDetail:E=>l.$emit("show-program-detail",V.id,x.channel,V),onQuickReserve:E=>l.$emit("quick-reserve",V.id,x.channel,V)},null,8,["program","channel","hourHeight","channelWidth","fullChannelWidth","isSplit","viewportHeight","channelHeaderHeight","isScrollAtBottom","isSelected","isPast","is36HourDisplay","isNextReserved","resizeTrigger","onClick","onShowDetail","onQuickReserve"])):de("",!0)],64))),128)),Ee(x)?(Y(!0),Q(ye,{key:0},Ie(na(x),V=>(Y(),Q(ye,{key:V.channel.id},[(Y(!0),Q(ye,null,Ie(V.programs,E=>(Y(),Q(ye,{key:E.id},[pt(E)?(Y(),ge(It,{key:0,program:E,channel:V.channel,hourHeight:k.value,channelWidth:gt(x,E,!0),fullChannelWidth:me.value,isSplit:it(x,E,!0),viewportHeight:P.value,channelHeaderHeight:D.value,isScrollAtBottom:q.value,isSubchannel:!0,isSelected:i.value===E.id,isPast:_t(E),is36HourDisplay:s.is36HourDisplay,isNextReserved:bt(x,E,!0),resizeTrigger:B.value,onClick:ce=>Pt(E),onShowDetail:ce=>l.$emit("show-program-detail",E.id,V.channel,E),onQuickReserve:ce=>l.$emit("quick-reserve",E.id,V.channel,E)},null,8,["program","channel","hourHeight","channelWidth","fullChannelWidth","isSplit","viewportHeight","channelHeaderHeight","isScrollAtBottom","isSelected","isPast","is36HourDisplay","isNextReserved","resizeTrigger","onClick","onShowDetail","onQuickReserve"])):de("",!0)],64))),128))],64))),128)):de("",!0)],4))),128)),r(ul,{hourHeight:k.value,totalWidth:A.value,channelHeaderHeight:D.value},null,8,["hourHeight","totalWidth","channelHeaderHeight"])])],4)],4)],34),r(Vt,{name:"fade"},{default:J(()=>[o.value?(Y(),ge(Z,{key:0,class:"timetable-grid__next-day-button",variant:"elevated",color:"background-lighten-1",onClick:p[0]||(p[0]=x=>l.$emit("go-to-next-day"))},{default:J(()=>[r(H,{icon:"fluent:chevron-down-20-regular",width:"20px"}),p[2]||(p[2]=$("span",null,"次の日を見る",-1))]),_:1})):de("",!0)]),_:1}),r(Vt,{name:"fade"},{default:J(()=>[f.value?(Y(),ge(Z,{key:0,class:"timetable-grid__prev-day-button",variant:"elevated",color:"background-lighten-1",onClick:p[1]||(p[1]=x=>l.$emit("go-to-previous-day"))},{default:J(()=>[r(H,{icon:"fluent:chevron-up-20-regular",width:"20px"}),p[3]||(p[3]=$("span",null,"前の日を見る",-1))]),_:1})):de("",!0)]),_:1})],4)}}}),Yl=Ae(El,[["__scopeId","data-v-4bfd07bf"]]),Qt=Te({active:{type:[String,Array],default:void 0},disabled:{type:[Boolean,String,Array],default:null},nextIcon:{type:Je,default:"$next"},prevIcon:{type:Je,default:"$prev"},modeIcon:{type:Je,default:"$subgroup"},text:String,viewMode:{type:String,default:"month"}},"VDatePickerControls"),At=Ce()({name:"VDatePickerControls",props:Qt(),emits:{"click:year":()=>!0,"click:month":()=>!0,"click:prev":()=>!0,"click:next":()=>!0,"click:text":()=>!0},setup(e,a){let{emit:v}=a;const s=c(()=>Array.isArray(e.disabled)?e.disabled.includes("text"):!!e.disabled),t=c(()=>Array.isArray(e.disabled)?e.disabled.includes("mode"):!!e.disabled),m=c(()=>Array.isArray(e.disabled)?e.disabled.includes("prev"):!!e.disabled),u=c(()=>Array.isArray(e.disabled)?e.disabled.includes("next"):!!e.disabled);function n(){v("click:prev")}function i(){v("click:next")}function o(){v("click:year")}function f(){v("click:month")}return Ve(()=>r("div",{class:["v-date-picker-controls"]},[r(Z,{class:"v-date-picker-controls__month-btn","data-testid":"month-btn",disabled:s.value,text:e.text,variant:"text",rounded:!0,onClick:f},null),r(Z,{class:"v-date-picker-controls__mode-btn","data-testid":"year-btn",disabled:t.value,density:"comfortable",icon:e.modeIcon,variant:"text",onClick:o},null),r(Qa,null,null),r("div",{class:"v-date-picker-controls__month"},[r(Z,{"data-testid":"prev-month",disabled:m.value,icon:e.prevIcon,variant:"text",onClick:n},null),r(Z,{"data-testid":"next-month",disabled:u.value,icon:e.nextIcon,variant:"text",onClick:i},null)])])),{}}}),Nl=Te({appendIcon:Je,color:String,header:String,transition:String,onClick:Ca()},"VDatePickerHeader"),$t=Ce()({name:"VDatePickerHeader",props:Nl(),emits:{click:()=>!0,"click:append":()=>!0},setup(e,a){let{emit:v,slots:s}=a;const{backgroundColorClasses:t,backgroundColorStyles:m}=ft(e,"color");function u(){v("click")}function n(){v("click:append")}return Ve(()=>{const i=!!(s.default||e.header),o=!!(s.append||e.appendIcon);return r("div",{class:["v-date-picker-header",{"v-date-picker-header--clickable":!!e.onClick},t.value],style:m.value,onClick:u},[s.prepend&&r("div",{key:"prepend",class:"v-date-picker-header__prepend"},[s.prepend()]),i&&r(Xt,{key:"content",name:e.transition},{default:()=>{var f;return[r("div",{key:e.header,class:"v-date-picker-header__content"},[((f=s.default)==null?void 0:f.call(s))??e.header])]}}),o&&r("div",{class:"v-date-picker-header__append"},[s.append?r(nt,{key:"append-defaults",disabled:!e.appendIcon,defaults:{VBtn:{icon:e.appendIcon,variant:"text"}}},{default:()=>{var f;return[(f=s.append)==null?void 0:f.call(s)]}}):r(Z,{key:"append-btn",icon:e.appendIcon,variant:"text",onClick:n},null)])])}),{}}}),Wl=Te({allowedDates:[Array,Function],disabled:{type:Boolean,default:null},displayValue:null,modelValue:Array,month:[Number,String],max:null,min:null,showAdjacentMonths:Boolean,year:[Number,String],weekdays:{type:Array,default:()=>[0,1,2,3,4,5,6]},weeksInMonth:{type:String,default:"dynamic"},firstDayOfWeek:[Number,String]},"calendar");function Ll(e){const a=Fe(),v=Me(e,"modelValue",[],T=>Ze(T).map(w=>a.date(w))),s=c(()=>e.displayValue?a.date(e.displayValue):v.value.length>0?a.date(v.value[0]):e.min?a.date(e.min):Array.isArray(e.allowedDates)?a.date(e.allowedDates[0]):a.date()),t=Me(e,"year",void 0,T=>{const w=T!=null?Number(T):a.getYear(s.value);return a.startOfYear(a.setYear(a.date(),w))},T=>a.getYear(T)),m=Me(e,"month",void 0,T=>{const w=T!=null?Number(T):a.getMonth(s.value),C=a.setYear(a.startOfMonth(a.date()),a.getYear(t.value));return a.setMonth(C,w)},T=>a.getMonth(T)),u=c(()=>e.firstDayOfWeek??e.weekdays[0]),n=c(()=>{const T=Number(e.firstDayOfWeek??0);return e.weekdays.map(w=>(w+T)%7)}),i=c(()=>{const T=a.getWeekArray(m.value,u.value),w=T.flat(),C=6*7;if(e.weeksInMonth==="static"&&w.length<C){const M=w[w.length-1];let g=[];for(let N=1;N<=C-w.length;N++)g.push(a.addDays(M,N)),N%7===0&&(T.push(g),g=[])}return T});function o(T,w){return T.filter(C=>n.value.includes(a.toJsDate(C).getDay())).map((C,M)=>{const g=a.toISO(C),N=!a.isSameMonth(C,m.value),j=a.isSameDay(C,a.startOfMonth(m.value)),G=a.isSameDay(C,a.endOfMonth(m.value)),X=a.isSameDay(C,m.value);return{date:C,isoDate:g,formatted:a.format(C,"keyboardDate"),year:a.getYear(C),month:a.getMonth(C),isDisabled:q(C),isWeekStart:M%7===0,isWeekEnd:M%7===6,isToday:a.isSameDay(C,w),isAdjacent:N,isHidden:N&&!e.showAdjacentMonths,isStart:j,isSelected:v.value.some(z=>a.isSameDay(C,z)),isEnd:G,isSame:X,localized:a.format(C,"dayOfMonth")}})}const f=c(()=>{const T=a.startOfWeek(s.value,e.firstDayOfWeek),w=[];for(let M=0;M<=6;M++)w.push(a.addDays(T,M));const C=a.date();return o(w,C)}),h=c(()=>{const T=i.value.flat(),w=a.date();return o(T,w)}),P=c(()=>i.value.map(T=>T.length?Pa(a,T[0]):null));function q(T){if(e.disabled)return!0;const w=a.date(T);return e.min&&a.isAfter(a.date(e.min),w)||e.max&&a.isAfter(w,a.date(e.max))?!0:Array.isArray(e.allowedDates)&&e.allowedDates.length>0?!e.allowedDates.some(C=>a.isSameDay(a.date(C),w)):typeof e.allowedDates=="function"?!e.allowedDates(w):!1}return{displayValue:s,daysInMonth:h,daysInWeek:f,genDays:o,model:v,weeksInMonth:i,weekDays:n,weekNumbers:P}}const Jt=Te({color:String,hideWeekdays:Boolean,multiple:[Boolean,Number,String],showWeek:Boolean,transition:{type:String,default:"picker-transition"},reverseTransition:{type:String,default:"picker-reverse-transition"},...ze(Wl(),["displayValue"])},"VDatePickerMonth"),Et=Ce()({name:"VDatePickerMonth",props:Jt(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=S(),{daysInMonth:m,model:u,weekNumbers:n}=Ll(e),i=Fe(),o=Ue(),f=Ue(),h=Ue(!1),P=c(()=>h.value?e.reverseTransition:e.transition);e.multiple==="range"&&u.value.length>0&&(o.value=u.value[0],u.value.length>1&&(f.value=u.value[u.value.length-1]));const q=c(()=>{const M=["number","string"].includes(typeof e.multiple)?Number(e.multiple):1/0;return u.value.length>=M});be(m,(M,g)=>{g&&(h.value=i.isBefore(M[0].date,g[0].date))});function T(M){const g=i.startOfDay(M);if(u.value.length===0?o.value=void 0:u.value.length===1&&(o.value=u.value[0],f.value=void 0),!o.value)o.value=g,u.value=[o.value];else if(f.value)o.value=M,f.value=void 0,u.value=[o.value];else{if(i.isSameDay(g,o.value)){o.value=void 0,u.value=[];return}else i.isBefore(g,o.value)?(f.value=i.endOfDay(o.value),o.value=g):f.value=i.endOfDay(g);const N=i.getDiff(f.value,o.value,"days"),j=[o.value];for(let G=1;G<N;G++){const X=i.addDays(o.value,G);j.push(X)}j.push(f.value),u.value=j}}function w(M){const g=u.value.findIndex(N=>i.isSameDay(N,M));if(g===-1)u.value=[...u.value,M];else{const N=[...u.value];N.splice(g,1),u.value=N}}function C(M){e.multiple==="range"?T(M):e.multiple?w(M):u.value=[M]}return()=>r("div",{class:"v-date-picker-month"},[e.showWeek&&r("div",{key:"weeks",class:"v-date-picker-month__weeks"},[!e.hideWeekdays&&r("div",{key:"hide-week-days",class:"v-date-picker-month__day"},[vt(" ")]),n.value.map(M=>r("div",{class:["v-date-picker-month__day","v-date-picker-month__day--adjacent"]},[M]))]),r(Xt,{name:P.value},{default:()=>{var M;return[r("div",{ref:t,key:(M=m.value[0].date)==null?void 0:M.toString(),class:"v-date-picker-month__days"},[!e.hideWeekdays&&i.getWeekdays(e.firstDayOfWeek).map(g=>r("div",{class:["v-date-picker-month__day","v-date-picker-month__weekday"]},[g])),m.value.map((g,N)=>{const j={props:{onClick:()=>C(g.date)},item:g,i:N};return q.value&&!g.isSelected&&(g.isDisabled=!0),r("div",{class:["v-date-picker-month__day",{"v-date-picker-month__day--adjacent":g.isAdjacent,"v-date-picker-month__day--hide-adjacent":g.isHidden,"v-date-picker-month__day--selected":g.isSelected,"v-date-picker-month__day--week-end":g.isWeekEnd,"v-date-picker-month__day--week-start":g.isWeekStart}],"data-v-date":g.isDisabled?void 0:g.isoDate},[(e.showAdjacentMonths||!g.isAdjacent)&&r(nt,{defaults:{VBtn:{class:"v-date-picker-month__day-btn",color:(g.isSelected||g.isToday)&&!g.isDisabled?e.color:void 0,disabled:g.isDisabled,icon:!0,ripple:!1,text:g.localized,variant:g.isDisabled?g.isToday?"outlined":"text":g.isToday&&!g.isSelected?"outlined":"flat",onClick:()=>C(g.date)}}},{default:()=>{var G;return[((G=s.day)==null?void 0:G.call(s,j))??r(Z,j.props,null)]}})])})])]}})])}}),Zt=Te({color:String,height:[String,Number],min:null,max:null,modelValue:Number,year:Number},"VDatePickerMonths"),Yt=Ce()({name:"VDatePickerMonths",props:Zt(),emits:{"update:modelValue":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=Fe(),m=Me(e,"modelValue"),u=c(()=>{let n=t.startOfYear(t.date());return e.year&&(n=t.setYear(n,e.year)),Ft(12).map(i=>{const o=t.format(n,"monthShort"),f=!!(e.min&&t.isAfter(t.startOfMonth(t.date(e.min)),n)||e.max&&t.isAfter(n,t.startOfMonth(t.date(e.max))));return n=t.getNextMonth(n),{isDisabled:f,text:o,value:i}})});return Gt(()=>{m.value=m.value??t.getMonth(t.date())}),Ve(()=>r("div",{class:"v-date-picker-months",style:{height:jt(e.height)}},[r("div",{class:"v-date-picker-months__content"},[u.value.map((n,i)=>{var h;const o={active:m.value===i,color:m.value===i?e.color:void 0,disabled:n.isDisabled,rounded:!0,text:n.text,variant:m.value===n.value?"flat":"text",onClick:()=>f(i)};function f(P){if(m.value===P){v("update:modelValue",m.value);return}m.value=P}return((h=s.month)==null?void 0:h.call(s,{month:n,i,props:o}))??r(Z,he({key:"month"},o),null)})])])),{}}}),ea=Te({color:String,height:[String,Number],min:null,max:null,modelValue:Number},"VDatePickerYears"),Nt=Ce()({name:"VDatePickerYears",props:ea(),emits:{"update:modelValue":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=Fe(),m=Me(e,"modelValue"),u=c(()=>{const i=t.getYear(t.date());let o=i-100,f=i+52;e.min&&(o=t.getYear(t.date(e.min))),e.max&&(f=t.getYear(t.date(e.max)));let h=t.startOfYear(t.date());return h=t.setYear(h,o),Ft(f-o+1,o).map(P=>{const q=t.format(h,"year");return h=t.setYear(h,t.getYear(h)+1),{text:q,value:P}})});Gt(()=>{m.value=m.value??t.getYear(t.date())});const n=Ha();return lt(async()=>{var i;await He(),(i=n.el)==null||i.scrollIntoView({block:"center"})}),Ve(()=>r("div",{class:"v-date-picker-years",style:{height:jt(e.height)}},[r("div",{class:"v-date-picker-years__content"},[u.value.map((i,o)=>{var h;const f={ref:m.value===i.value?n:void 0,active:m.value===i.value,color:m.value===i.value?e.color:void 0,rounded:!0,text:i.text,variant:m.value===i.value?"flat":"text",onClick:()=>{if(m.value===i.value){v("update:modelValue",m.value);return}m.value=i.value}};return((h=s.year)==null?void 0:h.call(s,{year:i,i:o,props:f}))??r(Z,he({key:"month"},f),null)})])])),{}}}),Ul=Ja("v-picker-title"),ta=Te({color:String,...Fa(),...za(),...Ua(),...La(),...Wa(),...Na(),...Ya(),...Ea(),...$a()},"VSheet"),Wt=Ce()({name:"VSheet",props:ta(),setup(e,a){let{slots:v}=a;const{themeClasses:s}=Ma(e),{backgroundColorClasses:t,backgroundColorStyles:m}=ft(qt(e,"color")),{borderClasses:u}=Va(e),{dimensionStyles:n}=Ba(e),{elevationClasses:i}=Ra(e),{locationStyles:o}=Ia(e),{positionClasses:f}=Oa(e),{roundedClasses:h}=Aa(e);return Ve(()=>r(e.tag,{class:["v-sheet",s.value,t.value,u.value,i.value,f.value,h.value,e.class],style:[m.value,n.value,o.value,e.style]},v)),{}}}),aa=Te({bgColor:String,landscape:Boolean,title:String,hideHeader:Boolean,...ta()},"VPicker"),Lt=Ce()({name:"VPicker",props:aa(),setup(e,a){let{slots:v}=a;const{backgroundColorClasses:s,backgroundColorStyles:t}=ft(qt(e,"color"));return Ve(()=>{const m=Wt.filterProps(e),u=!!(e.title||v.title);return r(Wt,he(m,{color:e.bgColor,class:["v-picker",{"v-picker--landscape":e.landscape,"v-picker--with-actions":!!v.actions},e.class],style:e.style}),{default:()=>{var n;return[!e.hideHeader&&r("div",{key:"header",class:[s.value],style:[t.value]},[u&&r(Ul,{key:"picker-title"},{default:()=>{var i;return[((i=v.title)==null?void 0:i.call(v))??e.title]}}),v.header&&r("div",{class:"v-picker__header"},[v.header()])]),r("div",{class:"v-picker__body"},[(n=v.default)==null?void 0:n.call(v)]),v.actions&&r(nt,{defaults:{VBtn:{slim:!0,variant:"text"}}},{default:()=>[r("div",{class:"v-picker__actions"},[v.actions()])]})]}})}),{}}}),zl=Te({header:{type:String,default:"$vuetify.datePicker.header"},...Qt(),...Jt({weeksInMonth:"static"}),...ze(Zt(),["modelValue"]),...ze(ea(),["modelValue"]),...aa({title:"$vuetify.datePicker.title"}),modelValue:null},"VDatePicker"),Ut=Ce()({name:"VDatePicker",props:zl(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0,"update:viewMode":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=Fe(),{t:m}=Ga(),u=Me(e,"modelValue",void 0,_=>Ze(_).map(B=>t.date(B)),_=>e.multiple?_:_[0]),n=Me(e,"viewMode"),i=c(()=>{const _=t.date(e.min);return e.min&&t.isValid(_)?_:null}),o=c(()=>{const _=t.date(e.max);return e.max&&t.isValid(_)?_:null}),f=c(()=>{var L;const _=t.date();let B=_;return(L=u.value)!=null&&L[0]?B=t.date(u.value[0]):i.value&&t.isBefore(_,i.value)?B=i.value:o.value&&t.isAfter(_,o.value)&&(B=o.value),B&&t.isValid(B)?B:_}),h=S(Number(e.month??t.getMonth(t.startOfMonth(f.value)))),P=S(Number(e.year??t.getYear(t.startOfYear(t.setMonth(f.value,h.value))))),q=Ue(!1),T=c(()=>e.multiple&&u.value.length>1?m("$vuetify.datePicker.itemsSelected",u.value.length):u.value[0]&&t.isValid(u.value[0])?t.format(t.date(u.value[0]),"normalDateWithWeekday"):m(e.header)),w=c(()=>{let _=t.date();return _=t.setDate(_,1),_=t.setMonth(_,h.value),_=t.setYear(_,P.value),t.format(_,"monthAndYear")}),C=c(()=>`date-picker-header${q.value?"-reverse":""}-transition`),M=c(()=>{if(e.disabled)return!0;const _=[];if(n.value!=="month")_.push("prev","next");else{let B=t.date();if(B=t.startOfMonth(B),B=t.setMonth(B,h.value),B=t.setYear(B,P.value),i.value){const L=t.addDays(t.startOfMonth(B),-1);t.isAfter(i.value,L)&&_.push("prev")}if(o.value){const L=t.addDays(t.endOfMonth(B),1);t.isAfter(L,o.value)&&_.push("next")}}return _});function g(){h.value<11?h.value++:(P.value++,h.value=0,te(P.value)),z(h.value)}function N(){h.value>0?h.value--:(P.value--,h.value=11,te(P.value)),z(h.value)}function j(){n.value="month"}function G(){n.value=n.value==="months"?"month":"months"}function X(){n.value=n.value==="year"?"month":"year"}function z(_){n.value==="months"&&G(),v("update:month",_)}function te(_){n.value==="year"&&X(),v("update:year",_)}return be(u,(_,B)=>{const L=Ze(B),ee=Ze(_);if(!ee.length)return;const oe=t.date(L[L.length-1]),ie=t.date(ee[ee.length-1]),ae=t.getMonth(ie),U=t.getYear(ie);ae!==h.value&&(h.value=ae,z(h.value)),U!==P.value&&(P.value=U,te(P.value)),q.value=t.isBefore(oe,ie)}),Ve(()=>{const _=Lt.filterProps(e),B=At.filterProps(e),L=$t.filterProps(e),ee=Et.filterProps(e),oe=ze(Yt.filterProps(e),["modelValue"]),ie=ze(Nt.filterProps(e),["modelValue"]),ae={header:T.value,transition:C.value};return r(Lt,he(_,{class:["v-date-picker",`v-date-picker--${n.value}`,{"v-date-picker--show-week":e.showWeek},e.class],style:e.style}),{title:()=>{var U;return((U=s.title)==null?void 0:U.call(s))??r("div",{class:"v-date-picker__title"},[m(e.title)])},header:()=>s.header?r(nt,{defaults:{VDatePickerHeader:{...ae}}},{default:()=>{var U;return[(U=s.header)==null?void 0:U.call(s,ae)]}}):r($t,he({key:"header"},L,ae,{onClick:n.value!=="month"?j:void 0}),{...s,default:void 0}),default:()=>r(ye,null,[r(At,he(B,{disabled:M.value,text:w.value,"onClick:next":g,"onClick:prev":N,"onClick:month":G,"onClick:year":X}),null),r(Za,{hideOnLeave:!0},{default:()=>[n.value==="months"?r(Yt,he({key:"date-picker-months"},oe,{modelValue:h.value,"onUpdate:modelValue":[U=>h.value=U,z],min:i.value,max:o.value,year:P.value}),null):n.value==="year"?r(Nt,he({key:"date-picker-years"},ie,{modelValue:P.value,"onUpdate:modelValue":[U=>P.value=U,te],min:i.value,max:o.value}),null):r(Et,he({key:"date-picker-month"},ee,{modelValue:u.value,"onUpdate:modelValue":U=>u.value=U,month:h.value,"onUpdate:month":[U=>h.value=U,z],year:P.value,"onUpdate:year":[U=>P.value=U,te],min:i.value,max:o.value}),null)]})]),actions:s.actions})}),{}}}),Fl={class:"route-container"},Gl={class:"timetable-controls"},jl={class:"timetable-controls__date"},ql={key:0,class:"timetable-controls-mobile"},Xl={class:"timetable-controls-mobile__inner"},Kl={class:"timetable-controls-mobile__date"},Ql=100,Jl=Oe({__name:"TimeTable",setup(e){const a=Ge(),v=S(null),s=Ka(),t=c(()=>s.server_settings),m=c(()=>s.is_loaded===!0&&t.value.general.backend==="EDCB");let u=null;async function n(){if(m.value===!1)return structuredClone(Bt);if(u!==null)return structuredClone(u);const k=await Le.fetchRecordingPresets();if(k!==null){const b=k.presets.find(D=>D.id===0);if(b)return u=b.record_settings,structuredClone(b.record_settings)}return structuredClone(Bt)}const i=S(!1),o=S(!1),f=S(0);let h=null;function P(){h!==null&&clearTimeout(h),h=window.setTimeout(()=>{f.value++,h=null},Ql)}const q=c(()=>(f.value,pe.isSmartphoneVertical()||pe.isSmartphoneHorizontal()||pe.isTabletVertical())),T=c(()=>(f.value,!pe.isSmartphoneVertical())),w=c(()=>a.date_display_offset),C=S(!1),M=S(null),g=S(null),N=S(null),j=S(!1),G=c(()=>{const k=[],b=a.available_channel_types;for(const D of Kt)b.has(D)&&k.push({title:D,value:D});return k}),X=c({get:()=>a.selected_channel_type,set:k=>{a.changeChannelType(k)}}),z=c(()=>{const k=[],b=a.is_36hour_display&&w.value===0;for(let D=4;D<=24;D+=4){const ue=D,A=D<=12;k.push({title:`${ue.toString().padStart(2,"0")}時`,value:D,...b&&A?{props:{disabled:!0}}:{}})}return k});function te(){let b=F().hour();return b<4&&(b+=24),Math.floor((b-4)/4)*4+4}const _=S(te()),B=c(()=>{const k=a.selected_date.add(w.value,"day"),b=k.month()+1,D=k.date(),ue=["日","月","火","水","木","金","土"][k.day()];return`${b}/${D} (${ue})`}),L=c({get:()=>a.selected_date.toDate(),set:k=>{const b=F(k).hour(4).minute(0).second(0).millisecond(0);a.changeDate(b)}}),ee=c(()=>a.can_go_previous_day),oe=c(()=>a.can_go_next_day),ie=c(()=>a.date_range===null?void 0:a.getBroadcastDate(a.date_range.earliest).startOf("day").toDate()),ae=c(()=>a.date_range===null?void 0:a.getBroadcastDate(a.date_range.latest).endOf("day").toDate());function U(k){if(a.date_range===null)return!1;const b=F(k),D=a.getBroadcastDate(a.date_range.earliest),ue=a.getBroadcastDate(a.date_range.latest);return b.isSameOrAfter(D,"day")&&b.isSameOrBefore(ue,"day")}function y(k){a.changeChannelType(k)}function O(k){o.value=!1;const b=F(k).hour(4).minute(0).second(0).millisecond(0);a.changeDate(b)}function d(k){k===null||v.value===null||v.value.scrollToHour(k)}async function R(){await a.goToPreviousDay(),await He(),v.value!==null&&v.value.scrollToEnd()}async function I(){await a.goToNextDay(),await He(),v.value!==null&&v.value.scrollToStart()}async function K(){await a.goToCurrentTime(),await He(),v.value!==null&&v.value.scrollToCurrentTime(!0,!0)}function ne(k){const b=Math.floor((k-4)/4)*4+4,D=Math.max(4,Math.min(24,b));_.value=D}function se(k){a.setDateDisplayOffset(k)}async function ve(k,b,D){const ue=F(D.end_time);if(j.value=ue.isBefore(F()),D.reservation!==null){const A=await Le.fetchReservation(D.reservation.id);A!==null?(M.value=A,g.value=null,N.value=null):(M.value=await re(D,b),g.value=null,N.value=null)}else M.value=await re(D,b),g.value=null,N.value=null;C.value=!0}async function re(k,b){return{id:-1,channel:b,program:k,is_recording_in_progress:!1,recording_availability:"Full",comment:"",scheduled_recording_file_name:"",estimated_recording_file_size:0,record_settings:await n()}}async function we(){await a.fetchTimeTableData()}async function le(){await a.fetchTimeTableData()}async function ke(){await a.fetchTimeTableData()}async function me(k,b,D){if(F(D.end_time).isBefore(F()))return;if(m.value===!1){ct.warning("録画予約機能は EDCB バックエンド選択時のみ利用できます。");return}if(D.reservation!==null){const Ee=await Le.fetchReservation(D.reservation.id);if(Ee===null)return;const De=structuredClone(Ee.record_settings);if(De.is_enabled=!De.is_enabled,await Le.updateReservation(Ee.id,De)!==null){const Ye=De.is_enabled?`録画予約を有効にしました。
番組開始時刻になると自動的に録画が開始されます。`:`録画予約を無効にしました。
番組開始時刻までに再度予約を有効にしない限り、この番組は録画されません。`;ct.success(Ye),await a.fetchTimeTableData()}return}const A=await n();await Le.addReservation(k,A)&&(ct.success("録画予約を追加しました。"),await a.fetchTimeTableData())}return lt(async()=>{window.addEventListener("resize",P),await s.fetchServerSettingsOnce(),await a.initialLoad()}),mt(()=>{window.removeEventListener("resize",P),h!==null&&(clearTimeout(h),h=null),a.reset()}),be(()=>a.selected_date,()=>{a.setDateDisplayOffset(0)}),(k,b)=>{const D=tt("Icon"),ue=zt("ftooltip");return Y(),Q("div",Fl,[r(_a,null,ja({_:2},[q.value?void 0:{name:"timetable-controls",fn:J(()=>[$("div",Gl,[r(qe,{class:"timetable-controls__channel-type",variant:"outlined",density:"compact","hide-details":"",items:G.value,modelValue:X.value,"onUpdate:modelValue":[b[0]||(b[0]=A=>X.value=A),y]},null,8,["items","modelValue"]),$("div",jl,[r(Z,{variant:"flat",icon:"",size:"small",disabled:!ee.value,onClick:R},{default:J(()=>[r(D,{icon:"fluent:chevron-left-20-regular",width:"20px"})]),_:1},8,["disabled"]),r(Rt,{modelValue:o.value,"onUpdate:modelValue":b[2]||(b[2]=A=>o.value=A),"close-on-content-click":!1},{activator:J(({props:A})=>[r(Z,he({variant:"flat",class:"timetable-controls__date-button"},A),{default:J(()=>[vt(xe(B.value),1)]),_:1},16)]),default:J(()=>[r(Ut,{modelValue:L.value,"onUpdate:modelValue":[b[1]||(b[1]=A=>L.value=A),O],color:"primary",min:ie.value,max:ae.value,"allowed-dates":U},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"]),r(Z,{variant:"flat",icon:"",size:"small",disabled:!oe.value,onClick:I},{default:J(()=>[r(D,{icon:"fluent:chevron-right-20-regular",width:"20px"})]),_:1},8,["disabled"])]),r(qe,{class:"timetable-controls__time",variant:"outlined",density:"compact","hide-details":"",items:z.value,modelValue:_.value,"onUpdate:modelValue":[b[3]||(b[3]=A=>_.value=A),d]},null,8,["items","modelValue"]),dt((Y(),ge(Z,{variant:"flat",class:"timetable-controls__now-button",icon:"",onClick:K},{default:J(()=>[r(D,{icon:"fluent:clock-20-regular",width:"22px"})]),_:1})),[[ue,"現在時刻に移動",void 0,{bottom:!0}]]),dt((Y(),ge(Z,{variant:"flat",class:"timetable-controls__settings-button",icon:"",onClick:b[4]||(b[4]=A=>i.value=!0)},{default:J(()=>[r(D,{icon:"fluent:settings-20-regular",width:"22px"})]),_:1})),[[ue,"番組表の表示設定",void 0,{bottom:!0}]])])]),key:"0"}]),1024),$("main",null,[r(ba,{"icon-only":T.value},null,8,["icon-only"]),$("div",{class:et(["timetable-container",{"timetable-container--loading":Qe(a).is_loading}])},[r(ka),q.value?(Y(),Q("div",ql,[$("div",Xl,[r(qe,{class:"timetable-controls-mobile__channel-type",variant:"outlined",density:"compact","hide-details":"",items:G.value,modelValue:X.value,"onUpdate:modelValue":[b[5]||(b[5]=A=>X.value=A),y]},null,8,["items","modelValue"]),$("div",Kl,[r(Rt,{modelValue:o.value,"onUpdate:modelValue":b[7]||(b[7]=A=>o.value=A),"close-on-content-click":!1},{activator:J(({props:A})=>[r(Z,he({variant:"flat",class:"timetable-controls-mobile__date-button",size:"small"},A),{default:J(()=>[vt(xe(B.value),1)]),_:1},16)]),default:J(()=>[r(Ut,{modelValue:L.value,"onUpdate:modelValue":[b[6]||(b[6]=A=>L.value=A),O],color:"primary",min:ie.value,max:ae.value,"allowed-dates":U},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"])]),r(qe,{class:"timetable-controls-mobile__time",variant:"outlined",density:"compact","hide-details":"",items:z.value,modelValue:_.value,"onUpdate:modelValue":[b[8]||(b[8]=A=>_.value=A),d]},null,8,["items","modelValue"]),r(Z,{variant:"flat",class:"timetable-controls-mobile__now-button",icon:"",size:"small",onClick:K},{default:J(()=>[r(D,{icon:"fluent:clock-20-regular",width:"18px"})]),_:1}),r(Z,{variant:"flat",class:"timetable-controls-mobile__settings-button",icon:"",size:"small",onClick:b[9]||(b[9]=A=>i.value=!0)},{default:J(()=>[r(D,{icon:"fluent:settings-20-regular",width:"18px"})]),_:1})])])):de("",!0),r(Yl,{ref_key:"timetableGridRef",ref:v,channels:Qe(a).channels_data,is36HourDisplay:Qe(a).is_36hour_display,canGoPreviousDay:ee.value,canGoNextDay:oe.value,onTimeSlotChange:ne,onDateDisplayOffsetChange:se,onShowProgramDetail:ve,onQuickReserve:me,onGoToNextDay:I,onGoToPreviousDay:R},null,8,["channels","is36HourDisplay","canGoPreviousDay","canGoNextDay"])],2)]),r(Ta,{isOpen:i.value,"onUpdate:isOpen":b[10]||(b[10]=A=>i.value=A)},null,8,["isOpen"]),r(Sa,{modelValue:C.value,"onUpdate:modelValue":b[11]||(b[11]=A=>C.value=A),reservation:M.value,program:g.value,channel:N.value,isPastProgram:j.value,onAdded:we,onUpdated:le,onDeleted:ke},null,8,["modelValue","reservation","program","channel","isPastProgram"])])}}}),pn=Ae(Jl,[["__scopeId","data-v-9aa6413a"]]);export{pn as default};
