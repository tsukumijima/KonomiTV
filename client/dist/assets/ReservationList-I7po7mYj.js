import{d as P,q as h,s as b,w as T,c as d,n as B,b as s,t as c,a as v,B as _,P as V,h as I,l as $,r as U,U as k,e as g,M as E,o,R as z,_ as H,k as M,F as S,V as D,g as O}from"./index-C90hjLTU.js";import{R as F}from"./ServerSettingsStore-vpXqLwW5.js";import{V as N}from"./VSwitch-DhhO6NGN.js";import{c as q}from"./VChip-CD6qvBgt.js";import{R as j}from"./ReservationDetailDrawer-ShI1R4Va.js";import{c as A}from"./VSelect-CWOpdxGi.js";import{V as G}from"./VPagination-Dfjl2-E6.js";const J={class:"reservation__container"},K={class:"reservation__controls"},Q={class:"reservation__priority"},W={class:"reservation__priority-badge"},X={class:"reservation__toggle-label"},Y={key:1,class:"reservation__recording"},Z={class:"reservation__content"},ee={class:"reservation__content-header"},te=["innerHTML"],se={class:"reservation__content-status"},ae={class:"reservation__content-meta"},ne={class:"reservation__content-meta-broadcaster"},ie=["src"],oe={class:"reservation__content-meta-broadcaster-name"},re={class:"reservation__content-meta-time"},le={class:"reservation__content-meta-size-comment"},ce={key:0,class:"reservation__content-meta-comment"},de={class:"reservation__content-meta-comment-text"},ve={class:"reservation__content-meta-size"},ue={class:"reservation__content-meta-time-pc"},me={class:"reservation__content-description-container"},_e=["innerHTML"],ge={class:"reservation__content-description-size-pc"},he=P({__name:"Reservation",props:{reservation:{}},emits:["deleted","click"],setup(t,{emit:C}){const n=t,y=C,r=h(n.reservation.record_settings.is_enabled),u=h(!1);b(()=>n.reservation.record_settings.is_enabled,e=>{r.value=e});const m=e=>{const a=e.target;a.src=`${k.api_base_url}/channels/gr001/logo`},f=e=>{if(e.is_recording_in_progress)return"録画中";switch(e.recording_availability){case"Full":return"録画可能";case"Partial":return"一部のみ録画可能";case"Unavailable":return"チューナー不足";default:return"不明"}},p=e=>{if(e.is_recording_in_progress)return"fluent:record-16-filled";switch(e.recording_availability){case"Full":return"fluent:checkmark-16-filled";case"Partial":return"fluent:warning-16-filled";case"Unavailable":return"fluent:dismiss-circle-16-filled";default:return"fluent:question-circle-16-filled"}},R=e=>{if(e.is_recording_in_progress)return"primary";switch(e.recording_availability){case"Full":return"success";case"Partial":return"warning";case"Unavailable":return"error";default:return"grey"}},L=()=>{y("click",n.reservation)},w=async()=>{if(!u.value){u.value=!0;try{const e={...n.reservation.record_settings,is_enabled:r.value};if(await F.updateReservation(n.reservation.id,e)){const l=r.value?`録画予約を有効にしました。
番組開始時刻になると自動的に録画が開始されます。`:`録画予約を無効にしました。
番組開始時刻までに再度予約を有効にしない限り、この番組は録画されません。`;E.success(l)}else r.value=n.reservation.record_settings.is_enabled}catch(e){console.error("Failed to update reservation:",e),r.value=n.reservation.record_settings.is_enabled}finally{u.value=!1}}},x=e=>{e.stopPropagation()};return(e,a)=>{const l=U("Icon");return T((o(),d("div",{class:B(["reservation",{"reservation--disabled":!r.value}]),onClick:L},[s("div",J,[s("div",K,[s("div",Q,[s("div",W,c(t.reservation.record_settings.priority),1),a[1]||(a[1]=s("div",{class:"reservation__priority-label"},"優先度",-1))]),t.reservation.is_recording_in_progress?(o(),d("div",Y,[...a[2]||(a[2]=[s("div",{class:"reservation__recording-icon"},null,-1)])])):(o(),d("div",{key:0,class:"reservation__toggle",onClick:x},[v(N,{modelValue:r.value,"onUpdate:modelValue":[a[0]||(a[0]=i=>r.value=i),w],color:"primary",density:"compact","hide-details":"",onClick:x},null,8,["modelValue"]),s("div",X,c(r.value?"有効":"無効"),1)]))]),s("div",Z,[s("div",ee,[s("div",{class:"reservation__content-title",innerHTML:_(V).decorateProgramInfo(t.reservation.program,"title")},null,8,te),s("div",se,[v(q,{color:R(t.reservation),size:"small",variant:"tonal"},{default:I(()=>[v(l,{icon:p(t.reservation),width:"12px",height:"12px",class:"mr-1"},null,8,["icon"]),$(" "+c(f(t.reservation)),1)]),_:1},8,["color"])])]),s("div",ae,[s("div",ne,[s("img",{class:"reservation__content-meta-broadcaster-icon",loading:"lazy",decoding:"async",src:`${_(k).api_base_url}/channels/${t.reservation.channel.id}/logo`,onError:m},null,40,ie),s("span",oe,"Ch: "+c(t.reservation.channel.channel_number)+" "+c(t.reservation.channel.name),1)]),s("div",re,c(_(V).getProgramTime(t.reservation.program)),1),s("div",le,[t.reservation.comment?(o(),d("div",ce,[v(l,{icon:"fluent:note-20-filled",width:"14px",height:"14px",class:"reservation__content-meta-comment-icon"}),s("span",de,c(t.reservation.comment),1)])):g("",!0),s("div",ve,[v(l,{icon:"fluent:hard-drive-20-filled",width:"14px",height:"14px",class:"reservation__content-meta-size-icon"}),$(" 約 "+c(_(k).formatBytes(t.reservation.estimated_recording_file_size,1,!0)),1)])]),s("div",ue,c(_(V).getProgramTime(t.reservation.program)),1)]),s("div",me,[s("div",{class:"reservation__content-description",innerHTML:_(V).decorateProgramInfo(t.reservation.program,"description")},null,8,_e),s("div",ge,[v(l,{icon:"fluent:hard-drive-20-filled",width:"14px",height:"14px",class:"reservation__content-description-size-icon"}),$(" 約 "+c(_(k).formatBytes(t.reservation.estimated_recording_file_size,1,!0)),1)])])])])],2)),[[z]])}}}),fe=H(he,[["__scopeId","data-v-44317a9b"]]),ye={key:0,class:"reservation-list__header"},pe={class:"reservation-list__title"},be={class:"reservation-list__title-text"},ke={key:1,class:"reservation-list__title-count"},we={class:"reservation-list__actions"},xe={class:"reservation-list__empty-content"},Ve=["innerHTML"],Me=["innerHTML"],Be={class:"reservation-list__grid-content"},$e={key:1,class:"reservation-list__pagination"},Ce=P({__name:"ReservationList",props:{title:{},reservations:{},total:{},page:{default:1},sortOrder:{default:"desc"},hideHeader:{type:Boolean,default:!1},hideSort:{type:Boolean,default:!1},hidePagination:{type:Boolean,default:!1},showMoreButton:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:timer-20-regular"},emptyMessage:{default:"まだ録画予約がありません。"},emptySubMessage:{default:"番組表から録画予約を追加できます。"},isLoading:{type:Boolean,default:!1}},emits:["update:page","update:sortOrder","more","delete"],setup(t,{emit:C}){const n=t,y=h(n.page),r=h(n.sortOrder),u=h([...n.reservations]),m=h(n.total),f=h(!1),p=h(null);b(()=>n.page,e=>{y.value=e}),b(()=>n.sortOrder,e=>{r.value=e}),b(()=>n.reservations,e=>{u.value=[...e]}),b(()=>n.total,e=>{m.value=e});const R=C,L=e=>{p.value=e,f.value=!0},w=e=>{u.value=u.value.filter(a=>a.id!==e),m.value=Math.max(0,m.value-1),f.value=!1,R("delete",e)},x=e=>{const a=u.value.findIndex(l=>l.id===e.id);a!==-1&&(u.value[a]=e),p.value=e};return(e,a)=>{const l=U("Icon");return o(),d("div",{class:B(["reservation-list",{"reservation-list--show-sort":!t.hideSort}])},[t.hideHeader?g("",!0):(o(),d("div",ye,[s("h2",pe,[t.showBackButton?T((o(),d("div",{key:0,class:"reservation-list__title-back",onClick:a[0]||(a[0]=i=>e.$router.back())},[v(l,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[z]]):g("",!0),s("span",be,c(t.title),1),t.showMoreButton?g("",!0):(o(),d("div",ke,[t.isLoading?(o(),M(l,{key:0,icon:"line-md:loading-twotone-loop",class:"mr-1 spin",width:"20px",height:"20px"})):(o(),d(S,{key:1},[$(c(m.value)+"件",1)],64))]))]),s("div",we,[t.hideSort?g("",!0):(o(),M(A,{key:0,modelValue:r.value,"onUpdate:modelValue":[a[1]||(a[1]=i=>r.value=i),a[2]||(a[2]=i=>e.$emit("update:sortOrder",i))],items:[{title:"放送が近い順",value:"asc"},{title:"放送が遠い順",value:"desc"}],"item-title":"title","item-value":"value",class:"reservation-list__sort",color:"primary","bg-color":"background-lighten-1",variant:"solo",density:"comfortable","hide-details":""},null,8,["modelValue"])),t.showMoreButton?(o(),M(D,{key:1,variant:"text",class:"reservation-list__more",onClick:a[3]||(a[3]=i=>e.$emit("more"))},{default:I(()=>[a[7]||(a[7]=s("span",{class:"text-primary"},"もっと見る",-1)),v(l,{icon:"fluent:chevron-right-12-regular",width:"18px",class:"ml-1 text-text-darken-1",style:{margin:"0px -4px"}})]),_:1})):g("",!0)])])),s("div",{class:B(["reservation-list__grid",{"reservation-list__grid--loading":t.isLoading,"reservation-list__grid--empty":m.value===0&&t.showEmptyMessage}])},[s("div",{class:B(["reservation-list__empty",{"reservation-list__empty--show":m.value===0&&t.showEmptyMessage&&!t.isLoading}])},[s("div",xe,[v(l,{class:"reservation-list__empty-icon",icon:t.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),s("h2",{innerHTML:t.emptyMessage},null,8,Ve),t.emptySubMessage?(o(),d("div",{key:0,class:"reservation-list__empty-submessage",innerHTML:t.emptySubMessage},null,8,Me)):g("",!0)])],2),s("div",Be,[(o(!0),d(S,null,O(u.value,i=>(o(),M(fe,{key:i.id,reservation:i,onDeleted:w,onClick:L},null,8,["reservation"]))),128))])],2),!t.hidePagination&&m.value>0?(o(),d("div",$e,[v(G,{modelValue:y.value,"onUpdate:modelValue":[a[4]||(a[4]=i=>y.value=i),a[5]||(a[5]=i=>e.$emit("update:page",i))],"active-color":"primary",density:"comfortable",length:Math.ceil(m.value/30),"total-visible":_(k).isSmartphoneVertical()?5:7},null,8,["modelValue","length","total-visible"])])):g("",!0),v(j,{modelValue:f.value,"onUpdate:modelValue":a[6]||(a[6]=i=>f.value=i),reservation:p.value,onDeleted:w,onUpdated:x},null,8,["modelValue","reservation"])],2)}}}),ze=H(Ce,[["__scopeId","data-v-60b7e754"]]);export{ze as R};
