import{d as T,y as R,D as U,B as H,q as O,ao as A,c as f,w as g,a as r,aX as F,e as y,b,k,h,aF as G,r as W,v as K,s as M,V as C,ap as j,aq as Q,ar as X,l as J,o as c,R as m,_ as N,I as Y,J as Z,dU as x,a6 as tt,N as et,a5 as $,az as nt,a8 as it,ab as at,W as st,dV as ot,db as rt,a_ as lt,K as ct,a2 as vt,ac as ut,dO as dt,ad as ht,dW as _t,ae as pt,ah as ft,aC as gt,aj as yt,ak as mt,dX as kt,n as d,aO as q,x as bt,U as E,m as wt,j as St,t as Ot}from"./index-CHrOVu2g.js";import{V as z,_ as Ct,u as Wt}from"./ssrBoot-xQqBeRGC.js";function $t(t,a,e,v){function s(i){return i instanceof e?i:new e(function(l){l(i)})}return new(e||(e=Promise))(function(i,l){function u(_){try{n(v.next(_))}catch(S){l(S)}}function w(_){try{n(v.throw(_))}catch(S){l(S)}}function n(_){_.done?i(_.value):s(_.value).then(u,w)}n((v=v.apply(t,[])).next())})}function Vt(t,a){var e={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},v,s,i,l;return l={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function u(n){return function(_){return w([n,_])}}function w(n){if(v)throw new TypeError("Generator is already executing.");for(;l&&(l=0,n[0]&&(e=0)),e;)try{if(v=1,s&&(i=n[0]&2?s.return:n[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,n[1])).done)return i;switch(s=0,i&&(n=[n[0]&2,i.value]),n[0]){case 0:case 1:i=n;break;case 4:return e.label++,{value:n[1],done:!1};case 5:e.label++,s=n[1],n=[0];continue;case 7:n=e.ops.pop(),e.trys.pop();continue;default:if(i=e.trys,!(i=i.length>0&&i[i.length-1])&&(n[0]===6||n[0]===2)){e=0;continue}if(n[0]===3&&(!i||n[1]>i[0]&&n[1]<i[3])){e.label=n[1];break}if(n[0]===6&&e.label<i[1]){e.label=i[1],i=n;break}if(i&&e.label<i[2]){e.label=i[2],e.ops.push(n);break}i[2]&&e.ops.pop(),e.trys.pop();continue}n=a.call(t,e)}catch(_){n=[6,_],s=0}finally{v=i=0}if(n[0]&5)throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}var Bt=function(){function t(){var a=this;this.event=null,this.callbacks=[],this.install=function(){return $t(a,void 0,void 0,function(){var e=this;return Vt(this,function(v){switch(v.label){case 0:return this.event?(this.event.prompt(),[4,this.event.userChoice.then(function(s){var i=s.outcome;return e.updateEvent(null),i==="accepted"})]):[3,2];case 1:return[2,v.sent()];case 2:throw new Error("Not allowed to prompt.")}})})},!(typeof window>"u")&&(window.addEventListener("beforeinstallprompt",function(e){e.preventDefault(),a.updateEvent(e)}),window.addEventListener("appinstalled",function(){a.updateEvent(null)}))}return t.prototype.getEvent=function(){return this.event},t.prototype.canInstall=function(){return this.event!==null},t.prototype.updateEvent=function(a){var e=this;a!==this.event&&(this.event=a,this.callbacks.forEach(function(v){return v(e.canInstall())}))},t.prototype.addListener=function(a){a(this.canInstall()),this.callbacks.push(a)},t.prototype.removeListener=function(a){this.callbacks=this.callbacks.filter(function(e){return a!==e})},t}(),L=new Bt;const It={class:"header"},Et={key:0,class:"search-box"},Nt=["placeholder"],Pt=T({__name:"HeaderBar",setup(t){const a=R(!1),e=R(""),v=j(),s=A(),i=o=>{if(Array.isArray(o)){const p=o[0];return typeof p=="string"?p:void 0}if(typeof o=="string")return o},l=()=>{if(s.path.startsWith("/clip-videos")){e.value=i(s.query.keyword)??"";return}if(s.path.endsWith("/search")&&s.query.query){e.value=decodeURIComponent(s.query.query);return}};U(()=>{L.addListener(o=>{a.value=o}),l()}),H(()=>s.fullPath,l);const u=O(()=>{const o=s.path;return o.startsWith("/clip-videos")?"クリップ動画を検索...":o.startsWith("/videos")||o.startsWith("/mylist")||o.startsWith("/watched-history")?"録画番組を検索...":"放送予定の番組を検索..."}),w=()=>s.path.startsWith("/clip-videos")?"/clip-videos/":s.path.startsWith("/videos")||s.path.startsWith("/mylist")||s.path.startsWith("/watched-history")?"/videos/search":"/tv/search",n=o=>{o.key==="Enter"&&!o.isComposing&&_()},_=async()=>{const o=e.value.trim();if(s.path.startsWith("/clip-videos")){const P={order:i(s.query.order)==="asc"?"asc":"desc",page:"1"};o!==""&&(P.keyword=o);try{await v.push({path:"/clip-videos/",query:P})}catch(D){if(Q(D,X.duplicated)){window.dispatchEvent(new CustomEvent("clip-videos-search",{detail:o}));return}throw D}return}if(o==="")return;const V=w();v.push(`${V}?query=${encodeURIComponent(o)}`)},S=O(()=>{const o=s.path;return!o.startsWith("/captures")&&!o.startsWith("/settings")&&!o.startsWith("/login")&&!o.startsWith("/register")});return(o,p)=>{const V=W("router-link"),B=W("Icon");return c(),f("header",It,[g((c(),k(V,{class:"konomitv-logo ml-3 ml-md-6",to:"/tv/"},{default:h(()=>[...p[2]||(p[2]=[b("img",{class:"konomitv-logo__image",src:Ct,height:"21"},null,-1)])]),_:1})),[[m]]),r(z),F(o.$slots,"timetable-controls",{},void 0,!0),S.value?(c(),f("div",Et,[g(b("input",{class:"search-input",type:"search",enterkeyhint:"search",placeholder:u.value,"onUpdate:modelValue":p[0]||(p[0]=I=>e.value=I),onKeydown:n},null,40,Nt),[[G,e.value]]),r(B,{class:"search-input__icon",icon:"fluent:search-20-filled",height:"24px",onClick:_})])):y("",!0),g(r(C,{variant:"flat",class:"pwa-install-button",onClick:p[1]||(p[1]=I=>M(L).install())},{default:h(()=>[r(B,{icon:"material-symbols:install-desktop-rounded",height:"20px",class:"mr-1"}),p[3]||(p[3]=J(" アプリとしてインストール ",-1))]),_:1},512),[[K,a.value]]),p[4]||(p[4]=b("div",{class:"mr-3 mr-md-6"},null,-1))])}}}),ee=N(Pt,[["__scopeId","data-v-093ec570"]]),Dt=Z({baseColor:String,bgColor:String,color:String,grow:Boolean,mode:{type:String,validator:t=>!t||["horizontal","shift"].includes(t)},height:{type:[Number,String],default:56},active:{type:Boolean,default:!0},...mt(),...yt(),...gt(),...ft(),...pt(),..._t({name:"bottom-navigation"}),...ht({tag:"header"}),...dt({selectedClass:"v-btn--selected"}),...ut()},"VBottomNavigation"),Rt=Y()({name:"VBottomNavigation",props:Dt(),emits:{"update:active":t=>!0,"update:modelValue":t=>!0},setup(t,a){let{slots:e}=a;const{themeClasses:v}=x(),{borderClasses:s}=tt(t),{backgroundColorClasses:i,backgroundColorStyles:l}=et($(t,"bgColor")),{densityClasses:u}=nt(t),{elevationClasses:w}=it(t),{roundedClasses:n}=at(t),{ssrBootStyles:_}=Wt(),S=O(()=>Number(t.height)-(t.density==="comfortable"?8:0)-(t.density==="compact"?16:0)),o=st(t,"active",t.active),{layoutItemStyles:p}=ot({id:t.name,order:O(()=>parseInt(t.order,10)),position:O(()=>"bottom"),layoutSize:O(()=>o.value?S.value:0),elementSize:S,active:o,absolute:$(t,"absolute")});return rt(t,kt),lt({VBtn:{baseColor:$(t,"baseColor"),color:$(t,"color"),density:$(t,"density"),stacked:O(()=>t.mode!=="horizontal"),variant:"text"}},{scoped:!0}),ct(()=>r(t.tag,{class:["v-bottom-navigation",{"v-bottom-navigation--active":o.value,"v-bottom-navigation--grow":t.grow,"v-bottom-navigation--shift":t.mode==="shift"},v.value,i.value,s.value,u.value,w.value,n.value,t.class],style:[l.value,p.value,{height:vt(S.value)},_.value,t.style]},{default:()=>[e.default&&r("div",{class:"v-bottom-navigation__content"},[e.default()])]})),{}}}),qt={};function Lt(t,a){const e=W("Icon");return c(),k(Rt,{class:"bottom-navigation-container elevation-12",color:"primary",grow:"",active:""},{default:h(()=>[r(C,{class:d(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/tv")}]),to:"/tv/"},{default:h(()=>[r(e,{icon:"fluent:tv-20-regular",width:"30px"}),a[0]||(a[0]=b("span",{class:"mt-1"},"テレビをみる",-1))]),_:1},8,["class"]),r(C,{class:d(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/videos")}]),to:"/videos/"},{default:h(()=>[r(e,{icon:"fluent:movies-and-tv-20-regular",width:"30px"}),a[1]||(a[1]=b("span",{class:"mt-1"},"ビデオをみる",-1))]),_:1},8,["class"]),r(C,{class:d(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/clip-videos")}]),to:"/clip-videos/"},{default:h(()=>[r(e,{icon:"fluent:video-clip-20-regular",width:"30px"}),a[2]||(a[2]=b("span",{class:"mt-1"},"クリップ",-1))]),_:1},8,["class"]),r(C,{class:d(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/reservations")}]),to:"/reservations/"},{default:h(()=>[r(e,{icon:"fluent:timer-16-regular",width:"30px"}),a[3]||(a[3]=b("span",{class:"mt-1"},"録画予約",-1))]),_:1},8,["class"]),r(C,{class:d(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/mypage")}]),to:"/mypage/"},{default:h(()=>[r(e,{icon:"fluent:person-20-regular",width:"30px"}),a[4]||(a[4]=b("span",{class:"mt-1"},"マイページ",-1))]),_:1},8,["class"])]),_:1})}const Tt=N(qt,[["render",Lt],["__scopeId","data-v-f141a5cd"]]);class zt{static async fetchServerVersion(a=!1){const e=await q.get("/version");return e.type==="error"?(a===!1&&q.showGenericError(e,"バージョン情報を取得できませんでした。"),null):e.data}}const Ut=bt("version",{state:()=>({server_version_info:null,last_updated_at:0}),getters:{client_version(){return E.version},server_version(){var t;return((t=this.server_version_info)==null?void 0:t.version)??null},latest_version(){var t;return((t=this.server_version_info)==null?void 0:t.latest_version)??null},is_client_develop_version(){return this.client_version.includes("-dev")},is_server_develop_version(){var t;return((t=this.server_version)==null?void 0:t.includes("-dev"))??!1},is_update_available(){return this.server_version===null||this.latest_version===null?!1:this.is_server_develop_version===!1&&this.server_version!==this.latest_version||this.is_server_develop_version===!0&&this.server_version.replace("-dev","")===this.latest_version},is_version_mismatch(){return this.server_version===null?!1:this.client_version!==this.server_version},server_environment(){var t;return((t=this.server_version_info)==null?void 0:t.environment)??null},is_linux_environment(){const t=this.server_environment;return t==="Linux"||t==="Linux-Docker"||t==="Linux-ARM"}},actions:{async fetchServerVersion(t=!1){if(this.server_version_info!==null&&t===!1)return E.time()-this.last_updated_at>60&&this.fetchServerVersion(!0),this.server_version_info;const a=await zt.fetchServerVersion();return a===null?null:(this.server_version_info=a,this.last_updated_at=E.time(),this.server_version_info)}}}),Ht=T({name:"Navigation",components:{BottomNavigation:Tt},props:{iconOnly:{type:Boolean,default:!1}},computed:{...wt(Ut)},async created(){await this.versionStore.fetchServerVersion()}}),At={key:0,class:"navigation__link-text"},Ft={key:0,class:"navigation__link-text"},Gt={key:0,class:"navigation__link-text"},Kt={key:0,class:"navigation__link-text"},Mt={key:0,class:"navigation__link-text"},jt={key:0,class:"navigation__link-text"},Qt={key:0,class:"navigation__link-text"},Xt={key:0,class:"navigation__link-text"},Jt={key:0,class:"navigation__link-text"},Yt={key:0,class:"navigation__link-text"};function Zt(t,a,e,v,s,i){const l=W("Icon"),u=W("router-link"),w=W("BottomNavigation"),n=St("ftooltip");return c(),f("div",null,[b("div",{class:d(["navigation-container elevation-8",{"navigation-container--icon-only":t.iconOnly}])},[b("nav",{class:d(["navigation",{"navigation--icon-only":t.iconOnly}])},[b("div",{class:d(["navigation-scroll",{"navigation-scroll--icon-only":t.iconOnly}])},[g((c(),k(u,{class:d(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/tv"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/tv/"},{default:h(()=>[r(l,{class:"navigation__link-icon",icon:"fluent:tv-20-regular",width:"26px"}),t.iconOnly?y("",!0):(c(),f("span",At,"テレビをみる"))]),_:1},8,["class"])),[[m],[n,t.iconOnly?"テレビをみる":"",void 0,{right:!0}]]),g((c(),k(u,{class:d(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/videos"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/videos/"},{default:h(()=>[r(l,{class:"navigation__link-icon",icon:"fluent:movies-and-tv-20-regular",width:"26px"}),t.iconOnly?y("",!0):(c(),f("span",Ft,"ビデオをみる"))]),_:1},8,["class"])),[[m],[n,t.iconOnly?"ビデオをみる":"",void 0,{right:!0}]]),g((c(),k(u,{class:d(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/clip-videos"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/clip-videos/"},{default:h(()=>[r(l,{class:"navigation__link-icon",icon:"fluent:video-clip-20-regular",width:"26px"}),t.iconOnly?y("",!0):(c(),f("span",Gt,"クリップ動画"))]),_:1},8,["class"])),[[m],[n,t.iconOnly?"クリップ動画":"",void 0,{right:!0}]]),g((c(),k(u,{class:d(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/timetable"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/timetable/"},{default:h(()=>[r(l,{class:"navigation__link-icon",icon:"fluent:calendar-ltr-20-regular",width:"26px"}),t.iconOnly?y("",!0):(c(),f("span",Kt,"番組表"))]),_:1},8,["class"])),[[m],[n,t.iconOnly?"番組表":"",void 0,{right:!0}]]),g((c(),k(u,{class:d(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/reservations"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/reservations/"},{default:h(()=>[r(l,{class:"navigation__link-icon",icon:"fluent:timer-16-regular",width:"26px",style:{padding:"0.5px"}}),t.iconOnly?y("",!0):(c(),f("span",Mt,"録画予約"))]),_:1},8,["class"])),[[m],[n,t.iconOnly?"録画予約":"",void 0,{right:!0}]]),g((c(),k(u,{class:d(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/captures"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/captures/"},{default:h(()=>[r(l,{class:"navigation__link-icon",icon:"fluent:image-multiple-24-regular",width:"26px"}),t.iconOnly?y("",!0):(c(),f("span",jt,"キャプチャ"))]),_:1},8,["class"])),[[m],[n,t.iconOnly?"キャプチャ":"",void 0,{right:!0}]]),g((c(),k(u,{class:d(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/mylist"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/mylist/"},{default:h(()=>[r(l,{class:"navigation__link-icon",icon:"ic:round-playlist-play",width:"26px"}),t.iconOnly?y("",!0):(c(),f("span",Qt,"マイリスト"))]),_:1},8,["class"])),[[m],[n,t.iconOnly?"マイリスト":"",void 0,{right:!0}]]),g((c(),k(u,{class:d(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/watched-history"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/watched-history/"},{default:h(()=>[r(l,{class:"navigation__link-icon",icon:"fluent:history-20-regular",width:"26px"}),t.iconOnly?y("",!0):(c(),f("span",Xt,"視聴履歴"))]),_:1},8,["class"])),[[m],[n,t.iconOnly?"視聴履歴":"",void 0,{right:!0}]]),r(z),g((c(),k(u,{class:d(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/settings"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/settings/"},{default:h(()=>[r(l,{class:"navigation__link-icon",icon:"fluent:settings-20-regular",width:"26px"}),t.iconOnly?y("",!0):(c(),f("span",Jt,"設定"))]),_:1},8,["class"])),[[m],[n,t.iconOnly?"設定":"",void 0,{right:!0}]]),g((c(),f("a",{class:d(["navigation__link",{"navigation__link--develop-version":t.versionStore.is_client_develop_version,"navigation__link--highlight":t.versionStore.is_update_available,"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",href:"https://github.com/tsukumijima/KonomiTV",target:"_blank"},[r(l,{class:"navigation__link-icon",icon:"fluent:info-16-regular",width:"26px"}),t.iconOnly?y("",!0):(c(),f("span",Yt,"version "+Ot(t.versionStore.client_version),1))],2)),[[m],[n,t.iconOnly?t.versionStore.is_update_available?`アップデートがあります (version ${t.versionStore.latest_version})`:`version ${t.versionStore.client_version}`:t.versionStore.is_update_available?`アップデートがあります (version ${t.versionStore.latest_version})`:"",void 0,{right:!0}]])],2)],2)],2),r(w)])}const ne=N(Ht,[["render",Zt],["__scopeId","data-v-0d0eaa4a"]]);export{ee as H,ne as N,zt as V,Ut as u};
