import{G as m,d as b,m as S,M as a,U as A,N as y,u as V,_ as $,r as B,o as _,j as U,h as d,e as u,w as N,c as C,b as n,k as s,V as F,i as g,t as f,n as T,R as I,p as P,q as R}from"./index-CfJiLHux.js";import{C as j}from"./CommentMuteSettings-BB-bawhG.js";import{S as M}from"./Base-CPDPX-Y5.js";import{V as h}from"./VSlider-Bf2PZdpL.js";import{V as O}from"./VSwitch-DN1qehb_.js";import"./VDialog-DWuoX6cV.js";import"./VTextField-CrVL-eS9.js";import"./VAvatar-CEfQlnus.js";import"./VCard-m76MDXrR.js";import"./ssrBoot-CFKDKzIn.js";import"./VSelect-5IqOopnC.js";import"./Navigation-BWN4Vyh0.js";class L{static async fetchAuthorizationURL(){const e=await m.get("/niconico/auth");return e.type==="error"?(m.showGenericError(e,"ニコニコアカウントとの連携用の認証 URL を取得できませんでした。"),null):e.data.authorization_url}static async logoutAccount(){const e=await m.delete("/niconico/logout");return e.type==="error"?(m.showGenericError(e,"ニコニコアカウントとの連携を解除できませんでした。"),!1):!0}}const D=L,W=b({name:"Settings-Jikkyo",components:{SettingsBase:M,CommentMuteSettings:j},data(){return{comment_mute_settings_modal:!1,is_loading:!0}},computed:{...S(V,y)},async created(){if(await this.userStore.fetchUser(),this.is_loading=!1,location.hash!==""){const t=new URLSearchParams(location.hash.replace("#",""));if(t.get("status")!==null&&t.get("detail")!==null){const e=parseInt(t.get("status")),c=t.get("detail");this.onOAuthCallbackReceived(e,c),history.replaceState(null,""," ")}}},methods:{async loginNiconicoAccount(){if(this.userStore.is_logged_in===!1){a.warning("連携をはじめるには、KonomiTV アカウントにログインしてください。");return}const t=await D.fetchAuthorizationURL();if(t===null)return;if(A.isMobileDevice()===!0){location.href=t;return}const e=window.open(t,"KonomiTV-OAuthPopup",A.getWindowFeatures());if(e===null){a.error("ポップアップウインドウを開けませんでした。");return}const c=async l=>{if(e.closed||A.typeof(l.data)!=="object"||!("KonomiTV-OAuthPopup"in l.data))return;e&&e.close(),window.removeEventListener("message",c);const E=l.data["KonomiTV-OAuthPopup"].status,p=l.data["KonomiTV-OAuthPopup"].detail;this.onOAuthCallbackReceived(E,p)};window.addEventListener("message",c)},async onOAuthCallbackReceived(t,e){if(console.log(`NiconicoAuthCallbackAPI: Status: ${t} / Detail: ${e}`),t!==200){if(e.startsWith("Authorization was denied (access_denied)"))a.error("ニコニコアカウントとの連携がキャンセルされました。");else if(e.startsWith("Failed to get access token (HTTP Error ")){const c=e.replace("Failed to get access token ","");a.error(`アクセストークンの取得に失敗しました。${c}`)}else if(e.startsWith("Failed to get access token (Connection Timeout)"))a.error("アクセストークンの取得に失敗しました。ニコニコで障害が発生している可能性があります。");else if(e.startsWith("Failed to get user information (HTTP Error ")){const c=e.replace("Failed to get user information ","");a.error(`ニコニコアカウントのユーザー情報の取得に失敗しました。${c}`)}else e.startsWith("Failed to get user information (Connection Timeout)")?a.error("ニコニコアカウントのユーザー情報の取得に失敗しました。ニコニコで障害が発生している可能性があります。"):a.error(`ニコニコアカウントとの連携に失敗しました。(${e})`);return}await this.userStore.fetchUser(!0),a.success("ニコニコアカウントと連携しました。")},async logoutNiconicoAccount(){await D.logoutAccount()!==!1&&(await this.userStore.fetchUser(!0),a.success("ニコニコアカウントとの連携を解除しました。"))}}}),o=t=>(P("data-v-377ff4c9"),t=t(),R(),t),K={class:"settings__heading"},z=o(()=>u("span",{class:"ml-3"},"ニコニコ実況",-1)),G={key:0,class:"niconico-account niconico-account--anonymous"},J={class:"niconico-account-wrapper"},H=o(()=>u("div",{class:"niconico-account__info ml-4"},[u("div",{class:"niconico-account__info-name"},[u("span",{class:"niconico-account__info-name-text"},"ニコニコアカウントと連携していません")]),u("span",{class:"niconico-account__info-description"}," ニコニコアカウントと連携すると、テレビを見ながらニコニコ実況にコメントできるようになります。 ")],-1)),q={key:1,class:"niconico-account"},X={class:"niconico-account-wrapper"},Q=["src"],Y={class:"niconico-account__info"},Z={class:"niconico-account__info-name"},x={class:"niconico-account__info-name-text"},uu={class:"niconico-account__info-description"},tu=o(()=>u("span",{class:"mr-2",style:{"white-space":"nowrap"}},"Niconico User ID:",-1)),eu=["href"],su={key:0,class:"text-secondary"},ou={class:"settings__item-label mt-7",style:{"border-left":"3px solid rgb(var(--v-theme-text-darken-1))","padding-left":"12px"}},nu=o(()=>u("br",null,null,-1)),iu=o(()=>u("div",{class:"mt-1"},null,-1)),au=o(()=>u("a",{class:"link",href:"https://jk.nicovideo.jp",target:"_blank"},"ニコニコ実況",-1)),cu=o(()=>u("a",{class:"link",href:"https://nx-jikkyo.tsukumijima.net",target:"_blank"},"NX-Jikkyo",-1)),ru=o(()=>u("div",{class:"settings__item"},[u("div",{class:"settings__item-heading"},"コメントのミュート設定"),u("div",{class:"settings__item-label"},[s(" 表示したくないコメントを、映像上やコメントリストに表示しないようにミュートできます。"),u("br")]),u("div",{class:"settings__item-label mt-2"},[s(" デフォルトでは、下記のミュート設定がオンになっています。"),u("br"),s(" これらのコメントも表示したい方は、適宜オフに設定してください。"),u("br"),u("ul",{class:"ml-5 mt-2"},[u("li",null,"露骨な表現を含むコメントをミュートする"),u("li",null,"ネガティブな表現、差別的な表現、政治的に偏った表現を含むコメントをミュートする"),u("li",null,"文字サイズが大きいコメントをミュートする")])])],-1)),lu=o(()=>u("span",{class:"ml-1"},"コメントのミュート設定を開く",-1)),_u={class:"settings__item"},du=o(()=>u("div",{class:"settings__item-heading"},"コメントの速さ",-1)),mu=o(()=>u("div",{class:"settings__item-label"},[s(" プレイヤーに流れるコメントの速さを設定します。"),u("br"),s(" たとえば 1.2 に設定すると、コメントが 1.2 倍速く流れます。"),u("br")],-1)),Bu={class:"settings__item"},Cu=o(()=>u("div",{class:"settings__item-heading"},"コメントの文字サイズ",-1)),Au=o(()=>u("div",{class:"settings__item-label"},[s(" プレイヤーに流れるコメントの文字サイズの基準値を設定します。"),u("br"),s(" 実際の文字サイズは画面サイズに合わせて調整されます。デフォルトの文字サイズは 34px です。"),u("br")],-1)),Fu={class:"settings__item settings__item--switch"},gu=o(()=>u("label",{class:"settings__item-heading",for:"close_comment_form_after_sending"},"コメント送信後にコメント入力フォームを閉じる",-1)),Eu=o(()=>u("label",{class:"settings__item-label",for:"close_comment_form_after_sending"},[s(" この設定をオンにすると、コメントを送信した後に、コメント入力フォームが自動で閉じるようになります。"),u("br"),s(" コメント入力フォームが表示されたままだと、大半のショートカットキーが文字入力と競合して使えなくなります。とくに理由がなければ、オンにしておくのがおすすめです。"),u("br")],-1));function pu(t,e,c,l,E,p){const r=B("Icon"),w=B("router-link"),k=B("CommentMuteSettings"),v=B("SettingsBase");return _(),U(v,null,{default:d(()=>[u("h2",K,[N((_(),C("a",{class:"settings__back-button",onClick:e[0]||(e[0]=i=>t.$router.back())},[n(r,{icon:"fluent:arrow-left-12-filled",width:"25px"})])),[[I]]),n(r,{icon:"bi:chat-left-text-fill",width:"19px"}),z]),u("div",{class:T(["settings__content",{"settings__content--loading":t.is_loading}])},[t.userStore.user===null||t.userStore.user.niconico_user_id===null?(_(),C("div",G,[u("div",J,[n(r,{class:"flex-shrink-0",icon:"bi:chat-left-text-fill",width:"45px"}),H]),n(F,{class:"niconico-account__login ml-auto",color:"secondary",width:"130",height:"56",variant:"flat",onClick:e[1]||(e[1]=i=>t.loginNiconicoAccount())},{default:d(()=>[n(r,{icon:"fluent:plug-connected-20-filled",class:"mr-2",height:"26"}),s("連携する ")]),_:1})])):g("",!0),t.userStore.user!==null&&t.userStore.user.niconico_user_id!==null?(_(),C("div",q,[u("div",X,[u("img",{class:"niconico-account__icon",src:t.userStore.user_niconico_icon_url??""},null,8,Q),u("div",Y,[u("div",Z,[u("span",x,f(t.userStore.user.niconico_user_name)+" と連携しています",1)]),u("span",uu,[tu,u("a",{class:"link mr-2",href:`https://www.nicovideo.jp/user/${t.userStore.user.niconico_user_id}`,target:"_blank"},f(t.userStore.user.niconico_user_id),9,eu),t.userStore.user.niconico_user_premium===!0?(_(),C("span",su,"(Premium)")):g("",!0)])])]),n(F,{class:"niconico-account__login ml-auto",color:"secondary",width:"130",height:"56",variant:"flat",onClick:e[2]||(e[2]=i=>t.logoutNiconicoAccount())},{default:d(()=>[n(r,{icon:"fluent:plug-disconnected-20-filled",class:"mr-2",height:"26"}),s("連携解除 ")]),_:1})])):g("",!0),u("div",ou,[s(" コメントの透明度は、プレイヤー下にある設定アイコン ⚙️ から変更できます。"),nu,iu,au,s(" の代わりに "),cu,s(" の実況コメントをリアルタイム表示するには、"),n(w,{class:"link",to:"/settings/server"},{default:d(()=>[s("サーバー設定")]),_:1}),s(" → ［テレビのライブストリーミング］に移動してください。 ")]),ru,n(F,{class:"settings__save-button mt-4",variant:"flat",onClick:e[3]||(e[3]=i=>t.comment_mute_settings_modal=!t.comment_mute_settings_modal)},{default:d(()=>[n(r,{icon:"heroicons-solid:filter",height:"19px"}),lu]),_:1}),u("div",_u,[du,mu,n(h,{class:"settings__item-form",color:"primary","show-ticks":"always","thumb-label":"","hide-details":"",step:.1,min:.5,max:2,modelValue:t.settingsStore.settings.comment_speed_rate,"onUpdate:modelValue":e[4]||(e[4]=i=>t.settingsStore.settings.comment_speed_rate=i)},null,8,["modelValue"])]),u("div",Bu,[Cu,Au,n(h,{class:"settings__item-form",color:"primary","show-ticks":"always","thumb-label":"","hide-details":"",step:1,min:20,max:60,modelValue:t.settingsStore.settings.comment_font_size,"onUpdate:modelValue":e[5]||(e[5]=i=>t.settingsStore.settings.comment_font_size=i)},null,8,["modelValue"])]),u("div",Fu,[gu,Eu,n(O,{class:"settings__item-switch",color:"primary",id:"close_comment_form_after_sending","hide-details":"",modelValue:t.settingsStore.settings.close_comment_form_after_sending,"onUpdate:modelValue":e[6]||(e[6]=i=>t.settingsStore.settings.close_comment_form_after_sending=i)},null,8,["modelValue"])])],2),n(k,{modelValue:t.comment_mute_settings_modal,"onUpdate:modelValue":e[7]||(e[7]=i=>t.comment_mute_settings_modal=i)},null,8,["modelValue"])]),_:1})}const Nu=$(W,[["render",pu],["__scopeId","data-v-377ff4c9"]]);export{Nu as default};
