import{A as a,aM as _}from"./index-LUcZSfg3.js";const p={id:-1,status:"Recorded",file_path:"",file_hash:"",file_size:0,file_created_at:"2000-01-01T00:00:00+09:00",file_modified_at:"2000-01-01T00:00:00+09:00",recording_start_time:null,recording_end_time:null,duration:0,container_format:"MPEG-TS",video_codec:"MPEG-2",video_codec_profile:"High",video_scan_type:"Interlaced",video_frame_rate:29.97,video_resolution_width:1440,video_resolution_height:1080,primary_audio_codec:"AAC-LC",primary_audio_channel:"Stereo",primary_audio_sampling_rate:48e3,secondary_audio_codec:null,secondary_audio_channel:null,secondary_audio_sampling_rate:null,has_key_frames:!1,cm_sections:null,created_at:"2000-01-01T00:00:00+09:00",updated_at:"2000-01-01T00:00:00+09:00"},h={id:-1,recorded_video:p,recording_start_margin:0,recording_end_margin:0,is_partially_recorded:!1,channel:null,network_id:null,service_id:null,event_id:null,series_id:null,series_broadcast_period_id:null,title:"取得中…",series_title:null,episode_number:null,subtitle:null,description:"取得中…",detail:{},start_time:"2000-01-01T00:00:00+09:00",end_time:"2000-01-01T00:00:00+09:00",duration:0,is_free:!0,genres:[],primary_audio_type:"2/0モード(ステレオ)",primary_audio_language:"日本語",secondary_audio_type:null,secondary_audio_language:null,created_at:"2000-01-01T00:00:00+09:00",updated_at:"2000-01-01T00:00:00+09:00"};class y{static async fetchVideos(r="desc",e=1,t=null){const i=await a.get("/videos",{params:{order:r,page:e,ids:t},paramsSerializer:{indexes:null}});return i.type==="error"?(a.showGenericError(i,"録画番組一覧を取得できませんでした。"),null):i.data}static async searchVideos(r,e="desc",t=1){const i=await a.get("/videos/search",{params:{query:r,order:e,page:t}});return i.type==="error"?(a.showGenericError(i,"録画番組の検索に失敗しました。"),null):i.data}static async fetchVideo(r){const e=await a.get(`/videos/${r}`);return e.type==="error"?(a.showGenericError(e,"録画番組情報を取得できませんでした。"),null):e.data}static async fetchVideoJikkyoComments(r){const e=await a.get(`/videos/${r}/jikkyo`);return e.type==="error"?(a.showGenericError(e,"過去ログコメントを取得できませんでした。"),{is_success:!1,comments:[],detail:"過去ログコメントを取得できませんでした。"}):(e.data.comments=e.data.comments.filter(t=>_.isMutedComment(t.text,t.author,t.color,t.type,t.size)===!1),e.data)}static async reanalyzeVideo(r){const e=await a.post(`/videos/${r}/reanalyze`,void 0,{timeout:6e5});if(e.type==="error"){switch(e.data.detail){default:a.showGenericError(e,"メタデータの再解析に失敗しました。");break}return!1}return!0}static async regenerateThumbnail(r){const e=await a.post(`/videos/${r}/thumbnail/regenerate`,void 0,{timeout:18e5});if(e.type==="error"){switch(e.data.detail){default:a.showGenericError(e,"サムネイルの再生成に失敗しました。");break}return!1}return!0}static async deleteVideo(r){const e=await a.delete(`/videos/${r}`);if(e.type==="error"){switch(e.data.detail){default:a.showGenericError(e,"録画ファイルの削除に失敗しました。");break}return!1}return!0}static async exportVideoClip(r,e){if(e.length===0)return console.error("Clip export failed: No segments provided"),null;const t=e[0].start_frame!==void 0;let i;e.length===1?t?i={start_frame:e[0].start_frame,end_frame:e[0].end_frame}:i={start_time:e[0].start_time,end_time:e[0].end_time}:i={segments:e.map(s=>t?{start_frame:s.start_frame,end_frame:s.end_frame}:{start_time:s.start_time,end_time:s.end_time})};const o=await a.post(`/streams/video/${r}/clip-export`,i);return o.type==="error"?(a.showGenericError(o,"クリップの書き出しを開始できませんでした。"),null):!o.data.is_success||!o.data.task_id?(console.error("Clip export failed:",o.data.detail),null):o.data.task_id}static async fetchVideoClipExportStatus(r,e){const t=await a.get(`/streams/video/${r}/clip-export/${e}`);return t.type==="error"?(a.showGenericError(t,"クリップ書き出しの進捗状況を取得できませんでした。"),null):t.data}static async downloadVideoClip(r,e){try{const t=`/api/streams/video/${r}/clip-export/${e}/download`,i=await fetch(t);if(!i.ok)return console.error("Failed to fetch clip for download:",i.status,i.statusText),!1;const o=i.headers.get("Content-Disposition");let d="clip.mp4";if(o){const c=o.match(/filename\*=UTF-8''(.+)/i);if(c)d=decodeURIComponent(c[1]);else{const u=o.match(/filename="?([^";\n]+)"?/i);u&&(d=u[1])}}const s=await i.blob(),l=URL.createObjectURL(s),n=document.createElement("a");return n.href=l,n.download=d,document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout(()=>URL.revokeObjectURL(l),1e3),!0}catch(t){return console.error("Failed to download clip:",t),!1}}static async saveVideoClip(r,e){const t=await a.post(`/streams/video/${r}/clip-export/${e}/save`);return t.type==="error"?(a.showGenericError(t,"クリップの保存に失敗しました。"),!1):!0}}export{h as I,y as V};
