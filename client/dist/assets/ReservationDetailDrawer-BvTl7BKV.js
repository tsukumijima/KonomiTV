import{D as ke,E as Ce,T as Pe,S as $e,G as v,O as De,Y as Re,W as Se,a as r,Q as ae,d as se,U as ne,P as X,_ as te,c,e as h,b as e,t as y,F as ee,g as ie,r as re,o as d,q as C,aJ as H,aK as oe,s as q,x as pe,l as w,B as z,i as Ue,n as j,w as W,k as Y,h as b,V as L,M as I,R as Z}from"./index-BwZ9zzz0.js";import{u as Ee}from"./SPHeaderBar-Dwp6a3LQ.js";import{m as Be,e as le,c as K}from"./VSelect-CkFu0EQK.js";import{V as Le}from"./VSwitch-CqUSXHTX.js";import{V as Ie}from"./VSlider-DXIZgjgt.js";import{u as Te,m as Me,V as de,c as N}from"./VTextField-C85TyjR9.js";import{u as Fe,R as G}from"./ServerSettingsStore-B3yrK2_n.js";import{V as ue}from"./VDialog-C14Tby68.js";import{a as ce,V as ge,b as ve,c as me}from"./VCard-DnZOakur.js";import{V as _e}from"./ssrBoot-9lPhdD8P.js";const Ae=Ce({...Me(),...Re(Be(),["inline"])},"VCheckbox"),Oe=ke()({name:"VCheckbox",inheritAttrs:!1,props:Ae(),emits:{"update:modelValue":t=>!0,"update:focused":t=>!0},setup(t,S){let{attrs:o,slots:P}=S;const f=Pe(t,"modelValue"),{isFocused:n,focus:$,blur:m}=Te(t),_=$e(),U=v(()=>t.id||`checkbox-${_}`);return De(()=>{const[x,D]=Se(o),R=de.filterProps(t),E=le.filterProps(t);return r(de,ae({class:["v-checkbox",t.class]},x,R,{modelValue:f.value,"onUpdate:modelValue":B=>f.value=B,id:U.value,focused:n.value,style:t.style}),{...P,default:B=>{let{id:F,messagesId:A,isDisabled:T,isReadonly:O,isValid:p}=B;return r(le,ae(E,{id:F.value,"aria-describedby":A.value,disabled:T.value,readonly:O.value},D,{error:p.value===!1,modelValue:f.value,"onUpdate:modelValue":M=>f.value=M,onFocus:$,onBlur:m}),P)}})}),{}}}),He=se({name:"ReservationProgramInfo",props:{reservation:{type:Object,default:null},program:{type:Object,default:null},channel:{type:Object,default:null}},data(){return{Utils:Object.freeze(ne),ProgramUtils:Object.freeze(X)}},computed:{displayProgram(){var t;return((t=this.reservation)==null?void 0:t.program)??this.program},displayChannel(){var t;return((t=this.reservation)==null?void 0:t.channel)??this.channel}},methods:{onLogoError(t){const S=t.target;S.src=`${ne.api_base_url}/channels/gr001/logo`}}}),je={key:0,class:"program-container"},Ne={class:"program-info"},ze=["innerHTML"],Ke={class:"program-info__broadcaster"},Ge=["src"],qe={class:"program-info__broadcaster-container"},Je={class:"d-flex align-center"},Qe={class:"program-info__broadcaster-number"},We={class:"program-info__broadcaster-name"},Ye={class:"program-info__broadcaster-time"},Ze=["innerHTML"],Xe={key:0,class:"program-info__genre-container"},es={class:"mt-5"},ss={key:0,class:"program-info__status"},ts={class:"ml-2"},rs={class:"program-info__status"},as={class:"ml-2"},ns={key:1,class:"program-info__status"},is={class:"ml-2"},os={class:"program-detail-container"},ls={class:"program-detail__heading"},ds=["innerHTML"];function us(t,S,o,P,f,n){const $=re("Icon");return t.displayProgram&&t.displayChannel?(d(),c("div",je,[e("section",Ne,[e("h1",{class:"program-info__title",innerHTML:t.ProgramUtils.decorateProgramInfo(t.displayProgram,"title")},null,8,ze),e("div",Ke,[e("img",{class:"program-info__broadcaster-icon",src:`${t.Utils.api_base_url}/channels/${t.displayChannel.id}/logo`,onError:S[0]||(S[0]=(...m)=>t.onLogoError&&t.onLogoError(...m))},null,40,Ge),e("div",qe,[e("div",Je,[e("div",Qe,"Ch: "+y(t.displayChannel.channel_number),1),e("div",We,y(t.displayChannel.name),1)]),e("div",Ye,y(t.ProgramUtils.getProgramTime(t.displayProgram)),1)])]),e("div",{class:"program-info__description",innerHTML:t.ProgramUtils.decorateProgramInfo(t.displayProgram,"description")},null,8,Ze),t.displayProgram.genres&&t.displayProgram.genres.length>0?(d(),c("div",Xe,[(d(!0),c(ee,null,ie(t.displayProgram.genres,(m,_)=>(d(),c("div",{class:"program-info__genre",key:_},y(m.major)+" / "+y(m.middle),1))),128))])):h("",!0),e("div",es,[t.displayProgram.video_codec&&t.displayProgram.video_resolution?(d(),c("div",ss,[r($,{icon:"fluent:video-16-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",ts,"映像: "+y(t.displayProgram.video_codec)+" / "+y(t.displayProgram.video_resolution),1)])):h("",!0),e("div",rs,[r($,{icon:"fluent:headphones-sound-wave-20-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",as,"主音声: "+y(t.displayProgram.primary_audio_type)+" "+y(t.displayProgram.primary_audio_sampling_rate||"Unknown")+" / "+y(t.displayProgram.primary_audio_language),1)]),t.displayProgram.secondary_audio_type?(d(),c("div",ns,[r($,{icon:"fluent:headphones-sound-wave-20-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",is,"副音声: "+y(t.displayProgram.secondary_audio_type)+" "+y(t.displayProgram.secondary_audio_sampling_rate||"Unknown")+" / "+y(t.displayProgram.secondary_audio_language),1)])):h("",!0)])]),e("section",os,[(d(!0),c(ee,null,ie(t.displayProgram.detail??{},(m,_)=>(d(),c("div",{class:"program-detail",key:_},[e("h2",ls,y(_),1),e("div",{class:"program-detail__text",innerHTML:t.Utils.URLtoLink(m)},null,8,ds)]))),128))])])):h("",!0)}const cs=te(He,[["render",us],["__scopeId","data-v-21faec51"]]),gs={class:"reservation-recording-settings"},vs={key:0,class:"recording-warning-banner"},ms={key:1,class:"reservation-recording-settings__section"},_s={class:"reservation-recording-settings__section"},ps={class:"reservation-recording-settings__header"},fs={class:"reservation-recording-settings__section"},bs={class:"reservation-recording-settings__slider"},ys={class:"reservation-recording-settings__section"},hs={class:"reservation-recording-settings__section"},ws={class:"reservation-recording-settings__section"},Vs={class:"reservation-recording-settings__margin-default"},xs={class:"reservation-recording-settings__margin-default-text",for:"use-default-margin",style:{"user-select":"none"}},ks={class:"reservation-recording-settings__margin-controls"},Cs={class:"reservation-recording-settings__section"},Ps={class:"reservation-recording-settings__section"},$s={class:"reservation-recording-settings__section"},Ds={class:"reservation-recording-settings__section"},Rs={class:"reservation-recording-settings__description"},Ss=se({__name:"ReservationRecordingSettings",props:{reservation:{},presets:{},hasChanges:{type:Boolean}},emits:["updateSettings","changesDetected"],setup(t,{emit:S}){const o=t,P=S,f=Ee(),n=C(structuredClone(H(o.reservation.record_settings))),$=C(structuredClone(H(o.reservation.record_settings))),m=v({get:()=>n.value.recording_folders.length>0?n.value.recording_folders[0].recording_folder_path:"",set:i=>{U(i,_.value)}}),_=v({get:()=>n.value.recording_folders.length>0&&n.value.recording_folders[0].recording_file_name_template||"",set:i=>{U(m.value,i)}}),U=(i,s)=>{const V=i.trim()!=="",u=s.trim()!=="";!V&&!u?n.value.recording_folders=[]:(n.value.recording_folders.length===0&&n.value.recording_folders.push({recording_folder_path:"",recording_file_name_template:null,is_oneseg_separate_recording_folder:!1}),n.value.recording_folders[0].recording_folder_path=i,n.value.recording_folders[0].recording_file_name_template=s||null)},x=C(n.value.recording_start_margin===null&&n.value.recording_end_margin===null),D=v(()=>o.presets===null?[]:o.presets.presets.map(i=>({title:i.name,value:i.id}))),R=C(null),E=i=>{if(o.presets===null)return;const s=o.presets.presets.find(V=>V.id===i);s&&(n.value=structuredClone(H(s.record_settings)),x.value=n.value.recording_start_margin===null&&n.value.recording_end_margin===null,p())},B={Nothing:"何もしない",Standby:"スタンバイ",StandbyAndReboot:"スタンバイ(復帰後再起動)",Suspend:"サスペンド",SuspendAndReboot:"サスペンド(復帰後再起動)",Shutdown:"シャットダウン"},F=v(()=>{var V;const i=(V=o.presets)==null?void 0:V.global_defaults;return[{title:i?`デフォルト設定を使う (${i.caption_recording_mode==="Enable"?"録画する":"録画しない"})`:"デフォルト設定を使う",value:"Default"},{title:"録画する",value:"Enable"},{title:"録画しない",value:"Disable"}]}),A=v(()=>{var V;const i=(V=o.presets)==null?void 0:V.global_defaults;return[{title:i?`デフォルト設定を使う (${i.data_broadcasting_recording_mode==="Enable"?"録画する":"録画しない"})`:"デフォルト設定を使う",value:"Default"},{title:"録画する",value:"Enable"},{title:"録画しない",value:"Disable"}]}),T=v(()=>{var V;const i=(V=o.presets)==null?void 0:V.global_defaults;return[{title:i?`デフォルト設定を使う (${B[i.post_recording_mode]??i.post_recording_mode})`:"デフォルト設定を使う",value:"Default"},{title:"何もしない",value:"Nothing"},{title:"スタンバイ",value:"Standby"},{title:"スタンバイ(復帰後再起動)",value:"StandbyAndReboot"},{title:"サスペンド",value:"Suspend"},{title:"サスペンド(復帰後再起動)",value:"SuspendAndReboot"},{title:"シャットダウン",value:"Shutdown"}]}),O=v(()=>oe(n.value)!==oe($.value));q(O,i=>{P("changesDetected",i)}),q(()=>o.hasChanges,(i,s)=>{s===!0&&i===!1&&($.value=structuredClone(H(n.value)))});const p=()=>{P("updateSettings",n.value)},M=v(()=>{var s;const i=(s=o.presets)==null?void 0:s.global_defaults;return i?`デフォルト設定を使う (開始 ${i.recording_start_margin} 秒前 / 終了 ${i.recording_end_margin} 秒後)`:"デフォルト設定を使う"}),J=()=>{var i;if(x.value)n.value.recording_start_margin=null,n.value.recording_end_margin=null;else{const s=(i=o.presets)==null?void 0:i.global_defaults;n.value.recording_start_margin=(s==null?void 0:s.recording_start_margin)??5,n.value.recording_end_margin=(s==null?void 0:s.recording_end_margin)??2}p()};return q(()=>o.reservation,i=>{n.value=structuredClone(H(i.record_settings)),$.value=structuredClone(H(i.record_settings)),R.value=null,x.value=i.record_settings.recording_start_margin===null&&i.record_settings.recording_end_margin===null},{deep:!0}),pe(async()=>{await f.fetchServerVersion()}),(i,s)=>{const V=re("Icon");return d(),c("div",gs,[t.reservation.is_recording_in_progress?(d(),c("div",vs,[r(V,{icon:"fluent:warning-16-filled",class:"recording-warning-banner__icon"}),s[12]||(s[12]=e("span",{class:"recording-warning-banner__text"}," 録画中の録画設定の変更はできません。 ",-1))])):h("",!0),t.presets!==null&&t.presets.presets.length>=2?(d(),c("div",ms,[s[13]||(s[13]=e("div",{class:"reservation-recording-settings__label"},"録画設定プリセット",-1)),s[14]||(s[14]=e("div",{class:"reservation-recording-settings__description"}," EDCB の録画設定プリセットから設定値を読み込みます。プリセットの追加・変更・削除は EpgTimer から行ってください。 ",-1)),r(K,{disabled:t.reservation.is_recording_in_progress,modelValue:R.value,"onUpdate:modelValue":[s[0]||(s[0]=u=>R.value=u),E],items:D.value,"item-title":"title","item-value":"value",color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue","items"])])):h("",!0),e("div",_s,[e("div",ps,[s[15]||(s[15]=e("div",{class:"reservation-recording-settings__label"},"録画予約の有効/無効",-1)),r(Le,{disabled:t.reservation.is_recording_in_progress,style:{height:"0","margin-top":"-40px","margin-right":"6px"},modelValue:n.value.is_enabled,"onUpdate:modelValue":[s[1]||(s[1]=u=>n.value.is_enabled=u),p],color:"primary",density:"compact","hide-details":""},null,8,["disabled","modelValue"])]),s[16]||(s[16]=e("div",{class:"reservation-recording-settings__description mb-0"},[w(" 予約が無効なときは、この番組の録画動作を行いません。"),e("br"),w(" キーワード自動予約条件により不必要な番組が予約されてしまっているときは、予約を無効にしてみてください。(予約削除ではすぐ再追加されてしまい意味がありません。) ")],-1))]),e("div",fs,[s[17]||(s[17]=e("div",{class:"reservation-recording-settings__label"},"録画予約の優先度",-1)),s[18]||(s[18]=e("div",{class:"reservation-recording-settings__description mb-0"}," 放送時間が重なりチューナーが足りないときは、より優先度が高い予約から優先的に録画します。 ",-1)),e("div",bs,[r(Ie,{disabled:t.reservation.is_recording_in_progress,modelValue:n.value.priority,"onUpdate:modelValue":[s[2]||(s[2]=u=>n.value.priority=u),p],min:1,max:5,step:1,color:"primary",density:"compact","show-ticks":"always","thumb-label":"","hide-details":""},null,8,["disabled","modelValue"])])]),e("div",ys,[s[19]||(s[19]=e("div",{class:"reservation-recording-settings__label"},"録画フォルダのパス",-1)),s[20]||(s[20]=e("div",{class:"reservation-recording-settings__description"}," 空欄にすると、デフォルトの録画フォルダに保存されます。 ",-1)),r(N,{disabled:t.reservation.is_recording_in_progress,modelValue:m.value,"onUpdate:modelValue":[s[3]||(s[3]=u=>m.value=u),p],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:z(f).is_linux_environment?"/mnt/hdd/Records/2025年春アニメ":"E:\\Records\\2025年春アニメ"},null,8,["disabled","modelValue","placeholder"])]),e("div",hs,[s[21]||(s[21]=Ue('<div class="reservation-recording-settings__label" data-v-8b066103>録画ファイル名テンプレート (マクロ)</div><div class="reservation-recording-settings__description" data-v-8b066103> 空欄にすると、デフォルトの録画ファイル名テンプレート (マクロ) が録画ファイル名の変更に利用されます。<br data-v-8b066103><div class="mt-1" data-v-8b066103><a class="link" href="https://github.com/xtne6f/EDCB/blob/work-plus-s/Document/Readme_EpgTimer.txt#L929-L1008" target="_blank" data-v-8b066103>テンプレート構文の一覧</a> / <a class="link" href="https://github.com/xtne6f/EDCB/blob/work-plus-s/Document/Readme_Mod.txt#%E3%83%9E%E3%82%AF%E3%83%AD" target="_blank" data-v-8b066103>xtne6f 版での追加差分</a></div></div>',2)),r(N,{disabled:t.reservation.is_recording_in_progress,modelValue:_.value,"onUpdate:modelValue":[s[4]||(s[4]=u=>_.value=u),p],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:"$ZtoH(Title)$.ts"},null,8,["disabled","modelValue"])]),e("div",ws,[s[22]||(s[22]=e("div",{class:"reservation-recording-settings__label"},"録画マージン (秒)",-1)),s[23]||(s[23]=e("div",{class:"reservation-recording-settings__description"}," 番組開始時刻の何秒前から録画を開始し、番組終了時刻の何秒後に録画を終了するかの設定です。最低でも5秒以上をおすすめします。(0秒だと番組の冒頭/末尾が欠けてしまいます。) ",-1)),e("div",Vs,[r(Oe,{disabled:t.reservation.is_recording_in_progress,id:"use-default-margin",modelValue:x.value,"onUpdate:modelValue":[s[5]||(s[5]=u=>x.value=u),J],color:"primary",density:"compact","hide-details":""},null,8,["disabled","modelValue"]),e("label",xs,y(M.value),1)]),e("div",ks,[r(N,{disabled:t.reservation.is_recording_in_progress||x.value,modelValue:n.value.recording_start_margin,"onUpdate:modelValue":[s[6]||(s[6]=u=>n.value.recording_start_margin=u),p],modelModifiers:{number:!0},color:"primary",variant:"outlined",density:"compact",type:"number","hide-details":"",prefix:"番組開始",suffix:"秒前",style:{width:"160px"}},null,8,["disabled","modelValue"]),r(N,{disabled:t.reservation.is_recording_in_progress||x.value,modelValue:n.value.recording_end_margin,"onUpdate:modelValue":[s[7]||(s[7]=u=>n.value.recording_end_margin=u),p],modelModifiers:{number:!0},color:"primary",variant:"outlined",density:"compact",type:"number","hide-details":"",prefix:"番組終了",suffix:"秒後",style:{width:"166px"}},null,8,["disabled","modelValue"])])]),e("div",Cs,[s[24]||(s[24]=e("div",{class:"reservation-recording-settings__label"},"字幕データ録画設定",-1)),s[25]||(s[25]=e("div",{class:"reservation-recording-settings__description"},[w(" 字幕データはほとんど録画容量を消費しません。"),e("br"),w(" [録画する] に設定しておくことを強くおすすめします。 ")],-1)),r(K,{disabled:t.reservation.is_recording_in_progress,modelValue:n.value.caption_recording_mode,"onUpdate:modelValue":[s[8]||(s[8]=u=>n.value.caption_recording_mode=u),p],items:F.value,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue","items"])]),e("div",Ps,[s[26]||(s[26]=e("div",{class:"reservation-recording-settings__label"},"データ放送録画設定",-1)),s[27]||(s[27]=e("div",{class:"reservation-recording-settings__description"},[w(" データ放送は30分で 500MB 以上録画容量を消費する上、KonomiTV は録画再生時のデータ放送表示に非対応です。"),e("br"),w(" [録画しない] に設定しておくことを強くおすすめします。 ")],-1)),r(K,{disabled:t.reservation.is_recording_in_progress,modelValue:n.value.data_broadcasting_recording_mode,"onUpdate:modelValue":[s[9]||(s[9]=u=>n.value.data_broadcasting_recording_mode=u),p],items:A.value,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue","items"])]),e("div",$s,[s[28]||(s[28]=e("div",{class:"reservation-recording-settings__label"},"録画後動作設定",-1)),s[29]||(s[29]=e("div",{class:"reservation-recording-settings__description"}," 通常は [何もしない] のままで大丈夫です。録画後に録画 PC をスリープさせておきたい方のみ設定してください。環境によっては復帰できず以降の録画に失敗することがあります。 ",-1)),r(K,{disabled:t.reservation.is_recording_in_progress,modelValue:n.value.post_recording_mode,"onUpdate:modelValue":[s[10]||(s[10]=u=>n.value.post_recording_mode=u),p],items:T.value,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue","items"])]),e("div",Ds,[s[30]||(s[30]=e("div",{class:"reservation-recording-settings__label"},"録画後実行スクリプトのパス",-1)),e("div",Rs," 通常は空欄のままで大丈夫です。録画後に指定の "+y(z(f).is_linux_environment?".sh / .lua":".bat / .ps1 / .lua")+" スクリプトを実行させたい方のみ設定してください。 ",1),r(N,{disabled:t.reservation.is_recording_in_progress,modelValue:n.value.post_recording_bat_file_path,"onUpdate:modelValue":[s[11]||(s[11]=u=>n.value.post_recording_bat_file_path=u),p],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:z(f).is_linux_environment?"/var/local/edcb/transcode.sh":"C:\\DTV\\EDCB\\Transcode.bat"},null,8,["disabled","modelValue","placeholder"])])])}}}),Us=te(Ss,[["__scopeId","data-v-8b066103"]]),Es={class:"reservation-detail-drawer__header"},Bs={class:"reservation-detail-drawer__tab-text"},Ls={class:"reservation-detail-drawer__content"},Is={key:0,class:"reservation-detail-drawer__info"},Ts={key:0,class:"status-banner status-banner--warning mb-4"},Ms={key:1,class:"status-banner status-banner--error mb-4"},Fs={key:2,class:"status-banner status-banner--info mb-4"},As={key:1,class:"reservation-detail-drawer__settings"},Os={key:0,class:"reservation-detail-drawer__footer"},Hs={class:"reservation-detail-drawer__actions"},js={key:1,class:"reservation-detail-drawer__footer"},Ns={class:"reservation-detail-drawer__actions"},zs={key:0,class:"mb-4"},Ks=["innerHTML"],Gs={class:"text-body-2 text-text-darken-1"},qs={key:1,class:"warning-banner warning-banner--recording"},Js={key:2,class:"warning-banner warning-banner--normal"},Qs={key:3,class:"warning-banner warning-banner--keyword mt-3"},Ws={class:"warning-banner warning-banner--normal"},Ys=se({__name:"ReservationDetailDrawer",props:{reservation:{},program:{},channel:{},isPastProgram:{type:Boolean},modelValue:{type:Boolean}},emits:["update:modelValue","updated","deleted","added"],setup(t,{emit:S}){const o=t,P=S,f=v({get:()=>o.modelValue,set:l=>P("update:modelValue",l)}),n=Fe(),$=v(()=>n.server_settings),m=C("info"),_=C(!1),U=C(!1),x=C(!1),D=C(null),R=C(!1),E=C(!1),B=C(null),F=v(()=>o.reservation!==null),A=v(()=>o.reservation!==null&&o.reservation.id===-1),T=v(()=>F.value&&!A.value),O=v(()=>{var l;return((l=o.reservation)==null?void 0:l.program)??o.program??null}),p=v(()=>n.is_loaded===!0&&$.value.general.backend==="EDCB"),M=v(()=>F.value&&!o.isPastProgram),J=v(()=>A.value&&!o.isPastProgram),i=v(()=>{var l;return((l=o.reservation)==null?void 0:l.comment.includes("EPG自動予約"))??!1}),s=v(()=>{var l;return((l=o.reservation)==null?void 0:l.is_recording_in_progress)??!1}),V=v(()=>{var l;return((l=o.reservation)==null?void 0:l.recording_availability)??"Full"}),u=v(()=>V.value==="Partial"),fe=v(()=>V.value==="Unavailable");pe(async()=>{await n.fetchServerSettingsOnce(),p.value&&(B.value=await G.fetchRecordingPresets())}),q(f,l=>{l?(m.value="info",_.value=!1,document.documentElement.classList.add("v-overlay-scroll-blocked")):document.documentElement.classList.remove("v-overlay-scroll-blocked")});const Q=()=>{if(_.value){E.value=!0;return}f.value=!1},be=()=>{E.value=!1,_.value=!1,f.value=!1},ye=l=>{D.value=l},he=async()=>{if(!_.value||U.value||!D.value||!o.reservation)return;const l=D.value.caption_recording_mode==="Default",a=D.value.data_broadcasting_recording_mode==="Default";if(l!==a){I.warning("字幕データ録画設定・データ放送録画設定を明示的に設定する際は、両方とも「デフォルト設定を使う」以外に設定してください。");return}U.value=!0;try{if(await G.updateReservation(o.reservation.id,D.value)){I.success("録画設定の変更を保存しました。");const k={...o.reservation,record_settings:D.value};P("updated",k),_.value=!1}}catch(g){console.error("Failed to save settings:",g),I.error("録画設定の保存に失敗しました。")}finally{U.value=!1}},we=()=>{R.value=!0},Ve=async()=>{if(R.value=!1,!!o.reservation)try{await G.deleteReservation(o.reservation.id)&&(I.success("録画予約を削除しました。"),P("deleted",o.reservation.id),f.value=!1)}catch(l){console.error("Failed to delete reservation:",l)}},xe=async()=>{if(!(x.value||!O.value||!o.reservation)){if(!p.value){I.error("録画予約機能は EDCB バックエンド選択時のみ利用できます。");return}x.value=!0;try{const l=D.value??o.reservation.record_settings,a=l.caption_recording_mode==="Default",g=l.data_broadcasting_recording_mode==="Default";if(a!==g){I.warning("字幕データ録画設定・データ放送録画設定を明示的に設定する際は、両方とも「デフォルト設定を使う」以外に設定してください。"),x.value=!1;return}await G.addReservation(O.value.id,l)&&(I.success("録画予約を追加しました。"),P("added"),f.value=!1)}catch(l){console.error("Failed to add reservation:",l),I.error("録画予約の追加に失敗しました。")}finally{x.value=!1}}};return(l,a)=>{const g=re("Icon");return d(),c(ee,null,[e("div",{class:j(["reservation-detail-drawer__scrim",{"reservation-detail-drawer__scrim--visible":f.value}]),onClick:Q},null,2),e("div",{class:j(["reservation-detail-drawer",{"reservation-detail-drawer--visible":f.value}])},[e("div",Es,[e("div",{class:j(["reservation-detail-drawer__tabs",{"reservation-detail-drawer__tabs--single":!M.value}])},[W((d(),c("div",{class:j(["reservation-detail-drawer__tab",{"reservation-detail-drawer__tab--active":m.value==="info"}]),onClick:a[0]||(a[0]=k=>m.value="info")},[r(g,{icon:"fluent:info-12-regular",width:"20px",height:"20px"}),e("span",Bs,"番組情報 "+y(M.value?"":"（終了済み）"),1)],2)),[[Z]]),M.value?W((d(),c("div",{key:0,class:j(["reservation-detail-drawer__tab",{"reservation-detail-drawer__tab--active":m.value==="settings"}]),onClick:a[1]||(a[1]=k=>m.value="settings")},[r(g,{icon:"material-symbols:settings-video-camera-outline-rounded",width:"20px",height:"20px"}),a[7]||(a[7]=e("span",{class:"reservation-detail-drawer__tab-text"},"録画設定",-1))],2)),[[Z]]):h("",!0)],2),W((d(),c("div",{class:"reservation-detail-drawer__close",onClick:Q},[r(g,{icon:"fluent:dismiss-16-filled",width:"22px",height:"22px"})])),[[Z]])]),e("div",Ls,[m.value==="info"?(d(),c("div",Is,[u.value?(d(),c("div",Ts,[r(g,{icon:"fluent:warning-16-filled",class:"status-banner__icon"}),a[8]||(a[8]=e("span",{class:"status-banner__text"},[w(" チューナー不足のため、この番組は一部のみ録画されます。"),e("br"),w(" 優先度を上げるか、重複する録画予約を調整してください。 ")],-1))])):h("",!0),fe.value?(d(),c("div",Ms,[r(g,{icon:"fluent:error-circle-16-filled",class:"status-banner__icon"}),a[9]||(a[9]=e("span",{class:"status-banner__text"},[w(" チューナー不足のため、この番組は録画できません。"),e("br"),w(" 優先度を上げるか、重複する録画予約を削除してください。 ")],-1))])):h("",!0),!p.value&&!t.isPastProgram&&!T.value?(d(),c("div",Fs,[r(g,{icon:"fluent:info-16-regular",class:"status-banner__icon"}),a[10]||(a[10]=e("span",{class:"status-banner__text"}," 録画予約機能は EDCB バックエンド選択時のみ利用できます。 ",-1))])):h("",!0),r(cs,{reservation:t.reservation,program:t.program,channel:t.channel},null,8,["reservation","program","channel"])])):h("",!0),m.value==="settings"&&t.reservation?(d(),c("div",As,[r(Us,{reservation:t.reservation,presets:B.value,"has-changes":_.value,onUpdateSettings:ye,onChangesDetected:a[2]||(a[2]=k=>_.value=k)},null,8,["reservation","presets","has-changes"])])):h("",!0)]),t.isPastProgram?(d(),c("div",js,[e("div",Ns,[r(L,{class:"px-3",variant:"text",onClick:Q},{default:b(()=>[r(g,{icon:"fluent:dismiss-16-regular",width:"20px",height:"20px"}),a[14]||(a[14]=e("span",{class:"ml-1"},"閉じる",-1))]),_:1})])])):(d(),c("div",Os,[e("div",Hs,[T.value?(d(),Y(L,{key:0,class:"px-3",variant:"text",onClick:we},{default:b(()=>[r(g,{icon:"fluent:delete-16-regular",width:"20px",height:"20px"}),a[11]||(a[11]=e("span",{class:"ml-1"},"予約を削除",-1))]),_:1})):h("",!0),T.value&&m.value==="settings"?(d(),Y(L,{key:1,class:"px-3",color:"secondary",variant:"flat",disabled:!_.value,loading:U.value,onClick:he},{default:b(()=>[r(g,{icon:"fluent:save-16-regular",width:"20px",height:"20px"}),a[12]||(a[12]=e("span",{class:"ml-1"},"変更を保存",-1))]),_:1},8,["disabled","loading"])):h("",!0),J.value?(d(),Y(L,{key:2,class:"px-3",color:"secondary",variant:"flat",disabled:!p.value,loading:x.value,onClick:xe},{default:b(()=>[r(g,{icon:"fluent:timer-16-regular",width:"20px",height:"20px"}),a[13]||(a[13]=e("span",{class:"ml-1"},"予約を追加",-1))]),_:1},8,["disabled","loading"])):h("",!0)])]))],2),r(ue,{modelValue:R.value,"onUpdate:modelValue":a[4]||(a[4]=k=>R.value=k),"max-width":"715"},{default:b(()=>[r(ce,null,{default:b(()=>[r(ge,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:b(()=>[...a[15]||(a[15]=[w(" 録画予約を削除しますか？ ",-1)])]),_:1}),r(ve,{class:"pt-2 pb-0"},{default:b(()=>[t.reservation?(d(),c("div",zs,[e("div",{class:"text-h6 text-text mb-2",innerHTML:z(X).decorateProgramInfo(t.reservation.program,"title")},null,8,Ks),e("div",Gs,y(z(X).getProgramTime(t.reservation.program)),1)])):h("",!0),s.value&&t.reservation?(d(),c("div",qs,[r(g,{icon:"fluent:warning-16-filled",class:"warning-banner__icon"}),a[16]||(a[16]=e("span",{class:"warning-banner__text"},[w(" この番組は現在録画中です。"),e("br"),w(" 予約を削除すると、現在までの録画ファイルは残りますが、残りの期間の録画は中断されます。 ")],-1))])):t.reservation?(d(),c("div",Js,[r(g,{icon:"fluent:info-16-regular",class:"warning-banner__icon"}),a[17]||(a[17]=e("span",{class:"warning-banner__text"}," 録画予約を削除すると、番組開始時刻までに再度予約を追加しない限り、この番組は録画されません。 ",-1))])):h("",!0),i.value&&t.reservation?(d(),c("div",Qs,[r(g,{icon:"fluent:warning-16-filled",class:"warning-banner__icon"}),a[18]||(a[18]=e("span",{class:"warning-banner__text"},[w(" この予約はキーワード自動予約で追加されました。削除してもすぐに再追加される可能性があります。"),e("br"),w(" 録画が不要な場合は削除ではなく「無効」にすることをおすすめします。 ")],-1))])):h("",!0)]),_:1}),r(me,{class:"pt-4 px-6 pb-6"},{default:b(()=>[r(_e),r(L,{color:"text",variant:"text",onClick:a[3]||(a[3]=k=>R.value=!1)},{default:b(()=>[r(g,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),a[19]||(a[19]=e("span",{class:"ml-1"},"キャンセル",-1))]),_:1}),r(L,{class:"px-3",color:"error",variant:"flat",onClick:Ve},{default:b(()=>[r(g,{icon:"fluent:delete-20-regular",width:"18px",height:"18px"}),a[20]||(a[20]=e("span",{class:"ml-1"},"予約を削除",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),r(ue,{modelValue:E.value,"onUpdate:modelValue":a[6]||(a[6]=k=>E.value=k),"max-width":"500"},{default:b(()=>[r(ce,null,{default:b(()=>[r(ge,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:b(()=>[...a[21]||(a[21]=[w(" 変更を破棄しますか？ ",-1)])]),_:1}),r(ve,{class:"pt-2 pb-0"},{default:b(()=>[e("div",Ws,[r(g,{icon:"fluent:info-16-regular",class:"warning-banner__icon"}),a[22]||(a[22]=e("span",{class:"warning-banner__text"},[w(" 録画設定の変更がまだ保存されていません。"),e("br"),w(" このまま閉じると、変更内容は破棄されます。 ")],-1))])]),_:1}),r(me,{class:"pt-4 px-6 pb-6"},{default:b(()=>[r(_e),r(L,{color:"text",variant:"text",onClick:a[5]||(a[5]=k=>E.value=!1)},{default:b(()=>[r(g,{icon:"fluent:arrow-left-20-regular",width:"18px",height:"18px"}),a[23]||(a[23]=e("span",{class:"ml-1"},"編集に戻る",-1))]),_:1}),r(L,{class:"px-3",color:"secondary",variant:"flat",onClick:be},{default:b(()=>[r(g,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),a[24]||(a[24]=e("span",{class:"ml-1"},"変更を破棄",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),lt=te(Ys,[["__scopeId","data-v-a2741630"]]);export{lt as R};
