import{H as pa,N as ya,S as _a}from"./SPHeaderBar-DvnuePHO.js";import{u as ba,R as ka,a as Ue,I as Ct}from"./ReservationDetailDrawer-C6E1mFjs.js";import{T as pe,a as Sa}from"./TimeTableSettings-DtjDxrTG.js";import{d as Ie,G as d,U as he,w as ct,j as Wt,k as fe,r as Je,f as ve,h as Z,b as R,B as qe,t as De,o as $,_ as Re,ae as Ta,u as Ne,q as S,af as Ye,N as j,s as ye,ag as wa,x as Ze,z as vt,c as J,e as ce,P as $e,n as Qe,a as r,p as Pt,V as ee,a2 as Ce,F as ge,g as Be,ac as Da,ah as Ht,D as xe,E as ke,O as He,X as Xe,ai as mt,aj as et,ak as xa,al as We,T as Pe,am as Ke,an as Ca,l as dt,Y as Ee,ao as Lt,ap as zt,Q as me,aq as Ut,ar as Pa,as as Ha,at as Ft,au as Ma,av as Va,aw as Ba,ax as Ia,ay as Ra,az as Oa,aA as Aa,I as $a,aB as Ya,aC as Ea,aD as Na,aE as Wa,aF as La,J as za,aG as Ua,aH as Fa,aI as Ga,M as ut}from"./index-FNB8-8D6.js";import{u as ja,P as qa}from"./ChannelsStore-DLXcz_q9.js";import{c as Fe,d as Mt}from"./VSelect-Bq-Cy6Fn.js";import{V as Xa,c as Ka}from"./ssrBoot-_OqiFBin.js";import{M as Gt}from"./VAvatar-DsJ9wVDO.js";import{b as Qa}from"./VTextField-C_0P4vzd.js";import"./VSwitch-641dQ9VF.js";import"./VChip-BGAy9xjh.js";import"./VSlider-CPqyQVQ_.js";import"./VDialog-chtCOHZl.js";import"./VCard-Ca-kHZue.js";const Ja={class:"timetable-channel-header__logo-wrapper"},Za=["src","alt"],el={class:"timetable-channel-header__info"},tl={class:"timetable-channel-header__number"},al={class:"timetable-channel-header__name"},ll=Ie({__name:"TimeTableChannelHeader",props:{channel:{},width:{},height:{},resizeTrigger:{}},setup(e){const a=e,v=d(()=>Math.round(Math.min(46,Math.max(32,a.width*.27)))),s=d(()=>Math.round(v.value*(3/4))),t=d(()=>Math.min(14,Math.max(13,a.width*.06))),m=d(()=>(a.resizeTrigger,Math.min(13.5,Math.max(he.isSmartphoneVertical()?10:12,a.width*.08)))),u=d(()=>`${a.channel.name} を視聴`);return(n,i)=>{const o=Je("router-link"),f=Wt("ftooltip");return ct(($(),fe(o,{class:"timetable-channel-header",to:`/tv/watch/${e.channel.display_channel_id}`,style:ve({width:`${e.width}px`,height:`${e.height}px`,"--timetable-channel-logo-width":`${v.value}px`,"--timetable-channel-logo-height":`${s.value}px`,"--timetable-channel-number-size":`${t.value}px`,"--timetable-channel-name-size":`${m.value}px`})},{default:Z(()=>[R("div",Ja,[R("img",{class:"timetable-channel-header__logo",loading:"lazy",decoding:"async",src:`${qe(he).api_base_url}/channels/${e.channel.id}/logo`,alt:e.channel.name},null,8,Za)]),R("div",el,[R("span",tl,De(e.channel.channel_number),1),R("span",al,De(e.channel.name),1)])]),_:1},8,["to","style"])),[[f,u.value,void 0,{bottom:!0}]])}}}),nl=Re(ll,[["__scopeId","data-v-b4f70efc"]]),jt=["ピン留め","地デジ","BS","CS","CATV","SKY","BS4K"],il=new Map([["地デジ","GR"],["BS","BS"],["CS","CS"],["CATV","CATV"],["SKY","SKY"],["BS4K","BS4K"]]),Le=Ta("timetable",()=>{const e=Ne(),a=ja(),v=S(null),s=S(p()),t=Ye([]),m=S(null),u=S(!1),n=S(!1),i=S(!1),o=S(0),f=S(null);function g(){const c=j(),O=p();if(s.value.isSame(O,"day")===!1)return!1;let A=c.hour();return A<4&&(A+=24),A>=17}function P(){const c=j(),O=p();if(s.value.isSame(O,"day")===!1)return null;const A=c.startOf("hour").subtract(1,"hour"),_=q();return A.isBefore(_)?_:A}function q(){return i.value?s.value.add(12,"hour"):s.value}function p(){const c=j();let O=c.hour(4).minute(0).second(0).millisecond(0);return c.hour()<4&&(O=O.subtract(1,"day")),O}function D(c,O=!1){return O?c.add(36,"hour"):c.add(1,"day")}const C=d(()=>i.value?s.value.add(12,"hour"):s.value),x=d(()=>{const c=new Set;if(a.is_channels_list_initial_updated===!1)return c;for(const O of a.channels_list_with_pinned.keys()){if(O==="ピン留め"){const A=a.channels_list_with_pinned.get("ピン留め");if(A===void 0||A.length===0)continue}c.add(O)}return c});function y(){return v.value===null?N():x.value.has(v.value)?null:N()}function N(){if(x.value.has("ピン留め"))return"ピン留め";if(x.value.has("地デジ"))return"地デジ";for(const c of jt)if(x.value.has(c))return c;return"地デジ"}async function z(c,O,A,_){i.value=g(),f.value=P();const W=c??q(),L=O??D(W,i.value),Q=A??v.value??"地デジ",de=Q==="ピン留め"?_??e.settings.pinned_channel_ids:void 0,se=il.get(Q),ae=await qa.fetchTimeTable(W,L,se,de);return ae===null?!1:(t.value=ae.channels,m.value={earliest:j(ae.date_range.earliest),latest:j(ae.date_range.latest)},!0)}async function X(){u.value=!0,n.value=!1;try{if(await a.update(),s.value=p(),v.value=N(),await z()===!1){u.value=!1;return}n.value=!0}finally{u.value=!1}}async function K(c){u.value=!0;try{s.value=c,await z()}finally{u.value=!1}}async function U(c){u.value=!0;try{v.value=c,await z()}finally{u.value=!1}}function te(){let O=j().hour();return O<4&&(O+=24),O>=17}async function b(){if(m.value===null)return;const c=p(),O=te();let A;if(i.value)A=s.value.subtract(1,"day");else if(O){const _=s.value.subtract(1,"day");_.isSame(c.add(1,"day"),"day")?A=c:A=_}else A=s.value.subtract(1,"day");A.isBefore(m.value.earliest,"day")||await K(A)}async function V(){if(m.value===null)return;let c;i.value?c=s.value.add(2,"day"):c=s.value.add(1,"day"),!c.isAfter(m.value.latest,"day")&&await K(c)}async function Y(){const c=p();s.value.isSame(c,"day")===!1&&await K(c)}function oe(c){o.value=c}const le=d(()=>{if(m.value===null)return!1;const c=p(),O=te();let A;if(i.value)A=s.value.subtract(1,"day");else if(O){const _=s.value.subtract(1,"day");_.isSame(c.add(1,"day"),"day")?A=c:A=_}else A=s.value.subtract(1,"day");return A.isSameOrAfter(m.value.earliest,"day")}),ne=d(()=>{if(m.value===null)return!1;let c;return i.value?c=s.value.add(2,"day"):c=s.value.add(1,"day"),c.isSameOrBefore(m.value.latest,"day")});function ie(){t.value=[],m.value=null,u.value=!1,n.value=!1,i.value=!1,o.value=0,f.value=null,v.value=null}return ye(()=>e.settings.pinned_channel_ids,async(c,O)=>{v.value==="ピン留め"&&n.value!==!1&&wa(c,O)===!1&&await z()},{deep:!0}),ye(()=>a.channels_list_with_pinned,async()=>{if(n.value===!1)return;const c=y();c!==null&&await U(c)},{deep:!0}),{selected_channel_type:v,selected_date:s,channels_data:t,date_range:m,is_loading:u,is_initial_load_completed:n,is_36hour_display:i,date_display_offset:o,scroll_top_limit_time:f,available_channel_types:x,display_start_time:C,can_go_previous_day:le,can_go_next_day:ne,getTodayStartTime:p,getDayEndTime:D,getDisplayStartTime:q,setDateDisplayOffset:oe,fetchTimeTableData:z,initialLoad:X,changeDate:K,changeChannelType:U,goToPreviousDay:b,goToNextDay:V,goToCurrentTime:Y,reset:ie}}),sl=Ie({__name:"TimeTableCurrentTimeLine",props:{hourHeight:{},totalWidth:{},channelHeaderHeight:{}},setup(e){const a=e,v=Le(),s=S(j());let t=null,m=null;const u=d(()=>{const i=s.value,o=v.getDisplayStartTime(),f=v.getDayEndTime(o,v.is_36hour_display);return i.isSameOrAfter(o)&&i.isBefore(f)}),n=d(()=>{if(!u.value)return 0;const i=v.getDisplayStartTime();return pe.calculateCurrentTimeY(s.value,i,a.hourHeight,a.channelHeaderHeight)-a.channelHeaderHeight});return Ze(()=>{const i=j(),o=i.add(1,"minute").startOf("minute"),f=Math.max(0,o.valueOf()-i.valueOf());m=setTimeout(()=>{s.value=j(),t=setInterval(()=>{s.value=j()},60*1e3)},f)}),vt(()=>{m!==null&&clearTimeout(m),t!==null&&clearInterval(t)}),(i,o)=>u.value?($(),J("div",{key:0,class:"timetable-current-time-line",style:ve({top:`${n.value}px`,width:`${e.totalWidth}px`})},[...o[0]||(o[0]=[R("div",{class:"timetable-current-time-line__indicator"},null,-1),R("div",{class:"timetable-current-time-line__line"},null,-1)])],4)):ce("",!0)}}),ol=Re(sl,[["__scopeId","data-v-8d4f4a9f"]]),rl={class:"timetable-program-cell__content"},ul={class:"timetable-program-cell__header"},cl={class:"timetable-program-cell__start-minute"},dl={key:0,class:"timetable-program-cell__reservation-icon"},vl={key:0,class:"timetable-program-cell__recording-icon"},ml=["innerHTML"],fl=["innerHTML"],hl={key:0,class:"timetable-program-cell__actions"},gl="fluent:timer-16-filled",pl="mdi:timer-pause-outline",yl=Ie({__name:"TimeTableProgramCell",props:{program:{},channel:{},hourHeight:{},channelWidth:{},fullChannelWidth:{},viewportHeight:{},channelHeaderHeight:{},isScrollAtBottom:{type:Boolean},isSubchannel:{type:Boolean},isSplit:{type:Boolean},isSelected:{type:Boolean},isPast:{type:Boolean},is36HourDisplay:{type:Boolean},isNextReserved:{type:Boolean},resizeTrigger:{}},emits:["click","show-detail","quick-reserve"],setup(e,{emit:a}){const v=new Map;function s(_,W){const L=_.title,Q=_.description;if(L===null||Q===null)return $e.decorateProgramInfo(_,W);const de=v.get(_.id);if(de===void 0||de.raw_title!==L||de.raw_description!==Q){const ae=$e.decorateProgramInfo(_,"title"),_e=$e.decorateProgramInfo(_,"description");v.set(_.id,{raw_title:L,raw_description:Q,title:ae,description:_e})}const se=v.get(_.id);return se===void 0?$e.decorateProgramInfo(_,W):W==="title"?se.title:se.description}const t=e,m=a,u=Ne(),n=Le(),i=S(!1),o=S(null),f=S(0),g=d(()=>(t.resizeTrigger,he.isTouchDevice()?t.isSelected:t.isSelected||u.settings.timetable_hover_expand&&i.value)),P=d(()=>t.program.reservation!==null),q=d(()=>{var _;return((_=t.program.reservation)==null?void 0:_.status)==="Recording"}),p=d(()=>{var _;return((_=t.program.reservation)==null?void 0:_.status)==="Disabled"}),D=d(()=>{var _;return((_=t.program.reservation)==null?void 0:_.recording_availability)==="Partial"}),C=d(()=>{var _;return((_=t.program.reservation)==null?void 0:_.recording_availability)==="Unavailable"}),x=d(()=>u.settings.timetable_dim_shopping_programs===!1?!1:$e.isShoppingProgram(t.program)),y=d(()=>C.value?"rgb(var(--v-theme-error))":D.value?"rgb(var(--v-theme-warning))":p.value?"rgb(var(--v-theme-text-darken-2))":"rgb(var(--v-theme-secondary))"),N=d(()=>p.value?pl:gl),z=d(()=>P.value?p.value?"mdi:timer-play-outline":"mdi:timer-pause-outline":"mdi:timer-plus-outline"),X=d(()=>{if(t.resizeTrigger,!P.value)return"録画予約";const _=u.settings.timetable_channel_width==="Narrow",W=u.settings.timetable_channel_width!=="Wide",L=he.isSmartphoneVertical()&&W||(he.isSmartphoneHorizontal()||he.isTabletVertical())&&_;return p.value?L?"有効化":"予約を有効化":L?"無効化":"予約を無効化"}),K=d(()=>j(t.program.start_time).minute().toString().padStart(2,"0")),U=d(()=>{var L,Q;const _=(Q=(L=t.program.genres)==null?void 0:L[0])==null?void 0:Q.major;return pe.getGenreColors(_,u.settings.timetable_genre_colors).highlight}),te=d(()=>{var L,Q;if(C.value)return"#f8d7da";if(D.value)return"#fff3cd";const _=(Q=(L=t.program.genres)==null?void 0:L[0])==null?void 0:Q.major;return pe.getGenreColors(_,u.settings.timetable_genre_colors).background}),b=d(()=>{const _=j(t.program.start_time),W=n.getDisplayStartTime();return pe.calculateProgramY(_,W,t.hourHeight,t.channelHeaderHeight)-t.channelHeaderHeight}),V=d(()=>(t.is36HourDisplay?36:24)*t.hourHeight),Y=d(()=>{const _=pe.calculateProgramHeight(t.program.duration,t.hourHeight);return b.value+_>V.value?Math.max(0,V.value-b.value):Math.max(_,20)}),oe=d(()=>{const _=t.fullChannelWidth??t.channelWidth,W=t.isSplit===!0&&t.channelWidth<_,L=g.value&&f.value>0?f.value:Y.value,Q=t.isSubchannel&&W?t.channelWidth:0,de=g.value&&W?0:Q,se=g.value&&W?_:t.channelWidth,ae={top:`${b.value}px`,left:`${de}px`,width:`${se}px`,minHeight:`${Y.value}px`,"--timetable-cell-height":`${L}px`,"--timetable-program-base-background":te.value,"--timetable-program-base-highlight":U.value};if(g.value||(ae.height=`${Y.value}px`),g.value&&t.viewportHeight>0&&t.isScrollAtBottom===!0){const _e=f.value>0?f.value:Y.value,Se=Math.max(0,V.value-t.viewportHeight),Te=Se+t.viewportHeight,T=b.value+_e,k=b.value+Y.value>=V.value-1;if(T>Te&&k){const H=T-Te,F=Math.max(0,b.value-Se),I=Math.min(H,F);I>0&&(ae.transform=`translateY(-${I}px)`)}}return ae}),le=d(()=>s(t.program,"title")),ne=d(()=>s(t.program,"description"));function ie(){m("click")}function c(){i.value=!0}function O(){i.value=!1}function A(){m("quick-reserve")}return ye(g,async _=>{if(_===!1){f.value=0;return}await Ce(),o.value!==null&&(f.value=Math.max(o.value.getBoundingClientRect().height,Y.value))}),(_,W)=>{const L=Je("Icon");return $(),J("div",{class:Qe(["timetable-program-cell",{"timetable-program-cell--selected":e.isSelected,"timetable-program-cell--expanded":g.value,"timetable-program-cell--past":e.isPast,"timetable-program-cell--subchannel":e.isSubchannel,"timetable-program-cell--reserved":P.value,"timetable-program-cell--recording":q.value,"timetable-program-cell--partial":D.value,"timetable-program-cell--unavailable":C.value,"timetable-program-cell--disabled":p.value,"timetable-program-cell--shopping":x.value,"timetable-program-cell--next-reserved":P.value&&e.isNextReserved}]),ref_key:"cellRef",ref:o,style:ve(oe.value),onClick:ie,onMouseenter:c,onMouseleave:O},[W[2]||(W[2]=R("div",{class:"timetable-program-cell__highlight"},null,-1)),R("div",rl,[R("div",ul,[R("span",cl,De(K.value),1),P.value?($(),J("div",dl,[r(L,{icon:N.value,width:"14px",style:ve({color:y.value})},null,8,["icon","style"]),q.value?($(),J("div",vl)):ce("",!0),D.value?($(),fe(L,{key:1,icon:"fluent:warning-16-filled",width:"12px",class:"timetable-program-cell__warning-icon"})):ce("",!0),C.value?($(),fe(L,{key:2,icon:"fluent:dismiss-circle-16-filled",width:"12px",class:"timetable-program-cell__error-icon"})):ce("",!0)])):ce("",!0)]),R("div",{class:"timetable-program-cell__title",innerHTML:le.value},null,8,ml),R("div",{class:"timetable-program-cell__description",innerHTML:ne.value},null,8,fl),g.value?($(),J("div",hl,[r(ee,{variant:"flat",size:"small",class:"timetable-program-cell__action-button",onClick:W[0]||(W[0]=Pt(Q=>_.$emit("show-detail"),["stop"]))},{default:Z(()=>[r(L,{icon:"fluent:info-12-regular",width:"16px"}),W[1]||(W[1]=R("span",null,"番組詳細",-1))]),_:1}),e.isPast?ce("",!0):($(),fe(ee,{key:0,variant:"flat",size:"small",class:Qe(["timetable-program-cell__action-button",{"timetable-program-cell__action-button--reserved":P.value&&!p.value,"timetable-program-cell__action-button--disabled-reservation":p.value}]),onClick:Pt(A,["stop"])},{default:Z(()=>[r(L,{icon:z.value,width:"16px"},null,8,["icon"]),R("span",null,De(X.value),1)]),_:1},8,["class"]))])):ce("",!0)])],38)}}}),Vt=Re(yl,[["__scopeId","data-v-8603e6bf"]]),_l={class:"timetable-time-scale"},bl=["data-hour"],kl={class:"timetable-time-scale__label"},Sl={key:0,class:"timetable-time-scale__date"},Tl={class:"timetable-time-scale__hour-number"},wl=Ie({__name:"TimeTableTimeScale",props:{hourHeight:{},is36HourDisplay:{type:Boolean}},setup(e){const a=e,v=Ne(),s=Le(),t=d(()=>{const i=a.is36HourDisplay?36:24,o=s.display_start_time,f=[];for(let g=0;g<i;g++)f.push(o.add(g,"hour"));return f});function m(i){const o=i.hour();return v.settings.use_28hour_clock&&o>=0&&o<=3?(o+24).toString().padStart(2,"0"):o.toString().padStart(2,"0")}function u(i){const o=i.hour(),f=s.display_start_time;return!([0,4,8,12,16,20].includes(o)===!1||a.is36HourDisplay&&o===4&&f.hour()===4)}function n(i){return`${i.month()+1}/${i.date()}`}return(i,o)=>($(),J("div",_l,[($(!0),J(ge,null,Be(t.value,f=>($(),J("div",{class:"timetable-time-scale__hour",key:f.valueOf(),style:ve({height:`${a.hourHeight}px`}),"data-hour":f.hour()},[R("div",kl,[u(f)?($(),J("span",Sl,De(n(f)),1)):ce("",!0),R("span",Tl,De(m(f)),1),o[0]||(o[0]=R("span",{class:"timetable-time-scale__hour-label"},"時",-1))])],12,bl))),128))]))}}),Dl=Re(wl,[["__scopeId","data-v-fe795608"]]),xl={class:"timetable-grid__channel-headers"},Cl={class:"timetable-grid__content"},Pl=2,Hl=3,Ml=.5,Vl=60,Bl=2,Il=100,Rl=120,Bt=.95,Ge=.5,je=5,Ol=Ie({__name:"TimeTableGrid",props:{channels:{},is36HourDisplay:{type:Boolean},canGoPreviousDay:{type:Boolean},canGoNextDay:{type:Boolean}},emits:["time-slot-change","date-display-offset-change","show-program-detail","quick-reserve","go-to-next-day","go-to-previous-day"],setup(e,{expose:a,emit:v}){const s=e,t=v,m=Ne(),u=Le(),n=S(null),i=S(null),o=S(!1),f=S(!1);let g=0;const P=S(0),q=S(!1),p=S(0),D=S(0),C=S(0),x=S(0),y=S(null);let N=null,z=null;const X=S(0),K=new Set;let U=null,te=null,b=null;const V=S(0);let Y=null;function oe(){Y!==null&&clearTimeout(Y),Y=window.setTimeout(()=>{V.value++,Y=null},Il)}const le=S(!1),ne=S(!1),ie=S(!1),c=S(null),O=S(0),A=S(0),_=S(0),W=S(0),L=S(!1),Q=S(!1),de=S(0),se=S(0),ae=S(0),_e=S(0),Se=S(0),Te=S(0),T=S(null),k=d(()=>(V.value,pe.getDeviceType())),H=d(()=>pe.getChannelWidth(m.settings.timetable_channel_width,k.value)),F=d(()=>pe.getHourHeight(m.settings.timetable_hour_height,k.value)),I=d(()=>k.value==="Smartphone"?Hl:Pl),re=d(()=>pe.getChannelHeaderHeight(H.value)),we=d(()=>(V.value,pe.getTimeScaleWidth(k.value,he.isSmartphoneVertical()))),tt=d(()=>s.channels.length*H.value),Me=d(()=>(s.is36HourDisplay?36:24)*F.value);function ea(l){return l.subchannels===null||l.subchannels.length===0?!1:l.subchannels.some(h=>h.programs.length>0)}const at=new Map,Oe=new Map;function lt(l){if(l==null)return{start:0,end:0};const h=at.get(l.id);if(h!==void 0)return h;const M={start:j(l.start_time).valueOf(),end:j(l.end_time).valueOf()};return at.set(l.id,M),M}function ft(l,h){const M=lt(l);return h.some(w=>{const G=lt(w);return G.start<M.end&&G.end>M.start})}function nt(l,h,M){const w=`${h.id}:${M?"sub":"main"}`,G=Oe.get(w);if(G!==void 0)return G;const B=pt(l);if(B.length===0)return Oe.set(w,!1),!1;if(M){const ue=ft(h,l.programs);return Oe.set(w,ue),ue}const E=ft(h,B);return Oe.set(w,E),E}function ht(l,h,M){return nt(l,h,M)?H.value/2:H.value}function Ve(l){const h=F.value*I.value;p.value=Math.max(0,l-h),D.value=l+P.value+h}function ta(l){const M=F.value*I.value*Ml,w=l+P.value;return P.value<=0||D.value===0||l<p.value+M||w>D.value-M?(Ve(l),!0):!1}function gt(l){const h=lt(l),M=(h.start-X.value)/(1e3*60*60)*F.value;return(h.end-X.value)/(1e3*60*60)*F.value>=p.value&&M<=D.value}function aa(l){return l.subchannels===null?[]:l.subchannels}function pt(l){return l.subchannels===null?[]:l.subchannels.flatMap(h=>h.programs)}function yt(l){return j(l.end_time).isBefore(j())}function _t(l,h,M){const w=M?pt(l):l.programs,G=j(h.end_time).valueOf(),B=w.find(E=>j(E.start_time).valueOf()===G);return B!==void 0&&B.reservation!==null}function bt(){if(n.value===null)return;C.value;const l=x.value;g=l;const h=n.value.clientHeight-re.value;P.value!==h&&(P.value=h);const M=n.value.scrollHeight-n.value.clientHeight,w=l>=M-1;q.value!==w&&(q.value=w),ta(l)&&Ae();const B=l>M-100&&s.canGoNextDay,E=l<100&&s.canGoPreviousDay;o.value!==B&&(o.value=B),f.value!==E&&(f.value=E);const ue=u.getDisplayStartTime(),be=Math.floor(l/F.value);let st=ue.add(be,"hour").hour();st<4&&(st+=24);const fa=Math.floor((st-4)/4)*4+4,ot=Math.max(4,Math.min(24,fa));if(N!==ot&&(t("time-slot-change",ot),N=ot),s.is36HourDisplay){const ha=m.settings.use_28hour_clock?4:0;let ze=ue.hour(ha).minute(0).second(0).millisecond(0);ze.isSameOrBefore(ue)&&(ze=ze.add(1,"day"));const ga=(ze.valueOf()-ue.valueOf())/(1e3*60*60)*F.value,rt=l>=ga?1:0;z!==rt&&(t("date-display-offset-change",rt),z=rt)}else z!==0&&(t("date-display-offset-change",0),z=0);kt()}function la(){y.value===null&&(y.value=requestAnimationFrame(()=>{y.value=null,bt()}))}function Ae(){b===null&&(b=requestAnimationFrame(()=>{b=null,St()}))}function kt(){te===null&&(te=requestAnimationFrame(()=>{te=null,na()}))}function St(){n.value!==null&&(U!==null&&(U.disconnect(),K.clear()),U=new IntersectionObserver(l=>{for(const h of l){const M=h.target,w=h.rootBounds;if(w===null)continue;const G=h.intersectionRect.top<=w.top,B=h.intersectionRect.height<h.boundingClientRect.height,E=w.height<h.boundingClientRect.height;if(h.isIntersecting&&G&&(B||E))K.add(M),M.classList.add("timetable-program-cell--fixed");else{K.delete(M),M.classList.remove("timetable-program-cell--fixed");const be=M.querySelector(".timetable-program-cell__content");be!==null&&(be.style.paddingTop="")}}kt()},{root:n.value,rootMargin:`-${re.value}px 0px 0px 0px`,threshold:[0,1]}),n.value.querySelectorAll(".timetable-program-cell").forEach(l=>{U==null||U.observe(l)}))}function na(){if(n.value===null||K.size===0)return;const l=n.value.getBoundingClientRect().top+re.value;K.forEach(h=>{const M=h.querySelector(".timetable-program-cell__content");if(M===null)return;const w=h.getBoundingClientRect().top,G=l-w;if(G<=0){M.style.paddingTop="";return}const B=h.style.getPropertyValue("--timetable-cell-height"),E=B?Number.parseFloat(B):h.getBoundingClientRect().height,ue=Math.max(0,E-Vl),be=h.classList.contains("timetable-program-cell--reserved")?3:0,xt=Math.min(G,ue);M.style.paddingTop=`${Bl+Math.max(xt-be,0)}px`})}function ia(){n.value!==null&&(C.value=n.value.scrollLeft,x.value=n.value.scrollTop,la())}function Tt(l){n.value!==null&&(T.value!==null&&(cancelAnimationFrame(T.value),T.value=null),l.deltaX!==0&&(l.preventDefault(),n.value.scrollLeft+=l.deltaX),l.shiftKey&&l.deltaY!==0?(l.preventDefault(),n.value.scrollLeft+=l.deltaY):l.deltaY!==0&&l.deltaX===0&&(l.preventDefault(),n.value.scrollTop+=l.deltaY))}function sa(l){if(l.pointerType!=="mouse"||n.value===null)return;const h=l.target;h.closest(".v-btn")||h.closest("a")||(ne.value=!0,le.value=!1,L.value=!1,O.value=l.clientX,A.value=l.clientY,_.value=n.value.scrollLeft,W.value=n.value.scrollTop,T.value!==null&&(cancelAnimationFrame(T.value),T.value=null),se.value=0,ae.value=0,_e.value=performance.now(),Se.value=l.clientX,Te.value=l.clientY)}function oa(l){if(l.pointerType!=="mouse"||ne.value===!1||n.value===null)return;const h=O.value-l.clientX,M=A.value-l.clientY;if((Math.abs(h)>je||Math.abs(M)>je)&&le.value===!1&&n.value!==null&&(le.value=!0,L.value=!0,n.value.setPointerCapture(l.pointerId),ie.value=!0,c.value=l.pointerId),le.value===!1)return;l.preventDefault(),(Math.abs(h)>je||Math.abs(M)>je)&&(L.value=!0),n.value.scrollLeft=_.value+h,n.value.scrollTop=W.value+M;const w=performance.now(),G=w-_e.value;if(G>0){const B=l.clientX-Se.value,E=l.clientY-Te.value;se.value=-B/G*16,ae.value=-E/G*16}_e.value=w,Se.value=l.clientX,Te.value=l.clientY}function wt(l){if(l.pointerType==="mouse"&&ne.value!==!1){if(ne.value=!1,le.value=!1,n.value!==null&&ie.value&&c.value!==null)try{n.value.releasePointerCapture(c.value)}catch{}ie.value=!1,c.value=null,L.value?(ua(),Q.value=!0,de.value=performance.now()):(Q.value=!1,de.value=0)}}function ra(l){if(Q.value===!1)return;performance.now()-de.value<=Rl&&(l.preventDefault(),l.stopPropagation()),Q.value=!1}function ua(){if(n.value===null||Math.abs(se.value)<Ge&&Math.abs(ae.value)<Ge)return;const l=()=>{if(n.value!==null){if(se.value*=Bt,ae.value*=Bt,n.value.scrollLeft+=se.value,n.value.scrollTop+=ae.value,Math.abs(se.value)<Ge&&Math.abs(ae.value)<Ge){T.value=null;return}T.value=requestAnimationFrame(l)}};T.value=requestAnimationFrame(l)}function Dt(l){i.value===l.id?i.value=null:i.value=l.id}function ca(l){if(n.value===null)return;const M=u.getDisplayStartTime().hour();let G=(l===24?0:l)-M;G<0&&(G+=24);const B=G*F.value;n.value.scrollTo({top:B,behavior:"smooth"})}function da(){const l=u.scroll_top_limit_time;if(l===null)return 0;const h=u.getDisplayStartTime(),w=(l.valueOf()-h.valueOf())/(1e3*60*60);return Math.max(0,w*F.value)}function it(l=!0,h=!1){if(n.value===null)return;const M=j(),w=u.getDisplayStartTime(),G=da(),ue=(M.subtract(30,"minute").valueOf()-w.valueOf())/(1e3*60*60),be=Math.max(G,ue*F.value);if(h){n.value.scrollTo({top:be,behavior:l?"smooth":"instant"});return}if(G===0){n.value.scrollTo({top:0,behavior:"instant"});return}n.value.scrollTo({top:G,behavior:"instant"}),l&&setTimeout(()=>{n.value!==null&&n.value.scrollTo({top:be,behavior:"smooth"})},50)}function va(){n.value!==null&&n.value.scrollTo({top:0,behavior:"instant"})}function ma(){if(n.value===null)return;const l=n.value.scrollHeight-n.value.clientHeight;n.value.scrollTo({top:l,behavior:"instant"})}return a({scrollToHour:ca,scrollToCurrentTime:it,scrollToStart:va,scrollToEnd:ma}),Ze(async()=>{window.addEventListener("resize",oe),n.value!==null&&n.value.addEventListener("wheel",Tt,{passive:!1}),await Ce(),n.value!==null&&(C.value=n.value.scrollLeft,x.value=n.value.scrollTop,bt(),St()),setTimeout(()=>{it(),Ve(g)},100)}),Da(()=>{window.removeEventListener("resize",oe),Y!==null&&(clearTimeout(Y),Y=null),n.value!==null&&n.value.removeEventListener("wheel",Tt),y.value!==null&&cancelAnimationFrame(y.value),te!==null&&cancelAnimationFrame(te),b!==null&&cancelAnimationFrame(b),U!==null&&(U.disconnect(),U=null,K.clear()),T.value!==null&&cancelAnimationFrame(T.value)}),vt(()=>{T.value!==null&&cancelAnimationFrame(T.value)}),ye(()=>s.channels,async(l,h)=>{at.clear(),Oe.clear(),Ve(g),Ae(),h.length===0&&l.length>0&&(await Ce(),setTimeout(()=>{it(),Ae()},100))},{deep:!1}),ye([F,P],()=>{Ve(g),Ae()}),ye(re,()=>{Ae()}),ye(()=>u.display_start_time,l=>{X.value=l.valueOf()},{immediate:!0}),(l,h)=>{const M=Je("Icon");return $(),J("div",{class:"timetable-grid",style:ve({"--timetable-channel-header-height":`${re.value}px`})},[R("div",{class:Qe(["timetable-grid__scroll-area",{"timetable-grid__scroll-area--dragging":le.value}]),ref_key:"scrollAreaRef",ref:n,onScroll:ia,onPointerdown:sa,onPointermove:oa,onPointerup:wt,onPointercancel:wt,onClickCapture:ra},[R("div",{class:"timetable-grid__layout",style:ve({width:`${we.value+tt.value}px`,height:`${re.value+Me.value}px`})},[R("div",{class:"timetable-grid__header-row",style:ve({height:`${re.value}px`})},[R("div",{class:"timetable-grid__corner",style:ve({width:`${we.value}px`})},null,4),R("div",xl,[($(!0),J(ge,null,Be(e.channels,w=>($(),fe(nl,{key:w.channel.id,channel:w.channel,width:H.value,height:re.value,resizeTrigger:V.value},null,8,["channel","width","height","resizeTrigger"]))),128))])],4),R("div",{class:"timetable-grid__body-row",style:ve({height:`${Me.value}px`})},[R("div",{class:"timetable-grid__time-scale",style:ve({width:`${we.value}px`})},[r(Dl,{hourHeight:F.value,is36HourDisplay:s.is36HourDisplay},null,8,["hourHeight","is36HourDisplay"])],4),R("div",Cl,[($(!0),J(ge,null,Be(e.channels,(w,G)=>($(),J("div",{class:"timetable-grid__channel-column",key:w.channel.id,style:ve({left:`${G*H.value}px`,width:`${H.value}px`,height:`${Me.value}px`})},[R("div",{class:"timetable-grid__channel-background",style:ve({height:`${Me.value}px`})},null,4),($(!0),J(ge,null,Be(w.programs,B=>($(),J(ge,{key:B.id},[gt(B)?($(),fe(Vt,{key:0,program:B,channel:w.channel,hourHeight:F.value,channelWidth:ht(w,B,!1),fullChannelWidth:H.value,isSplit:nt(w,B,!1),viewportHeight:P.value,channelHeaderHeight:re.value,isScrollAtBottom:q.value,isSelected:i.value===B.id,isPast:yt(B),is36HourDisplay:s.is36HourDisplay,isNextReserved:_t(w,B,!1),resizeTrigger:V.value,onClick:E=>Dt(B),onShowDetail:E=>l.$emit("show-program-detail",B.id,w.channel,B),onQuickReserve:E=>l.$emit("quick-reserve",B.id,w.channel,B)},null,8,["program","channel","hourHeight","channelWidth","fullChannelWidth","isSplit","viewportHeight","channelHeaderHeight","isScrollAtBottom","isSelected","isPast","is36HourDisplay","isNextReserved","resizeTrigger","onClick","onShowDetail","onQuickReserve"])):ce("",!0)],64))),128)),ea(w)?($(!0),J(ge,{key:0},Be(aa(w),B=>($(),J(ge,{key:B.channel.id},[($(!0),J(ge,null,Be(B.programs,E=>($(),J(ge,{key:E.id},[gt(E)?($(),fe(Vt,{key:0,program:E,channel:B.channel,hourHeight:F.value,channelWidth:ht(w,E,!0),fullChannelWidth:H.value,isSplit:nt(w,E,!0),viewportHeight:P.value,channelHeaderHeight:re.value,isScrollAtBottom:q.value,isSubchannel:!0,isSelected:i.value===E.id,isPast:yt(E),is36HourDisplay:s.is36HourDisplay,isNextReserved:_t(w,E,!0),resizeTrigger:V.value,onClick:ue=>Dt(E),onShowDetail:ue=>l.$emit("show-program-detail",E.id,B.channel,E),onQuickReserve:ue=>l.$emit("quick-reserve",E.id,B.channel,E)},null,8,["program","channel","hourHeight","channelWidth","fullChannelWidth","isSplit","viewportHeight","channelHeaderHeight","isScrollAtBottom","isSelected","isPast","is36HourDisplay","isNextReserved","resizeTrigger","onClick","onShowDetail","onQuickReserve"])):ce("",!0)],64))),128))],64))),128)):ce("",!0)],4))),128)),r(ol,{hourHeight:F.value,totalWidth:tt.value,channelHeaderHeight:re.value},null,8,["hourHeight","totalWidth","channelHeaderHeight"])])],4)],4)],34),r(Ht,{name:"fade"},{default:Z(()=>[o.value?($(),fe(ee,{key:0,class:"timetable-grid__next-day-button",variant:"elevated",color:"background-lighten-1",onClick:h[0]||(h[0]=w=>l.$emit("go-to-next-day"))},{default:Z(()=>[r(M,{icon:"fluent:chevron-down-20-regular",width:"20px"}),h[2]||(h[2]=R("span",null,"次の日を見る",-1))]),_:1})):ce("",!0)]),_:1}),r(Ht,{name:"fade"},{default:Z(()=>[f.value?($(),fe(ee,{key:0,class:"timetable-grid__prev-day-button",variant:"elevated",color:"background-lighten-1",onClick:h[1]||(h[1]=w=>l.$emit("go-to-previous-day"))},{default:Z(()=>[r(M,{icon:"fluent:chevron-up-20-regular",width:"20px"}),h[3]||(h[3]=R("span",null,"前の日を見る",-1))]),_:1})):ce("",!0)]),_:1})],4)}}}),Al=Re(Ol,[["__scopeId","data-v-e5631ddb"]]),qt=ke({active:{type:[String,Array],default:void 0},disabled:{type:[Boolean,String,Array],default:null},nextIcon:{type:Xe,default:"$next"},prevIcon:{type:Xe,default:"$prev"},modeIcon:{type:Xe,default:"$subgroup"},text:String,viewMode:{type:String,default:"month"}},"VDatePickerControls"),It=xe()({name:"VDatePickerControls",props:qt(),emits:{"click:year":()=>!0,"click:month":()=>!0,"click:prev":()=>!0,"click:next":()=>!0,"click:text":()=>!0},setup(e,a){let{emit:v}=a;const s=d(()=>Array.isArray(e.disabled)?e.disabled.includes("text"):!!e.disabled),t=d(()=>Array.isArray(e.disabled)?e.disabled.includes("mode"):!!e.disabled),m=d(()=>Array.isArray(e.disabled)?e.disabled.includes("prev"):!!e.disabled),u=d(()=>Array.isArray(e.disabled)?e.disabled.includes("next"):!!e.disabled);function n(){v("click:prev")}function i(){v("click:next")}function o(){v("click:year")}function f(){v("click:month")}return He(()=>r("div",{class:["v-date-picker-controls"]},[r(ee,{class:"v-date-picker-controls__month-btn","data-testid":"month-btn",disabled:s.value,text:e.text,variant:"text",rounded:!0,onClick:f},null),r(ee,{class:"v-date-picker-controls__mode-btn","data-testid":"year-btn",disabled:t.value,density:"comfortable",icon:e.modeIcon,variant:"text",onClick:o},null),r(Xa,null,null),r("div",{class:"v-date-picker-controls__month"},[r(ee,{"data-testid":"prev-month",disabled:m.value,icon:e.prevIcon,variant:"text",onClick:n},null),r(ee,{"data-testid":"next-month",disabled:u.value,icon:e.nextIcon,variant:"text",onClick:i},null)])])),{}}}),$l=ke({appendIcon:Xe,color:String,header:String,transition:String,onClick:xa()},"VDatePickerHeader"),Rt=xe()({name:"VDatePickerHeader",props:$l(),emits:{click:()=>!0,"click:append":()=>!0},setup(e,a){let{emit:v,slots:s}=a;const{backgroundColorClasses:t,backgroundColorStyles:m}=mt(e,"color");function u(){v("click")}function n(){v("click:append")}return He(()=>{const i=!!(s.default||e.header),o=!!(s.append||e.appendIcon);return r("div",{class:["v-date-picker-header",{"v-date-picker-header--clickable":!!e.onClick},t.value],style:m.value,onClick:u},[s.prepend&&r("div",{key:"prepend",class:"v-date-picker-header__prepend"},[s.prepend()]),i&&r(Gt,{key:"content",name:e.transition},{default:()=>{var f;return[r("div",{key:e.header,class:"v-date-picker-header__content"},[((f=s.default)==null?void 0:f.call(s))??e.header])]}}),o&&r("div",{class:"v-date-picker-header__append"},[s.append?r(et,{key:"append-defaults",disabled:!e.appendIcon,defaults:{VBtn:{icon:e.appendIcon,variant:"text"}}},{default:()=>{var f;return[(f=s.append)==null?void 0:f.call(s)]}}):r(ee,{key:"append-btn",icon:e.appendIcon,variant:"text",onClick:n},null)])])}),{}}}),Yl=ke({allowedDates:[Array,Function],disabled:{type:Boolean,default:null},displayValue:null,modelValue:Array,month:[Number,String],max:null,min:null,showAdjacentMonths:Boolean,year:[Number,String],weekdays:{type:Array,default:()=>[0,1,2,3,4,5,6]},weeksInMonth:{type:String,default:"dynamic"},firstDayOfWeek:[Number,String]},"calendar");function El(e){const a=We(),v=Pe(e,"modelValue",[],p=>Ke(p).map(D=>a.date(D))),s=d(()=>e.displayValue?a.date(e.displayValue):v.value.length>0?a.date(v.value[0]):e.min?a.date(e.min):Array.isArray(e.allowedDates)?a.date(e.allowedDates[0]):a.date()),t=Pe(e,"year",void 0,p=>{const D=p!=null?Number(p):a.getYear(s.value);return a.startOfYear(a.setYear(a.date(),D))},p=>a.getYear(p)),m=Pe(e,"month",void 0,p=>{const D=p!=null?Number(p):a.getMonth(s.value),C=a.setYear(a.startOfMonth(a.date()),a.getYear(t.value));return a.setMonth(C,D)},p=>a.getMonth(p)),u=d(()=>e.firstDayOfWeek??e.weekdays[0]),n=d(()=>{const p=Number(e.firstDayOfWeek??0);return e.weekdays.map(D=>(D+p)%7)}),i=d(()=>{const p=a.getWeekArray(m.value,u.value),D=p.flat(),C=6*7;if(e.weeksInMonth==="static"&&D.length<C){const x=D[D.length-1];let y=[];for(let N=1;N<=C-D.length;N++)y.push(a.addDays(x,N)),N%7===0&&(p.push(y),y=[])}return p});function o(p,D){return p.filter(C=>n.value.includes(a.toJsDate(C).getDay())).map((C,x)=>{const y=a.toISO(C),N=!a.isSameMonth(C,m.value),z=a.isSameDay(C,a.startOfMonth(m.value)),X=a.isSameDay(C,a.endOfMonth(m.value)),K=a.isSameDay(C,m.value);return{date:C,isoDate:y,formatted:a.format(C,"keyboardDate"),year:a.getYear(C),month:a.getMonth(C),isDisabled:q(C),isWeekStart:x%7===0,isWeekEnd:x%7===6,isToday:a.isSameDay(C,D),isAdjacent:N,isHidden:N&&!e.showAdjacentMonths,isStart:z,isSelected:v.value.some(U=>a.isSameDay(C,U)),isEnd:X,isSame:K,localized:a.format(C,"dayOfMonth")}})}const f=d(()=>{const p=a.startOfWeek(s.value,e.firstDayOfWeek),D=[];for(let x=0;x<=6;x++)D.push(a.addDays(p,x));const C=a.date();return o(D,C)}),g=d(()=>{const p=i.value.flat(),D=a.date();return o(p,D)}),P=d(()=>i.value.map(p=>p.length?Ca(a,p[0]):null));function q(p){if(e.disabled)return!0;const D=a.date(p);return e.min&&a.isAfter(a.date(e.min),D)||e.max&&a.isAfter(D,a.date(e.max))?!0:Array.isArray(e.allowedDates)&&e.allowedDates.length>0?!e.allowedDates.some(C=>a.isSameDay(a.date(C),D)):typeof e.allowedDates=="function"?!e.allowedDates(D):!1}return{displayValue:s,daysInMonth:g,daysInWeek:f,genDays:o,model:v,weeksInMonth:i,weekDays:n,weekNumbers:P}}const Xt=ke({color:String,hideWeekdays:Boolean,multiple:[Boolean,Number,String],showWeek:Boolean,transition:{type:String,default:"picker-transition"},reverseTransition:{type:String,default:"picker-reverse-transition"},...Ee(Yl(),["displayValue"])},"VDatePickerMonth"),Ot=xe()({name:"VDatePickerMonth",props:Xt(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=S(),{daysInMonth:m,model:u,weekNumbers:n}=El(e),i=We(),o=Ye(),f=Ye(),g=Ye(!1),P=d(()=>g.value?e.reverseTransition:e.transition);e.multiple==="range"&&u.value.length>0&&(o.value=u.value[0],u.value.length>1&&(f.value=u.value[u.value.length-1]));const q=d(()=>{const x=["number","string"].includes(typeof e.multiple)?Number(e.multiple):1/0;return u.value.length>=x});ye(m,(x,y)=>{y&&(g.value=i.isBefore(x[0].date,y[0].date))});function p(x){const y=i.startOfDay(x);if(u.value.length===0?o.value=void 0:u.value.length===1&&(o.value=u.value[0],f.value=void 0),!o.value)o.value=y,u.value=[o.value];else if(f.value)o.value=x,f.value=void 0,u.value=[o.value];else{if(i.isSameDay(y,o.value)){o.value=void 0,u.value=[];return}else i.isBefore(y,o.value)?(f.value=i.endOfDay(o.value),o.value=y):f.value=i.endOfDay(y);const N=i.getDiff(f.value,o.value,"days"),z=[o.value];for(let X=1;X<N;X++){const K=i.addDays(o.value,X);z.push(K)}z.push(f.value),u.value=z}}function D(x){const y=u.value.findIndex(N=>i.isSameDay(N,x));if(y===-1)u.value=[...u.value,x];else{const N=[...u.value];N.splice(y,1),u.value=N}}function C(x){e.multiple==="range"?p(x):e.multiple?D(x):u.value=[x]}return()=>r("div",{class:"v-date-picker-month"},[e.showWeek&&r("div",{key:"weeks",class:"v-date-picker-month__weeks"},[!e.hideWeekdays&&r("div",{key:"hide-week-days",class:"v-date-picker-month__day"},[dt(" ")]),n.value.map(x=>r("div",{class:["v-date-picker-month__day","v-date-picker-month__day--adjacent"]},[x]))]),r(Gt,{name:P.value},{default:()=>{var x;return[r("div",{ref:t,key:(x=m.value[0].date)==null?void 0:x.toString(),class:"v-date-picker-month__days"},[!e.hideWeekdays&&i.getWeekdays(e.firstDayOfWeek).map(y=>r("div",{class:["v-date-picker-month__day","v-date-picker-month__weekday"]},[y])),m.value.map((y,N)=>{const z={props:{onClick:()=>C(y.date)},item:y,i:N};return q.value&&!y.isSelected&&(y.isDisabled=!0),r("div",{class:["v-date-picker-month__day",{"v-date-picker-month__day--adjacent":y.isAdjacent,"v-date-picker-month__day--hide-adjacent":y.isHidden,"v-date-picker-month__day--selected":y.isSelected,"v-date-picker-month__day--week-end":y.isWeekEnd,"v-date-picker-month__day--week-start":y.isWeekStart}],"data-v-date":y.isDisabled?void 0:y.isoDate},[(e.showAdjacentMonths||!y.isAdjacent)&&r(et,{defaults:{VBtn:{class:"v-date-picker-month__day-btn",color:(y.isSelected||y.isToday)&&!y.isDisabled?e.color:void 0,disabled:y.isDisabled,icon:!0,ripple:!1,text:y.localized,variant:y.isDisabled?y.isToday?"outlined":"text":y.isToday&&!y.isSelected?"outlined":"flat",onClick:()=>C(y.date)}}},{default:()=>{var X;return[((X=s.day)==null?void 0:X.call(s,z))??r(ee,z.props,null)]}})])})])]}})])}}),Kt=ke({color:String,height:[String,Number],min:null,max:null,modelValue:Number,year:Number},"VDatePickerMonths"),At=xe()({name:"VDatePickerMonths",props:Kt(),emits:{"update:modelValue":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=We(),m=Pe(e,"modelValue"),u=d(()=>{let n=t.startOfYear(t.date());return e.year&&(n=t.setYear(n,e.year)),Lt(12).map(i=>{const o=t.format(n,"monthShort"),f=!!(e.min&&t.isAfter(t.startOfMonth(t.date(e.min)),n)||e.max&&t.isAfter(n,t.startOfMonth(t.date(e.max))));return n=t.getNextMonth(n),{isDisabled:f,text:o,value:i}})});return zt(()=>{m.value=m.value??t.getMonth(t.date())}),He(()=>r("div",{class:"v-date-picker-months",style:{height:Ut(e.height)}},[r("div",{class:"v-date-picker-months__content"},[u.value.map((n,i)=>{var g;const o={active:m.value===i,color:m.value===i?e.color:void 0,disabled:n.isDisabled,rounded:!0,text:n.text,variant:m.value===n.value?"flat":"text",onClick:()=>f(i)};function f(P){if(m.value===P){v("update:modelValue",m.value);return}m.value=P}return((g=s.month)==null?void 0:g.call(s,{month:n,i,props:o}))??r(ee,me({key:"month"},o),null)})])])),{}}}),Qt=ke({color:String,height:[String,Number],min:null,max:null,modelValue:Number},"VDatePickerYears"),$t=xe()({name:"VDatePickerYears",props:Qt(),emits:{"update:modelValue":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=We(),m=Pe(e,"modelValue"),u=d(()=>{const i=t.getYear(t.date());let o=i-100,f=i+52;e.min&&(o=t.getYear(t.date(e.min))),e.max&&(f=t.getYear(t.date(e.max)));let g=t.startOfYear(t.date());return g=t.setYear(g,o),Lt(f-o+1,o).map(P=>{const q=t.format(g,"year");return g=t.setYear(g,t.getYear(g)+1),{text:q,value:P}})});zt(()=>{m.value=m.value??t.getYear(t.date())});const n=Pa();return Ze(async()=>{var i;await Ce(),(i=n.el)==null||i.scrollIntoView({block:"center"})}),He(()=>r("div",{class:"v-date-picker-years",style:{height:Ut(e.height)}},[r("div",{class:"v-date-picker-years__content"},[u.value.map((i,o)=>{var g;const f={ref:m.value===i.value?n:void 0,active:m.value===i.value,color:m.value===i.value?e.color:void 0,rounded:!0,text:i.text,variant:m.value===i.value?"flat":"text",onClick:()=>{if(m.value===i.value){v("update:modelValue",m.value);return}m.value=i.value}};return((g=s.year)==null?void 0:g.call(s,{year:i,i:o,props:f}))??r(ee,me({key:"month"},f),null)})])])),{}}}),Nl=Ka("v-picker-title"),Jt=ke({color:String,...Ua(),...za(),...La(),...Wa(),...Na(),...Ea(),...Ya(),...$a(),...Aa()},"VSheet"),Yt=xe()({name:"VSheet",props:Jt(),setup(e,a){let{slots:v}=a;const{themeClasses:s}=Ha(e),{backgroundColorClasses:t,backgroundColorStyles:m}=mt(Ft(e,"color")),{borderClasses:u}=Ma(e),{dimensionStyles:n}=Va(e),{elevationClasses:i}=Ba(e),{locationStyles:o}=Ia(e),{positionClasses:f}=Ra(e),{roundedClasses:g}=Oa(e);return He(()=>r(e.tag,{class:["v-sheet",s.value,t.value,u.value,i.value,f.value,g.value,e.class],style:[m.value,n.value,o.value,e.style]},v)),{}}}),Zt=ke({bgColor:String,landscape:Boolean,title:String,hideHeader:Boolean,...Jt()},"VPicker"),Et=xe()({name:"VPicker",props:Zt(),setup(e,a){let{slots:v}=a;const{backgroundColorClasses:s,backgroundColorStyles:t}=mt(Ft(e,"color"));return He(()=>{const m=Yt.filterProps(e),u=!!(e.title||v.title);return r(Yt,me(m,{color:e.bgColor,class:["v-picker",{"v-picker--landscape":e.landscape,"v-picker--with-actions":!!v.actions},e.class],style:e.style}),{default:()=>{var n;return[!e.hideHeader&&r("div",{key:"header",class:[s.value],style:[t.value]},[u&&r(Nl,{key:"picker-title"},{default:()=>{var i;return[((i=v.title)==null?void 0:i.call(v))??e.title]}}),v.header&&r("div",{class:"v-picker__header"},[v.header()])]),r("div",{class:"v-picker__body"},[(n=v.default)==null?void 0:n.call(v)]),v.actions&&r(et,{defaults:{VBtn:{slim:!0,variant:"text"}}},{default:()=>[r("div",{class:"v-picker__actions"},[v.actions()])]})]}})}),{}}}),Wl=ke({header:{type:String,default:"$vuetify.datePicker.header"},...qt(),...Xt({weeksInMonth:"static"}),...Ee(Kt(),["modelValue"]),...Ee(Qt(),["modelValue"]),...Zt({title:"$vuetify.datePicker.title"}),modelValue:null},"VDatePicker"),Nt=xe()({name:"VDatePicker",props:Wl(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0,"update:viewMode":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=We(),{t:m}=Fa(),u=Pe(e,"modelValue",void 0,b=>Ke(b).map(V=>t.date(V)),b=>e.multiple?b:b[0]),n=Pe(e,"viewMode"),i=d(()=>{const b=t.date(e.min);return e.min&&t.isValid(b)?b:null}),o=d(()=>{const b=t.date(e.max);return e.max&&t.isValid(b)?b:null}),f=d(()=>{var Y;const b=t.date();let V=b;return(Y=u.value)!=null&&Y[0]?V=t.date(u.value[0]):i.value&&t.isBefore(b,i.value)?V=i.value:o.value&&t.isAfter(b,o.value)&&(V=o.value),V&&t.isValid(V)?V:b}),g=S(Number(e.month??t.getMonth(t.startOfMonth(f.value)))),P=S(Number(e.year??t.getYear(t.startOfYear(t.setMonth(f.value,g.value))))),q=Ye(!1),p=d(()=>e.multiple&&u.value.length>1?m("$vuetify.datePicker.itemsSelected",u.value.length):u.value[0]&&t.isValid(u.value[0])?t.format(t.date(u.value[0]),"normalDateWithWeekday"):m(e.header)),D=d(()=>{let b=t.date();return b=t.setDate(b,1),b=t.setMonth(b,g.value),b=t.setYear(b,P.value),t.format(b,"monthAndYear")}),C=d(()=>`date-picker-header${q.value?"-reverse":""}-transition`),x=d(()=>{if(e.disabled)return!0;const b=[];if(n.value!=="month")b.push("prev","next");else{let V=t.date();if(V=t.startOfMonth(V),V=t.setMonth(V,g.value),V=t.setYear(V,P.value),i.value){const Y=t.addDays(t.startOfMonth(V),-1);t.isAfter(i.value,Y)&&b.push("prev")}if(o.value){const Y=t.addDays(t.endOfMonth(V),1);t.isAfter(Y,o.value)&&b.push("next")}}return b});function y(){g.value<11?g.value++:(P.value++,g.value=0,te(P.value)),U(g.value)}function N(){g.value>0?g.value--:(P.value--,g.value=11,te(P.value)),U(g.value)}function z(){n.value="month"}function X(){n.value=n.value==="months"?"month":"months"}function K(){n.value=n.value==="year"?"month":"year"}function U(b){n.value==="months"&&X(),v("update:month",b)}function te(b){n.value==="year"&&K(),v("update:year",b)}return ye(u,(b,V)=>{const Y=Ke(V),oe=Ke(b);if(!oe.length)return;const le=t.date(Y[Y.length-1]),ne=t.date(oe[oe.length-1]),ie=t.getMonth(ne),c=t.getYear(ne);ie!==g.value&&(g.value=ie,U(g.value)),c!==P.value&&(P.value=c,te(P.value)),q.value=t.isBefore(le,ne)}),He(()=>{const b=Et.filterProps(e),V=It.filterProps(e),Y=Rt.filterProps(e),oe=Ot.filterProps(e),le=Ee(At.filterProps(e),["modelValue"]),ne=Ee($t.filterProps(e),["modelValue"]),ie={header:p.value,transition:C.value};return r(Et,me(b,{class:["v-date-picker",`v-date-picker--${n.value}`,{"v-date-picker--show-week":e.showWeek},e.class],style:e.style}),{title:()=>{var c;return((c=s.title)==null?void 0:c.call(s))??r("div",{class:"v-date-picker__title"},[m(e.title)])},header:()=>s.header?r(et,{defaults:{VDatePickerHeader:{...ie}}},{default:()=>{var c;return[(c=s.header)==null?void 0:c.call(s,ie)]}}):r(Rt,me({key:"header"},Y,ie,{onClick:n.value!=="month"?z:void 0}),{...s,default:void 0}),default:()=>r(ge,null,[r(It,me(V,{disabled:x.value,text:D.value,"onClick:next":y,"onClick:prev":N,"onClick:month":X,"onClick:year":K}),null),r(Qa,{hideOnLeave:!0},{default:()=>[n.value==="months"?r(At,me({key:"date-picker-months"},le,{modelValue:g.value,"onUpdate:modelValue":[c=>g.value=c,U],min:i.value,max:o.value,year:P.value}),null):n.value==="year"?r($t,me({key:"date-picker-years"},ne,{modelValue:P.value,"onUpdate:modelValue":[c=>P.value=c,te],min:i.value,max:o.value}),null):r(Ot,me({key:"date-picker-month"},oe,{modelValue:u.value,"onUpdate:modelValue":c=>u.value=c,month:g.value,"onUpdate:month":[c=>g.value=c,U],year:P.value,"onUpdate:year":[c=>P.value=c,te],min:i.value,max:o.value}),null)]})]),actions:s.actions})}),{}}}),Ll={class:"route-container"},zl={class:"timetable-controls"},Ul={class:"timetable-controls__date"},Fl={key:0,class:"timetable-controls-mobile"},Gl={class:"timetable-controls-mobile__inner"},jl={class:"timetable-controls-mobile__date"},ql=100,Xl=Ie({__name:"TimeTable",setup(e){Ne();const a=Le(),v=S(null),s=ba(),t=d(()=>s.server_settings),m=d(()=>t.value.general.backend==="EDCB"),u=S(!1),n=S(!1),i=S(0);let o=null;function f(){o!==null&&clearTimeout(o),o=window.setTimeout(()=>{i.value++,o=null},ql)}const g=d(()=>(i.value,he.isSmartphoneVertical()||he.isSmartphoneHorizontal()||he.isTabletVertical())),P=d(()=>(i.value,!he.isSmartphoneVertical())),q=d(()=>a.date_display_offset),p=S(!1),D=S(null),C=S(null),x=S(null),y=S(!1),N=d(()=>{const T=[],k=a.available_channel_types;for(const H of jt)k.has(H)&&T.push({title:H,value:H});return T}),z=d({get:()=>a.selected_channel_type,set:T=>{a.changeChannelType(T)}}),X=d(()=>{const T=[],k=a.is_36hour_display&&q.value===0;for(let H=4;H<=24;H+=4){const F=H,I=H<=12;T.push({title:`${F.toString().padStart(2,"0")}時`,value:H,...k&&I?{props:{disabled:!0}}:{}})}return T});function K(){let k=j().hour();return k<4&&(k+=24),Math.floor((k-4)/4)*4+4}const U=S(K()),te=d(()=>{const T=a.selected_date.add(q.value,"day"),k=T.month()+1,H=T.date(),F=["日","月","火","水","木","金","土"][T.day()];return`${k}/${H} (${F})`}),b=d({get:()=>a.selected_date.toDate(),set:T=>{const k=j(T).hour(4).minute(0).second(0).millisecond(0);a.changeDate(k)}}),V=d(()=>a.can_go_previous_day),Y=d(()=>a.can_go_next_day),oe=d(()=>{if(a.date_range!==null)return a.date_range.earliest.startOf("day").toDate()}),le=d(()=>{if(a.date_range!==null)return a.date_range.latest.endOf("day").toDate()});function ne(T){if(a.date_range===null)return!1;const k=j(T);return k.isSameOrAfter(a.date_range.earliest,"day")&&k.isSameOrBefore(a.date_range.latest,"day")}function ie(T){a.changeChannelType(T)}function c(T){n.value=!1;const k=j(T).hour(4).minute(0).second(0).millisecond(0);a.changeDate(k)}function O(T){T===null||v.value===null||v.value.scrollToHour(T)}async function A(){await a.goToPreviousDay(),await Ce(),v.value!==null&&v.value.scrollToEnd()}async function _(){await a.goToNextDay(),await Ce(),v.value!==null&&v.value.scrollToStart()}async function W(){await a.goToCurrentTime(),await Ce(),v.value!==null&&v.value.scrollToCurrentTime(!0,!0)}function L(T){const k=Math.floor((T-4)/4)*4+4,H=Math.max(4,Math.min(24,k));U.value=H}function Q(T){a.setDateDisplayOffset(T)}async function de(T,k,H){const F=j(H.end_time);if(y.value=F.isBefore(j()),H.reservation!==null){const I=await Ue.fetchReservation(H.reservation.id);I!==null?(D.value=I,C.value=null,x.value=null):(D.value=se(H,k),C.value=null,x.value=null)}else D.value=se(H,k),C.value=null,x.value=null;p.value=!0}function se(T,k){return{id:-1,channel:k,program:T,is_recording_in_progress:!1,recording_availability:"Full",comment:"",scheduled_recording_file_name:"",estimated_recording_file_size:0,record_settings:structuredClone(Ct)}}async function ae(){await a.fetchTimeTableData()}async function _e(){await a.fetchTimeTableData()}async function Se(){await a.fetchTimeTableData()}async function Te(T,k,H){if(j(H.end_time).isBefore(j()))return;if(m.value===!1){ut.warning("録画予約機能は EDCB バックエンド利用時のみ使用できます。");return}if(H.reservation!==null){const re=await Ue.fetchReservation(H.reservation.id);if(re===null)return;const we=structuredClone(re.record_settings);if(we.is_enabled=!we.is_enabled,await Ue.updateReservation(re.id,we)!==null){const Me=we.is_enabled?`録画予約を有効にしました。
番組開始時刻になると自動的に録画が開始されます。`:`録画予約を無効にしました。
番組開始時刻までに再度予約を有効にしない限り、この番組は録画されません。`;ut.success(Me),await a.fetchTimeTableData()}return}await Ue.addReservation(T,structuredClone(Ct))&&(ut.success("録画予約を追加しました。"),await a.fetchTimeTableData())}return Ze(async()=>{window.addEventListener("resize",f),await s.fetchServerSettingsOnce(),await a.initialLoad()}),vt(()=>{window.removeEventListener("resize",f),o!==null&&(clearTimeout(o),o=null),a.reset()}),ye(()=>a.selected_date,()=>{a.setDateDisplayOffset(0)}),(T,k)=>{const H=Je("Icon"),F=Wt("ftooltip");return $(),J("div",Ll,[r(pa,null,Ga({_:2},[g.value?void 0:{name:"timetable-controls",fn:Z(()=>[R("div",zl,[r(Fe,{class:"timetable-controls__channel-type",variant:"outlined",density:"compact","hide-details":"",items:N.value,modelValue:z.value,"onUpdate:modelValue":[k[0]||(k[0]=I=>z.value=I),ie]},null,8,["items","modelValue"]),R("div",Ul,[r(ee,{variant:"flat",icon:"",size:"small",disabled:!V.value,onClick:A},{default:Z(()=>[r(H,{icon:"fluent:chevron-left-20-regular",width:"20px"})]),_:1},8,["disabled"]),r(Mt,{modelValue:n.value,"onUpdate:modelValue":k[2]||(k[2]=I=>n.value=I),"close-on-content-click":!1},{activator:Z(({props:I})=>[r(ee,me({variant:"flat",class:"timetable-controls__date-button"},I),{default:Z(()=>[dt(De(te.value),1)]),_:1},16)]),default:Z(()=>[r(Nt,{modelValue:b.value,"onUpdate:modelValue":[k[1]||(k[1]=I=>b.value=I),c],color:"primary",min:oe.value,max:le.value,"allowed-dates":ne},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"]),r(ee,{variant:"flat",icon:"",size:"small",disabled:!Y.value,onClick:_},{default:Z(()=>[r(H,{icon:"fluent:chevron-right-20-regular",width:"20px"})]),_:1},8,["disabled"])]),r(Fe,{class:"timetable-controls__time",variant:"outlined",density:"compact","hide-details":"",items:X.value,modelValue:U.value,"onUpdate:modelValue":[k[3]||(k[3]=I=>U.value=I),O]},null,8,["items","modelValue"]),ct(($(),fe(ee,{variant:"flat",class:"timetable-controls__now-button",icon:"",onClick:W},{default:Z(()=>[r(H,{icon:"fluent:clock-20-regular",width:"22px"})]),_:1})),[[F,"現在時刻に移動",void 0,{bottom:!0}]]),ct(($(),fe(ee,{variant:"flat",class:"timetable-controls__settings-button",icon:"",onClick:k[4]||(k[4]=I=>u.value=!0)},{default:Z(()=>[r(H,{icon:"fluent:settings-20-regular",width:"22px"})]),_:1})),[[F,"番組表の表示設定",void 0,{bottom:!0}]])])]),key:"0"}]),1024),R("main",null,[r(ya,{"icon-only":P.value},null,8,["icon-only"]),R("div",{class:Qe(["timetable-container",{"timetable-container--loading":qe(a).is_loading}])},[r(_a),g.value?($(),J("div",Fl,[R("div",Gl,[r(Fe,{class:"timetable-controls-mobile__channel-type",variant:"outlined",density:"compact","hide-details":"",items:N.value,modelValue:z.value,"onUpdate:modelValue":[k[5]||(k[5]=I=>z.value=I),ie]},null,8,["items","modelValue"]),R("div",jl,[r(Mt,{modelValue:n.value,"onUpdate:modelValue":k[7]||(k[7]=I=>n.value=I),"close-on-content-click":!1},{activator:Z(({props:I})=>[r(ee,me({variant:"flat",class:"timetable-controls-mobile__date-button",size:"small"},I),{default:Z(()=>[dt(De(te.value),1)]),_:1},16)]),default:Z(()=>[r(Nt,{modelValue:b.value,"onUpdate:modelValue":[k[6]||(k[6]=I=>b.value=I),c],color:"primary",min:oe.value,max:le.value,"allowed-dates":ne},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"])]),r(Fe,{class:"timetable-controls-mobile__time",variant:"outlined",density:"compact","hide-details":"",items:X.value,modelValue:U.value,"onUpdate:modelValue":[k[8]||(k[8]=I=>U.value=I),O]},null,8,["items","modelValue"]),r(ee,{variant:"flat",class:"timetable-controls-mobile__now-button",icon:"",size:"small",onClick:W},{default:Z(()=>[r(H,{icon:"fluent:clock-20-regular",width:"18px"})]),_:1}),r(ee,{variant:"flat",class:"timetable-controls-mobile__settings-button",icon:"",size:"small",onClick:k[9]||(k[9]=I=>u.value=!0)},{default:Z(()=>[r(H,{icon:"fluent:settings-20-regular",width:"18px"})]),_:1})])])):ce("",!0),r(Al,{ref_key:"timetableGridRef",ref:v,channels:qe(a).channels_data,is36HourDisplay:qe(a).is_36hour_display,canGoPreviousDay:V.value,canGoNextDay:Y.value,onTimeSlotChange:L,onDateDisplayOffsetChange:Q,onShowProgramDetail:de,onQuickReserve:Te,onGoToNextDay:_,onGoToPreviousDay:A},null,8,["channels","is36HourDisplay","canGoPreviousDay","canGoNextDay"])],2)]),r(Sa,{isOpen:u.value,"onUpdate:isOpen":k[10]||(k[10]=I=>u.value=I)},null,8,["isOpen"]),r(ka,{modelValue:p.value,"onUpdate:modelValue":k[11]||(k[11]=I=>p.value=I),reservation:D.value,program:C.value,channel:x.value,isPastProgram:y.value,onAdded:ae,onUpdated:_e,onDeleted:Se},null,8,["modelValue","reservation","program","channel","isPastProgram"])])}}}),mn=Re(Xl,[["__scopeId","data-v-40dcefde"]]);export{mn as default};
