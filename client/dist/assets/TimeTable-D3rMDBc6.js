import{H as ga,N as pa,S as ya}from"./SPHeaderBar-DHYKIoWf.js";import{u as _a,R as ba,a as Ue,I as Ct}from"./ReservationDetailDrawer-DcJpu5Wq.js";import{T as he,a as ka}from"./TimeTableSettings-BRzsl8Dw.js";import{d as Ie,G as c,U as me,w as ct,j as Wt,k as ve,r as Je,f as re,h as J,b as R,B as qe,t as De,o as E,_ as Re,ae as Sa,u as Ne,q as b,af as Ye,N as G,s as ge,ag as Ta,x as Ze,z as vt,c as te,e as oe,P as Ae,n as Qe,a as o,p as Pt,V as Z,a2 as Ce,F as we,g as $e,ac as wa,ah as Ht,D as xe,E as be,O as He,X as Xe,ai as mt,aj as et,ak as Da,al as We,T as Pe,am as Ke,an as xa,l as dt,Y as Ee,ao as Lt,ap as zt,Q as de,aq as Ut,ar as Ca,as as Pa,at as Ft,au as Ha,av as Ma,aw as Va,ax as Ba,ay as Ia,az as Ra,aA as Oa,I as Aa,aB as $a,aC as Ya,aD as Ea,aE as Na,aF as Wa,J as La,aG as za,aH as Ua,aI as Fa,M as ut}from"./index-Da91cxHn.js";import{u as Ga,P as ja}from"./ChannelsStore-B_myz0yE.js";import{c as Fe,d as Mt}from"./VSelect-DL4W8-X-.js";import{V as qa,c as Xa}from"./ssrBoot-uJDF8aJ1.js";import{M as Gt}from"./VAvatar-DjFGxyA-.js";import{b as Ka}from"./VTextField-O1_pOS4K.js";import"./VSwitch-BknbpaVM.js";import"./VChip-oJ3Kn7Gx.js";import"./VSlider-Dj_FfjTw.js";import"./VDialog-CKz6Ug1K.js";import"./VCard-DN2hJ20o.js";const Qa={class:"timetable-channel-header__logo-wrapper"},Ja=["src","alt"],Za={class:"timetable-channel-header__info"},el={class:"timetable-channel-header__number"},tl={class:"timetable-channel-header__name"},al=Ie({__name:"TimeTableChannelHeader",props:{channel:{},width:{},height:{},resizeTrigger:{}},setup(e){const a=e,d=c(()=>Math.round(Math.min(46,Math.max(32,a.width*.27)))),r=c(()=>Math.round(d.value*(3/4))),t=c(()=>Math.min(14,Math.max(13,a.width*.06))),f=c(()=>(a.resizeTrigger,Math.min(13.5,Math.max(me.isSmartphoneVertical()?10:12,a.width*.08)))),u=c(()=>`${a.channel.name} を視聴`);return(l,i)=>{const s=Je("router-link"),m=Wt("ftooltip");return ct((E(),ve(s,{class:"timetable-channel-header",to:`/tv/watch/${e.channel.display_channel_id}`,style:re({width:`${e.width}px`,height:`${e.height}px`,"--timetable-channel-logo-width":`${d.value}px`,"--timetable-channel-logo-height":`${r.value}px`,"--timetable-channel-number-size":`${t.value}px`,"--timetable-channel-name-size":`${f.value}px`})},{default:J(()=>[R("div",Qa,[R("img",{class:"timetable-channel-header__logo",loading:"lazy",decoding:"async",src:`${qe(me).api_base_url}/channels/${e.channel.id}/logo`,alt:e.channel.name},null,8,Ja)]),R("div",Za,[R("span",el,De(e.channel.channel_number),1),R("span",tl,De(e.channel.name),1)])]),_:1},8,["to","style"])),[[m,u.value,void 0,{bottom:!0}]])}}}),ll=Re(al,[["__scopeId","data-v-b4f70efc"]]),jt=["ピン留め","地デジ","BS","CS","CATV","SKY","BS4K"],nl=new Map([["地デジ","GR"],["BS","BS"],["CS","CS"],["CATV","CATV"],["SKY","SKY"],["BS4K","BS4K"]]),Le=Sa("timetable",()=>{const e=Ne(),a=Ga(),d=b(null),r=b(N()),t=Ye([]),f=b(null),u=b(!1),l=b(!1),i=b(!1),s=b(null);function m(){const v=G(),$=N();if(r.value.isSame($,"day")===!1)return!1;let z=v.hour();return z<4&&(z+=24),z>=17}function g(){const v=G(),$=N();if(r.value.isSame($,"day")===!1)return null;const z=v.startOf("hour").subtract(1,"hour"),K=C();return z.isBefore(K)?K:z}function C(){return i.value?r.value.add(12,"hour"):r.value}function N(){const v=G();let $=v.hour(4).minute(0).second(0).millisecond(0);return v.hour()<4&&($=$.subtract(1,"day")),$}function S(v,$=!1){return $?v.add(36,"hour"):v.add(1,"day")}const P=c(()=>i.value?r.value.add(12,"hour"):r.value),w=c(()=>{const v=new Set;if(a.is_channels_list_initial_updated===!1)return v;for(const $ of a.channels_list_with_pinned.keys()){if($==="ピン留め"){const z=a.channels_list_with_pinned.get("ピン留め");if(z===void 0||z.length===0)continue}v.add($)}return v});function H(){return d.value===null?p():w.value.has(d.value)?null:p()}function p(){if(w.value.has("ピン留め"))return"ピン留め";if(w.value.has("地デジ"))return"地デジ";for(const v of jt)if(w.value.has(v))return v;return"地デジ"}async function O(v,$,z,K){i.value=m(),s.value=g();const le=v??C(),Y=$??S(le,i.value),fe=z??d.value??"地デジ",pe=fe==="ピン留め"?K??e.settings.pinned_channel_ids:void 0,D=nl.get(fe),A=await ja.fetchTimeTable(le,Y,D,pe);return A===null?!1:(t.value=A.channels,f.value={earliest:G(A.date_range.earliest),latest:G(A.date_range.latest)},!0)}async function q(){u.value=!0,l.value=!1;try{if(await a.update(),r.value=N(),d.value=p(),await O()===!1){u.value=!1;return}l.value=!0}finally{u.value=!1}}async function j(v){u.value=!0;try{r.value=v,await O()}finally{u.value=!1}}async function X(v){u.value=!0;try{d.value=v,await O()}finally{u.value=!1}}async function L(){if(f.value===null)return;const v=r.value.subtract(1,"day");v.isBefore(f.value.earliest,"day")||await j(v)}async function ae(){if(f.value===null)return;const v=r.value.add(1,"day");v.isAfter(f.value.latest,"day")||await j(v)}async function y(){const v=N();r.value.isSame(v,"day")===!1&&await j(v)}function B(){t.value=[],f.value=null,u.value=!1,l.value=!1,i.value=!1,s.value=null,d.value=null}return ge(()=>e.settings.pinned_channel_ids,async(v,$)=>{d.value==="ピン留め"&&l.value!==!1&&Ta(v,$)===!1&&await O()},{deep:!0}),ge(()=>a.channels_list_with_pinned,async()=>{if(l.value===!1)return;const v=H();v!==null&&await X(v)},{deep:!0}),{selected_channel_type:d,selected_date:r,channels_data:t,date_range:f,is_loading:u,is_initial_load_completed:l,is_36hour_display:i,scroll_top_limit_time:s,available_channel_types:w,display_start_time:P,getTodayStartTime:N,getDayEndTime:S,getDisplayStartTime:C,fetchTimeTableData:O,initialLoad:q,changeDate:j,changeChannelType:X,goToPreviousDay:L,goToNextDay:ae,goToCurrentTime:y,reset:B}}),il=Ie({__name:"TimeTableCurrentTimeLine",props:{hourHeight:{},totalWidth:{},channelHeaderHeight:{}},setup(e){const a=e,d=Le(),r=b(G());let t=null,f=null;const u=c(()=>{const i=r.value,s=d.getDisplayStartTime(),m=d.getDayEndTime(s,d.is_36hour_display);return i.isSameOrAfter(s)&&i.isBefore(m)}),l=c(()=>{if(!u.value)return 0;const i=d.getDisplayStartTime();return he.calculateCurrentTimeY(r.value,i,a.hourHeight,a.channelHeaderHeight)-a.channelHeaderHeight});return Ze(()=>{const i=G(),s=i.add(1,"minute").startOf("minute"),m=Math.max(0,s.valueOf()-i.valueOf());f=setTimeout(()=>{r.value=G(),t=setInterval(()=>{r.value=G()},60*1e3)},m)}),vt(()=>{f!==null&&clearTimeout(f),t!==null&&clearInterval(t)}),(i,s)=>u.value?(E(),te("div",{key:0,class:"timetable-current-time-line",style:re({top:`${l.value}px`,width:`${e.totalWidth}px`})},[...s[0]||(s[0]=[R("div",{class:"timetable-current-time-line__indicator"},null,-1),R("div",{class:"timetable-current-time-line__line"},null,-1)])],4)):oe("",!0)}}),sl=Re(il,[["__scopeId","data-v-8d4f4a9f"]]),ol={class:"timetable-program-cell__content"},rl={class:"timetable-program-cell__header"},ul={class:"timetable-program-cell__start-minute"},cl={key:0,class:"timetable-program-cell__reservation-icon"},dl={key:0,class:"timetable-program-cell__recording-icon"},vl=["innerHTML"],ml=["innerHTML"],fl={key:0,class:"timetable-program-cell__actions"},hl="fluent:timer-16-filled",gl="mdi:timer-pause-outline",pl=Ie({__name:"TimeTableProgramCell",props:{program:{},channel:{},hourHeight:{},channelWidth:{},fullChannelWidth:{},viewportHeight:{},channelHeaderHeight:{},isScrollAtBottom:{type:Boolean},isSubchannel:{type:Boolean},isSplit:{type:Boolean},isSelected:{type:Boolean},isPast:{type:Boolean},is36HourDisplay:{type:Boolean},isNextReserved:{type:Boolean},resizeTrigger:{}},emits:["click","show-detail","quick-reserve"],setup(e,{emit:a}){const d=new Map;function r(D,A){const W=D.title,ee=D.description;if(W===null||ee===null)return Ae.decorateProgramInfo(D,A);const ce=d.get(D.id);if(ce===void 0||ce.raw_title!==W||ce.raw_description!==ee){const se=Ae.decorateProgramInfo(D,"title"),ye=Ae.decorateProgramInfo(D,"description");d.set(D.id,{raw_title:W,raw_description:ee,title:se,description:ye})}const ne=d.get(D.id);return ne===void 0?Ae.decorateProgramInfo(D,A):A==="title"?ne.title:ne.description}const t=e,f=a,u=Ne(),l=Le(),i=b(!1),s=b(null),m=b(0),g=c(()=>(t.resizeTrigger,me.isTouchDevice()?t.isSelected:t.isSelected||u.settings.timetable_hover_expand&&i.value)),C=c(()=>t.program.reservation!==null),N=c(()=>{var D;return((D=t.program.reservation)==null?void 0:D.status)==="Recording"}),S=c(()=>{var D;return((D=t.program.reservation)==null?void 0:D.status)==="Disabled"}),P=c(()=>{var D;return((D=t.program.reservation)==null?void 0:D.recording_availability)==="Partial"}),w=c(()=>{var D;return((D=t.program.reservation)==null?void 0:D.recording_availability)==="Unavailable"}),H=c(()=>u.settings.timetable_dim_shopping_programs===!1?!1:Ae.isShoppingProgram(t.program)),p=c(()=>w.value?"rgb(var(--v-theme-error))":P.value?"rgb(var(--v-theme-warning))":S.value?"rgb(var(--v-theme-text-darken-2))":"rgb(var(--v-theme-secondary))"),O=c(()=>S.value?gl:hl),q=c(()=>C.value?S.value?"mdi:timer-play-outline":"mdi:timer-pause-outline":"mdi:timer-plus-outline"),j=c(()=>{if(t.resizeTrigger,!C.value)return"録画予約";const D=u.settings.timetable_channel_width==="Narrow",A=u.settings.timetable_channel_width!=="Wide",W=me.isSmartphoneVertical()&&A||(me.isSmartphoneHorizontal()||me.isTabletVertical())&&D;return S.value?W?"有効化":"予約を有効化":W?"無効化":"予約を無効化"}),X=c(()=>G(t.program.start_time).minute().toString().padStart(2,"0")),L=c(()=>{var W,ee;const D=(ee=(W=t.program.genres)==null?void 0:W[0])==null?void 0:ee.major;return he.getGenreColors(D,u.settings.timetable_genre_colors).highlight}),ae=c(()=>{var W,ee;if(w.value)return"#f8d7da";if(P.value)return"#fff3cd";const D=(ee=(W=t.program.genres)==null?void 0:W[0])==null?void 0:ee.major;return he.getGenreColors(D,u.settings.timetable_genre_colors).background}),y=c(()=>{const D=G(t.program.start_time),A=l.getDisplayStartTime();return he.calculateProgramY(D,A,t.hourHeight,t.channelHeaderHeight)-t.channelHeaderHeight}),B=c(()=>(t.is36HourDisplay?36:24)*t.hourHeight),v=c(()=>{const D=he.calculateProgramHeight(t.program.duration,t.hourHeight);return y.value+D>B.value?Math.max(0,B.value-y.value):Math.max(D,20)}),$=c(()=>{const D=t.fullChannelWidth??t.channelWidth,A=t.isSplit===!0&&t.channelWidth<D,W=g.value&&m.value>0?m.value:v.value,ee=t.isSubchannel&&A?t.channelWidth:0,ce=g.value&&A?0:ee,ne=g.value&&A?D:t.channelWidth,se={top:`${y.value}px`,left:`${ce}px`,width:`${ne}px`,minHeight:`${v.value}px`,"--timetable-cell-height":`${W}px`,"--timetable-program-base-background":ae.value,"--timetable-program-base-highlight":L.value};if(g.value||(se.height=`${v.value}px`),g.value&&t.viewportHeight>0&&t.isScrollAtBottom===!0){const ye=m.value>0?m.value:v.value,ke=Math.max(0,B.value-t.viewportHeight),Se=ke+t.viewportHeight,k=y.value+ye,_=y.value+v.value>=B.value-1;if(k>Se&&_){const M=k-Se,U=Math.max(0,y.value-ke),I=Math.min(M,U);I>0&&(se.transform=`translateY(-${I}px)`)}}return se}),z=c(()=>r(t.program,"title")),K=c(()=>r(t.program,"description"));function le(){f("click")}function Y(){i.value=!0}function fe(){i.value=!1}function pe(){f("quick-reserve")}return ge(g,async D=>{if(D===!1){m.value=0;return}await Ce(),s.value!==null&&(m.value=Math.max(s.value.getBoundingClientRect().height,v.value))}),(D,A)=>{const W=Je("Icon");return E(),te("div",{class:Qe(["timetable-program-cell",{"timetable-program-cell--selected":e.isSelected,"timetable-program-cell--expanded":g.value,"timetable-program-cell--past":e.isPast,"timetable-program-cell--subchannel":e.isSubchannel,"timetable-program-cell--reserved":C.value,"timetable-program-cell--recording":N.value,"timetable-program-cell--partial":P.value,"timetable-program-cell--unavailable":w.value,"timetable-program-cell--disabled":S.value,"timetable-program-cell--shopping":H.value,"timetable-program-cell--next-reserved":C.value&&e.isNextReserved}]),ref_key:"cellRef",ref:s,style:re($.value),onClick:le,onMouseenter:Y,onMouseleave:fe},[A[2]||(A[2]=R("div",{class:"timetable-program-cell__highlight"},null,-1)),R("div",ol,[R("div",rl,[R("span",ul,De(X.value),1),C.value?(E(),te("div",cl,[o(W,{icon:O.value,width:"14px",style:re({color:p.value})},null,8,["icon","style"]),N.value?(E(),te("div",dl)):oe("",!0),P.value?(E(),ve(W,{key:1,icon:"fluent:warning-16-filled",width:"12px",class:"timetable-program-cell__warning-icon"})):oe("",!0),w.value?(E(),ve(W,{key:2,icon:"fluent:dismiss-circle-16-filled",width:"12px",class:"timetable-program-cell__error-icon"})):oe("",!0)])):oe("",!0)]),R("div",{class:"timetable-program-cell__title",innerHTML:z.value},null,8,vl),R("div",{class:"timetable-program-cell__description",innerHTML:K.value},null,8,ml),g.value?(E(),te("div",fl,[o(Z,{variant:"flat",size:"small",class:"timetable-program-cell__action-button",onClick:A[0]||(A[0]=Pt(ee=>D.$emit("show-detail"),["stop"]))},{default:J(()=>[o(W,{icon:"fluent:info-12-regular",width:"16px"}),A[1]||(A[1]=R("span",null,"番組詳細",-1))]),_:1}),e.isPast?oe("",!0):(E(),ve(Z,{key:0,variant:"flat",size:"small",class:Qe(["timetable-program-cell__action-button",{"timetable-program-cell__action-button--reserved":C.value&&!S.value,"timetable-program-cell__action-button--disabled-reservation":S.value}]),onClick:Pt(pe,["stop"])},{default:J(()=>[o(W,{icon:q.value,width:"16px"},null,8,["icon"]),R("span",null,De(j.value),1)]),_:1},8,["class"]))])):oe("",!0)])],38)}}}),Vt=Re(pl,[["__scopeId","data-v-8603e6bf"]]),yl={class:"timetable-time-scale"},_l=["data-hour"],bl={class:"timetable-time-scale__label"},kl={key:0,class:"timetable-time-scale__date"},Sl={class:"timetable-time-scale__hour-number"},Tl=Ie({__name:"TimeTableTimeScale",props:{hourHeight:{},is36HourDisplay:{type:Boolean}},setup(e){const a=e,d=Ne(),r=Le(),t=c(()=>{const i=a.is36HourDisplay?36:24,s=r.display_start_time,m=[];for(let g=0;g<i;g++)m.push(s.add(g,"hour"));return m});function f(i){const s=i.hour();return d.settings.use_28hour_clock&&s>=0&&s<=3?(s+24).toString().padStart(2,"0"):s.toString().padStart(2,"0")}function u(i){const s=i.hour(),m=r.display_start_time;return!([0,4,8,12,16,20].includes(s)===!1||a.is36HourDisplay&&s===4&&m.hour()===4)}function l(i){return`${i.month()+1}/${i.date()}`}return(i,s)=>(E(),te("div",yl,[(E(!0),te(we,null,$e(t.value,m=>(E(),te("div",{class:"timetable-time-scale__hour",key:m.valueOf(),style:re({height:`${a.hourHeight}px`}),"data-hour":m.hour()},[R("div",bl,[u(m)?(E(),te("span",kl,De(l(m)),1)):oe("",!0),R("span",Sl,De(f(m)),1),s[0]||(s[0]=R("span",{class:"timetable-time-scale__hour-label"},"時",-1))])],12,_l))),128))]))}}),wl=Re(Tl,[["__scopeId","data-v-fe795608"]]),Dl={class:"timetable-grid__channel-headers"},xl={class:"timetable-grid__content"},Cl=2,Pl=3,Hl=.5,Ml=60,Vl=2,Bl=100,Il=120,Bt=.95,Ge=.5,je=5,Rl=Ie({__name:"TimeTableGrid",props:{channels:{},is36HourDisplay:{type:Boolean},canGoPreviousDay:{type:Boolean},canGoNextDay:{type:Boolean}},emits:["time-slot-change","date-display-offset-change","show-program-detail","quick-reserve","go-to-next-day","go-to-previous-day"],setup(e,{expose:a,emit:d}){const r=e,t=d,f=Ne(),u=Le(),l=b(null),i=b(null),s=b(!1),m=b(!1);let g=0;const C=b(0),N=b(!1),S=b(0),P=b(0),w=b(0),H=b(0),p=b(null);let O=null,q=null;const j=b(0),X=new Set;let L=null,ae=null,y=null;const B=b(0);let v=null;function $(){v!==null&&clearTimeout(v),v=window.setTimeout(()=>{B.value++,v=null},Bl)}const z=b(!1),K=b(!1),le=b(!1),Y=b(null),fe=b(0),pe=b(0),D=b(0),A=b(0),W=b(!1),ee=b(!1),ce=b(0),ne=b(0),se=b(0),ye=b(0),ke=b(0),Se=b(0),k=b(null),_=c(()=>(B.value,he.getDeviceType())),M=c(()=>he.getChannelWidth(f.settings.timetable_channel_width,_.value)),U=c(()=>he.getHourHeight(f.settings.timetable_hour_height,_.value)),I=c(()=>_.value==="Smartphone"?Pl:Cl),ie=c(()=>he.getChannelHeaderHeight(M.value)),Te=c(()=>(B.value,he.getTimeScaleWidth(_.value,me.isSmartphoneVertical()))),tt=c(()=>r.channels.length*M.value),Me=c(()=>(r.is36HourDisplay?36:24)*U.value);function ea(n){return n.subchannel_programs===null?!1:Object.values(n.subchannel_programs).flat().length>0}const at=new Map,Ve=new Map;function lt(n){if(n==null)return{start:0,end:0};const h=at.get(n.id);if(h!==void 0)return h;const V={start:G(n.start_time).valueOf(),end:G(n.end_time).valueOf()};return at.set(n.id,V),V}function ft(n,h){const V=lt(n);return h.some(T=>{const F=lt(T);return F.start<V.end&&F.end>V.start})}function nt(n,h,V){const T=`${h.id}:${V?"sub":"main"}`,F=Ve.get(T);if(F!==void 0)return F;if(n.subchannel_programs===null)return Ve.set(T,!1),!1;const x=Object.values(n.subchannel_programs).flat();if(x.length===0)return Ve.set(T,!1),!1;if(V){const ue=ft(h,n.programs);return Ve.set(T,ue),ue}const Q=ft(h,x);return Ve.set(T,Q),Q}function ht(n,h,V){return nt(n,h,V)?M.value/2:M.value}function Be(n){const h=U.value*I.value;S.value=Math.max(0,n-h),P.value=n+C.value+h}function ta(n){const V=U.value*I.value*Hl,T=n+C.value;return C.value<=0||P.value===0||n<S.value+V||T>P.value-V?(Be(n),!0):!1}function gt(n){const h=lt(n),V=(h.start-j.value)/(1e3*60*60)*U.value;return(h.end-j.value)/(1e3*60*60)*U.value>=S.value&&V<=P.value}function pt(n){return n.subchannel_programs===null?[]:Object.values(n.subchannel_programs).flat()}function yt(n){return G(n.end_time).isBefore(G())}function _t(n,h,V){const T=V?pt(n):n.programs,F=G(h.end_time).valueOf(),x=T.find(Q=>G(Q.start_time).valueOf()===F);return x!==void 0&&x.reservation!==null}function bt(){if(l.value===null)return;w.value;const n=H.value;g=n;const h=l.value.clientHeight-ie.value;C.value!==h&&(C.value=h);const V=l.value.scrollHeight-l.value.clientHeight,T=n>=V-1;N.value!==T&&(N.value=T),ta(n)&&Oe();const x=n>V-100&&r.canGoNextDay,Q=n<100&&r.canGoPreviousDay;s.value!==x&&(s.value=x),m.value!==Q&&(m.value=Q);const ue=u.getDisplayStartTime(),_e=Math.floor(n/U.value);let st=ue.add(_e,"hour").hour();st<4&&(st+=24);const ma=Math.floor((st-4)/4)*4+4,ot=Math.max(4,Math.min(24,ma));if(O!==ot&&(t("time-slot-change",ot),O=ot),r.is36HourDisplay){const fa=f.settings.use_28hour_clock?4:0;let ze=ue.hour(fa).minute(0).second(0).millisecond(0);ze.isSameOrBefore(ue)&&(ze=ze.add(1,"day"));const ha=(ze.valueOf()-ue.valueOf())/(1e3*60*60)*U.value,rt=n>=ha?1:0;q!==rt&&(t("date-display-offset-change",rt),q=rt)}else q!==0&&(t("date-display-offset-change",0),q=0);kt()}function aa(){p.value===null&&(p.value=requestAnimationFrame(()=>{p.value=null,bt()}))}function Oe(){y===null&&(y=requestAnimationFrame(()=>{y=null,St()}))}function kt(){ae===null&&(ae=requestAnimationFrame(()=>{ae=null,la()}))}function St(){l.value!==null&&(L!==null&&(L.disconnect(),X.clear()),L=new IntersectionObserver(n=>{for(const h of n){const V=h.target,T=h.rootBounds;if(T===null)continue;const F=h.intersectionRect.top<=T.top,x=h.intersectionRect.height<h.boundingClientRect.height,Q=T.height<h.boundingClientRect.height;if(h.isIntersecting&&F&&(x||Q))X.add(V),V.classList.add("timetable-program-cell--fixed");else{X.delete(V),V.classList.remove("timetable-program-cell--fixed");const _e=V.querySelector(".timetable-program-cell__content");_e!==null&&(_e.style.paddingTop="")}}kt()},{root:l.value,rootMargin:`-${ie.value}px 0px 0px 0px`,threshold:[0,1]}),l.value.querySelectorAll(".timetable-program-cell").forEach(n=>{L==null||L.observe(n)}))}function la(){if(l.value===null||X.size===0)return;const n=l.value.getBoundingClientRect().top+ie.value;X.forEach(h=>{const V=h.querySelector(".timetable-program-cell__content");if(V===null)return;const T=h.getBoundingClientRect().top,F=n-T;if(F<=0){V.style.paddingTop="";return}const x=h.style.getPropertyValue("--timetable-cell-height"),Q=x?Number.parseFloat(x):h.getBoundingClientRect().height,ue=Math.max(0,Q-Ml),_e=h.classList.contains("timetable-program-cell--reserved")?3:0,xt=Math.min(F,ue);V.style.paddingTop=`${Vl+Math.max(xt-_e,0)}px`})}function na(){l.value!==null&&(w.value=l.value.scrollLeft,H.value=l.value.scrollTop,aa())}function Tt(n){l.value!==null&&(k.value!==null&&(cancelAnimationFrame(k.value),k.value=null),n.deltaX!==0&&(n.preventDefault(),l.value.scrollLeft+=n.deltaX),n.shiftKey&&n.deltaY!==0?(n.preventDefault(),l.value.scrollLeft+=n.deltaY):n.deltaY!==0&&n.deltaX===0&&(n.preventDefault(),l.value.scrollTop+=n.deltaY))}function ia(n){if(n.pointerType!=="mouse"||l.value===null)return;const h=n.target;h.closest(".v-btn")||h.closest("a")||(K.value=!0,z.value=!1,W.value=!1,fe.value=n.clientX,pe.value=n.clientY,D.value=l.value.scrollLeft,A.value=l.value.scrollTop,k.value!==null&&(cancelAnimationFrame(k.value),k.value=null),ne.value=0,se.value=0,ye.value=performance.now(),ke.value=n.clientX,Se.value=n.clientY)}function sa(n){if(n.pointerType!=="mouse"||K.value===!1||l.value===null)return;const h=fe.value-n.clientX,V=pe.value-n.clientY;if((Math.abs(h)>je||Math.abs(V)>je)&&z.value===!1&&l.value!==null&&(z.value=!0,W.value=!0,l.value.setPointerCapture(n.pointerId),le.value=!0,Y.value=n.pointerId),z.value===!1)return;n.preventDefault(),(Math.abs(h)>je||Math.abs(V)>je)&&(W.value=!0),l.value.scrollLeft=D.value+h,l.value.scrollTop=A.value+V;const T=performance.now(),F=T-ye.value;if(F>0){const x=n.clientX-ke.value,Q=n.clientY-Se.value;ne.value=-x/F*16,se.value=-Q/F*16}ye.value=T,ke.value=n.clientX,Se.value=n.clientY}function wt(n){if(n.pointerType==="mouse"&&K.value!==!1){if(K.value=!1,z.value=!1,l.value!==null&&le.value&&Y.value!==null)try{l.value.releasePointerCapture(Y.value)}catch{}le.value=!1,Y.value=null,W.value?(ra(),ee.value=!0,ce.value=performance.now()):(ee.value=!1,ce.value=0)}}function oa(n){if(ee.value===!1)return;performance.now()-ce.value<=Il&&(n.preventDefault(),n.stopPropagation()),ee.value=!1}function ra(){if(l.value===null||Math.abs(ne.value)<Ge&&Math.abs(se.value)<Ge)return;const n=()=>{if(l.value!==null){if(ne.value*=Bt,se.value*=Bt,l.value.scrollLeft+=ne.value,l.value.scrollTop+=se.value,Math.abs(ne.value)<Ge&&Math.abs(se.value)<Ge){k.value=null;return}k.value=requestAnimationFrame(n)}};k.value=requestAnimationFrame(n)}function Dt(n){i.value===n.id?i.value=null:i.value=n.id}function ua(n){if(l.value===null)return;const V=u.getDisplayStartTime().hour();let F=(n===24?0:n)-V;F<0&&(F+=24);const x=F*U.value;l.value.scrollTo({top:x,behavior:"smooth"})}function ca(){const n=u.scroll_top_limit_time;if(n===null)return 0;const h=u.getDisplayStartTime(),T=(n.valueOf()-h.valueOf())/(1e3*60*60);return Math.max(0,T*U.value)}function it(n=!0,h=!1){if(l.value===null)return;const V=G(),T=u.getDisplayStartTime(),F=ca(),ue=(V.subtract(30,"minute").valueOf()-T.valueOf())/(1e3*60*60),_e=Math.max(F,ue*U.value);if(h){l.value.scrollTo({top:_e,behavior:n?"smooth":"instant"});return}if(F===0){l.value.scrollTo({top:0,behavior:"instant"});return}l.value.scrollTo({top:F,behavior:"instant"}),n&&setTimeout(()=>{l.value!==null&&l.value.scrollTo({top:_e,behavior:"smooth"})},50)}function da(){l.value!==null&&l.value.scrollTo({top:0,behavior:"instant"})}function va(){if(l.value===null)return;const n=l.value.scrollHeight-l.value.clientHeight;l.value.scrollTo({top:n,behavior:"instant"})}return a({scrollToHour:ua,scrollToCurrentTime:it,scrollToStart:da,scrollToEnd:va}),Ze(async()=>{window.addEventListener("resize",$),l.value!==null&&l.value.addEventListener("wheel",Tt,{passive:!1}),await Ce(),l.value!==null&&(w.value=l.value.scrollLeft,H.value=l.value.scrollTop,bt(),St()),setTimeout(()=>{it(),Be(g)},100)}),wa(()=>{window.removeEventListener("resize",$),v!==null&&(clearTimeout(v),v=null),l.value!==null&&l.value.removeEventListener("wheel",Tt),p.value!==null&&cancelAnimationFrame(p.value),ae!==null&&cancelAnimationFrame(ae),y!==null&&cancelAnimationFrame(y),L!==null&&(L.disconnect(),L=null,X.clear()),k.value!==null&&cancelAnimationFrame(k.value)}),vt(()=>{k.value!==null&&cancelAnimationFrame(k.value)}),ge(()=>r.channels,async(n,h)=>{at.clear(),Ve.clear(),Be(g),Oe(),h.length===0&&n.length>0&&(await Ce(),setTimeout(()=>{it(),Oe()},100))},{deep:!1}),ge([U,C],()=>{Be(g),Oe()}),ge(ie,()=>{Oe()}),ge(()=>u.display_start_time,n=>{j.value=n.valueOf()},{immediate:!0}),(n,h)=>{const V=Je("Icon");return E(),te("div",{class:"timetable-grid",style:re({"--timetable-channel-header-height":`${ie.value}px`})},[R("div",{class:Qe(["timetable-grid__scroll-area",{"timetable-grid__scroll-area--dragging":z.value}]),ref_key:"scrollAreaRef",ref:l,onScroll:na,onPointerdown:ia,onPointermove:sa,onPointerup:wt,onPointercancel:wt,onClickCapture:oa},[R("div",{class:"timetable-grid__layout",style:re({width:`${Te.value+tt.value}px`,height:`${ie.value+Me.value}px`})},[R("div",{class:"timetable-grid__header-row",style:re({height:`${ie.value}px`})},[R("div",{class:"timetable-grid__corner",style:re({width:`${Te.value}px`})},null,4),R("div",Dl,[(E(!0),te(we,null,$e(e.channels,T=>(E(),ve(ll,{key:T.channel.id,channel:T.channel,width:M.value,height:ie.value,resizeTrigger:B.value},null,8,["channel","width","height","resizeTrigger"]))),128))])],4),R("div",{class:"timetable-grid__body-row",style:re({height:`${Me.value}px`})},[R("div",{class:"timetable-grid__time-scale",style:re({width:`${Te.value}px`})},[o(wl,{hourHeight:U.value,is36HourDisplay:r.is36HourDisplay},null,8,["hourHeight","is36HourDisplay"])],4),R("div",xl,[(E(!0),te(we,null,$e(e.channels,(T,F)=>(E(),te("div",{class:"timetable-grid__channel-column",key:T.channel.id,style:re({left:`${F*M.value}px`,width:`${M.value}px`,height:`${Me.value}px`})},[R("div",{class:"timetable-grid__channel-background",style:re({height:`${Me.value}px`})},null,4),(E(!0),te(we,null,$e(T.programs,x=>(E(),te(we,{key:x.id},[gt(x)?(E(),ve(Vt,{key:0,program:x,channel:T.channel,hourHeight:U.value,channelWidth:ht(T,x,!1),fullChannelWidth:M.value,isSplit:nt(T,x,!1),viewportHeight:C.value,channelHeaderHeight:ie.value,isScrollAtBottom:N.value,isSelected:i.value===x.id,isPast:yt(x),is36HourDisplay:r.is36HourDisplay,isNextReserved:_t(T,x,!1),resizeTrigger:B.value,onClick:Q=>Dt(x),onShowDetail:Q=>n.$emit("show-program-detail",x.id,T,x),onQuickReserve:Q=>n.$emit("quick-reserve",x.id,T,x)},null,8,["program","channel","hourHeight","channelWidth","fullChannelWidth","isSplit","viewportHeight","channelHeaderHeight","isScrollAtBottom","isSelected","isPast","is36HourDisplay","isNextReserved","resizeTrigger","onClick","onShowDetail","onQuickReserve"])):oe("",!0)],64))),128)),ea(T)?(E(!0),te(we,{key:0},$e(pt(T),x=>(E(),te(we,{key:x.id},[gt(x)?(E(),ve(Vt,{key:0,program:x,channel:T.channel,hourHeight:U.value,channelWidth:ht(T,x,!0),fullChannelWidth:M.value,isSplit:nt(T,x,!0),viewportHeight:C.value,channelHeaderHeight:ie.value,isScrollAtBottom:N.value,isSubchannel:!0,isSelected:i.value===x.id,isPast:yt(x),is36HourDisplay:r.is36HourDisplay,isNextReserved:_t(T,x,!0),resizeTrigger:B.value,onClick:Q=>Dt(x),onShowDetail:Q=>n.$emit("show-program-detail",x.id,T,x),onQuickReserve:Q=>n.$emit("quick-reserve",x.id,T,x)},null,8,["program","channel","hourHeight","channelWidth","fullChannelWidth","isSplit","viewportHeight","channelHeaderHeight","isScrollAtBottom","isSelected","isPast","is36HourDisplay","isNextReserved","resizeTrigger","onClick","onShowDetail","onQuickReserve"])):oe("",!0)],64))),128)):oe("",!0)],4))),128)),o(sl,{hourHeight:U.value,totalWidth:tt.value,channelHeaderHeight:ie.value},null,8,["hourHeight","totalWidth","channelHeaderHeight"])])],4)],4)],34),o(Ht,{name:"fade"},{default:J(()=>[s.value?(E(),ve(Z,{key:0,class:"timetable-grid__next-day-button",variant:"elevated",color:"background-lighten-1",onClick:h[0]||(h[0]=T=>n.$emit("go-to-next-day"))},{default:J(()=>[o(V,{icon:"fluent:chevron-down-20-regular",width:"20px"}),h[2]||(h[2]=R("span",null,"次の日を見る",-1))]),_:1})):oe("",!0)]),_:1}),o(Ht,{name:"fade"},{default:J(()=>[m.value?(E(),ve(Z,{key:0,class:"timetable-grid__prev-day-button",variant:"elevated",color:"background-lighten-1",onClick:h[1]||(h[1]=T=>n.$emit("go-to-previous-day"))},{default:J(()=>[o(V,{icon:"fluent:chevron-up-20-regular",width:"20px"}),h[3]||(h[3]=R("span",null,"前の日を見る",-1))]),_:1})):oe("",!0)]),_:1})],4)}}}),Ol=Re(Rl,[["__scopeId","data-v-3910de55"]]),qt=be({active:{type:[String,Array],default:void 0},disabled:{type:[Boolean,String,Array],default:null},nextIcon:{type:Xe,default:"$next"},prevIcon:{type:Xe,default:"$prev"},modeIcon:{type:Xe,default:"$subgroup"},text:String,viewMode:{type:String,default:"month"}},"VDatePickerControls"),It=xe()({name:"VDatePickerControls",props:qt(),emits:{"click:year":()=>!0,"click:month":()=>!0,"click:prev":()=>!0,"click:next":()=>!0,"click:text":()=>!0},setup(e,a){let{emit:d}=a;const r=c(()=>Array.isArray(e.disabled)?e.disabled.includes("text"):!!e.disabled),t=c(()=>Array.isArray(e.disabled)?e.disabled.includes("mode"):!!e.disabled),f=c(()=>Array.isArray(e.disabled)?e.disabled.includes("prev"):!!e.disabled),u=c(()=>Array.isArray(e.disabled)?e.disabled.includes("next"):!!e.disabled);function l(){d("click:prev")}function i(){d("click:next")}function s(){d("click:year")}function m(){d("click:month")}return He(()=>o("div",{class:["v-date-picker-controls"]},[o(Z,{class:"v-date-picker-controls__month-btn","data-testid":"month-btn",disabled:r.value,text:e.text,variant:"text",rounded:!0,onClick:m},null),o(Z,{class:"v-date-picker-controls__mode-btn","data-testid":"year-btn",disabled:t.value,density:"comfortable",icon:e.modeIcon,variant:"text",onClick:s},null),o(qa,null,null),o("div",{class:"v-date-picker-controls__month"},[o(Z,{"data-testid":"prev-month",disabled:f.value,icon:e.prevIcon,variant:"text",onClick:l},null),o(Z,{"data-testid":"next-month",disabled:u.value,icon:e.nextIcon,variant:"text",onClick:i},null)])])),{}}}),Al=be({appendIcon:Xe,color:String,header:String,transition:String,onClick:Da()},"VDatePickerHeader"),Rt=xe()({name:"VDatePickerHeader",props:Al(),emits:{click:()=>!0,"click:append":()=>!0},setup(e,a){let{emit:d,slots:r}=a;const{backgroundColorClasses:t,backgroundColorStyles:f}=mt(e,"color");function u(){d("click")}function l(){d("click:append")}return He(()=>{const i=!!(r.default||e.header),s=!!(r.append||e.appendIcon);return o("div",{class:["v-date-picker-header",{"v-date-picker-header--clickable":!!e.onClick},t.value],style:f.value,onClick:u},[r.prepend&&o("div",{key:"prepend",class:"v-date-picker-header__prepend"},[r.prepend()]),i&&o(Gt,{key:"content",name:e.transition},{default:()=>{var m;return[o("div",{key:e.header,class:"v-date-picker-header__content"},[((m=r.default)==null?void 0:m.call(r))??e.header])]}}),s&&o("div",{class:"v-date-picker-header__append"},[r.append?o(et,{key:"append-defaults",disabled:!e.appendIcon,defaults:{VBtn:{icon:e.appendIcon,variant:"text"}}},{default:()=>{var m;return[(m=r.append)==null?void 0:m.call(r)]}}):o(Z,{key:"append-btn",icon:e.appendIcon,variant:"text",onClick:l},null)])])}),{}}}),$l=be({allowedDates:[Array,Function],disabled:{type:Boolean,default:null},displayValue:null,modelValue:Array,month:[Number,String],max:null,min:null,showAdjacentMonths:Boolean,year:[Number,String],weekdays:{type:Array,default:()=>[0,1,2,3,4,5,6]},weeksInMonth:{type:String,default:"dynamic"},firstDayOfWeek:[Number,String]},"calendar");function Yl(e){const a=We(),d=Pe(e,"modelValue",[],S=>Ke(S).map(P=>a.date(P))),r=c(()=>e.displayValue?a.date(e.displayValue):d.value.length>0?a.date(d.value[0]):e.min?a.date(e.min):Array.isArray(e.allowedDates)?a.date(e.allowedDates[0]):a.date()),t=Pe(e,"year",void 0,S=>{const P=S!=null?Number(S):a.getYear(r.value);return a.startOfYear(a.setYear(a.date(),P))},S=>a.getYear(S)),f=Pe(e,"month",void 0,S=>{const P=S!=null?Number(S):a.getMonth(r.value),w=a.setYear(a.startOfMonth(a.date()),a.getYear(t.value));return a.setMonth(w,P)},S=>a.getMonth(S)),u=c(()=>e.firstDayOfWeek??e.weekdays[0]),l=c(()=>{const S=Number(e.firstDayOfWeek??0);return e.weekdays.map(P=>(P+S)%7)}),i=c(()=>{const S=a.getWeekArray(f.value,u.value),P=S.flat(),w=6*7;if(e.weeksInMonth==="static"&&P.length<w){const H=P[P.length-1];let p=[];for(let O=1;O<=w-P.length;O++)p.push(a.addDays(H,O)),O%7===0&&(S.push(p),p=[])}return S});function s(S,P){return S.filter(w=>l.value.includes(a.toJsDate(w).getDay())).map((w,H)=>{const p=a.toISO(w),O=!a.isSameMonth(w,f.value),q=a.isSameDay(w,a.startOfMonth(f.value)),j=a.isSameDay(w,a.endOfMonth(f.value)),X=a.isSameDay(w,f.value);return{date:w,isoDate:p,formatted:a.format(w,"keyboardDate"),year:a.getYear(w),month:a.getMonth(w),isDisabled:N(w),isWeekStart:H%7===0,isWeekEnd:H%7===6,isToday:a.isSameDay(w,P),isAdjacent:O,isHidden:O&&!e.showAdjacentMonths,isStart:q,isSelected:d.value.some(L=>a.isSameDay(w,L)),isEnd:j,isSame:X,localized:a.format(w,"dayOfMonth")}})}const m=c(()=>{const S=a.startOfWeek(r.value,e.firstDayOfWeek),P=[];for(let H=0;H<=6;H++)P.push(a.addDays(S,H));const w=a.date();return s(P,w)}),g=c(()=>{const S=i.value.flat(),P=a.date();return s(S,P)}),C=c(()=>i.value.map(S=>S.length?xa(a,S[0]):null));function N(S){if(e.disabled)return!0;const P=a.date(S);return e.min&&a.isAfter(a.date(e.min),P)||e.max&&a.isAfter(P,a.date(e.max))?!0:Array.isArray(e.allowedDates)&&e.allowedDates.length>0?!e.allowedDates.some(w=>a.isSameDay(a.date(w),P)):typeof e.allowedDates=="function"?!e.allowedDates(P):!1}return{displayValue:r,daysInMonth:g,daysInWeek:m,genDays:s,model:d,weeksInMonth:i,weekDays:l,weekNumbers:C}}const Xt=be({color:String,hideWeekdays:Boolean,multiple:[Boolean,Number,String],showWeek:Boolean,transition:{type:String,default:"picker-transition"},reverseTransition:{type:String,default:"picker-reverse-transition"},...Ee($l(),["displayValue"])},"VDatePickerMonth"),Ot=xe()({name:"VDatePickerMonth",props:Xt(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0},setup(e,a){let{emit:d,slots:r}=a;const t=b(),{daysInMonth:f,model:u,weekNumbers:l}=Yl(e),i=We(),s=Ye(),m=Ye(),g=Ye(!1),C=c(()=>g.value?e.reverseTransition:e.transition);e.multiple==="range"&&u.value.length>0&&(s.value=u.value[0],u.value.length>1&&(m.value=u.value[u.value.length-1]));const N=c(()=>{const H=["number","string"].includes(typeof e.multiple)?Number(e.multiple):1/0;return u.value.length>=H});ge(f,(H,p)=>{p&&(g.value=i.isBefore(H[0].date,p[0].date))});function S(H){const p=i.startOfDay(H);if(u.value.length===0?s.value=void 0:u.value.length===1&&(s.value=u.value[0],m.value=void 0),!s.value)s.value=p,u.value=[s.value];else if(m.value)s.value=H,m.value=void 0,u.value=[s.value];else{if(i.isSameDay(p,s.value)){s.value=void 0,u.value=[];return}else i.isBefore(p,s.value)?(m.value=i.endOfDay(s.value),s.value=p):m.value=i.endOfDay(p);const O=i.getDiff(m.value,s.value,"days"),q=[s.value];for(let j=1;j<O;j++){const X=i.addDays(s.value,j);q.push(X)}q.push(m.value),u.value=q}}function P(H){const p=u.value.findIndex(O=>i.isSameDay(O,H));if(p===-1)u.value=[...u.value,H];else{const O=[...u.value];O.splice(p,1),u.value=O}}function w(H){e.multiple==="range"?S(H):e.multiple?P(H):u.value=[H]}return()=>o("div",{class:"v-date-picker-month"},[e.showWeek&&o("div",{key:"weeks",class:"v-date-picker-month__weeks"},[!e.hideWeekdays&&o("div",{key:"hide-week-days",class:"v-date-picker-month__day"},[dt(" ")]),l.value.map(H=>o("div",{class:["v-date-picker-month__day","v-date-picker-month__day--adjacent"]},[H]))]),o(Gt,{name:C.value},{default:()=>{var H;return[o("div",{ref:t,key:(H=f.value[0].date)==null?void 0:H.toString(),class:"v-date-picker-month__days"},[!e.hideWeekdays&&i.getWeekdays(e.firstDayOfWeek).map(p=>o("div",{class:["v-date-picker-month__day","v-date-picker-month__weekday"]},[p])),f.value.map((p,O)=>{const q={props:{onClick:()=>w(p.date)},item:p,i:O};return N.value&&!p.isSelected&&(p.isDisabled=!0),o("div",{class:["v-date-picker-month__day",{"v-date-picker-month__day--adjacent":p.isAdjacent,"v-date-picker-month__day--hide-adjacent":p.isHidden,"v-date-picker-month__day--selected":p.isSelected,"v-date-picker-month__day--week-end":p.isWeekEnd,"v-date-picker-month__day--week-start":p.isWeekStart}],"data-v-date":p.isDisabled?void 0:p.isoDate},[(e.showAdjacentMonths||!p.isAdjacent)&&o(et,{defaults:{VBtn:{class:"v-date-picker-month__day-btn",color:(p.isSelected||p.isToday)&&!p.isDisabled?e.color:void 0,disabled:p.isDisabled,icon:!0,ripple:!1,text:p.localized,variant:p.isDisabled?p.isToday?"outlined":"text":p.isToday&&!p.isSelected?"outlined":"flat",onClick:()=>w(p.date)}}},{default:()=>{var j;return[((j=r.day)==null?void 0:j.call(r,q))??o(Z,q.props,null)]}})])})])]}})])}}),Kt=be({color:String,height:[String,Number],min:null,max:null,modelValue:Number,year:Number},"VDatePickerMonths"),At=xe()({name:"VDatePickerMonths",props:Kt(),emits:{"update:modelValue":e=>!0},setup(e,a){let{emit:d,slots:r}=a;const t=We(),f=Pe(e,"modelValue"),u=c(()=>{let l=t.startOfYear(t.date());return e.year&&(l=t.setYear(l,e.year)),Lt(12).map(i=>{const s=t.format(l,"monthShort"),m=!!(e.min&&t.isAfter(t.startOfMonth(t.date(e.min)),l)||e.max&&t.isAfter(l,t.startOfMonth(t.date(e.max))));return l=t.getNextMonth(l),{isDisabled:m,text:s,value:i}})});return zt(()=>{f.value=f.value??t.getMonth(t.date())}),He(()=>o("div",{class:"v-date-picker-months",style:{height:Ut(e.height)}},[o("div",{class:"v-date-picker-months__content"},[u.value.map((l,i)=>{var g;const s={active:f.value===i,color:f.value===i?e.color:void 0,disabled:l.isDisabled,rounded:!0,text:l.text,variant:f.value===l.value?"flat":"text",onClick:()=>m(i)};function m(C){if(f.value===C){d("update:modelValue",f.value);return}f.value=C}return((g=r.month)==null?void 0:g.call(r,{month:l,i,props:s}))??o(Z,de({key:"month"},s),null)})])])),{}}}),Qt=be({color:String,height:[String,Number],min:null,max:null,modelValue:Number},"VDatePickerYears"),$t=xe()({name:"VDatePickerYears",props:Qt(),emits:{"update:modelValue":e=>!0},setup(e,a){let{emit:d,slots:r}=a;const t=We(),f=Pe(e,"modelValue"),u=c(()=>{const i=t.getYear(t.date());let s=i-100,m=i+52;e.min&&(s=t.getYear(t.date(e.min))),e.max&&(m=t.getYear(t.date(e.max)));let g=t.startOfYear(t.date());return g=t.setYear(g,s),Lt(m-s+1,s).map(C=>{const N=t.format(g,"year");return g=t.setYear(g,t.getYear(g)+1),{text:N,value:C}})});zt(()=>{f.value=f.value??t.getYear(t.date())});const l=Ca();return Ze(async()=>{var i;await Ce(),(i=l.el)==null||i.scrollIntoView({block:"center"})}),He(()=>o("div",{class:"v-date-picker-years",style:{height:Ut(e.height)}},[o("div",{class:"v-date-picker-years__content"},[u.value.map((i,s)=>{var g;const m={ref:f.value===i.value?l:void 0,active:f.value===i.value,color:f.value===i.value?e.color:void 0,rounded:!0,text:i.text,variant:f.value===i.value?"flat":"text",onClick:()=>{if(f.value===i.value){d("update:modelValue",f.value);return}f.value=i.value}};return((g=r.year)==null?void 0:g.call(r,{year:i,i:s,props:m}))??o(Z,de({key:"month"},m),null)})])])),{}}}),El=Xa("v-picker-title"),Jt=be({color:String,...za(),...La(),...Wa(),...Na(),...Ea(),...Ya(),...$a(),...Aa(),...Oa()},"VSheet"),Yt=xe()({name:"VSheet",props:Jt(),setup(e,a){let{slots:d}=a;const{themeClasses:r}=Pa(e),{backgroundColorClasses:t,backgroundColorStyles:f}=mt(Ft(e,"color")),{borderClasses:u}=Ha(e),{dimensionStyles:l}=Ma(e),{elevationClasses:i}=Va(e),{locationStyles:s}=Ba(e),{positionClasses:m}=Ia(e),{roundedClasses:g}=Ra(e);return He(()=>o(e.tag,{class:["v-sheet",r.value,t.value,u.value,i.value,m.value,g.value,e.class],style:[f.value,l.value,s.value,e.style]},d)),{}}}),Zt=be({bgColor:String,landscape:Boolean,title:String,hideHeader:Boolean,...Jt()},"VPicker"),Et=xe()({name:"VPicker",props:Zt(),setup(e,a){let{slots:d}=a;const{backgroundColorClasses:r,backgroundColorStyles:t}=mt(Ft(e,"color"));return He(()=>{const f=Yt.filterProps(e),u=!!(e.title||d.title);return o(Yt,de(f,{color:e.bgColor,class:["v-picker",{"v-picker--landscape":e.landscape,"v-picker--with-actions":!!d.actions},e.class],style:e.style}),{default:()=>{var l;return[!e.hideHeader&&o("div",{key:"header",class:[r.value],style:[t.value]},[u&&o(El,{key:"picker-title"},{default:()=>{var i;return[((i=d.title)==null?void 0:i.call(d))??e.title]}}),d.header&&o("div",{class:"v-picker__header"},[d.header()])]),o("div",{class:"v-picker__body"},[(l=d.default)==null?void 0:l.call(d)]),d.actions&&o(et,{defaults:{VBtn:{slim:!0,variant:"text"}}},{default:()=>[o("div",{class:"v-picker__actions"},[d.actions()])]})]}})}),{}}}),Nl=be({header:{type:String,default:"$vuetify.datePicker.header"},...qt(),...Xt({weeksInMonth:"static"}),...Ee(Kt(),["modelValue"]),...Ee(Qt(),["modelValue"]),...Zt({title:"$vuetify.datePicker.title"}),modelValue:null},"VDatePicker"),Nt=xe()({name:"VDatePicker",props:Nl(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0,"update:viewMode":e=>!0},setup(e,a){let{emit:d,slots:r}=a;const t=We(),{t:f}=Ua(),u=Pe(e,"modelValue",void 0,y=>Ke(y).map(B=>t.date(B)),y=>e.multiple?y:y[0]),l=Pe(e,"viewMode"),i=c(()=>{const y=t.date(e.min);return e.min&&t.isValid(y)?y:null}),s=c(()=>{const y=t.date(e.max);return e.max&&t.isValid(y)?y:null}),m=c(()=>{var v;const y=t.date();let B=y;return(v=u.value)!=null&&v[0]?B=t.date(u.value[0]):i.value&&t.isBefore(y,i.value)?B=i.value:s.value&&t.isAfter(y,s.value)&&(B=s.value),B&&t.isValid(B)?B:y}),g=b(Number(e.month??t.getMonth(t.startOfMonth(m.value)))),C=b(Number(e.year??t.getYear(t.startOfYear(t.setMonth(m.value,g.value))))),N=Ye(!1),S=c(()=>e.multiple&&u.value.length>1?f("$vuetify.datePicker.itemsSelected",u.value.length):u.value[0]&&t.isValid(u.value[0])?t.format(t.date(u.value[0]),"normalDateWithWeekday"):f(e.header)),P=c(()=>{let y=t.date();return y=t.setDate(y,1),y=t.setMonth(y,g.value),y=t.setYear(y,C.value),t.format(y,"monthAndYear")}),w=c(()=>`date-picker-header${N.value?"-reverse":""}-transition`),H=c(()=>{if(e.disabled)return!0;const y=[];if(l.value!=="month")y.push("prev","next");else{let B=t.date();if(B=t.startOfMonth(B),B=t.setMonth(B,g.value),B=t.setYear(B,C.value),i.value){const v=t.addDays(t.startOfMonth(B),-1);t.isAfter(i.value,v)&&y.push("prev")}if(s.value){const v=t.addDays(t.endOfMonth(B),1);t.isAfter(v,s.value)&&y.push("next")}}return y});function p(){g.value<11?g.value++:(C.value++,g.value=0,ae(C.value)),L(g.value)}function O(){g.value>0?g.value--:(C.value--,g.value=11,ae(C.value)),L(g.value)}function q(){l.value="month"}function j(){l.value=l.value==="months"?"month":"months"}function X(){l.value=l.value==="year"?"month":"year"}function L(y){l.value==="months"&&j(),d("update:month",y)}function ae(y){l.value==="year"&&X(),d("update:year",y)}return ge(u,(y,B)=>{const v=Ke(B),$=Ke(y);if(!$.length)return;const z=t.date(v[v.length-1]),K=t.date($[$.length-1]),le=t.getMonth(K),Y=t.getYear(K);le!==g.value&&(g.value=le,L(g.value)),Y!==C.value&&(C.value=Y,ae(C.value)),N.value=t.isBefore(z,K)}),He(()=>{const y=Et.filterProps(e),B=It.filterProps(e),v=Rt.filterProps(e),$=Ot.filterProps(e),z=Ee(At.filterProps(e),["modelValue"]),K=Ee($t.filterProps(e),["modelValue"]),le={header:S.value,transition:w.value};return o(Et,de(y,{class:["v-date-picker",`v-date-picker--${l.value}`,{"v-date-picker--show-week":e.showWeek},e.class],style:e.style}),{title:()=>{var Y;return((Y=r.title)==null?void 0:Y.call(r))??o("div",{class:"v-date-picker__title"},[f(e.title)])},header:()=>r.header?o(et,{defaults:{VDatePickerHeader:{...le}}},{default:()=>{var Y;return[(Y=r.header)==null?void 0:Y.call(r,le)]}}):o(Rt,de({key:"header"},v,le,{onClick:l.value!=="month"?q:void 0}),{...r,default:void 0}),default:()=>o(we,null,[o(It,de(B,{disabled:H.value,text:P.value,"onClick:next":p,"onClick:prev":O,"onClick:month":j,"onClick:year":X}),null),o(Ka,{hideOnLeave:!0},{default:()=>[l.value==="months"?o(At,de({key:"date-picker-months"},z,{modelValue:g.value,"onUpdate:modelValue":[Y=>g.value=Y,L],min:i.value,max:s.value,year:C.value}),null):l.value==="year"?o($t,de({key:"date-picker-years"},K,{modelValue:C.value,"onUpdate:modelValue":[Y=>C.value=Y,ae],min:i.value,max:s.value}),null):o(Ot,de({key:"date-picker-month"},$,{modelValue:u.value,"onUpdate:modelValue":Y=>u.value=Y,month:g.value,"onUpdate:month":[Y=>g.value=Y,L],year:C.value,"onUpdate:year":[Y=>C.value=Y,ae],min:i.value,max:s.value}),null)]})]),actions:r.actions})}),{}}}),Wl={class:"route-container"},Ll={class:"timetable-controls"},zl={class:"timetable-controls__date"},Ul={key:0,class:"timetable-controls-mobile"},Fl={class:"timetable-controls-mobile__inner"},Gl={class:"timetable-controls-mobile__date"},jl=100,ql=Ie({__name:"TimeTable",setup(e){Ne();const a=Le(),d=b(null),r=_a(),t=c(()=>r.server_settings),f=c(()=>t.value.general.backend==="EDCB"),u=b(!1),l=b(!1),i=b(0);let s=null;function m(){s!==null&&clearTimeout(s),s=window.setTimeout(()=>{i.value++,s=null},jl)}const g=c(()=>(i.value,me.isSmartphoneVertical()||me.isSmartphoneHorizontal()||me.isTabletVertical())),C=c(()=>(i.value,!me.isSmartphoneVertical())),N=b(0),S=b(!1),P=b(null),w=b(null),H=b(null),p=b(!1),O=c(()=>{const k=[],_=a.available_channel_types;for(const M of jt)_.has(M)&&k.push({title:M,value:M});return k}),q=c({get:()=>a.selected_channel_type,set:k=>{a.changeChannelType(k)}}),j=c(()=>{const k=[],_=a.is_36hour_display&&N.value===0;for(let M=4;M<=24;M+=4){const U=M,I=M<=12;k.push({title:`${U.toString().padStart(2,"0")}時`,value:M,..._&&I?{props:{disabled:!0}}:{}})}return k});function X(){let _=G().hour();return _<4&&(_+=24),Math.floor((_-4)/4)*4+4}const L=b(X()),ae=c(()=>{const k=a.selected_date.add(N.value,"day"),_=k.month()+1,M=k.date(),U=["日","月","火","水","木","金","土"][k.day()];return`${_}/${M} (${U})`}),y=c({get:()=>a.selected_date.toDate(),set:k=>{const _=G(k).hour(4).minute(0).second(0).millisecond(0);a.changeDate(_)}}),B=c(()=>a.date_range===null?!1:a.selected_date.subtract(1,"day").isSameOrAfter(a.date_range.earliest,"day")),v=c(()=>a.date_range===null?!1:a.selected_date.add(1,"day").isSameOrBefore(a.date_range.latest,"day")),$=c(()=>{if(a.date_range!==null)return a.date_range.earliest.startOf("day").toDate()}),z=c(()=>{if(a.date_range!==null)return a.date_range.latest.endOf("day").toDate()});function K(k){if(a.date_range===null)return!1;const _=G(k);return _.isSameOrAfter(a.date_range.earliest,"day")&&_.isSameOrBefore(a.date_range.latest,"day")}function le(k){a.changeChannelType(k)}function Y(k){l.value=!1;const _=G(k).hour(4).minute(0).second(0).millisecond(0);a.changeDate(_)}function fe(k){k===null||d.value===null||d.value.scrollToHour(k)}async function pe(){await a.goToPreviousDay(),await Ce(),d.value!==null&&d.value.scrollToEnd()}async function D(){await a.goToNextDay(),await Ce(),d.value!==null&&d.value.scrollToStart()}async function A(){await a.goToCurrentTime(),await Ce(),d.value!==null&&d.value.scrollToCurrentTime(!0,!0)}function W(k){const _=Math.floor((k-4)/4)*4+4,M=Math.max(4,Math.min(24,_));L.value=M}function ee(k){N.value=k}async function ce(k,_,M){const U=G(M.end_time);if(p.value=U.isBefore(G()),M.reservation!==null){const I=await Ue.fetchReservation(M.reservation.id);I!==null?(P.value=I,w.value=null,H.value=null):(P.value=ne(M,_.channel),w.value=null,H.value=null)}else P.value=ne(M,_.channel),w.value=null,H.value=null;S.value=!0}function ne(k,_){return{id:-1,channel:_,program:k,is_recording_in_progress:!1,recording_availability:"Full",comment:"",scheduled_recording_file_name:"",estimated_recording_file_size:0,record_settings:structuredClone(Ct)}}async function se(){await a.fetchTimeTableData()}async function ye(){await a.fetchTimeTableData()}async function ke(){await a.fetchTimeTableData()}async function Se(k,_,M){if(G(M.end_time).isBefore(G()))return;if(f.value===!1){ut.warning("録画予約機能は EDCB バックエンド利用時のみ使用できます。");return}if(M.reservation!==null){const ie=await Ue.fetchReservation(M.reservation.id);if(ie===null)return;const Te=structuredClone(ie.record_settings);if(Te.is_enabled=!Te.is_enabled,await Ue.updateReservation(ie.id,Te)!==null){const Me=Te.is_enabled?`録画予約を有効にしました。
番組開始時刻になると自動的に録画が開始されます。`:`録画予約を無効にしました。
番組開始時刻までに再度予約を有効にしない限り、この番組は録画されません。`;ut.success(Me),await a.fetchTimeTableData()}return}await Ue.addReservation(k,structuredClone(Ct))&&(ut.success("録画予約を追加しました。"),await a.fetchTimeTableData())}return Ze(async()=>{window.addEventListener("resize",m),await r.fetchServerSettingsOnce(),await a.initialLoad()}),vt(()=>{window.removeEventListener("resize",m),s!==null&&(clearTimeout(s),s=null),a.reset()}),ge(()=>a.selected_date,()=>{N.value=0}),(k,_)=>{const M=Je("Icon"),U=Wt("ftooltip");return E(),te("div",Wl,[o(ga,null,Fa({_:2},[g.value?void 0:{name:"timetable-controls",fn:J(()=>[R("div",Ll,[o(Fe,{class:"timetable-controls__channel-type",variant:"outlined",density:"compact","hide-details":"",items:O.value,modelValue:q.value,"onUpdate:modelValue":[_[0]||(_[0]=I=>q.value=I),le]},null,8,["items","modelValue"]),R("div",zl,[o(Z,{variant:"flat",icon:"",size:"small",disabled:!B.value,onClick:pe},{default:J(()=>[o(M,{icon:"fluent:chevron-left-20-regular",width:"20px"})]),_:1},8,["disabled"]),o(Mt,{modelValue:l.value,"onUpdate:modelValue":_[2]||(_[2]=I=>l.value=I),"close-on-content-click":!1},{activator:J(({props:I})=>[o(Z,de({variant:"flat",class:"timetable-controls__date-button"},I),{default:J(()=>[dt(De(ae.value),1)]),_:1},16)]),default:J(()=>[o(Nt,{modelValue:y.value,"onUpdate:modelValue":[_[1]||(_[1]=I=>y.value=I),Y],color:"primary",min:$.value,max:z.value,"allowed-dates":K},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"]),o(Z,{variant:"flat",icon:"",size:"small",disabled:!v.value,onClick:D},{default:J(()=>[o(M,{icon:"fluent:chevron-right-20-regular",width:"20px"})]),_:1},8,["disabled"])]),o(Fe,{class:"timetable-controls__time",variant:"outlined",density:"compact","hide-details":"",items:j.value,modelValue:L.value,"onUpdate:modelValue":[_[3]||(_[3]=I=>L.value=I),fe]},null,8,["items","modelValue"]),ct((E(),ve(Z,{variant:"flat",class:"timetable-controls__now-button",icon:"",onClick:A},{default:J(()=>[o(M,{icon:"fluent:clock-20-regular",width:"22px"})]),_:1})),[[U,"現在時刻に移動",void 0,{bottom:!0}]]),ct((E(),ve(Z,{variant:"flat",class:"timetable-controls__settings-button",icon:"",onClick:_[4]||(_[4]=I=>u.value=!0)},{default:J(()=>[o(M,{icon:"fluent:settings-20-regular",width:"22px"})]),_:1})),[[U,"番組表の表示設定",void 0,{bottom:!0}]])])]),key:"0"}]),1024),R("main",null,[o(pa,{"icon-only":C.value},null,8,["icon-only"]),R("div",{class:Qe(["timetable-container",{"timetable-container--loading":qe(a).is_loading}])},[o(ya),g.value?(E(),te("div",Ul,[R("div",Fl,[o(Fe,{class:"timetable-controls-mobile__channel-type",variant:"outlined",density:"compact","hide-details":"",items:O.value,modelValue:q.value,"onUpdate:modelValue":[_[5]||(_[5]=I=>q.value=I),le]},null,8,["items","modelValue"]),R("div",Gl,[o(Mt,{modelValue:l.value,"onUpdate:modelValue":_[7]||(_[7]=I=>l.value=I),"close-on-content-click":!1},{activator:J(({props:I})=>[o(Z,de({variant:"flat",class:"timetable-controls-mobile__date-button",size:"small"},I),{default:J(()=>[dt(De(ae.value),1)]),_:1},16)]),default:J(()=>[o(Nt,{modelValue:y.value,"onUpdate:modelValue":[_[6]||(_[6]=I=>y.value=I),Y],color:"primary",min:$.value,max:z.value,"allowed-dates":K},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"])]),o(Fe,{class:"timetable-controls-mobile__time",variant:"outlined",density:"compact","hide-details":"",items:j.value,modelValue:L.value,"onUpdate:modelValue":[_[8]||(_[8]=I=>L.value=I),fe]},null,8,["items","modelValue"]),o(Z,{variant:"flat",class:"timetable-controls-mobile__now-button",icon:"",size:"small",onClick:A},{default:J(()=>[o(M,{icon:"fluent:clock-20-regular",width:"18px"})]),_:1}),o(Z,{variant:"flat",class:"timetable-controls-mobile__settings-button",icon:"",size:"small",onClick:_[9]||(_[9]=I=>u.value=!0)},{default:J(()=>[o(M,{icon:"fluent:settings-20-regular",width:"18px"})]),_:1})])])):oe("",!0),o(Ol,{ref_key:"timetableGridRef",ref:d,channels:qe(a).channels_data,is36HourDisplay:qe(a).is_36hour_display,canGoPreviousDay:B.value,canGoNextDay:v.value,onTimeSlotChange:W,onDateDisplayOffsetChange:ee,onShowProgramDetail:ce,onQuickReserve:Se,onGoToNextDay:D,onGoToPreviousDay:pe},null,8,["channels","is36HourDisplay","canGoPreviousDay","canGoNextDay"])],2)]),o(ka,{isOpen:u.value,"onUpdate:isOpen":_[10]||(_[10]=I=>u.value=I)},null,8,["isOpen"]),o(ba,{modelValue:S.value,"onUpdate:modelValue":_[11]||(_[11]=I=>S.value=I),reservation:P.value,program:w.value,channel:H.value,isPastProgram:p.value,onAdded:se,onUpdated:ye,onDeleted:ke},null,8,["modelValue","reservation","program","channel","isPastProgram"])])}}}),vn=Re(ql,[["__scopeId","data-v-67a0324d"]]);export{vn as default};
