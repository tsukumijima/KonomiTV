import{cj as d,y as l,u as w,a7 as a,M as n}from"./index-n0Wx4Wae.js";const f=d("twitter",{state:()=>({is_logged_in_twitter:!1,selected_twitter_account:null,account_api_activity:{}}),actions:{async update(){const i=l(),e=w();if(await i.fetchUser()!==null)if(i.is_logged_in===!0){if(i.user&&i.user.twitter_accounts.length>0){this.is_logged_in_twitter=!0,(e.settings.selected_twitter_account_id===null||!i.user.twitter_accounts.some(s=>s.id===e.settings.selected_twitter_account_id))&&(e.settings.selected_twitter_account_id=i.user.twitter_accounts[0].id);const t=i.user.twitter_accounts.findIndex(s=>s.id===e.settings.selected_twitter_account_id);this.selected_twitter_account=i.user.twitter_accounts[t],this.selected_twitter_account&&this.resetAccountAPIActivity(this.selected_twitter_account.screen_name)}}else this.is_logged_in_twitter=!1,this.selected_twitter_account=null,this.account_api_activity={}},markAccountAPIActivity(i){i!==""&&(this.account_api_activity={...this.account_api_activity,[i]:!0})},resetAccountAPIActivity(i){i!==""&&(this.account_api_activity={...this.account_api_activity,[i]:!1})}}});class o{static async auth(e){const r=await a.post("/twitter/auth",e);return r.type==="error"?typeof r.data.detail=="string"&&r.data.detail.startsWith("Failed to get user information")?(n.error("Twitter アカウント情報の取得に失敗しました。有効な Cookie を入力してください。"),!1):(a.showGenericError(r,"Twitter アカウントとの連携に失敗しました。"),!1):!0}static async logoutAccount(e){const r=await a.delete(`/twitter/accounts/${e}`);return r.type==="error"?(a.showGenericError(r,"Twitter アカウントとの連携を解除できませんでした。"),!1):!0}static async keepAlive(e){const r=await a.post(`/twitter/accounts/${e}/keep-alive`);if(r.type==="error"){a.showGenericError(r,"ヘッドレスブラウザへの Keep-Alive 送信に失敗しました。");return}o.recordAccountActivity(e)}static async sendTweet(e,r,t){const s=new FormData;s.append("tweet",r);for(const u of t)s.append("images",u);const c=await a.post(`/twitter/accounts/${e}/tweets`,s,{headers:{"Content-Type":"multipart/form-data"},timeout:10*60*1e3});return c.type==="error"?typeof c.data.detail=="string"&&c.data.detail==="Chrome or Brave is not installed on this machine."?{message:"ヘッドレスブラウザの起動に必要な Chrome または Brave が KonomiTV サーバーにインストールされていません。",is_error:!0}:typeof c.data.detail=="string"?Number.isNaN(c.status)?{message:`ツイートの送信に失敗しました。(${c.data.detail})`,is_error:!0}:{message:`ツイートの送信に失敗しました。(HTTP Error ${c.status} / ${c.data.detail})`,is_error:!0}:{message:`ツイートの送信に失敗しました。(HTTP Error ${c.status})`,is_error:!0}:c.data.is_success===!1?{message:c.data.detail,is_error:!0}:(o.recordAccountActivity(e),{message:c.data.detail,is_error:!1})}static async retweet(e,r){const t=await a.put(`/twitter/accounts/${e}/tweets/${r}/retweet`,void 0);if(t.type==="error"){switch(t.data.detail){default:a.showGenericError(t,"ツイートをリツイートできませんでした。");break}return null}return t.data.is_success===!1?(n.error(t.data.detail),null):(o.recordAccountActivity(e),t.data)}static async cancelRetweet(e,r){const t=await a.delete(`/twitter/accounts/${e}/tweets/${r}/retweet`);if(t.type==="error"){switch(t.data.detail){default:a.showGenericError(t,"リツイートを取り消せませんでした。");break}return null}return t.data.is_success===!1?(n.error(t.data.detail),null):(o.recordAccountActivity(e),t.data)}static async favorite(e,r){const t=await a.put(`/twitter/accounts/${e}/tweets/${r}/favorite`,void 0);if(t.type==="error"){switch(t.data.detail){default:a.showGenericError(t,"ツイートをいいねできませんでした。");break}return null}return t.data.is_success===!1?(n.error(t.data.detail),null):(o.recordAccountActivity(e),t.data)}static async cancelFavorite(e,r){const t=await a.delete(`/twitter/accounts/${e}/tweets/${r}/favorite`);if(t.type==="error"){switch(t.data.detail){default:a.showGenericError(t,"いいねを取り消せませんでした。");break}return null}return t.data.is_success===!1?(n.error(t.data.detail),null):(o.recordAccountActivity(e),t.data)}static async getHomeTimeline(e,r){const t=await a.get(`/twitter/accounts/${e}/timeline`,{params:{cursor_id:r}});if(t.type==="error"){switch(t.data.detail){default:a.showGenericError(t,"ホームタイムラインを取得できませんでした。");break}return null}return"is_success"in t.data&&t.data.is_success===!1?(n.error(t.data.detail),null):(o.recordAccountActivity(e),t.data)}static async searchTweets(e,r,t){const s=await a.get(`/twitter/accounts/${e}/search`,{params:{query:r,cursor_id:t}});if(s.type==="error"){switch(s.data.detail){default:a.showGenericError(s,"ツイートの検索に失敗しました。");break}return null}return"is_success"in s.data&&s.data.is_success===!1?(n.error(s.data.detail),null):(o.recordAccountActivity(e),s.data)}static recordAccountActivity(e){if(e==="")return;f().markAccountAPIActivity(e)}}export{o as T,f as u};
