import{d as T,q as V,x as U,s as Q,G as O,A as H,c as _,w as g,a as o,cd as z,e as S,b as y,k as $,h as p,a3 as A,r as C,v as F,B as j,V as B,C as G,l as x,o as r,R as k,_ as P,D as J,E as X,dQ as Y,au as Z,ai as tt,at as I,d6 as et,aw as nt,az as at,T as it,dR as st,d3 as ot,aO as rt,O as lt,aq as ct,aA as ut,dK as vt,I as dt,dS as ht,aB as _t,aE as ft,aS as pt,J as gt,aG as mt,dT as yt,n as h,a7 as D,af as kt,U as R,m as bt,j as wt,t as St,F as $t}from"./index-C90hjLTU.js";import{V as q,_ as K,u as Ot}from"./ssrBoot-OnzqbV2B.js";function Ct(t,i,e,c){function s(a){return a instanceof e?a:new e(function(l){l(a)})}return new(e||(e=Promise))(function(a,l){function u(f){try{n(c.next(f))}catch(w){l(w)}}function b(f){try{n(c.throw(f))}catch(w){l(w)}}function n(f){f.done?a(f.value):s(f.value).then(u,b)}n((c=c.apply(t,[])).next())})}function Wt(t,i){var e={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},c,s,a,l;return l={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function u(n){return function(f){return b([n,f])}}function b(n){if(c)throw new TypeError("Generator is already executing.");for(;l&&(l=0,n[0]&&(e=0)),e;)try{if(c=1,s&&(a=n[0]&2?s.return:n[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,n[1])).done)return a;switch(s=0,a&&(n=[n[0]&2,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return e.label++,{value:n[1],done:!1};case 5:e.label++,s=n[1],n=[0];continue;case 7:n=e.ops.pop(),e.trys.pop();continue;default:if(a=e.trys,!(a=a.length>0&&a[a.length-1])&&(n[0]===6||n[0]===2)){e=0;continue}if(n[0]===3&&(!a||n[1]>a[0]&&n[1]<a[3])){e.label=n[1];break}if(n[0]===6&&e.label<a[1]){e.label=a[1],a=n;break}if(a&&e.label<a[2]){e.label=a[2],e.ops.push(n);break}a[2]&&e.ops.pop(),e.trys.pop();continue}n=i.call(t,e)}catch(f){n=[6,f],s=0}finally{c=a=0}if(n[0]&5)throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}var Bt=function(){function t(){var i=this;this.event=null,this.callbacks=[],this.install=function(){return Ct(i,void 0,void 0,function(){var e=this;return Wt(this,function(c){switch(c.label){case 0:return this.event?(this.event.prompt(),[4,this.event.userChoice.then(function(s){var a=s.outcome;return e.updateEvent(null),a==="accepted"})]):[3,2];case 1:return[2,c.sent()];case 2:throw new Error("Not allowed to prompt.")}})})},!(typeof window>"u")&&(window.addEventListener("beforeinstallprompt",function(e){e.preventDefault(),i.updateEvent(e)}),window.addEventListener("appinstalled",function(){i.updateEvent(null)}))}return t.prototype.getEvent=function(){return this.event},t.prototype.canInstall=function(){return this.event!==null},t.prototype.updateEvent=function(i){var e=this;i!==this.event&&(this.event=i,this.callbacks.forEach(function(c){return c(e.canInstall())}))},t.prototype.addListener=function(i){i(this.canInstall()),this.callbacks.push(i)},t.prototype.removeListener=function(i){this.callbacks=this.callbacks.filter(function(e){return i!==e})},t}(),L=new Bt;const It={class:"header"},Vt={key:0,class:"search-box"},Et=["placeholder"],Pt=T({__name:"HeaderBar",setup(t){const i=V(!1),e=V(""),c=G(),s=H(),a=()=>{s.path.endsWith("/search")&&s.query.query&&(e.value=decodeURIComponent(s.query.query))};U(()=>{L.addListener(d=>{i.value=d}),a()}),Q(()=>s.fullPath,a);const l=O(()=>s.path.startsWith("/videos")||s.path.startsWith("/mylist")||s.path.startsWith("/watched-history")?"録画番組を検索...":"放送予定の番組を検索..."),u=()=>s.path.startsWith("/videos")||s.path.startsWith("/mylist")||s.path.startsWith("/watched-history")?"/videos/search":"/tv/search",b=d=>{d.key==="Enter"&&!d.isComposing&&n()},n=()=>{if(e.value.trim()){const d=u();c.push(`${d}?query=${encodeURIComponent(e.value.trim())}`)}},f=O(()=>{const d=s.path;return!d.startsWith("/captures")&&!d.startsWith("/settings")&&!d.startsWith("/login")&&!d.startsWith("/register")}),w=O(()=>s.path.startsWith("/timetable"));return(d,m)=>{const v=C("router-link"),W=C("Icon");return r(),_("header",It,[g((r(),$(v,{class:"konomitv-logo ml-3 ml-md-6",to:"/tv/"},{default:p(()=>[...m[2]||(m[2]=[y("img",{class:"konomitv-logo__image",src:K,height:"21"},null,-1)])]),_:1})),[[k]]),o(q),z(d.$slots,"timetable-controls",{},void 0,!0),f.value?(r(),_("div",Vt,[g(y("input",{class:"search-input",type:"search",enterkeyhint:"search",placeholder:l.value,"onUpdate:modelValue":m[0]||(m[0]=E=>e.value=E),onKeydown:b},null,40,Et),[[A,e.value]]),o(W,{class:"search-input__icon",icon:"fluent:search-20-filled",height:"24px",onClick:n})])):S("",!0),g(o(B,{variant:"flat",class:"pwa-install-button",onClick:m[1]||(m[1]=E=>j(L).install())},{default:p(()=>[o(W,{icon:"material-symbols:install-desktop-rounded",height:"20px",class:"mr-1"}),m[3]||(m[3]=x(" アプリとしてインストール ",-1))]),_:1},512),[[F,i.value&&!w.value]]),m[4]||(m[4]=y("div",{class:"mr-3 mr-md-6"},null,-1))])}}}),ae=P(Pt,[["__scopeId","data-v-e95246c2"]]),Nt=X({baseColor:String,bgColor:String,color:String,grow:Boolean,mode:{type:String,validator:t=>!t||["horizontal","shift"].includes(t)},height:{type:[Number,String],default:56},active:{type:Boolean,default:!0},...mt(),...gt(),...pt(),...ft(),..._t(),...ht({name:"bottom-navigation"}),...dt({tag:"header"}),...vt({selectedClass:"v-btn--selected"}),...ut()},"VBottomNavigation"),Rt=J()({name:"VBottomNavigation",props:Nt(),emits:{"update:active":t=>!0,"update:modelValue":t=>!0},setup(t,i){let{slots:e}=i;const{themeClasses:c}=Y(),{borderClasses:s}=Z(t),{backgroundColorClasses:a,backgroundColorStyles:l}=tt(I(t,"bgColor")),{densityClasses:u}=et(t),{elevationClasses:b}=nt(t),{roundedClasses:n}=at(t),{ssrBootStyles:f}=Ot(),w=O(()=>Number(t.height)-(t.density==="comfortable"?8:0)-(t.density==="compact"?16:0)),d=it(t,"active",t.active),{layoutItemStyles:m}=st({id:t.name,order:O(()=>parseInt(t.order,10)),position:O(()=>"bottom"),layoutSize:O(()=>d.value?w.value:0),elementSize:w,active:d,absolute:I(t,"absolute")});return ot(t,yt),rt({VBtn:{baseColor:I(t,"baseColor"),color:I(t,"color"),density:I(t,"density"),stacked:O(()=>t.mode!=="horizontal"),variant:"text"}},{scoped:!0}),lt(()=>o(t.tag,{class:["v-bottom-navigation",{"v-bottom-navigation--active":d.value,"v-bottom-navigation--grow":t.grow,"v-bottom-navigation--shift":t.mode==="shift"},c.value,a.value,s.value,u.value,b.value,n.value,t.class],style:[l.value,m.value,{height:ct(w.value)},f.value,t.style]},{default:()=>[e.default&&o("div",{class:"v-bottom-navigation__content"},[e.default()])]})),{}}}),Tt={};function qt(t,i){const e=C("Icon");return r(),$(Rt,{class:"bottom-navigation-container elevation-12",color:"primary",grow:"",active:""},{default:p(()=>[o(B,{class:h(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/tv")}]),to:"/tv/"},{default:p(()=>[o(e,{icon:"fluent:tv-20-regular",width:"30px"}),i[0]||(i[0]=y("span",{class:"mt-1"},"テレビをみる",-1))]),_:1},8,["class"]),o(B,{class:h(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/videos")}]),to:"/videos/"},{default:p(()=>[o(e,{icon:"fluent:movies-and-tv-20-regular",width:"30px"}),i[1]||(i[1]=y("span",{class:"mt-1"},"ビデオをみる",-1))]),_:1},8,["class"]),o(B,{class:h(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/reservations")}]),to:"/reservations/"},{default:p(()=>[o(e,{icon:"fluent:timer-16-regular",width:"30px"}),i[2]||(i[2]=y("span",{class:"mt-1"},"録画予約",-1))]),_:1},8,["class"]),o(B,{class:h(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/captures")}]),to:"/captures/"},{default:p(()=>[o(e,{icon:"fluent:image-multiple-24-regular",width:"30px"}),i[3]||(i[3]=y("span",{class:"mt-1"},"キャプチャ",-1))]),_:1},8,["class"]),o(B,{class:h(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/mypage")}]),to:"/mypage/"},{default:p(()=>[o(e,{icon:"fluent:person-20-regular",width:"30px"}),i[4]||(i[4]=y("span",{class:"mt-1"},"マイページ",-1))]),_:1},8,["class"])]),_:1})}const Dt=P(Tt,[["render",qt],["__scopeId","data-v-58f8356e"]]);class Lt{static async fetchServerVersion(i=!1){const e=await D.get("/version");return e.type==="error"?(i===!1&&D.showGenericError(e,"バージョン情報を取得できませんでした。"),null):e.data}}const Ut=kt("version",{state:()=>({server_version_info:null,last_updated_at:0}),getters:{client_version(){return R.version},server_version(){var t;return((t=this.server_version_info)==null?void 0:t.version)??null},latest_version(){var t;return((t=this.server_version_info)==null?void 0:t.latest_version)??null},is_client_develop_version(){return this.client_version.includes("-dev")},is_server_develop_version(){var t;return((t=this.server_version)==null?void 0:t.includes("-dev"))??!1},is_update_available(){return this.server_version===null||this.latest_version===null?!1:this.is_server_develop_version===!1&&this.server_version!==this.latest_version||this.is_server_develop_version===!0&&this.server_version.replace("-dev","")===this.latest_version},is_version_mismatch(){return this.server_version===null?!1:this.client_version!==this.server_version},server_environment(){var t;return((t=this.server_version_info)==null?void 0:t.environment)??null},is_linux_environment(){const t=this.server_environment;return t==="Linux"||t==="Linux-Docker"||t==="Linux-ARM"}},actions:{async fetchServerVersion(t=!1){if(this.server_version_info!==null&&t===!1)return R.time()-this.last_updated_at>60&&this.fetchServerVersion(!0),this.server_version_info;const i=await Lt.fetchServerVersion();return i===null?null:(this.server_version_info=i,this.last_updated_at=R.time(),this.server_version_info)}}}),Ht=T({name:"Navigation",components:{BottomNavigation:Dt},props:{iconOnly:{type:Boolean,default:!1}},computed:{...bt(Ut)},async created(){await this.versionStore.fetchServerVersion()}}),zt={key:0,class:"navigation__link-text"},At={key:0,class:"navigation__link-text"},Gt={key:0,class:"navigation__link-text"},Kt={key:0,class:"navigation__link-text"},Mt={key:0,class:"navigation__link-text"},Qt={key:0,class:"navigation__link-text"},Ft={key:0,class:"navigation__link-text"},jt={key:0,class:"navigation__link-text"},xt={key:0,class:"navigation__link-text"};function Jt(t,i,e,c,s,a){const l=C("Icon"),u=C("router-link"),b=C("BottomNavigation"),n=wt("ftooltip");return r(),_("div",null,[y("div",{class:h(["navigation-container elevation-8",{"navigation-container--icon-only":t.iconOnly}])},[y("nav",{class:h(["navigation",{"navigation--icon-only":t.iconOnly}])},[y("div",{class:h(["navigation-scroll",{"navigation-scroll--icon-only":t.iconOnly}])},[g((r(),$(u,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/tv"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/tv/"},{default:p(()=>[o(l,{class:"navigation__link-icon",icon:"fluent:tv-20-regular",width:"26px"}),t.iconOnly?S("",!0):(r(),_("span",zt,"テレビをみる"))]),_:1},8,["class"])),[[k],[n,t.iconOnly?"テレビをみる":"",void 0,{right:!0}]]),g((r(),$(u,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/videos"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/videos/"},{default:p(()=>[o(l,{class:"navigation__link-icon",icon:"fluent:movies-and-tv-20-regular",width:"26px"}),t.iconOnly?S("",!0):(r(),_("span",At,"ビデオをみる"))]),_:1},8,["class"])),[[k],[n,t.iconOnly?"ビデオをみる":"",void 0,{right:!0}]]),g((r(),$(u,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/timetable"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/timetable/"},{default:p(()=>[o(l,{class:"navigation__link-icon",icon:"fluent:calendar-ltr-20-regular",width:"26px"}),t.iconOnly?S("",!0):(r(),_("span",Gt,"番組表"))]),_:1},8,["class"])),[[k],[n,t.iconOnly?"番組表":"",void 0,{right:!0}]]),g((r(),$(u,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/reservations"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/reservations/"},{default:p(()=>[o(l,{class:"navigation__link-icon",icon:"fluent:timer-16-regular",width:"26px",style:{padding:"0.5px"}}),t.iconOnly?S("",!0):(r(),_("span",Kt,"録画予約"))]),_:1},8,["class"])),[[k],[n,t.iconOnly?"録画予約":"",void 0,{right:!0}]]),g((r(),$(u,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/captures"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/captures/"},{default:p(()=>[o(l,{class:"navigation__link-icon",icon:"fluent:image-multiple-24-regular",width:"26px"}),t.iconOnly?S("",!0):(r(),_("span",Mt,"キャプチャ"))]),_:1},8,["class"])),[[k],[n,t.iconOnly?"キャプチャ":"",void 0,{right:!0}]]),g((r(),$(u,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/mylist"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/mylist/"},{default:p(()=>[o(l,{class:"navigation__link-icon",icon:"ic:round-playlist-play",width:"26px"}),t.iconOnly?S("",!0):(r(),_("span",Qt,"マイリスト"))]),_:1},8,["class"])),[[k],[n,t.iconOnly?"マイリスト":"",void 0,{right:!0}]]),g((r(),$(u,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/watched-history"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/watched-history/"},{default:p(()=>[o(l,{class:"navigation__link-icon",icon:"fluent:history-20-regular",width:"26px"}),t.iconOnly?S("",!0):(r(),_("span",Ft,"視聴履歴"))]),_:1},8,["class"])),[[k],[n,t.iconOnly?"視聴履歴":"",void 0,{right:!0}]]),o(q),g((r(),$(u,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/settings"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/settings/"},{default:p(()=>[o(l,{class:"navigation__link-icon",icon:"fluent:settings-20-regular",width:"26px"}),t.iconOnly?S("",!0):(r(),_("span",jt,"設定"))]),_:1},8,["class"])),[[k],[n,t.iconOnly?"設定":"",void 0,{right:!0}]]),g((r(),_("a",{class:h(["navigation__link",{"navigation__link--develop-version":t.versionStore.is_client_develop_version,"navigation__link--highlight":t.versionStore.is_update_available,"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",href:"https://github.com/tsukumijima/KonomiTV",target:"_blank"},[o(l,{class:"navigation__link-icon",icon:"fluent:info-16-regular",width:"26px"}),t.iconOnly?S("",!0):(r(),_("span",xt,"version "+St(t.versionStore.client_version),1))],2)),[[k],[n,t.iconOnly?t.versionStore.is_update_available?`アップデートがあります (version ${t.versionStore.latest_version})`:`version ${t.versionStore.client_version}`:t.versionStore.is_update_available?`アップデートがあります (version ${t.versionStore.latest_version})`:"",void 0,{right:!0}]])],2)],2)],2),o(b)])}const ie=P(Ht,[["render",Jt],["__scopeId","data-v-60019fe5"]]),Xt={key:1,class:"search-box"},Yt={class:"search-box__icon"},Zt=["placeholder"],te=T({__name:"SPHeaderBar",props:{hideOnSmartphoneVertical:{type:Boolean,default:!1}},setup(t){const i=G(),e=H(),c=V(null),s=V(!1),a=V(""),l=O(()=>{const v=e.path;return!v.startsWith("/captures")&&!v.startsWith("/settings")&&!v.startsWith("/login")&&!v.startsWith("/register")}),u=O(()=>b(e.path)?"録画番組やシリーズを検索...":"放送予定の番組を検索..."),b=v=>v.startsWith("/videos")||v.startsWith("/mylist")||v.startsWith("/watched-history"),n=()=>b(e.path)?"/videos/search":"/tv/search",f=()=>{s.value=!0,setTimeout(()=>{var v;(v=c.value)==null||v.focus()},0)},w=()=>{s.value=!1,a.value=""},d=()=>{if(a.value.trim()){const v=n();i.push(`${v}?query=${encodeURIComponent(a.value.trim())}`)}},m=v=>{v.key==="Enter"?d():v.key==="Escape"&&w()};return U(()=>{e.path.endsWith("/search")&&e.query.query&&(a.value=decodeURIComponent(e.query.query),s.value=!0)}),(v,W)=>{const E=C("router-link"),N=C("Icon");return r(),_("header",{class:h(["header",{"search-active":s.value,"header--hide-on-sp-vertical":t.hideOnSmartphoneVertical}])},[s.value?(r(),_("div",Xt,[y("div",Yt,[o(N,{icon:"fluent:search-20-filled",height:"20px"})]),g(y("input",{ref_key:"searchInput",ref:c,type:"search",enterkeyhint:"search",placeholder:u.value,"onUpdate:modelValue":W[0]||(W[0]=M=>a.value=M),onKeydown:m},null,40,Zt),[[A,a.value]]),g((r(),_("div",{class:"search-box__close",onClick:w},[o(N,{icon:"fluent:dismiss-20-filled",height:"24px"})])),[[k]])])):(r(),_($t,{key:0},[g((r(),$(E,{class:"konomitv-logo",to:"/tv/"},{default:p(()=>[...W[1]||(W[1]=[y("img",{class:"konomitv-logo__image",src:K,height:"21"},null,-1)])]),_:1})),[[k]]),o(q),z(v.$slots,"timetable-controls",{},void 0,!0),l.value?g((r(),_("div",{key:0,class:"search-button",onClick:f},[o(N,{icon:"fluent:search-20-filled",height:"24px"})])),[[k]]):S("",!0)],64))],2)}}}),se=P(te,[["__scopeId","data-v-8a2cc497"]]);export{ae as H,ie as N,se as S,Lt as V,Ut as u};
