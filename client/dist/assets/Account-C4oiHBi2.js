import{d as T,m as U,M as p,cm as A,cn as v,co as I,u as y,U as K,y as B,_ as F,k as D,h as o,b as t,w as N,a as n,c as u,r as b,e as g,l as i,V as r,t as w,p as m,n as j,o as d,R as z}from"./index-Bwzgjc3Q.js";import{S as M}from"./Base-BWpXWXEe.js";import{V as R}from"./VSwitch-CqI-jjfn.js";import{a as S,V,b as C,c as E}from"./VCard-DQ5byH27.js";import{V as k}from"./VDialog-DiGP_t33.js";import{c as h,b as H}from"./VTextField-C8jbDFyH.js";import{V as c}from"./VForm-DL2tJ4Tg.js";import{V as Z}from"./VFileInput-CDr3boVd.js";import{V as q}from"./ssrBoot-1pWmlktz.js";import"./Navigation-Dc3WHOr4.js";import"./VChip-CLMuKveC.js";import"./VAvatar-DSObgxFt.js";const G=T({name:"Settings-Account",components:{SettingsBase:M},data(){return{is_form_dense:K.isSmartphoneHorizontal(),is_loading:!0,settings_username:null,settings_username_validation:e=>e===""||e===null?"ユーザー名を入力してください。":/^.{2,}$/.test(e)===!1?"ユーザー名は2文字以上で入力してください。":!0,settings_password:null,settings_password_showing:!1,settings_password_validation:e=>e===""||e===null?"パスワードを入力してください。":/^[a-zA-Z0-9!-/:-@¥[-`{-~]{4,}$/.test(e)===!1?"パスワードは4文字以上の半角英数記号を入力してください。":!0,settings_icon_file:null,account_delete_confirm_dialog:!1,sync_settings:y().settings.sync_settings,sync_settings_dialog:!1}},computed:{...U(y,B)},watch:{async sync_settings(){if(this.sync_settings===!0&&this.sync_settings_dialog===!1){const e=A(this.settingsStore.settings),s=v(e),f=await I.fetchClientSettings();if(f===null){p.error("サーバーから設定データを取得できませんでした。");return}const _=v(f);console.log("[Settings-Account] sync_settings_hash:",s),console.log("[Settings-Account] server_sync_settings_hash:",_),s!==_?(this.sync_settings_dialog=!0,this.sync_settings=!1):this.settingsStore.settings.sync_settings=!0}else this.sync_settings===!1&&this.sync_settings_dialog===!1&&(this.settingsStore.settings.sync_settings=!1)}},async created(){await this.userStore.fetchUser(),this.is_loading=!1},methods:{async overrideServerSettingsFromClient(){await this.settingsStore.syncClientSettingsToServer(!0),this.settingsStore.settings.sync_settings=!0,this.sync_settings=!0,this.sync_settings_dialog=!1},async overrideClientSettingsFromServer(){await this.settingsStore.syncClientSettingsFromServer(!0),this.settingsStore.settings.sync_settings=!0,this.sync_settings=!0,this.sync_settings_dialog=!1},async updateAccountInfo(e){if(e==="username"){if((await this.$refs.settings_username.validate()).valid===!1)return}else if((await this.$refs.settings_password.validate()).valid===!1)return;if(e==="username"){if(this.settings_username===null)return;await this.userStore.updateUser({username:this.settings_username})}else{if(this.settings_password===null)return;await this.userStore.updateUser({password:this.settings_password})}},async updateAccountIcon(){if(this.settings_icon_file===null){p.error("アップロードする画像を選択してください！");return}await this.userStore.updateUserIcon(this.settings_icon_file)},async deleteAccount(){this.account_delete_confirm_dialog=!1,await this.userStore.deleteUser()}}}),J="/assets/images/account-icon-default.png",L={class:"settings__heading"},O={key:0,class:"account"},P={key:1,class:"account"},Q={class:"account-wrapper"},W=["src"],X={class:"account__info"},Y={class:"account__info-name"},x={class:"account__info-name-text"},ss={key:0,class:"account__info-admin"},ts={class:"account__info-id"},es={key:2,class:"account-register"},ns={class:"account-register__feature"},is={class:"account-feature"},os={class:"account-feature"},ls={class:"account-feature"},as={class:"account-feature"},rs={key:3},ds={class:"settings__item settings__item--switch"},us={class:"d-flex flex-column px-4 pb-6 settings__conflict-dialog"};function gs(e,s,f,_,fs,_s){const a=b("Icon"),$=b("SettingsBase");return d(),D($,null,{default:o(()=>[t("h2",L,[N((d(),u("a",{class:"settings__back-button",onClick:s[0]||(s[0]=l=>e.$router.back())},[n(a,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[z]]),n(a,{icon:"fluent:person-20-filled",width:"25px"}),s[21]||(s[21]=t("span",{class:"ml-2"},"アカウント",-1))]),t("div",{class:j(["settings__content",{"settings__content--loading":e.is_loading}])},[e.userStore.user===null?(d(),u("div",O,[s[23]||(s[23]=t("div",{class:"account-wrapper"},[t("img",{class:"account__icon",src:J}),t("div",{class:"account__info"},[t("div",{class:"account__info-name"},[t("span",{class:"account__info-name-text"},"ログインしていません")]),t("span",{class:"account__info-id"},"Not logged in")])],-1)),n(r,{class:"account__login ml-auto",color:"secondary",width:"140",height:"56",variant:"flat",to:"/login/"},{default:o(()=>[n(a,{icon:"fa:sign-in",class:"mr-2"}),s[22]||(s[22]=i("ログイン ",-1))]),_:1})])):g("",!0),e.userStore.user!==null?(d(),u("div",P,[t("div",Q,[t("img",{class:"account__icon",src:e.userStore.user_icon_url??""},null,8,W),t("div",X,[t("div",Y,[t("span",x,w(e.userStore.user.name),1),e.userStore.user.is_admin?(d(),u("span",ss,"管理者")):g("",!0)]),t("span",ts,"User ID: "+w(e.userStore.user.id),1)])]),n(r,{class:"account__login ml-auto",color:"secondary",width:"140",height:"56",variant:"flat",onClick:s[1]||(s[1]=l=>e.userStore.logout())},{default:o(()=>[n(a,{icon:"fa:sign-out",class:"mr-2"}),s[24]||(s[24]=i("ログアウト ",-1))]),_:1})])):g("",!0),e.userStore.is_logged_in===!1?(d(),u("div",es,[s[30]||(s[30]=t("div",{class:"account-register__heading"},[i(" KonomiTV アカウントにログインすると、"),t("br"),i("より便利な機能が使えます！ ")],-1)),t("div",ns,[t("div",is,[n(a,{class:"account-feature__icon",icon:"bi:chat-left-text-fill"}),s[25]||(s[25]=t("div",{class:"account-feature__info"},[t("span",{class:"account-feature__info-heading"},"ニコニコ実況にコメントする"),t("span",{class:"account-feature__info-text"},"テレビを見ながらニコニコ実況にコメントできます。別途、ニコニコアカウントとの連携が必要です。")],-1))]),t("div",os,[n(a,{class:"account-feature__icon",icon:"fa-brands:twitter"}),s[26]||(s[26]=t("div",{class:"account-feature__info"},[t("span",{class:"account-feature__info-heading"},"Twitter 連携機能"),t("span",{class:"account-feature__info-text"},"テレビを見ながら Twitter にツイートしたり、検索したツイートをリアルタイムで表示できます。別途、Twitter アカウントとの連携が必要です。")],-1))]),t("div",ls,[n(a,{class:"account-feature__icon",icon:"fluent:arrow-sync-20-filled"}),s[27]||(s[27]=t("div",{class:"account-feature__info"},[t("span",{class:"account-feature__info-heading"},"設定をデバイス間で同期"),t("span",{class:"account-feature__info-text"},"ピン留めしたチャンネルなど、ブラウザに保存されている各種設定をブラウザやデバイスをまたいで同期できます。")],-1))]),t("div",as,[n(a,{class:"account-feature__icon",icon:"fa-solid:sliders-h"}),s[28]||(s[28]=t("div",{class:"account-feature__info"},[t("span",{class:"account-feature__info-heading"},"サーバー設定をブラウザから変更"),t("span",{class:"account-feature__info-text"},"管理者権限があれば、サーバー設定をブラウザから変更できます。一番最初に作成されたアカウントには、自動で管理者権限が付与されます。")],-1))])]),s[31]||(s[31]=t("div",{class:"account-register__description"},[i(" KonomiTV アカウントの作成に必要なものは"),t("br",{class:"smartphone-vertical-only"}),i("ユーザー名とパスワードだけです。"),t("br"),i(" アカウントはローカルに導入した"),t("br",{class:"smartphone-vertical-only"}),i(" KonomiTV サーバーにのみ保存されます。"),t("br"),i(" 外部のサービスには保存されませんので、ご安心ください。"),t("br")],-1)),n(r,{class:"account-register__button",color:"secondary",width:"100%","max-width":"250",height:"50",variant:"flat",to:"/register/"},{default:o(()=>[n(a,{icon:"fluent:person-add-20-filled",class:"mr-2",height:"24"}),s[29]||(s[29]=i("アカウントを作成 ",-1))]),_:1})])):g("",!0),e.userStore.is_logged_in===!0?(d(),u("div",rs,[t("div",ds,[s[32]||(s[32]=t("label",{class:"settings__item-heading",for:"sync_settings"},"設定をデバイス間で同期する",-1)),s[33]||(s[33]=t("label",{class:"settings__item-label",for:"sync_settings"},[i(" KonomiTV では、設定を同じアカウントでログインしているデバイス間で同期できます！"),t("br"),i(" 同期をオンにすると、同期をオンにしているすべてのデバイスで共通の設定が使えます。ピン留めチャンネルやハッシュタグリストなども同期されます。"),t("br"),i(" なお、デバイス固有の設定（画質設定など）は、同期後も各デバイスで個別に反映されます。"),t("br")],-1)),n(R,{class:"settings__item-switch",color:"primary",id:"sync_settings","hide-details":"",modelValue:e.sync_settings,"onUpdate:modelValue":s[2]||(s[2]=l=>e.sync_settings=l)},null,8,["modelValue"])]),n(k,{"max-width":"530",modelValue:e.sync_settings_dialog,"onUpdate:modelValue":s[6]||(s[6]=l=>e.sync_settings_dialog=l)},{default:o(()=>[n(S,null,{default:o(()=>[n(V,{class:"d-flex justify-center font-weight-bold pt-6"},{default:o(()=>[...s[34]||(s[34]=[i("設定データの競合",-1)])]),_:1}),n(C,{class:"pt-2 pb-5"},{default:o(()=>[...s[35]||(s[35]=[i(" このデバイスの設定と、サーバーに保存されている設定が競合しています。",-1),t("br",null,null,-1),i(" 一度上書きすると、元に戻すことはできません。慎重に選択してください。",-1),t("br",null,null,-1)])]),_:1}),t("div",us,[n(r,{class:"settings__save-button text-error-lighten-1",color:"background-lighten-1",variant:"flat",onClick:s[3]||(s[3]=l=>e.overrideServerSettingsFromClient())},{default:o(()=>[n(a,{icon:"fluent:document-arrow-up-16-filled",class:"mr-2",height:"22px"}),s[36]||(s[36]=i(" サーバーに保存されている設定を、",-1)),s[37]||(s[37]=t("br",{class:"smartphone-vertical-only"},null,-1)),s[38]||(s[38]=i("このデバイスの設定で上書きする ",-1))]),_:1}),n(r,{class:"settings__save-button text-error-lighten-1 mt-3",color:"background-lighten-1",variant:"flat",onClick:s[4]||(s[4]=l=>e.overrideClientSettingsFromServer())},{default:o(()=>[n(a,{icon:"fluent:document-arrow-down-16-filled",class:"mr-2",height:"22px"}),s[39]||(s[39]=i(" このデバイスの設定を、",-1)),s[40]||(s[40]=t("br",{class:"smartphone-vertical-only"},null,-1)),s[41]||(s[41]=i("サーバーに保存されている設定で上書きする ",-1))]),_:1}),n(r,{class:"settings__save-button mt-3",variant:"flat",color:"background-lighten-1",onClick:s[5]||(s[5]=l=>e.sync_settings_dialog=!1)},{default:o(()=>[n(a,{icon:"fluent:dismiss-16-filled",class:"mr-2",height:"22px"}),s[42]||(s[42]=i(" キャンセル ",-1))]),_:1})])]),_:1})]),_:1},8,["modelValue"]),n(c,{class:"settings__item",ref:"settings_username",onSubmit:s[8]||(s[8]=m(()=>{},["prevent"]))},{default:o(()=>[s[43]||(s[43]=t("div",{class:"settings__item-heading"},"ユーザー名",-1)),s[44]||(s[44]=t("div",{class:"settings__item-label"},[i(" KonomiTV アカウントのユーザー名を設定します。アルファベットだけでなく日本語や記号も使えます。"),t("br"),i(" 同じ KonomiTV サーバー上の他のアカウントと同じユーザー名には変更できません。"),t("br")],-1)),n(h,{class:"settings__item-form",color:"primary",variant:"outlined",placeholder:"ユーザー名",density:e.is_form_dense?"compact":"default",modelValue:e.settings_username,"onUpdate:modelValue":s[7]||(s[7]=l=>e.settings_username=l),rules:[e.settings_username_validation]},null,8,["density","modelValue","rules"])]),_:1},512),n(r,{class:"settings__save-button mt-2",variant:"flat",onClick:s[9]||(s[9]=l=>e.updateAccountInfo("username"))},{default:o(()=>[n(a,{icon:"fluent:save-16-filled",class:"mr-2",height:"24px"}),s[45]||(s[45]=i("ユーザー名を更新 ",-1))]),_:1}),n(c,{class:"settings__item",onSubmit:s[11]||(s[11]=m(()=>{},["prevent"]))},{default:o(()=>[s[46]||(s[46]=t("div",{class:"settings__item-heading"},"アイコン画像",-1)),s[47]||(s[47]=t("div",{class:"settings__item-label"},[i(" KonomiTV アカウントのアイコン画像を設定します。"),t("br"),i(" アップロードされた画像は自動で 400×400 の正方形にリサイズされます。"),t("br")],-1)),n(Z,{class:"settings__item-form",color:"primary",variant:"outlined","hide-details":"",label:"アイコン画像を選択",density:e.is_form_dense?"compact":"default",accept:"image/jpeg, image/png","prepend-icon":"","prepend-inner-icon":"mdi-paperclip",modelValue:e.settings_icon_file,"onUpdate:modelValue":s[10]||(s[10]=l=>e.settings_icon_file=l)},null,8,["density","modelValue"])]),_:1}),n(r,{class:"settings__save-button mt-5",variant:"flat",onClick:s[12]||(s[12]=l=>e.updateAccountIcon())},{default:o(()=>[n(a,{icon:"fluent:save-16-filled",class:"mr-2",height:"24px"}),s[48]||(s[48]=i("アイコン画像を更新 ",-1))]),_:1}),n(c,{class:"settings__item",ref:"settings_password",onSubmit:s[15]||(s[15]=m(()=>{},["prevent"]))},{default:o(()=>[s[49]||(s[49]=t("div",{class:"settings__item-heading"},"新しいパスワード",-1)),s[50]||(s[50]=t("div",{class:"settings__item-label"},[i(" KonomiTV アカウントの新しいパスワードを設定します。"),t("br")],-1)),n(h,{class:"settings__item-form",color:"primary",variant:"outlined",placeholder:"新しいパスワード",density:e.is_form_dense?"compact":"default",modelValue:e.settings_password,"onUpdate:modelValue":s[13]||(s[13]=l=>e.settings_password=l),type:e.settings_password_showing?"text":"password",rules:[e.settings_password_validation],"append-inner-icon":e.settings_password_showing?"mdi-eye":"mdi-eye-off","onClick:appendInner":s[14]||(s[14]=l=>e.settings_password_showing=!e.settings_password_showing)},null,8,["density","modelValue","type","rules","append-inner-icon"])]),_:1},512),n(r,{class:"settings__save-button mt-2",variant:"flat",onClick:s[16]||(s[16]=l=>e.updateAccountInfo("password"))},{default:o(()=>[n(a,{icon:"fluent:save-16-filled",class:"mr-2",height:"24px"}),s[51]||(s[51]=i("パスワードを更新 ",-1))]),_:1}),n(H,{class:"mt-6"}),s[57]||(s[57]=t("div",{class:"settings__item mt-6"},[t("div",{class:"settings__item-heading text-error-lighten-1"},"アカウントを削除"),t("div",{class:"settings__item-label"},[i(" 現在ログインしている KonomiTV アカウントを削除します。"),t("br"),t("strong",{class:"text-error-lighten-1"},"アカウントに紐づくすべてのデータが削除されます。元に戻すことはできません。"),t("br")])],-1)),n(r,{class:"settings__save-button bg-error mt-5",variant:"flat",onClick:s[17]||(s[17]=l=>e.account_delete_confirm_dialog=!0)},{default:o(()=>[n(a,{icon:"fluent:delete-16-filled",class:"mr-2",height:"24px"}),s[52]||(s[52]=i("アカウントを削除 ",-1))]),_:1}),n(k,{"max-width":"385",modelValue:e.account_delete_confirm_dialog,"onUpdate:modelValue":s[20]||(s[20]=l=>e.account_delete_confirm_dialog=l)},{default:o(()=>[n(S,null,{default:o(()=>[n(V,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:o(()=>[...s[53]||(s[53]=[i("本当にアカウントを削除しますか？",-1)])]),_:1}),n(C,{class:"pt-2 pb-0"},{default:o(()=>[...s[54]||(s[54]=[i(" アカウントに紐づくすべてのユーザーデータが削除されます。元に戻すことはできません。",-1),t("br",null,null,-1),i(" 本当にアカウントを削除しますか？ ",-1)])]),_:1}),n(E,{class:"pt-4 px-6 pb-6"},{default:o(()=>[n(q),n(r,{color:"text",variant:"text",onClick:s[18]||(s[18]=l=>e.account_delete_confirm_dialog=!1)},{default:o(()=>[...s[55]||(s[55]=[i("キャンセル",-1)])]),_:1}),n(r,{color:"error",variant:"flat",onClick:s[19]||(s[19]=l=>e.deleteAccount())},{default:o(()=>[...s[56]||(s[56]=[i("削除",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):g("",!0)],2)]),_:1})}const $s=F(G,[["render",gs],["__scopeId","data-v-52bea2ef"]]);export{$s as default};
