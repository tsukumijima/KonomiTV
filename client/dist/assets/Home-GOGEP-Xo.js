import{F as R,d as S,X as z,a8 as ae,M as N,J as d,c as o,L as e,w as H,Z as E,H as b,N as D,O as c,a5 as Z,a1 as A,U as _,R as K,_ as Y,G as x,a9 as I,P as O,K as y,S as M,az as oe,r as de,ao as ne,a4 as te,$ as X,a2 as re,ab as ce,aA as ue,ac as pe,aB as ve,aC as me,aD as fe}from"./index-LUcZSfg3.js";import{V as _e,B as ge}from"./VPagination-DhZl_zip.js";import{V as Q}from"./VDialog-BBKQPlvn.js";import{V as W,a as ee,b as le,c as se}from"./VCard-BS7Vnm3K.js";import{V as ie}from"./VSpacer-ChgMJFbm.js";import{C as P}from"./ClipVideos-BxWXHHGm.js";import{V as he}from"./VTextarea-CtNdwhaN.js";import{b as we,c as T,d as L,a as Ve,V as ye}from"./VSelect-BmKGxRth.js";import{V as be}from"./VDivider-BSQIFqDW.js";import{H as xe,N as $e}from"./Navigation-BgRKLSNg.js";import{S as ke}from"./SPHeaderBar-f4zP5ny9.js";import"./VSelectionControl-B5SCUdJT.js";import"./VTextField-BDf-Yp3u.js";import"./VAvatar-DFvMdaEn.js";import"./lazy-BNtSIMgY.js";import"./BottomNavigation-DprrKkNz.js";const Ce={class:"px-5 pb-6"},Se={class:"text-subtitle-1 d-flex align-center font-weight-bold mt-2"},Be={class:"clip-video-info__item"},Me={class:"clip-video-info__item-value"},Ue={key:0,class:"clip-video-info__item"},De={class:"clip-video-info__item-value"},Ie={class:"clip-video-info__item"},Ne={class:"clip-video-info__item-value"},Te={class:"clip-video-info__item"},Le={class:"clip-video-info__item-value"},Pe={class:"clip-video-info__item"},ze={class:"clip-video-info__item-value"},He={class:"clip-video-info__item"},Oe={class:"clip-video-info__item-value"},Ae={class:"clip-video-info__item"},Ee={class:"clip-video-info__item-value"},Re={class:"text-subtitle-1 d-flex align-center font-weight-bold mt-4"},qe={class:"clip-video-info__item"},Fe={class:"clip-video-info__item-value"},Ke={class:"clip-video-info__item"},Ye={class:"clip-video-info__item-value"},je={class:"clip-video-info__item"},Je={class:"clip-video-info__item-value"},Ge={class:"text-subtitle-1 d-flex align-center font-weight-bold mt-4"},Xe={class:"clip-video-info__item"},Ze={class:"clip-video-info__item-value"},Qe={class:"clip-video-info__item"},We={class:"clip-video-info__item-value"},ei={class:"clip-video-info__item"},ii={class:"clip-video-info__item-value"},ti={class:"clip-video-info__item"},oi={class:"clip-video-info__item-value"},li={class:"clip-video-info__item"},si={class:"clip-video-info__item-value"},ai={class:"text-subtitle-1 d-flex align-center font-weight-bold mt-4"},di={class:"clip-video-info__item"},ni={class:"clip-video-info__item-value"},ri={class:"clip-video-info__item"},ci={class:"clip-video-info__item-value"},ui={class:"clip-video-info__item"},pi={class:"clip-video-info__item-value"},vi={class:"text-subtitle-1 d-flex align-center font-weight-bold mt-4"},mi={class:"clip-video-info__item"},fi={class:"clip-video-info__item-value"},_i={class:"clip-video-info__item"},gi={class:"clip-video-info__item-value"},hi={class:"clip-video-info__item"},wi={class:"clip-video-info__item-value"},Vi=R({__name:"ClipVideoInfoDialog",props:{clipVideo:{},show:{type:Boolean}},emits:["update:show"],setup(l){const $=l,r=v=>{const t=Math.max(0,Math.floor(v)),f=Math.floor(t/3600),n=Math.floor(t%3600/60),a=t%60;return f>0?`${f}:${n.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`:`${n}:${a.toString().padStart(2,"0")}`},V=S(()=>r($.clipVideo.start_time)),h=S(()=>r($.clipVideo.end_time)),p=S(()=>r($.clipVideo.duration)),m=S(()=>z.apply28HourClock(ae($.clipVideo.created_at).format("YYYY/MM/DD (dd) HH:mm:ss")));return(v,t)=>{const f=E("Icon");return _(),N(Q,{"max-width":"770",transition:"slide-y-transition","model-value":l.show,"onUpdate:modelValue":t[1]||(t[1]=n=>v.$emit("update:show",n))},{default:d(()=>[o(W,{class:"clip-video-info"},{default:d(()=>[o(ee,{class:"px-5 pt-6 pb-3 d-flex align-center font-weight-bold",style:{height:"60px"}},{default:d(()=>[o(f,{icon:"fluent:document-20-filled",height:"26px"}),t[2]||(t[2]=e("span",{class:"ml-3"},"クリップ動画情報",-1)),o(ie),H((_(),b("div",{class:"d-flex align-center rounded-circle cursor-pointer px-2 py-2",onClick:t[0]||(t[0]=n=>v.$emit("update:show",!1))},[o(f,{icon:"fluent:dismiss-12-filled",width:"23px",height:"23px"})])),[[K]])]),_:1}),e("div",Ce,[e("div",Se,[o(f,{icon:"fluent:video-clip-20-filled",width:"24px",height:"20px"}),t[3]||(t[3]=e("span",{class:"ml-2"},"クリップ情報",-1))]),e("div",Be,[t[4]||(t[4]=e("div",{class:"clip-video-info__item-label"},"タイトル",-1)),e("div",Me,c(l.clipVideo.title),1)]),l.clipVideo.alternate_title?(_(),b("div",Ue,[t[5]||(t[5]=e("div",{class:"clip-video-info__item-label"},"別タイトル",-1)),e("div",De,c(l.clipVideo.alternate_title),1)])):D("",!0),e("div",Ie,[t[6]||(t[6]=e("div",{class:"clip-video-info__item-label"},"元番組タイトル",-1)),e("div",Ne,c(l.clipVideo.recorded_program.title),1)]),e("div",Te,[t[7]||(t[7]=e("div",{class:"clip-video-info__item-label"},"元動画での開始位置",-1)),e("div",Le,c(V.value),1)]),e("div",Pe,[t[8]||(t[8]=e("div",{class:"clip-video-info__item-label"},"元動画での終了位置",-1)),e("div",ze,c(h.value),1)]),e("div",He,[t[9]||(t[9]=e("div",{class:"clip-video-info__item-label"},"クリップの長さ",-1)),e("div",Oe,c(p.value),1)]),e("div",Ae,[t[10]||(t[10]=e("div",{class:"clip-video-info__item-label"},"作成日時",-1)),e("div",Ee,c(m.value),1)]),e("div",Re,[o(f,{icon:"fluent:folder-20-filled",width:"22px",height:"20px"}),t[11]||(t[11]=e("span",{class:"ml-2"},"ファイル情報",-1))]),e("div",qe,[t[12]||(t[12]=e("div",{class:"clip-video-info__item-label"},"ファイルパス",-1)),e("div",Fe,c(l.clipVideo.file_path),1)]),e("div",Ke,[t[13]||(t[13]=e("div",{class:"clip-video-info__item-label"},"ファイルサイズ",-1)),e("div",Ye,c(Z(z).formatBytes(l.clipVideo.file_size)),1)]),e("div",je,[t[14]||(t[14]=e("div",{class:"clip-video-info__item-label"},"ファイルハッシュ",-1)),e("div",Je,c(l.clipVideo.file_hash),1)]),e("div",Ge,[o(f,{icon:"fluent:video-20-filled",width:"24px",height:"20px"}),t[15]||(t[15]=e("span",{class:"ml-2"},"映像情報",-1))]),e("div",Xe,[t[16]||(t[16]=e("div",{class:"clip-video-info__item-label"},"コンテナ形式",-1)),e("div",Ze,c(l.clipVideo.container_format),1)]),e("div",Qe,[t[17]||(t[17]=e("div",{class:"clip-video-info__item-label"},"コーデック",-1)),e("div",We,c(l.clipVideo.video_codec)+" ("+c(l.clipVideo.video_codec_profile)+")",1)]),e("div",ei,[t[18]||(t[18]=e("div",{class:"clip-video-info__item-label"},"解像度",-1)),e("div",ii,c(l.clipVideo.video_resolution_width)+"×"+c(l.clipVideo.video_resolution_height),1)]),e("div",ti,[t[19]||(t[19]=e("div",{class:"clip-video-info__item-label"},"フレームレート",-1)),e("div",oi,c(l.clipVideo.video_frame_rate)+" fps",1)]),e("div",li,[t[20]||(t[20]=e("div",{class:"clip-video-info__item-label"},"スキャン方式",-1)),e("div",si,c(l.clipVideo.video_scan_type),1)]),e("div",ai,[o(f,{icon:"fluent:speaker-2-20-filled",width:"24px",height:"20px"}),t[21]||(t[21]=e("span",{class:"ml-2"},"音声情報（主音声）",-1))]),e("div",di,[t[22]||(t[22]=e("div",{class:"clip-video-info__item-label"},"コーデック",-1)),e("div",ni,c(l.clipVideo.primary_audio_codec),1)]),e("div",ri,[t[23]||(t[23]=e("div",{class:"clip-video-info__item-label"},"チャンネル",-1)),e("div",ci,c(l.clipVideo.primary_audio_channel),1)]),e("div",ui,[t[24]||(t[24]=e("div",{class:"clip-video-info__item-label"},"サンプリングレート",-1)),e("div",pi,c(l.clipVideo.primary_audio_sampling_rate?`${l.clipVideo.primary_audio_sampling_rate/1e3}kHz`:"不明"),1)]),l.clipVideo.secondary_audio_codec?(_(),b(A,{key:1},[e("div",vi,[o(f,{icon:"fluent:speaker-2-20-filled",width:"24px",height:"20px"}),t[25]||(t[25]=e("span",{class:"ml-2"},"音声情報（副音声）",-1))]),e("div",mi,[t[26]||(t[26]=e("div",{class:"clip-video-info__item-label"},"コーデック",-1)),e("div",fi,c(l.clipVideo.secondary_audio_codec),1)]),e("div",_i,[t[27]||(t[27]=e("div",{class:"clip-video-info__item-label"},"チャンネル",-1)),e("div",gi,c(l.clipVideo.secondary_audio_channel),1)]),e("div",hi,[t[28]||(t[28]=e("div",{class:"clip-video-info__item-label"},"サンプリングレート",-1)),e("div",wi,c(l.clipVideo.secondary_audio_sampling_rate?`${l.clipVideo.secondary_audio_sampling_rate/1e3}kHz`:"不明"),1)])],64)):D("",!0)])]),_:1})]),_:1},8,["model-value"])}}}),yi=Y(Vi,[["__scopeId","data-v-99c27d32"]]),bi=R({__name:"ClipVideoAlternateTitleDialog",props:{clipVideo:{},show:{type:Boolean}},emits:["update:show","saved"],setup(l,{emit:$}){const r=l,V=$,h=x(""),p=x(!1),m=n=>(n??"").trim(),v=S(()=>m(h.value)!==m(r.clipVideo.alternate_title));I(()=>r.show,n=>{n&&(h.value=r.clipVideo.alternate_title??"")}),I(()=>r.clipVideo.alternate_title,n=>{r.show||(h.value=n??"")});const t=()=>{h.value=""},f=async()=>{if(p.value)return;if(!v.value){V("update:show",!1);return}const n=m(h.value),a=n===""?null:n;p.value=!0,V("update:show",!1);const w=await P.updateClipVideoAlternateTitle(r.clipVideo.id,a);p.value=!1,w!==null?(a===null?M.success("別タイトルを削除しました。"):M.success("別タイトルを更新しました。"),V("saved",w)):M.error("別タイトルの更新に失敗しました。")};return(n,a)=>{const w=E("Icon");return _(),N(Q,{"max-width":"520",transition:"slide-y-transition","model-value":l.show,"onUpdate:modelValue":a[2]||(a[2]=g=>V("update:show",g))},{default:d(()=>[o(W,null,{default:d(()=>[o(ee,{class:"px-5 pt-6 pb-3 d-flex align-center font-weight-bold"},{default:d(()=>[o(w,{icon:"fluent:edit-20-filled",width:"24px",height:"24px"}),a[3]||(a[3]=e("span",{class:"ml-3"},"別タイトルを編集",-1))]),_:1}),o(le,{class:"px-5 pt-2 pb-0"},{default:d(()=>[a[4]||(a[4]=e("div",{class:"text-body-2 text-text-darken-1"}," クリップ動画に表示する別タイトルを設定できます。空欄で保存すると別タイトルは解除されます。 ",-1)),o(he,{modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=g=>h.value=g),class:"mt-4",color:"primary",variant:"outlined","hide-details":"auto",rows:"2","auto-grow":"",disabled:p.value,placeholder:"例: 名シーンまとめ (後半)"},null,8,["modelValue","disabled"])]),_:1}),o(se,{class:"px-5 pt-4 pb-5"},{default:d(()=>[o(ie),o(O,{variant:"text",color:"text",disabled:p.value,onClick:t},{default:d(()=>[...a[5]||(a[5]=[y(" クリア ",-1)])]),_:1},8,["disabled"]),o(O,{variant:"text",color:"text",disabled:p.value,onClick:a[1]||(a[1]=g=>V("update:show",!1))},{default:d(()=>[...a[6]||(a[6]=[y(" キャンセル ",-1)])]),_:1},8,["disabled"]),o(O,{color:"primary",variant:"flat",loading:p.value,disabled:!v.value||p.value,onClick:f},{default:d(()=>[...a[7]||(a[7]=[y(" 保存 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),xi={class:"clip-video-item__container"},$i={class:"clip-video-item__thumbnail"},ki=["src"],Ci={class:"clip-video-item__thumbnail-duration"},Si={class:"clip-video-item__content"},Bi={class:"clip-video-item__content-title"},Mi={class:"clip-video-item__content-meta"},Ui={key:0,class:"clip-video-item__content-meta-broadcaster"},Di=["src"],Ii={class:"clip-video-item__content-meta-broadcaster-name"},Ni={key:1,class:"clip-video-item__content-meta-broadcaster"},Ti={class:"clip-video-item__content-meta-time"},Li={class:"clip-video-item__content-description"},Pi={class:"clip-video-item__menu"},zi={class:"delete-confirmation__title mb-4"},Hi=R({__name:"ClipVideoItem",props:{clipVideo:{}},emits:["deleted","updated"],setup(l,{emit:$}){const r=l,V=$,h=x(!1),p=x(!1),m=x(!1),v=x(r.clipVideo.alternate_title);I(()=>r.clipVideo.alternate_title,s=>{v.value=s??null});const t=oe(),f=S(()=>P.getClipVideoThumbnailURL(r.clipVideo.id)),n=S(()=>{const s=Math.floor(r.clipVideo.duration),i=Math.floor(s/3600),u=Math.floor(s%3600/60),k=s%60;return i>0?`${i}:${u.toString().padStart(2,"0")}:${k.toString().padStart(2,"0")}`:`${u}:${k.toString().padStart(2,"0")}`}),a=S(()=>{var i;const s=(i=v.value)==null?void 0:i.trim();return s&&s.length>0?s:r.clipVideo.title}),w=s=>{const i=new Date(s),k=new Date().getTime()-i.getTime(),B=Math.floor(k/(1e3*60*60*24));return B===0?"今日":B===1?"昨日":B<7?`${B}日前`:i.toLocaleDateString("ja-JP",{year:"numeric",month:"numeric",day:"numeric"})},g=()=>{window.location.href=`${z.api_base_url}/clip-videos/${r.clipVideo.id}/download`},U=S(()=>z.formatBytes(r.clipVideo.file_size)),j=async()=>{M.success("メタデータの再解析を開始します。完了までしばらくお待ちください。"),await P.reanalyzeClipVideo(r.clipVideo.id)===!0&&M.success("メタデータの再解析が完了しました。")},q=async s=>{M.success("サムネイルの再作成を開始しました。完了までしばらくお待ちください。"),await P.regenerateThumbnail(r.clipVideo.id,s)===!0&&M.success("サムネイルの再作成が完了しました。")},J=()=>{if(t.user===null||t.user.is_admin===!1){M.warning(`クリップ動画を削除するには管理者権限が必要です。
管理者アカウントでログインし直してください。`);return}p.value=!0},G=async()=>{p.value=!1,M.info("クリップ動画の削除を開始します。完了までしばらくお待ちください。"),await P.deleteClipVideo(r.clipVideo.id)?(M.success("クリップ動画を削除しました。"),V("deleted",r.clipVideo.id)):M.error("クリップ動画の削除に失敗しました。")},F=s=>{v.value=s.alternate_title??null,V("updated",s)};return(s,i)=>{const u=E("Icon"),k=E("router-link"),B=de("ftooltip");return _(),b(A,null,[H((_(),N(k,{class:"clip-video-item",to:`/clip-videos/watch/${l.clipVideo.id}`},{default:d(()=>[e("div",xi,[e("div",$i,[e("img",{class:"clip-video-item__thumbnail-image",loading:"lazy",decoding:"async",src:f.value},null,8,ki),e("div",Ci,c(n.value),1)]),e("div",Si,[e("div",Bi,c(a.value),1),e("div",Mi,[l.clipVideo.recorded_program.channel?(_(),b("div",Ui,[e("img",{class:"clip-video-item__content-meta-broadcaster-icon",loading:"lazy",decoding:"async",src:`${Z(z).api_base_url}/channels/${l.clipVideo.recorded_program.channel.id}/logo`},null,8,Di),e("span",Ii,"Ch: "+c(l.clipVideo.recorded_program.channel.channel_number)+" "+c(l.clipVideo.recorded_program.channel.name),1)])):(_(),b("div",Ni,[...i[10]||(i[10]=[e("span",{class:"clip-video-item__content-meta-broadcaster-name"},"チャンネル情報なし",-1)])])),e("div",Ti,c(w(l.clipVideo.created_at)),1)]),e("div",Li,c(l.clipVideo.recorded_program.description),1)]),e("div",Pi,[o(Ve,{location:"bottom end","close-on-content-click":!0},{activator:d(({props:C})=>[H((_(),b("div",ne({class:"clip-video-item__menu-button"},C,{onClick:i[0]||(i[0]=te(()=>{},["prevent","stop"])),onMousedown:i[1]||(i[1]=te(()=>{},["prevent","stop"]))}),[...i[11]||(i[11]=[e("svg",{width:"19px",height:"19px",viewBox:"0 0 16 16"},[e("path",{fill:"currentColor",d:"M9.5 13a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0"})],-1)])],16)),[[K]])]),default:d(()=>[o(we,{density:"compact","bg-color":"background-lighten-1",class:"clip-video-item__menu-list"},{default:d(()=>[o(T,{onClick:i[2]||(i[2]=C=>h.value=!0)},{prepend:d(()=>[...i[12]||(i[12]=[e("svg",{width:"20px",height:"20px",viewBox:"0 0 16 16"},[e("path",{fill:"currentColor",d:"M8.499 7.5a.5.5 0 1 0-1 0v3a.5.5 0 0 0 1 0zm.25-2a.749.749 0 1 1-1.499 0a.749.749 0 0 1 1.498 0M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1M2 8a6 6 0 1 1 12 0A6 6 0 0 1 2 8"})],-1)])]),default:d(()=>[o(L,{class:"ml-3"},{default:d(()=>[...i[13]||(i[13]=[y("クリップ動画情報を表示",-1)])]),_:1})]),_:1}),o(T,{onClick:i[3]||(i[3]=C=>m.value=!0)},{prepend:d(()=>[o(u,{icon:"fluent:rename-24-regular",width:"20px",height:"20px"})]),default:d(()=>[o(L,{class:"ml-3"},{default:d(()=>[...i[14]||(i[14]=[y("別タイトルを編集",-1)])]),_:1})]),_:1}),o(T,{onClick:g},{prepend:d(()=>[o(u,{icon:"fluent:arrow-download-24-regular",width:"20px",height:"20px"})]),default:d(()=>[o(L,{class:"ml-3"},{default:d(()=>[y("クリップ動画をダウンロード ("+c(U.value)+")",1)]),_:1})]),_:1}),o(T,{onClick:j},{prepend:d(()=>[o(u,{icon:"fluent:book-arrow-clockwise-20-regular",width:"20px",height:"20px"})]),default:d(()=>[o(L,{class:"ml-3"},{default:d(()=>[...i[15]||(i[15]=[y("メタデータを再解析",-1)])]),_:1})]),_:1}),H((_(),N(T,{onClick:i[4]||(i[4]=C=>q(!0))},{prepend:d(()=>[o(u,{icon:"fluent:image-arrow-counterclockwise-24-regular",width:"20px",height:"20px"})]),default:d(()=>[o(L,{class:"ml-3"},{default:d(()=>[...i[16]||(i[16]=[y("サムネイルを更新",-1)])]),_:1})]),_:1})),[[B,"既存のサムネイルタイルを再利用し代表サムネイルのみを更新します"]]),H((_(),N(T,{onClick:i[5]||(i[5]=C=>q(!1))},{prepend:d(()=>[o(u,{icon:"fluent:image-arrow-counterclockwise-24-regular",width:"20px",height:"20px"})]),default:d(()=>[o(L,{class:"ml-3"},{default:d(()=>[...i[17]||(i[17]=[y("サムネイルを再作成",-1)])]),_:1})]),_:1})),[[B,"サムネイルを完全に作り直します（数分かかります）"]]),o(be),o(T,{onClick:J,class:"clip-video-item__menu-list-item--danger"},{prepend:d(()=>[o(u,{icon:"fluent:delete-24-regular",width:"20px",height:"20px"})]),default:d(()=>[o(L,{class:"ml-3"},{default:d(()=>[...i[18]||(i[18]=[y("クリップ動画を削除",-1)])]),_:1})]),_:1})]),_:1})]),_:1})])])]),_:1},8,["to"])),[[K]]),o(yi,{clipVideo:l.clipVideo,show:h.value,"onUpdate:show":i[6]||(i[6]=C=>h.value=C)},null,8,["clipVideo","show"]),o(bi,{clipVideo:l.clipVideo,show:m.value,"onUpdate:show":i[7]||(i[7]=C=>m.value=C),onSaved:F},null,8,["clipVideo","show"]),o(Q,{"max-width":"750",modelValue:p.value,"onUpdate:modelValue":i[9]||(i[9]=C=>p.value=C)},{default:d(()=>[o(W,null,{default:d(()=>[o(ee,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:d(()=>[...i[19]||(i[19]=[y("本当にクリップ動画を削除しますか？",-1)])]),_:1}),o(le,{class:"pt-2 pb-0"},{default:d(()=>[e("div",zi,c(a.value),1),i[20]||(i[20]=e("div",{class:"text-error-lighten-1 font-weight-bold"},[y(" このクリップ動画に関連するすべてのデータが削除されます。"),e("br"),y(" 元に戻すことはできません。本当にクリップ動画を削除しますか？ ")],-1))]),_:1}),o(se,{class:"pt-4 px-6 pb-6"},{default:d(()=>[o(ie),o(O,{color:"text",variant:"text",onClick:i[8]||(i[8]=C=>p.value=!1)},{default:d(()=>[o(u,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),i[21]||(i[21]=e("span",{class:"ml-1"},"キャンセル",-1))]),_:1}),o(O,{class:"px-3",color:"error",variant:"flat",onClick:G},{default:d(()=>[o(u,{icon:"fluent:delete-20-regular",width:"18px",height:"18px"}),i[22]||(i[22]=e("span",{class:"ml-1"},"クリップ動画を削除",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),Oi=Y(Hi,[["__scopeId","data-v-3e381099"]]),Ai={key:0,class:"clip-video-list__header"},Ei={class:"clip-video-list__title"},Ri={class:"clip-video-list__title-text"},qi={key:1,class:"clip-video-list__title-count"},Fi={class:"clip-video-list__actions"},Ki={class:"clip-video-list__empty-content"},Yi={class:"clip-video-list__grid-content"},ji={key:1,class:"clip-video-list__pagination"},Ji=R({__name:"ClipVideoList",props:{title:{},clipVideos:{},total:{},page:{default:1},sortOrder:{default:"desc"},hideHeader:{type:Boolean,default:!1},hideSort:{type:Boolean,default:!1},hidePagination:{type:Boolean,default:!1},showMoreButton:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},isLoading:{type:Boolean,default:!1}},emits:["update:page","update:sortOrder","more","delete","clipVideoUpdated"],setup(l,{emit:$}){const r=l,V=$,h=x(r.page),p=x(r.sortOrder),m=x([...r.clipVideos]),v=x(r.total);I(()=>r.page,n=>{h.value=n}),I(()=>r.sortOrder,n=>{p.value=n}),I(()=>r.clipVideos,n=>{m.value=[...n]}),I(()=>r.total,n=>{v.value=n});const t=n=>{m.value=m.value.filter(a=>a.id!==n),v.value--},f=n=>{m.value=m.value.map(a=>a.id===n.id?n:a),V("clipVideoUpdated",n)};return(n,a)=>{const w=E("Icon");return _(),b("div",{class:X(["clip-video-list",{"clip-video-list--show-sort":!l.hideSort}])},[l.hideHeader?D("",!0):(_(),b("div",Ai,[e("h2",Ei,[l.showBackButton?H((_(),b("div",{key:0,class:"clip-video-list__title-back",onClick:a[0]||(a[0]=g=>n.$router.back())},[o(w,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[K]]):D("",!0),e("span",Ri,c(l.title),1),l.showMoreButton?D("",!0):(_(),b("div",qi,[l.isLoading?(_(),b(A,{key:0},[o(w,{icon:"line-md:loading-twotone-loop",class:"mr-1 spin",width:"20px",height:"20px"}),a[6]||(a[6]=e("span",null,"読み込み中...",-1))],64)):(_(),b(A,{key:1},[y(c(v.value)+"件",1)],64))]))]),e("div",Fi,[l.hideSort?D("",!0):(_(),N(ye,{key:0,modelValue:p.value,"onUpdate:modelValue":[a[1]||(a[1]=g=>p.value=g),a[2]||(a[2]=g=>n.$emit("update:sortOrder",g))],items:[{title:"新しい順",value:"desc"},{title:"古い順",value:"asc"}],"item-title":"title","item-value":"value",class:"clip-video-list__sort",color:"primary","bg-color":"background-lighten-1",variant:"solo",density:"comfortable","hide-details":""},null,8,["modelValue"])),l.showMoreButton?(_(),N(O,{key:1,variant:"text",class:"clip-video-list__more",onClick:a[3]||(a[3]=g=>n.$emit("more"))},{default:d(()=>[a[7]||(a[7]=e("span",{class:"text-primary"},"もっと見る",-1)),o(w,{icon:"fluent:chevron-right-12-regular",width:"18px",class:"ml-1 text-text-darken-1",style:{margin:"0px -4px"}})]),_:1})):D("",!0)])])),e("div",{class:X(["clip-video-list__grid",{"clip-video-list__grid--loading":l.isLoading,"clip-video-list__grid--empty":v.value===0&&l.showEmptyMessage}])},[e("div",{class:X(["clip-video-list__empty",{"clip-video-list__empty--show":v.value===0&&l.showEmptyMessage&&!l.isLoading}])},[e("div",Ki,[o(w,{class:"clip-video-list__empty-icon",icon:"fluent:video-clip-20-regular",width:"54px",height:"54px"}),a[8]||(a[8]=e("h2",null,"クリップ動画がありません",-1)),a[9]||(a[9]=e("div",{class:"clip-video-list__empty-submessage"},[y("録画番組からクリップを作成すると、"),e("br",{class:"d-sm-none"}),y("ここに表示されます。")],-1))])],2),e("div",Yi,[(_(!0),b(A,null,re(m.value,g=>(_(),N(Oi,{key:g.id,clipVideo:g,onDeleted:t,onUpdated:f},null,8,["clipVideo"]))),128))])],2),!l.hidePagination&&v.value>0?(_(),b("div",ji,[o(_e,{modelValue:h.value,"onUpdate:modelValue":[a[4]||(a[4]=g=>h.value=g),a[5]||(a[5]=g=>n.$emit("update:page",g))],"active-color":"primary",density:"comfortable",length:Math.ceil(v.value/30),"total-visible":Z(z).isSmartphoneVertical()?5:7},null,8,["modelValue","length","total-visible"])])):D("",!0)],2)}}}),Gi=Y(Ji,[["__scopeId","data-v-52aef915"]]),Xi={class:"route-container"},Zi={class:"clip-videos-container-wrapper"},Qi={class:"clip-videos-container"},Wi=R({__name:"Home",setup(l){const $=ue(),r=ve(),V=x([]),h=x(0),p=x(!0),m=x(1),v=x("desc"),t=x(""),f=S(()=>t.value.trim()),n=S(()=>f.value!==""?z.isSmartphoneVertical()?"検索結果":`「${f.value}」の検索結果`:"クリップ動画"),a=S(()=>{const s=[{name:"ホーム",path:"/"},{name:"ビデオをみる",path:"/videos/"}];if(f.value!==""){s.push({name:"クリップ動画",path:"/clip-videos/"});const i=new URLSearchParams({keyword:f.value,order:v.value,page:m.value.toString()});return s.push({name:"検索結果",path:`/clip-videos/?${i.toString()}`,disabled:!0}),s}return s.push({name:"クリップ動画",path:"/clip-videos/",disabled:!0}),s}),w=s=>{if(Array.isArray(s))return s[0];if(typeof s=="string")return s},g=async s=>{try{return await r.replace({query:s}),!0}catch(i){if(me(i,fe.duplicated))return!1;throw i}},U=async()=>{const s=await P.fetchClipVideos(v.value,m.value,f.value);s&&(V.value=s.clip_videos,h.value=s.total),p.value=!1},j=async s=>{m.value=s,p.value=!0;const i=f.value,u={order:v.value,page:s.toString()};i!==""&&(u.keyword=i),await g(u)||await U()},q=async s=>{v.value=s,m.value=1,p.value=!0;const i=f.value,u={order:s,page:"1"};i!==""&&(u.keyword=i),await g(u)||await U()},J=async s=>{await P.deleteClipVideo(s)&&(p.value=!0,await U())},G=s=>{V.value=V.value.map(i=>i.id===s.id?s:i)},F=async s=>{const i=s.detail,u=typeof i=="string"?i.trim():"";t.value=u,m.value=1,p.value=!0,await U()};return I(()=>$.query,async s=>{const i=w(s.page),u=i?Number.parseInt(i,10):NaN;m.value=Number.isNaN(u)||u<1?1:u;const k=w(s.order);v.value=k==="asc"?"asc":"desc";const B=w(s.keyword);t.value=(B??"").trim(),p.value=!0,await U()},{deep:!0}),ce(async()=>{await oe().fetchUser(),window.addEventListener("clip-videos-search",F);const i=w($.query.page),u=i?Number.parseInt(i,10):NaN;m.value=Number.isNaN(u)||u<1?1:u;const k=w($.query.order);v.value=k==="asc"?"asc":"desc";const B=w($.query.keyword);t.value=(B??"").trim(),await U()}),pe(()=>{window.removeEventListener("clip-videos-search",F)}),(s,i)=>(_(),b("div",Xi,[o(xe),e("main",null,[o($e),e("div",Zi,[o(ke),e("div",Qi,[o(ge,{crumbs:a.value},null,8,["crumbs"]),o(Gi,{title:n.value,clipVideos:V.value,total:h.value,page:m.value,sortOrder:v.value,isLoading:p.value,showBackButton:!0,showEmptyMessage:!p.value,"onUpdate:page":j,"onUpdate:sortOrder":i[0]||(i[0]=u=>q(u)),onDelete:J,onClipVideoUpdated:G},null,8,["title","clipVideos","total","page","sortOrder","isLoading","showEmptyMessage"])])])])]))}}),_t=Y(Wi,[["__scopeId","data-v-c5fecd09"]]);export{_t as default};
