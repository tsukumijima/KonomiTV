import{H as pa,N as ya,S as _a}from"./SPHeaderBar-DpFwrbXz.js";import{u as ba,R as ka,a as Ue,I as Ct}from"./ReservationDetailDrawer-UFeg2i_Y.js";import{T as ye,a as Sa}from"./TimeTableSettings-CdixVCgA.js";import{d as Ie,G as c,U as ge,w as ct,j as Wt,k as he,r as Je,f as me,h as J,b as $,B as qe,t as we,o as Y,_ as Re,ae as Ta,u as Ne,q as k,af as Ye,N as G,s as _e,ag as Da,x as Ze,z as vt,c as Q,e as ve,P as $e,n as Qe,a as r,p as Pt,V as Z,a2 as Ce,F as pe,g as Be,ac as wa,ah as Ht,D as xe,E as ke,O as He,X as Xe,ai as mt,aj as et,ak as xa,al as We,T as Pe,am as Ke,an as Ca,l as dt,Y as Ee,ao as Lt,ap as zt,Q as fe,aq as Ut,ar as Pa,as as Ha,at as Ft,au as Ma,av as Va,aw as Ba,ax as Ia,ay as Ra,az as Oa,aA as Aa,I as $a,aB as Ya,aC as Ea,aD as Na,aE as Wa,aF as La,J as za,aG as Ua,aH as Fa,aI as Ga,M as ut}from"./index-ZI53XMVv.js";import{u as ja,P as qa}from"./ChannelsStore-yoBZurJ3.js";import{c as Fe,d as Mt}from"./VSelect-O1kj1Ef6.js";import{V as Xa,c as Ka}from"./ssrBoot-FWSJwAbr.js";import{M as Gt}from"./VAvatar-CX1Ts1OR.js";import{b as Qa}from"./VTextField-CNzzuNfB.js";import"./VSwitch-BdPpREkS.js";import"./VChip-BluoVvOY.js";import"./VSlider-DG6coOD7.js";import"./VDialog-CYooIfSq.js";import"./VCard-CX79yYMk.js";const Ja={class:"timetable-channel-header__logo-wrapper"},Za=["src","alt"],el={class:"timetable-channel-header__info"},tl={class:"timetable-channel-header__number"},al={class:"timetable-channel-header__name"},ll=Ie({__name:"TimeTableChannelHeader",props:{channel:{},width:{},height:{},resizeTrigger:{}},setup(e){const a=e,v=c(()=>Math.round(Math.min(46,Math.max(32,a.width*.27)))),s=c(()=>Math.round(v.value*(3/4))),t=c(()=>Math.min(14,Math.max(13,a.width*.06))),m=c(()=>(a.resizeTrigger,Math.min(13.5,Math.max(ge.isSmartphoneVertical()?10:12,a.width*.08)))),u=c(()=>`${a.channel.name} を視聴`);return(n,i)=>{const o=Je("router-link"),f=Wt("ftooltip");return ct((Y(),he(o,{class:"timetable-channel-header",to:`/tv/watch/${e.channel.display_channel_id}`,style:me({width:`${e.width}px`,height:`${e.height}px`,"--timetable-channel-logo-width":`${v.value}px`,"--timetable-channel-logo-height":`${s.value}px`,"--timetable-channel-number-size":`${t.value}px`,"--timetable-channel-name-size":`${m.value}px`})},{default:J(()=>[$("div",Ja,[$("img",{class:"timetable-channel-header__logo",loading:"lazy",decoding:"async",src:`${qe(ge).api_base_url}/channels/${e.channel.id}/logo`,alt:e.channel.name},null,8,Za)]),$("div",el,[$("span",tl,we(e.channel.channel_number),1),$("span",al,we(e.channel.name),1)])]),_:1},8,["to","style"])),[[f,u.value,void 0,{bottom:!0}]])}}}),nl=Re(ll,[["__scopeId","data-v-b4f70efc"]]),jt=["ピン留め","地デジ","BS","CS","CATV","SKY","BS4K"],il=new Map([["地デジ","GR"],["BS","BS"],["CS","CS"],["CATV","CATV"],["SKY","SKY"],["BS4K","BS4K"]]),Le=Ta("timetable",()=>{const e=Ne(),a=ja(),v=k(null),s=k(T()),t=Ye([]),m=k(null),u=k(!1),n=k(!1),i=k(!1),o=k(0),f=k(null);function g(){const y=G(),I=T();if(s.value.isSame(I,"day")===!1)return!1;let d=y.hour();return d<4&&(d+=24),d>=17}function P(){const y=G(),I=T();if(s.value.isSame(I,"day")===!1)return null;const d=y.startOf("hour").subtract(1,"hour"),A=X();return d.isBefore(A)?A:d}function X(){return i.value?s.value.add(12,"hour"):s.value}function S(y){return y.subtract(1,"millisecond").subtract(4,"hour").startOf("day").add(4,"hour")}function T(){const y=G();let I=y.hour(4).minute(0).second(0).millisecond(0);return y.hour()<4&&(I=I.subtract(1,"day")),I}function x(y,I=!1){return I?y.add(36,"hour"):y.add(1,"day")}const H=c(()=>i.value?s.value.add(12,"hour"):s.value),p=c(()=>{const y=new Set;if(a.is_channels_list_initial_updated===!1)return y;for(const I of a.channels_list_with_pinned.keys()){if(I==="ピン留め"){const d=a.channels_list_with_pinned.get("ピン留め");if(d===void 0||d.length===0)continue}y.add(I)}return y});function U(){return v.value===null?j():p.value.has(v.value)?null:j()}function j(){if(p.value.has("ピン留め"))return"ピン留め";if(p.value.has("地デジ"))return"地デジ";for(const y of jt)if(p.value.has(y))return y;return"地デジ"}async function q(y,I,d,A){i.value=g(),f.value=P();const R=y??X(),K=I??x(R,i.value),ce=d??v.value??"地デジ",ie=ce==="ピン留め"?A??e.settings.pinned_channel_ids:void 0,se=il.get(ce),de=await qa.fetchTimeTable(R,K,se,ie);return de===null?!1:(t.value=de.channels,m.value={earliest:G(de.date_range.earliest),latest:G(de.date_range.latest)},!0)}async function ee(){u.value=!0,n.value=!1;try{if(await a.update(),s.value=T(),v.value=j(),await q()===!1){u.value=!1;return}n.value=!0}finally{u.value=!1}}async function W(y){u.value=!0;try{s.value=y,await q()}finally{u.value=!1}}async function te(y){u.value=!0;try{v.value=y,await q()}finally{u.value=!1}}function _(){let I=G().hour();return I<4&&(I+=24),I>=17}async function V(){if(m.value===null)return;const y=T(),I=_();let d;if(i.value)d=s.value.subtract(1,"day");else if(I){const R=s.value.subtract(1,"day");R.isSame(y.add(1,"day"),"day")?d=y:d=R}else d=s.value.subtract(1,"day");const A=S(m.value.earliest);d.isBefore(A,"day")||await W(d)}async function E(){if(m.value===null)return;let y;i.value?y=s.value.add(2,"day"):y=s.value.add(1,"day");const I=S(m.value.latest);y.isAfter(I,"day")||await W(y)}async function oe(){const y=T();s.value.isSame(y,"day")===!1&&await W(y)}function ae(y){o.value=y}const le=c(()=>{if(m.value===null)return!1;const y=T(),I=_();let d;if(i.value)d=s.value.subtract(1,"day");else if(I){const R=s.value.subtract(1,"day");R.isSame(y.add(1,"day"),"day")?d=y:d=R}else d=s.value.subtract(1,"day");const A=S(m.value.earliest);return d.isSameOrAfter(A,"day")}),ne=c(()=>{if(m.value===null)return!1;let y;i.value?y=s.value.add(2,"day"):y=s.value.add(1,"day");const I=S(m.value.latest);return y.isSameOrBefore(I,"day")});function L(){t.value=[],m.value=null,u.value=!1,n.value=!1,i.value=!1,o.value=0,f.value=null,v.value=null}return _e(()=>e.settings.pinned_channel_ids,async(y,I)=>{v.value==="ピン留め"&&n.value!==!1&&Da(y,I)===!1&&await q()},{deep:!0}),_e(()=>a.channels_list_with_pinned,async()=>{if(n.value===!1)return;const y=U();y!==null&&await te(y)},{deep:!0}),{selected_channel_type:v,selected_date:s,channels_data:t,date_range:m,is_loading:u,is_initial_load_completed:n,is_36hour_display:i,date_display_offset:o,scroll_top_limit_time:f,available_channel_types:p,display_start_time:H,can_go_previous_day:le,can_go_next_day:ne,getBroadcastDate:S,getTodayStartTime:T,getDayEndTime:x,getDisplayStartTime:X,setDateDisplayOffset:ae,fetchTimeTableData:q,initialLoad:ee,changeDate:W,changeChannelType:te,goToPreviousDay:V,goToNextDay:E,goToCurrentTime:oe,reset:L}}),sl=Ie({__name:"TimeTableCurrentTimeLine",props:{hourHeight:{},totalWidth:{},channelHeaderHeight:{}},setup(e){const a=e,v=Le(),s=k(G());let t=null,m=null;const u=c(()=>{const i=s.value,o=v.getDisplayStartTime(),f=v.getDayEndTime(o,v.is_36hour_display);return i.isSameOrAfter(o)&&i.isBefore(f)}),n=c(()=>{if(!u.value)return 0;const i=v.getDisplayStartTime();return ye.calculateCurrentTimeY(s.value,i,a.hourHeight,a.channelHeaderHeight)-a.channelHeaderHeight});return Ze(()=>{const i=G(),o=i.add(1,"minute").startOf("minute"),f=Math.max(0,o.valueOf()-i.valueOf());m=setTimeout(()=>{s.value=G(),t=setInterval(()=>{s.value=G()},60*1e3)},f)}),vt(()=>{m!==null&&clearTimeout(m),t!==null&&clearInterval(t)}),(i,o)=>u.value?(Y(),Q("div",{key:0,class:"timetable-current-time-line",style:me({top:`${n.value}px`,width:`${e.totalWidth}px`})},[...o[0]||(o[0]=[$("div",{class:"timetable-current-time-line__indicator"},null,-1),$("div",{class:"timetable-current-time-line__line"},null,-1)])],4)):ve("",!0)}}),ol=Re(sl,[["__scopeId","data-v-8d4f4a9f"]]),rl={class:"timetable-program-cell__content"},ul={class:"timetable-program-cell__header"},cl={class:"timetable-program-cell__start-minute"},dl={key:0,class:"timetable-program-cell__reservation-icon"},vl={key:0,class:"timetable-program-cell__recording-icon"},ml=["innerHTML"],fl=["innerHTML"],hl={key:0,class:"timetable-program-cell__actions"},gl="fluent:timer-16-filled",pl="mdi:timer-pause-outline",yl=Ie({__name:"TimeTableProgramCell",props:{program:{},channel:{},hourHeight:{},channelWidth:{},fullChannelWidth:{},viewportHeight:{},channelHeaderHeight:{},isScrollAtBottom:{type:Boolean},isSubchannel:{type:Boolean},isSplit:{type:Boolean},isSelected:{type:Boolean},isPast:{type:Boolean},is36HourDisplay:{type:Boolean},isNextReserved:{type:Boolean},resizeTrigger:{}},emits:["click","show-detail","quick-reserve"],setup(e,{emit:a}){const v=new Map;function s(d,A){const R=d.title,K=d.description;if(R===null||K===null)return $e.decorateProgramInfo(d,A);const ce=v.get(d.id);if(ce===void 0||ce.raw_title!==R||ce.raw_description!==K){const se=$e.decorateProgramInfo(d,"title"),de=$e.decorateProgramInfo(d,"description");v.set(d.id,{raw_title:R,raw_description:K,title:se,description:de})}const ie=v.get(d.id);return ie===void 0?$e.decorateProgramInfo(d,A):A==="title"?ie.title:ie.description}const t=e,m=a,u=Ne(),n=Le(),i=k(!1),o=k(null),f=k(0),g=c(()=>(t.resizeTrigger,ge.isTouchDevice()?t.isSelected:t.isSelected||u.settings.timetable_hover_expand&&i.value)),P=c(()=>t.program.reservation!==null),X=c(()=>{var d;return((d=t.program.reservation)==null?void 0:d.status)==="Recording"}),S=c(()=>{var d;return((d=t.program.reservation)==null?void 0:d.status)==="Disabled"}),T=c(()=>{var d;return((d=t.program.reservation)==null?void 0:d.recording_availability)==="Partial"}),x=c(()=>{var d;return((d=t.program.reservation)==null?void 0:d.recording_availability)==="Unavailable"}),H=c(()=>u.settings.timetable_dim_shopping_programs===!1?!1:$e.isShoppingProgram(t.program)),p=c(()=>x.value?"rgb(var(--v-theme-error))":T.value?"rgb(var(--v-theme-warning))":S.value?"rgb(var(--v-theme-text-darken-2))":"rgb(var(--v-theme-secondary))"),U=c(()=>S.value?pl:gl),j=c(()=>P.value?S.value?"mdi:timer-play-outline":"mdi:timer-pause-outline":"mdi:timer-plus-outline"),q=c(()=>{if(t.resizeTrigger,!P.value)return"録画予約";const d=u.settings.timetable_channel_width==="Narrow",A=u.settings.timetable_channel_width!=="Wide",R=ge.isSmartphoneVertical()&&A||(ge.isSmartphoneHorizontal()||ge.isTabletVertical())&&d;return S.value?R?"有効化":"予約を有効化":R?"無効化":"予約を無効化"}),ee=c(()=>G(t.program.start_time).minute().toString().padStart(2,"0")),W=c(()=>{var R,K;const d=(K=(R=t.program.genres)==null?void 0:R[0])==null?void 0:K.major;return ye.getGenreColors(d,u.settings.timetable_genre_colors).highlight}),te=c(()=>{var R,K;if(x.value)return"#f8d7da";if(T.value)return"#fff3cd";const d=(K=(R=t.program.genres)==null?void 0:R[0])==null?void 0:K.major;return ye.getGenreColors(d,u.settings.timetable_genre_colors).background}),_=c(()=>{const d=G(t.program.start_time),A=n.getDisplayStartTime();return ye.calculateProgramY(d,A,t.hourHeight,t.channelHeaderHeight)-t.channelHeaderHeight}),V=c(()=>(t.is36HourDisplay?36:24)*t.hourHeight),E=c(()=>{const d=ye.calculateProgramHeight(t.program.duration,t.hourHeight);return _.value+d>V.value?Math.max(0,V.value-_.value):Math.max(d,20)}),oe=c(()=>{const d=t.fullChannelWidth??t.channelWidth,A=t.isSplit===!0&&t.channelWidth<d,R=g.value&&f.value>0?f.value:E.value,K=t.isSubchannel&&A?t.channelWidth:0,ce=g.value&&A?0:K,ie=g.value&&A?d:t.channelWidth,se={top:`${_.value}px`,left:`${ce}px`,width:`${ie}px`,minHeight:`${E.value}px`,"--timetable-cell-height":`${R}px`,"--timetable-program-base-background":te.value,"--timetable-program-base-highlight":W.value};if(g.value||(se.height=`${E.value}px`),g.value&&t.viewportHeight>0&&t.isScrollAtBottom===!0){const de=f.value>0?f.value:E.value,Se=Math.max(0,V.value-t.viewportHeight),Te=Se+t.viewportHeight,D=_.value+de,b=_.value+E.value>=V.value-1;if(D>Te&&b){const C=D-Te,z=Math.max(0,_.value-Se),O=Math.min(C,z);O>0&&(se.transform=`translateY(-${O}px)`)}}return se}),ae=c(()=>s(t.program,"title")),le=c(()=>s(t.program,"description"));function ne(){m("click")}function L(){i.value=!0}function y(){i.value=!1}function I(){m("quick-reserve")}return _e(g,async d=>{if(d===!1){f.value=0;return}await Ce(),o.value!==null&&(f.value=Math.max(o.value.getBoundingClientRect().height,E.value))}),(d,A)=>{const R=Je("Icon");return Y(),Q("div",{class:Qe(["timetable-program-cell",{"timetable-program-cell--selected":e.isSelected,"timetable-program-cell--expanded":g.value,"timetable-program-cell--past":e.isPast,"timetable-program-cell--subchannel":e.isSubchannel,"timetable-program-cell--reserved":P.value,"timetable-program-cell--recording":X.value,"timetable-program-cell--partial":T.value,"timetable-program-cell--unavailable":x.value,"timetable-program-cell--disabled":S.value,"timetable-program-cell--shopping":H.value,"timetable-program-cell--next-reserved":P.value&&e.isNextReserved}]),ref_key:"cellRef",ref:o,style:me(oe.value),onClick:ne,onMouseenter:L,onMouseleave:y},[A[2]||(A[2]=$("div",{class:"timetable-program-cell__highlight"},null,-1)),$("div",rl,[$("div",ul,[$("span",cl,we(ee.value),1),P.value?(Y(),Q("div",dl,[r(R,{icon:U.value,width:"14px",style:me({color:p.value})},null,8,["icon","style"]),X.value?(Y(),Q("div",vl)):ve("",!0),T.value?(Y(),he(R,{key:1,icon:"fluent:warning-16-filled",width:"12px",class:"timetable-program-cell__warning-icon"})):ve("",!0),x.value?(Y(),he(R,{key:2,icon:"fluent:dismiss-circle-16-filled",width:"12px",class:"timetable-program-cell__error-icon"})):ve("",!0)])):ve("",!0)]),$("div",{class:"timetable-program-cell__title",innerHTML:ae.value},null,8,ml),$("div",{class:"timetable-program-cell__description",innerHTML:le.value},null,8,fl),g.value?(Y(),Q("div",hl,[r(Z,{variant:"flat",size:"small",class:"timetable-program-cell__action-button",onClick:A[0]||(A[0]=Pt(K=>d.$emit("show-detail"),["stop"]))},{default:J(()=>[r(R,{icon:"fluent:info-12-regular",width:"16px"}),A[1]||(A[1]=$("span",null,"番組詳細",-1))]),_:1}),e.isPast?ve("",!0):(Y(),he(Z,{key:0,variant:"flat",size:"small",class:Qe(["timetable-program-cell__action-button",{"timetable-program-cell__action-button--reserved":P.value&&!S.value,"timetable-program-cell__action-button--disabled-reservation":S.value}]),onClick:Pt(I,["stop"])},{default:J(()=>[r(R,{icon:j.value,width:"16px"},null,8,["icon"]),$("span",null,we(q.value),1)]),_:1},8,["class"]))])):ve("",!0)])],38)}}}),Vt=Re(yl,[["__scopeId","data-v-8603e6bf"]]),_l={class:"timetable-time-scale"},bl=["data-hour"],kl={class:"timetable-time-scale__label"},Sl={key:0,class:"timetable-time-scale__date"},Tl={class:"timetable-time-scale__hour-number"},Dl=Ie({__name:"TimeTableTimeScale",props:{hourHeight:{},is36HourDisplay:{type:Boolean}},setup(e){const a=e,v=Ne(),s=Le(),t=c(()=>{const i=a.is36HourDisplay?36:24,o=s.display_start_time,f=[];for(let g=0;g<i;g++)f.push(o.add(g,"hour"));return f});function m(i){const o=i.hour();return v.settings.use_28hour_clock&&o>=0&&o<=3?(o+24).toString().padStart(2,"0"):o.toString().padStart(2,"0")}function u(i){const o=i.hour(),f=s.display_start_time;return!([0,4,8,12,16,20].includes(o)===!1||a.is36HourDisplay&&o===4&&f.hour()===4)}function n(i){return`${i.month()+1}/${i.date()}`}return(i,o)=>(Y(),Q("div",_l,[(Y(!0),Q(pe,null,Be(t.value,f=>(Y(),Q("div",{class:"timetable-time-scale__hour",key:f.valueOf(),style:me({height:`${a.hourHeight}px`}),"data-hour":f.hour()},[$("div",kl,[u(f)?(Y(),Q("span",Sl,we(n(f)),1)):ve("",!0),$("span",Tl,we(m(f)),1),o[0]||(o[0]=$("span",{class:"timetable-time-scale__hour-label"},"時",-1))])],12,bl))),128))]))}}),wl=Re(Dl,[["__scopeId","data-v-fe795608"]]),xl={class:"timetable-grid__channel-headers"},Cl={class:"timetable-grid__content"},Pl=2,Hl=3,Ml=.5,Vl=60,Bl=2,Il=100,Rl=120,Bt=.95,Ge=.5,je=5,Ol=Ie({__name:"TimeTableGrid",props:{channels:{},is36HourDisplay:{type:Boolean},canGoPreviousDay:{type:Boolean},canGoNextDay:{type:Boolean}},emits:["time-slot-change","date-display-offset-change","show-program-detail","quick-reserve","go-to-next-day","go-to-previous-day"],setup(e,{expose:a,emit:v}){const s=e,t=v,m=Ne(),u=Le(),n=k(null),i=k(null),o=k(!1),f=k(!1);let g=0;const P=k(0),X=k(!1),S=k(0),T=k(0),x=k(0),H=k(0),p=k(null);let U=null,j=null;const q=k(0),ee=new Set;let W=null,te=null,_=null;const V=k(0);let E=null;function oe(){E!==null&&clearTimeout(E),E=window.setTimeout(()=>{V.value++,E=null},Il)}const ae=k(!1),le=k(!1),ne=k(!1),L=k(null),y=k(0),I=k(0),d=k(0),A=k(0),R=k(!1),K=k(!1),ce=k(0),ie=k(0),se=k(0),de=k(0),Se=k(0),Te=k(0),D=k(null),b=c(()=>(V.value,ye.getDeviceType())),C=c(()=>ye.getChannelWidth(m.settings.timetable_channel_width,b.value)),z=c(()=>ye.getHourHeight(m.settings.timetable_hour_height,b.value)),O=c(()=>b.value==="Smartphone"?Hl:Pl),re=c(()=>ye.getChannelHeaderHeight(C.value)),De=c(()=>(V.value,ye.getTimeScaleWidth(b.value,ge.isSmartphoneVertical()))),tt=c(()=>s.channels.length*C.value),Me=c(()=>(s.is36HourDisplay?36:24)*z.value);function ea(l){return l.subchannels===null||l.subchannels.length===0?!1:l.subchannels.some(h=>h.programs.length>0)}const at=new Map,Oe=new Map;function lt(l){if(l==null)return{start:0,end:0};const h=at.get(l.id);if(h!==void 0)return h;const M={start:G(l.start_time).valueOf(),end:G(l.end_time).valueOf()};return at.set(l.id,M),M}function ft(l,h){const M=lt(l);return h.some(w=>{const F=lt(w);return F.start<M.end&&F.end>M.start})}function nt(l,h,M){const w=`${h.id}:${M?"sub":"main"}`,F=Oe.get(w);if(F!==void 0)return F;const B=pt(l);if(B.length===0)return Oe.set(w,!1),!1;if(M){const ue=ft(h,l.programs);return Oe.set(w,ue),ue}const N=ft(h,B);return Oe.set(w,N),N}function ht(l,h,M){return nt(l,h,M)?C.value/2:C.value}function Ve(l){const h=z.value*O.value;S.value=Math.max(0,l-h),T.value=l+P.value+h}function ta(l){const M=z.value*O.value*Ml,w=l+P.value;return P.value<=0||T.value===0||l<S.value+M||w>T.value-M?(Ve(l),!0):!1}function gt(l){const h=lt(l),M=(h.start-q.value)/(1e3*60*60)*z.value;return(h.end-q.value)/(1e3*60*60)*z.value>=S.value&&M<=T.value}function aa(l){return l.subchannels===null?[]:l.subchannels}function pt(l){return l.subchannels===null?[]:l.subchannels.flatMap(h=>h.programs)}function yt(l){return G(l.end_time).isBefore(G())}function _t(l,h,M){const w=M?pt(l):l.programs,F=G(h.end_time).valueOf(),B=w.find(N=>G(N.start_time).valueOf()===F);return B!==void 0&&B.reservation!==null}function bt(){if(n.value===null)return;x.value;const l=H.value;g=l;const h=n.value.clientHeight-re.value;P.value!==h&&(P.value=h);const M=n.value.scrollHeight-n.value.clientHeight,w=l>=M-1;X.value!==w&&(X.value=w),ta(l)&&Ae();const B=l>M-100&&s.canGoNextDay,N=l<100&&s.canGoPreviousDay;o.value!==B&&(o.value=B),f.value!==N&&(f.value=N);const ue=u.getDisplayStartTime(),be=Math.floor(l/z.value);let st=ue.add(be,"hour").hour();st<4&&(st+=24);const fa=Math.floor((st-4)/4)*4+4,ot=Math.max(4,Math.min(24,fa));if(U!==ot&&(t("time-slot-change",ot),U=ot),s.is36HourDisplay){const ha=m.settings.use_28hour_clock?4:0;let ze=ue.hour(ha).minute(0).second(0).millisecond(0);ze.isSameOrBefore(ue)&&(ze=ze.add(1,"day"));const ga=(ze.valueOf()-ue.valueOf())/(1e3*60*60)*z.value,rt=l>=ga?1:0;j!==rt&&(t("date-display-offset-change",rt),j=rt)}else j!==0&&(t("date-display-offset-change",0),j=0);kt()}function la(){p.value===null&&(p.value=requestAnimationFrame(()=>{p.value=null,bt()}))}function Ae(){_===null&&(_=requestAnimationFrame(()=>{_=null,St()}))}function kt(){te===null&&(te=requestAnimationFrame(()=>{te=null,na()}))}function St(){n.value!==null&&(W!==null&&(W.disconnect(),ee.clear()),W=new IntersectionObserver(l=>{for(const h of l){const M=h.target,w=h.rootBounds;if(w===null)continue;const F=h.intersectionRect.top<=w.top,B=h.intersectionRect.height<h.boundingClientRect.height,N=w.height<h.boundingClientRect.height;if(h.isIntersecting&&F&&(B||N))ee.add(M),M.classList.add("timetable-program-cell--fixed");else{ee.delete(M),M.classList.remove("timetable-program-cell--fixed");const be=M.querySelector(".timetable-program-cell__content");be!==null&&(be.style.paddingTop="")}}kt()},{root:n.value,rootMargin:`-${re.value}px 0px 0px 0px`,threshold:[0,1]}),n.value.querySelectorAll(".timetable-program-cell").forEach(l=>{W==null||W.observe(l)}))}function na(){if(n.value===null||ee.size===0)return;const l=n.value.getBoundingClientRect().top+re.value;ee.forEach(h=>{const M=h.querySelector(".timetable-program-cell__content");if(M===null)return;const w=h.getBoundingClientRect().top,F=l-w;if(F<=0){M.style.paddingTop="";return}const B=h.style.getPropertyValue("--timetable-cell-height"),N=B?Number.parseFloat(B):h.getBoundingClientRect().height,ue=Math.max(0,N-Vl),be=h.classList.contains("timetable-program-cell--reserved")?3:0,xt=Math.min(F,ue);M.style.paddingTop=`${Bl+Math.max(xt-be,0)}px`})}function ia(){n.value!==null&&(x.value=n.value.scrollLeft,H.value=n.value.scrollTop,la())}function Tt(l){n.value!==null&&(D.value!==null&&(cancelAnimationFrame(D.value),D.value=null),l.deltaX!==0&&(l.preventDefault(),n.value.scrollLeft+=l.deltaX),l.shiftKey&&l.deltaY!==0?(l.preventDefault(),n.value.scrollLeft+=l.deltaY):l.deltaY!==0&&l.deltaX===0&&(l.preventDefault(),n.value.scrollTop+=l.deltaY))}function sa(l){if(l.pointerType!=="mouse"||n.value===null)return;const h=l.target;h.closest(".v-btn")||h.closest("a")||(le.value=!0,ae.value=!1,R.value=!1,y.value=l.clientX,I.value=l.clientY,d.value=n.value.scrollLeft,A.value=n.value.scrollTop,D.value!==null&&(cancelAnimationFrame(D.value),D.value=null),ie.value=0,se.value=0,de.value=performance.now(),Se.value=l.clientX,Te.value=l.clientY)}function oa(l){if(l.pointerType!=="mouse"||le.value===!1||n.value===null)return;const h=y.value-l.clientX,M=I.value-l.clientY;if((Math.abs(h)>je||Math.abs(M)>je)&&ae.value===!1&&n.value!==null&&(ae.value=!0,R.value=!0,n.value.setPointerCapture(l.pointerId),ne.value=!0,L.value=l.pointerId),ae.value===!1)return;l.preventDefault(),(Math.abs(h)>je||Math.abs(M)>je)&&(R.value=!0),n.value.scrollLeft=d.value+h,n.value.scrollTop=A.value+M;const w=performance.now(),F=w-de.value;if(F>0){const B=l.clientX-Se.value,N=l.clientY-Te.value;ie.value=-B/F*16,se.value=-N/F*16}de.value=w,Se.value=l.clientX,Te.value=l.clientY}function Dt(l){if(l.pointerType==="mouse"&&le.value!==!1){if(le.value=!1,ae.value=!1,n.value!==null&&ne.value&&L.value!==null)try{n.value.releasePointerCapture(L.value)}catch{}ne.value=!1,L.value=null,R.value?(ua(),K.value=!0,ce.value=performance.now()):(K.value=!1,ce.value=0)}}function ra(l){if(K.value===!1)return;performance.now()-ce.value<=Rl&&(l.preventDefault(),l.stopPropagation()),K.value=!1}function ua(){if(n.value===null||Math.abs(ie.value)<Ge&&Math.abs(se.value)<Ge)return;const l=()=>{if(n.value!==null){if(ie.value*=Bt,se.value*=Bt,n.value.scrollLeft+=ie.value,n.value.scrollTop+=se.value,Math.abs(ie.value)<Ge&&Math.abs(se.value)<Ge){D.value=null;return}D.value=requestAnimationFrame(l)}};D.value=requestAnimationFrame(l)}function wt(l){i.value===l.id?i.value=null:i.value=l.id}function ca(l){if(n.value===null)return;const M=u.getDisplayStartTime().hour();let F=(l===24?0:l)-M;F<0&&(F+=24);const B=F*z.value;n.value.scrollTo({top:B,behavior:"smooth"})}function da(){const l=u.scroll_top_limit_time;if(l===null)return 0;const h=u.getDisplayStartTime(),w=(l.valueOf()-h.valueOf())/(1e3*60*60);return Math.max(0,w*z.value)}function it(l=!0,h=!1){if(n.value===null)return;const M=G(),w=u.getDisplayStartTime(),F=da(),ue=(M.subtract(30,"minute").valueOf()-w.valueOf())/(1e3*60*60),be=Math.max(F,ue*z.value);if(h){n.value.scrollTo({top:be,behavior:l?"smooth":"instant"});return}if(F===0){n.value.scrollTo({top:0,behavior:"instant"});return}n.value.scrollTo({top:F,behavior:"instant"}),l&&setTimeout(()=>{n.value!==null&&n.value.scrollTo({top:be,behavior:"smooth"})},50)}function va(){n.value!==null&&n.value.scrollTo({top:0,behavior:"instant"})}function ma(){if(n.value===null)return;const l=n.value.scrollHeight-n.value.clientHeight;n.value.scrollTo({top:l,behavior:"instant"})}return a({scrollToHour:ca,scrollToCurrentTime:it,scrollToStart:va,scrollToEnd:ma}),Ze(async()=>{window.addEventListener("resize",oe),n.value!==null&&n.value.addEventListener("wheel",Tt,{passive:!1}),await Ce(),n.value!==null&&(x.value=n.value.scrollLeft,H.value=n.value.scrollTop,bt(),St()),setTimeout(()=>{it(),Ve(g)},100)}),wa(()=>{window.removeEventListener("resize",oe),E!==null&&(clearTimeout(E),E=null),n.value!==null&&n.value.removeEventListener("wheel",Tt),p.value!==null&&cancelAnimationFrame(p.value),te!==null&&cancelAnimationFrame(te),_!==null&&cancelAnimationFrame(_),W!==null&&(W.disconnect(),W=null,ee.clear()),D.value!==null&&cancelAnimationFrame(D.value)}),vt(()=>{D.value!==null&&cancelAnimationFrame(D.value)}),_e(()=>s.channels,async(l,h)=>{at.clear(),Oe.clear(),Ve(g),Ae(),h.length===0&&l.length>0&&(await Ce(),setTimeout(()=>{it(),Ae()},100))},{deep:!1}),_e([z,P],()=>{Ve(g),Ae()}),_e(re,()=>{Ae()}),_e(()=>u.display_start_time,l=>{q.value=l.valueOf()},{immediate:!0}),(l,h)=>{const M=Je("Icon");return Y(),Q("div",{class:"timetable-grid",style:me({"--timetable-channel-header-height":`${re.value}px`})},[$("div",{class:Qe(["timetable-grid__scroll-area",{"timetable-grid__scroll-area--dragging":ae.value}]),ref_key:"scrollAreaRef",ref:n,onScroll:ia,onPointerdown:sa,onPointermove:oa,onPointerup:Dt,onPointercancel:Dt,onClickCapture:ra},[$("div",{class:"timetable-grid__layout",style:me({width:`${De.value+tt.value}px`,height:`${re.value+Me.value}px`})},[$("div",{class:"timetable-grid__header-row",style:me({height:`${re.value}px`})},[$("div",{class:"timetable-grid__corner",style:me({width:`${De.value}px`})},null,4),$("div",xl,[(Y(!0),Q(pe,null,Be(e.channels,w=>(Y(),he(nl,{key:w.channel.id,channel:w.channel,width:C.value,height:re.value,resizeTrigger:V.value},null,8,["channel","width","height","resizeTrigger"]))),128))])],4),$("div",{class:"timetable-grid__body-row",style:me({height:`${Me.value}px`})},[$("div",{class:"timetable-grid__time-scale",style:me({width:`${De.value}px`})},[r(wl,{hourHeight:z.value,is36HourDisplay:s.is36HourDisplay},null,8,["hourHeight","is36HourDisplay"])],4),$("div",Cl,[(Y(!0),Q(pe,null,Be(e.channels,(w,F)=>(Y(),Q("div",{class:"timetable-grid__channel-column",key:w.channel.id,style:me({left:`${F*C.value}px`,width:`${C.value}px`,height:`${Me.value}px`})},[$("div",{class:"timetable-grid__channel-background",style:me({height:`${Me.value}px`})},null,4),(Y(!0),Q(pe,null,Be(w.programs,B=>(Y(),Q(pe,{key:B.id},[gt(B)?(Y(),he(Vt,{key:0,program:B,channel:w.channel,hourHeight:z.value,channelWidth:ht(w,B,!1),fullChannelWidth:C.value,isSplit:nt(w,B,!1),viewportHeight:P.value,channelHeaderHeight:re.value,isScrollAtBottom:X.value,isSelected:i.value===B.id,isPast:yt(B),is36HourDisplay:s.is36HourDisplay,isNextReserved:_t(w,B,!1),resizeTrigger:V.value,onClick:N=>wt(B),onShowDetail:N=>l.$emit("show-program-detail",B.id,w.channel,B),onQuickReserve:N=>l.$emit("quick-reserve",B.id,w.channel,B)},null,8,["program","channel","hourHeight","channelWidth","fullChannelWidth","isSplit","viewportHeight","channelHeaderHeight","isScrollAtBottom","isSelected","isPast","is36HourDisplay","isNextReserved","resizeTrigger","onClick","onShowDetail","onQuickReserve"])):ve("",!0)],64))),128)),ea(w)?(Y(!0),Q(pe,{key:0},Be(aa(w),B=>(Y(),Q(pe,{key:B.channel.id},[(Y(!0),Q(pe,null,Be(B.programs,N=>(Y(),Q(pe,{key:N.id},[gt(N)?(Y(),he(Vt,{key:0,program:N,channel:B.channel,hourHeight:z.value,channelWidth:ht(w,N,!0),fullChannelWidth:C.value,isSplit:nt(w,N,!0),viewportHeight:P.value,channelHeaderHeight:re.value,isScrollAtBottom:X.value,isSubchannel:!0,isSelected:i.value===N.id,isPast:yt(N),is36HourDisplay:s.is36HourDisplay,isNextReserved:_t(w,N,!0),resizeTrigger:V.value,onClick:ue=>wt(N),onShowDetail:ue=>l.$emit("show-program-detail",N.id,B.channel,N),onQuickReserve:ue=>l.$emit("quick-reserve",N.id,B.channel,N)},null,8,["program","channel","hourHeight","channelWidth","fullChannelWidth","isSplit","viewportHeight","channelHeaderHeight","isScrollAtBottom","isSelected","isPast","is36HourDisplay","isNextReserved","resizeTrigger","onClick","onShowDetail","onQuickReserve"])):ve("",!0)],64))),128))],64))),128)):ve("",!0)],4))),128)),r(ol,{hourHeight:z.value,totalWidth:tt.value,channelHeaderHeight:re.value},null,8,["hourHeight","totalWidth","channelHeaderHeight"])])],4)],4)],34),r(Ht,{name:"fade"},{default:J(()=>[o.value?(Y(),he(Z,{key:0,class:"timetable-grid__next-day-button",variant:"elevated",color:"background-lighten-1",onClick:h[0]||(h[0]=w=>l.$emit("go-to-next-day"))},{default:J(()=>[r(M,{icon:"fluent:chevron-down-20-regular",width:"20px"}),h[2]||(h[2]=$("span",null,"次の日を見る",-1))]),_:1})):ve("",!0)]),_:1}),r(Ht,{name:"fade"},{default:J(()=>[f.value?(Y(),he(Z,{key:0,class:"timetable-grid__prev-day-button",variant:"elevated",color:"background-lighten-1",onClick:h[1]||(h[1]=w=>l.$emit("go-to-previous-day"))},{default:J(()=>[r(M,{icon:"fluent:chevron-up-20-regular",width:"20px"}),h[3]||(h[3]=$("span",null,"前の日を見る",-1))]),_:1})):ve("",!0)]),_:1})],4)}}}),Al=Re(Ol,[["__scopeId","data-v-e5631ddb"]]),qt=ke({active:{type:[String,Array],default:void 0},disabled:{type:[Boolean,String,Array],default:null},nextIcon:{type:Xe,default:"$next"},prevIcon:{type:Xe,default:"$prev"},modeIcon:{type:Xe,default:"$subgroup"},text:String,viewMode:{type:String,default:"month"}},"VDatePickerControls"),It=xe()({name:"VDatePickerControls",props:qt(),emits:{"click:year":()=>!0,"click:month":()=>!0,"click:prev":()=>!0,"click:next":()=>!0,"click:text":()=>!0},setup(e,a){let{emit:v}=a;const s=c(()=>Array.isArray(e.disabled)?e.disabled.includes("text"):!!e.disabled),t=c(()=>Array.isArray(e.disabled)?e.disabled.includes("mode"):!!e.disabled),m=c(()=>Array.isArray(e.disabled)?e.disabled.includes("prev"):!!e.disabled),u=c(()=>Array.isArray(e.disabled)?e.disabled.includes("next"):!!e.disabled);function n(){v("click:prev")}function i(){v("click:next")}function o(){v("click:year")}function f(){v("click:month")}return He(()=>r("div",{class:["v-date-picker-controls"]},[r(Z,{class:"v-date-picker-controls__month-btn","data-testid":"month-btn",disabled:s.value,text:e.text,variant:"text",rounded:!0,onClick:f},null),r(Z,{class:"v-date-picker-controls__mode-btn","data-testid":"year-btn",disabled:t.value,density:"comfortable",icon:e.modeIcon,variant:"text",onClick:o},null),r(Xa,null,null),r("div",{class:"v-date-picker-controls__month"},[r(Z,{"data-testid":"prev-month",disabled:m.value,icon:e.prevIcon,variant:"text",onClick:n},null),r(Z,{"data-testid":"next-month",disabled:u.value,icon:e.nextIcon,variant:"text",onClick:i},null)])])),{}}}),$l=ke({appendIcon:Xe,color:String,header:String,transition:String,onClick:xa()},"VDatePickerHeader"),Rt=xe()({name:"VDatePickerHeader",props:$l(),emits:{click:()=>!0,"click:append":()=>!0},setup(e,a){let{emit:v,slots:s}=a;const{backgroundColorClasses:t,backgroundColorStyles:m}=mt(e,"color");function u(){v("click")}function n(){v("click:append")}return He(()=>{const i=!!(s.default||e.header),o=!!(s.append||e.appendIcon);return r("div",{class:["v-date-picker-header",{"v-date-picker-header--clickable":!!e.onClick},t.value],style:m.value,onClick:u},[s.prepend&&r("div",{key:"prepend",class:"v-date-picker-header__prepend"},[s.prepend()]),i&&r(Gt,{key:"content",name:e.transition},{default:()=>{var f;return[r("div",{key:e.header,class:"v-date-picker-header__content"},[((f=s.default)==null?void 0:f.call(s))??e.header])]}}),o&&r("div",{class:"v-date-picker-header__append"},[s.append?r(et,{key:"append-defaults",disabled:!e.appendIcon,defaults:{VBtn:{icon:e.appendIcon,variant:"text"}}},{default:()=>{var f;return[(f=s.append)==null?void 0:f.call(s)]}}):r(Z,{key:"append-btn",icon:e.appendIcon,variant:"text",onClick:n},null)])])}),{}}}),Yl=ke({allowedDates:[Array,Function],disabled:{type:Boolean,default:null},displayValue:null,modelValue:Array,month:[Number,String],max:null,min:null,showAdjacentMonths:Boolean,year:[Number,String],weekdays:{type:Array,default:()=>[0,1,2,3,4,5,6]},weeksInMonth:{type:String,default:"dynamic"},firstDayOfWeek:[Number,String]},"calendar");function El(e){const a=We(),v=Pe(e,"modelValue",[],S=>Ke(S).map(T=>a.date(T))),s=c(()=>e.displayValue?a.date(e.displayValue):v.value.length>0?a.date(v.value[0]):e.min?a.date(e.min):Array.isArray(e.allowedDates)?a.date(e.allowedDates[0]):a.date()),t=Pe(e,"year",void 0,S=>{const T=S!=null?Number(S):a.getYear(s.value);return a.startOfYear(a.setYear(a.date(),T))},S=>a.getYear(S)),m=Pe(e,"month",void 0,S=>{const T=S!=null?Number(S):a.getMonth(s.value),x=a.setYear(a.startOfMonth(a.date()),a.getYear(t.value));return a.setMonth(x,T)},S=>a.getMonth(S)),u=c(()=>e.firstDayOfWeek??e.weekdays[0]),n=c(()=>{const S=Number(e.firstDayOfWeek??0);return e.weekdays.map(T=>(T+S)%7)}),i=c(()=>{const S=a.getWeekArray(m.value,u.value),T=S.flat(),x=6*7;if(e.weeksInMonth==="static"&&T.length<x){const H=T[T.length-1];let p=[];for(let U=1;U<=x-T.length;U++)p.push(a.addDays(H,U)),U%7===0&&(S.push(p),p=[])}return S});function o(S,T){return S.filter(x=>n.value.includes(a.toJsDate(x).getDay())).map((x,H)=>{const p=a.toISO(x),U=!a.isSameMonth(x,m.value),j=a.isSameDay(x,a.startOfMonth(m.value)),q=a.isSameDay(x,a.endOfMonth(m.value)),ee=a.isSameDay(x,m.value);return{date:x,isoDate:p,formatted:a.format(x,"keyboardDate"),year:a.getYear(x),month:a.getMonth(x),isDisabled:X(x),isWeekStart:H%7===0,isWeekEnd:H%7===6,isToday:a.isSameDay(x,T),isAdjacent:U,isHidden:U&&!e.showAdjacentMonths,isStart:j,isSelected:v.value.some(W=>a.isSameDay(x,W)),isEnd:q,isSame:ee,localized:a.format(x,"dayOfMonth")}})}const f=c(()=>{const S=a.startOfWeek(s.value,e.firstDayOfWeek),T=[];for(let H=0;H<=6;H++)T.push(a.addDays(S,H));const x=a.date();return o(T,x)}),g=c(()=>{const S=i.value.flat(),T=a.date();return o(S,T)}),P=c(()=>i.value.map(S=>S.length?Ca(a,S[0]):null));function X(S){if(e.disabled)return!0;const T=a.date(S);return e.min&&a.isAfter(a.date(e.min),T)||e.max&&a.isAfter(T,a.date(e.max))?!0:Array.isArray(e.allowedDates)&&e.allowedDates.length>0?!e.allowedDates.some(x=>a.isSameDay(a.date(x),T)):typeof e.allowedDates=="function"?!e.allowedDates(T):!1}return{displayValue:s,daysInMonth:g,daysInWeek:f,genDays:o,model:v,weeksInMonth:i,weekDays:n,weekNumbers:P}}const Xt=ke({color:String,hideWeekdays:Boolean,multiple:[Boolean,Number,String],showWeek:Boolean,transition:{type:String,default:"picker-transition"},reverseTransition:{type:String,default:"picker-reverse-transition"},...Ee(Yl(),["displayValue"])},"VDatePickerMonth"),Ot=xe()({name:"VDatePickerMonth",props:Xt(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=k(),{daysInMonth:m,model:u,weekNumbers:n}=El(e),i=We(),o=Ye(),f=Ye(),g=Ye(!1),P=c(()=>g.value?e.reverseTransition:e.transition);e.multiple==="range"&&u.value.length>0&&(o.value=u.value[0],u.value.length>1&&(f.value=u.value[u.value.length-1]));const X=c(()=>{const H=["number","string"].includes(typeof e.multiple)?Number(e.multiple):1/0;return u.value.length>=H});_e(m,(H,p)=>{p&&(g.value=i.isBefore(H[0].date,p[0].date))});function S(H){const p=i.startOfDay(H);if(u.value.length===0?o.value=void 0:u.value.length===1&&(o.value=u.value[0],f.value=void 0),!o.value)o.value=p,u.value=[o.value];else if(f.value)o.value=H,f.value=void 0,u.value=[o.value];else{if(i.isSameDay(p,o.value)){o.value=void 0,u.value=[];return}else i.isBefore(p,o.value)?(f.value=i.endOfDay(o.value),o.value=p):f.value=i.endOfDay(p);const U=i.getDiff(f.value,o.value,"days"),j=[o.value];for(let q=1;q<U;q++){const ee=i.addDays(o.value,q);j.push(ee)}j.push(f.value),u.value=j}}function T(H){const p=u.value.findIndex(U=>i.isSameDay(U,H));if(p===-1)u.value=[...u.value,H];else{const U=[...u.value];U.splice(p,1),u.value=U}}function x(H){e.multiple==="range"?S(H):e.multiple?T(H):u.value=[H]}return()=>r("div",{class:"v-date-picker-month"},[e.showWeek&&r("div",{key:"weeks",class:"v-date-picker-month__weeks"},[!e.hideWeekdays&&r("div",{key:"hide-week-days",class:"v-date-picker-month__day"},[dt(" ")]),n.value.map(H=>r("div",{class:["v-date-picker-month__day","v-date-picker-month__day--adjacent"]},[H]))]),r(Gt,{name:P.value},{default:()=>{var H;return[r("div",{ref:t,key:(H=m.value[0].date)==null?void 0:H.toString(),class:"v-date-picker-month__days"},[!e.hideWeekdays&&i.getWeekdays(e.firstDayOfWeek).map(p=>r("div",{class:["v-date-picker-month__day","v-date-picker-month__weekday"]},[p])),m.value.map((p,U)=>{const j={props:{onClick:()=>x(p.date)},item:p,i:U};return X.value&&!p.isSelected&&(p.isDisabled=!0),r("div",{class:["v-date-picker-month__day",{"v-date-picker-month__day--adjacent":p.isAdjacent,"v-date-picker-month__day--hide-adjacent":p.isHidden,"v-date-picker-month__day--selected":p.isSelected,"v-date-picker-month__day--week-end":p.isWeekEnd,"v-date-picker-month__day--week-start":p.isWeekStart}],"data-v-date":p.isDisabled?void 0:p.isoDate},[(e.showAdjacentMonths||!p.isAdjacent)&&r(et,{defaults:{VBtn:{class:"v-date-picker-month__day-btn",color:(p.isSelected||p.isToday)&&!p.isDisabled?e.color:void 0,disabled:p.isDisabled,icon:!0,ripple:!1,text:p.localized,variant:p.isDisabled?p.isToday?"outlined":"text":p.isToday&&!p.isSelected?"outlined":"flat",onClick:()=>x(p.date)}}},{default:()=>{var q;return[((q=s.day)==null?void 0:q.call(s,j))??r(Z,j.props,null)]}})])})])]}})])}}),Kt=ke({color:String,height:[String,Number],min:null,max:null,modelValue:Number,year:Number},"VDatePickerMonths"),At=xe()({name:"VDatePickerMonths",props:Kt(),emits:{"update:modelValue":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=We(),m=Pe(e,"modelValue"),u=c(()=>{let n=t.startOfYear(t.date());return e.year&&(n=t.setYear(n,e.year)),Lt(12).map(i=>{const o=t.format(n,"monthShort"),f=!!(e.min&&t.isAfter(t.startOfMonth(t.date(e.min)),n)||e.max&&t.isAfter(n,t.startOfMonth(t.date(e.max))));return n=t.getNextMonth(n),{isDisabled:f,text:o,value:i}})});return zt(()=>{m.value=m.value??t.getMonth(t.date())}),He(()=>r("div",{class:"v-date-picker-months",style:{height:Ut(e.height)}},[r("div",{class:"v-date-picker-months__content"},[u.value.map((n,i)=>{var g;const o={active:m.value===i,color:m.value===i?e.color:void 0,disabled:n.isDisabled,rounded:!0,text:n.text,variant:m.value===n.value?"flat":"text",onClick:()=>f(i)};function f(P){if(m.value===P){v("update:modelValue",m.value);return}m.value=P}return((g=s.month)==null?void 0:g.call(s,{month:n,i,props:o}))??r(Z,fe({key:"month"},o),null)})])])),{}}}),Qt=ke({color:String,height:[String,Number],min:null,max:null,modelValue:Number},"VDatePickerYears"),$t=xe()({name:"VDatePickerYears",props:Qt(),emits:{"update:modelValue":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=We(),m=Pe(e,"modelValue"),u=c(()=>{const i=t.getYear(t.date());let o=i-100,f=i+52;e.min&&(o=t.getYear(t.date(e.min))),e.max&&(f=t.getYear(t.date(e.max)));let g=t.startOfYear(t.date());return g=t.setYear(g,o),Lt(f-o+1,o).map(P=>{const X=t.format(g,"year");return g=t.setYear(g,t.getYear(g)+1),{text:X,value:P}})});zt(()=>{m.value=m.value??t.getYear(t.date())});const n=Pa();return Ze(async()=>{var i;await Ce(),(i=n.el)==null||i.scrollIntoView({block:"center"})}),He(()=>r("div",{class:"v-date-picker-years",style:{height:Ut(e.height)}},[r("div",{class:"v-date-picker-years__content"},[u.value.map((i,o)=>{var g;const f={ref:m.value===i.value?n:void 0,active:m.value===i.value,color:m.value===i.value?e.color:void 0,rounded:!0,text:i.text,variant:m.value===i.value?"flat":"text",onClick:()=>{if(m.value===i.value){v("update:modelValue",m.value);return}m.value=i.value}};return((g=s.year)==null?void 0:g.call(s,{year:i,i:o,props:f}))??r(Z,fe({key:"month"},f),null)})])])),{}}}),Nl=Ka("v-picker-title"),Jt=ke({color:String,...Ua(),...za(),...La(),...Wa(),...Na(),...Ea(),...Ya(),...$a(),...Aa()},"VSheet"),Yt=xe()({name:"VSheet",props:Jt(),setup(e,a){let{slots:v}=a;const{themeClasses:s}=Ha(e),{backgroundColorClasses:t,backgroundColorStyles:m}=mt(Ft(e,"color")),{borderClasses:u}=Ma(e),{dimensionStyles:n}=Va(e),{elevationClasses:i}=Ba(e),{locationStyles:o}=Ia(e),{positionClasses:f}=Ra(e),{roundedClasses:g}=Oa(e);return He(()=>r(e.tag,{class:["v-sheet",s.value,t.value,u.value,i.value,f.value,g.value,e.class],style:[m.value,n.value,o.value,e.style]},v)),{}}}),Zt=ke({bgColor:String,landscape:Boolean,title:String,hideHeader:Boolean,...Jt()},"VPicker"),Et=xe()({name:"VPicker",props:Zt(),setup(e,a){let{slots:v}=a;const{backgroundColorClasses:s,backgroundColorStyles:t}=mt(Ft(e,"color"));return He(()=>{const m=Yt.filterProps(e),u=!!(e.title||v.title);return r(Yt,fe(m,{color:e.bgColor,class:["v-picker",{"v-picker--landscape":e.landscape,"v-picker--with-actions":!!v.actions},e.class],style:e.style}),{default:()=>{var n;return[!e.hideHeader&&r("div",{key:"header",class:[s.value],style:[t.value]},[u&&r(Nl,{key:"picker-title"},{default:()=>{var i;return[((i=v.title)==null?void 0:i.call(v))??e.title]}}),v.header&&r("div",{class:"v-picker__header"},[v.header()])]),r("div",{class:"v-picker__body"},[(n=v.default)==null?void 0:n.call(v)]),v.actions&&r(et,{defaults:{VBtn:{slim:!0,variant:"text"}}},{default:()=>[r("div",{class:"v-picker__actions"},[v.actions()])]})]}})}),{}}}),Wl=ke({header:{type:String,default:"$vuetify.datePicker.header"},...qt(),...Xt({weeksInMonth:"static"}),...Ee(Kt(),["modelValue"]),...Ee(Qt(),["modelValue"]),...Zt({title:"$vuetify.datePicker.title"}),modelValue:null},"VDatePicker"),Nt=xe()({name:"VDatePicker",props:Wl(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0,"update:viewMode":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=We(),{t:m}=Fa(),u=Pe(e,"modelValue",void 0,_=>Ke(_).map(V=>t.date(V)),_=>e.multiple?_:_[0]),n=Pe(e,"viewMode"),i=c(()=>{const _=t.date(e.min);return e.min&&t.isValid(_)?_:null}),o=c(()=>{const _=t.date(e.max);return e.max&&t.isValid(_)?_:null}),f=c(()=>{var E;const _=t.date();let V=_;return(E=u.value)!=null&&E[0]?V=t.date(u.value[0]):i.value&&t.isBefore(_,i.value)?V=i.value:o.value&&t.isAfter(_,o.value)&&(V=o.value),V&&t.isValid(V)?V:_}),g=k(Number(e.month??t.getMonth(t.startOfMonth(f.value)))),P=k(Number(e.year??t.getYear(t.startOfYear(t.setMonth(f.value,g.value))))),X=Ye(!1),S=c(()=>e.multiple&&u.value.length>1?m("$vuetify.datePicker.itemsSelected",u.value.length):u.value[0]&&t.isValid(u.value[0])?t.format(t.date(u.value[0]),"normalDateWithWeekday"):m(e.header)),T=c(()=>{let _=t.date();return _=t.setDate(_,1),_=t.setMonth(_,g.value),_=t.setYear(_,P.value),t.format(_,"monthAndYear")}),x=c(()=>`date-picker-header${X.value?"-reverse":""}-transition`),H=c(()=>{if(e.disabled)return!0;const _=[];if(n.value!=="month")_.push("prev","next");else{let V=t.date();if(V=t.startOfMonth(V),V=t.setMonth(V,g.value),V=t.setYear(V,P.value),i.value){const E=t.addDays(t.startOfMonth(V),-1);t.isAfter(i.value,E)&&_.push("prev")}if(o.value){const E=t.addDays(t.endOfMonth(V),1);t.isAfter(E,o.value)&&_.push("next")}}return _});function p(){g.value<11?g.value++:(P.value++,g.value=0,te(P.value)),W(g.value)}function U(){g.value>0?g.value--:(P.value--,g.value=11,te(P.value)),W(g.value)}function j(){n.value="month"}function q(){n.value=n.value==="months"?"month":"months"}function ee(){n.value=n.value==="year"?"month":"year"}function W(_){n.value==="months"&&q(),v("update:month",_)}function te(_){n.value==="year"&&ee(),v("update:year",_)}return _e(u,(_,V)=>{const E=Ke(V),oe=Ke(_);if(!oe.length)return;const ae=t.date(E[E.length-1]),le=t.date(oe[oe.length-1]),ne=t.getMonth(le),L=t.getYear(le);ne!==g.value&&(g.value=ne,W(g.value)),L!==P.value&&(P.value=L,te(P.value)),X.value=t.isBefore(ae,le)}),He(()=>{const _=Et.filterProps(e),V=It.filterProps(e),E=Rt.filterProps(e),oe=Ot.filterProps(e),ae=Ee(At.filterProps(e),["modelValue"]),le=Ee($t.filterProps(e),["modelValue"]),ne={header:S.value,transition:x.value};return r(Et,fe(_,{class:["v-date-picker",`v-date-picker--${n.value}`,{"v-date-picker--show-week":e.showWeek},e.class],style:e.style}),{title:()=>{var L;return((L=s.title)==null?void 0:L.call(s))??r("div",{class:"v-date-picker__title"},[m(e.title)])},header:()=>s.header?r(et,{defaults:{VDatePickerHeader:{...ne}}},{default:()=>{var L;return[(L=s.header)==null?void 0:L.call(s,ne)]}}):r(Rt,fe({key:"header"},E,ne,{onClick:n.value!=="month"?j:void 0}),{...s,default:void 0}),default:()=>r(pe,null,[r(It,fe(V,{disabled:H.value,text:T.value,"onClick:next":p,"onClick:prev":U,"onClick:month":q,"onClick:year":ee}),null),r(Qa,{hideOnLeave:!0},{default:()=>[n.value==="months"?r(At,fe({key:"date-picker-months"},ae,{modelValue:g.value,"onUpdate:modelValue":[L=>g.value=L,W],min:i.value,max:o.value,year:P.value}),null):n.value==="year"?r($t,fe({key:"date-picker-years"},le,{modelValue:P.value,"onUpdate:modelValue":[L=>P.value=L,te],min:i.value,max:o.value}),null):r(Ot,fe({key:"date-picker-month"},oe,{modelValue:u.value,"onUpdate:modelValue":L=>u.value=L,month:g.value,"onUpdate:month":[L=>g.value=L,W],year:P.value,"onUpdate:year":[L=>P.value=L,te],min:i.value,max:o.value}),null)]})]),actions:s.actions})}),{}}}),Ll={class:"route-container"},zl={class:"timetable-controls"},Ul={class:"timetable-controls__date"},Fl={key:0,class:"timetable-controls-mobile"},Gl={class:"timetable-controls-mobile__inner"},jl={class:"timetable-controls-mobile__date"},ql=100,Xl=Ie({__name:"TimeTable",setup(e){Ne();const a=Le(),v=k(null),s=ba(),t=c(()=>s.server_settings),m=c(()=>t.value.general.backend==="EDCB"),u=k(!1),n=k(!1),i=k(0);let o=null;function f(){o!==null&&clearTimeout(o),o=window.setTimeout(()=>{i.value++,o=null},ql)}const g=c(()=>(i.value,ge.isSmartphoneVertical()||ge.isSmartphoneHorizontal()||ge.isTabletVertical())),P=c(()=>(i.value,!ge.isSmartphoneVertical())),X=c(()=>a.date_display_offset),S=k(!1),T=k(null),x=k(null),H=k(null),p=k(!1),U=c(()=>{const D=[],b=a.available_channel_types;for(const C of jt)b.has(C)&&D.push({title:C,value:C});return D}),j=c({get:()=>a.selected_channel_type,set:D=>{a.changeChannelType(D)}}),q=c(()=>{const D=[],b=a.is_36hour_display&&X.value===0;for(let C=4;C<=24;C+=4){const z=C,O=C<=12;D.push({title:`${z.toString().padStart(2,"0")}時`,value:C,...b&&O?{props:{disabled:!0}}:{}})}return D});function ee(){let b=G().hour();return b<4&&(b+=24),Math.floor((b-4)/4)*4+4}const W=k(ee()),te=c(()=>{const D=a.selected_date.add(X.value,"day"),b=D.month()+1,C=D.date(),z=["日","月","火","水","木","金","土"][D.day()];return`${b}/${C} (${z})`}),_=c({get:()=>a.selected_date.toDate(),set:D=>{const b=G(D).hour(4).minute(0).second(0).millisecond(0);a.changeDate(b)}}),V=c(()=>a.can_go_previous_day),E=c(()=>a.can_go_next_day),oe=c(()=>a.date_range===null?void 0:a.getBroadcastDate(a.date_range.earliest).startOf("day").toDate()),ae=c(()=>a.date_range===null?void 0:a.getBroadcastDate(a.date_range.latest).endOf("day").toDate());function le(D){if(a.date_range===null)return!1;const b=G(D),C=a.getBroadcastDate(a.date_range.earliest),z=a.getBroadcastDate(a.date_range.latest);return b.isSameOrAfter(C,"day")&&b.isSameOrBefore(z,"day")}function ne(D){a.changeChannelType(D)}function L(D){n.value=!1;const b=G(D).hour(4).minute(0).second(0).millisecond(0);a.changeDate(b)}function y(D){D===null||v.value===null||v.value.scrollToHour(D)}async function I(){await a.goToPreviousDay(),await Ce(),v.value!==null&&v.value.scrollToEnd()}async function d(){await a.goToNextDay(),await Ce(),v.value!==null&&v.value.scrollToStart()}async function A(){await a.goToCurrentTime(),await Ce(),v.value!==null&&v.value.scrollToCurrentTime(!0,!0)}function R(D){const b=Math.floor((D-4)/4)*4+4,C=Math.max(4,Math.min(24,b));W.value=C}function K(D){a.setDateDisplayOffset(D)}async function ce(D,b,C){const z=G(C.end_time);if(p.value=z.isBefore(G()),C.reservation!==null){const O=await Ue.fetchReservation(C.reservation.id);O!==null?(T.value=O,x.value=null,H.value=null):(T.value=ie(C,b),x.value=null,H.value=null)}else T.value=ie(C,b),x.value=null,H.value=null;S.value=!0}function ie(D,b){return{id:-1,channel:b,program:D,is_recording_in_progress:!1,recording_availability:"Full",comment:"",scheduled_recording_file_name:"",estimated_recording_file_size:0,record_settings:structuredClone(Ct)}}async function se(){await a.fetchTimeTableData()}async function de(){await a.fetchTimeTableData()}async function Se(){await a.fetchTimeTableData()}async function Te(D,b,C){if(G(C.end_time).isBefore(G()))return;if(m.value===!1){ut.warning("録画予約機能は EDCB バックエンド利用時のみ使用できます。");return}if(C.reservation!==null){const re=await Ue.fetchReservation(C.reservation.id);if(re===null)return;const De=structuredClone(re.record_settings);if(De.is_enabled=!De.is_enabled,await Ue.updateReservation(re.id,De)!==null){const Me=De.is_enabled?`録画予約を有効にしました。
番組開始時刻になると自動的に録画が開始されます。`:`録画予約を無効にしました。
番組開始時刻までに再度予約を有効にしない限り、この番組は録画されません。`;ut.success(Me),await a.fetchTimeTableData()}return}await Ue.addReservation(D,structuredClone(Ct))&&(ut.success("録画予約を追加しました。"),await a.fetchTimeTableData())}return Ze(async()=>{window.addEventListener("resize",f),await s.fetchServerSettingsOnce(),await a.initialLoad()}),vt(()=>{window.removeEventListener("resize",f),o!==null&&(clearTimeout(o),o=null),a.reset()}),_e(()=>a.selected_date,()=>{a.setDateDisplayOffset(0)}),(D,b)=>{const C=Je("Icon"),z=Wt("ftooltip");return Y(),Q("div",Ll,[r(pa,null,Ga({_:2},[g.value?void 0:{name:"timetable-controls",fn:J(()=>[$("div",zl,[r(Fe,{class:"timetable-controls__channel-type",variant:"outlined",density:"compact","hide-details":"",items:U.value,modelValue:j.value,"onUpdate:modelValue":[b[0]||(b[0]=O=>j.value=O),ne]},null,8,["items","modelValue"]),$("div",Ul,[r(Z,{variant:"flat",icon:"",size:"small",disabled:!V.value,onClick:I},{default:J(()=>[r(C,{icon:"fluent:chevron-left-20-regular",width:"20px"})]),_:1},8,["disabled"]),r(Mt,{modelValue:n.value,"onUpdate:modelValue":b[2]||(b[2]=O=>n.value=O),"close-on-content-click":!1},{activator:J(({props:O})=>[r(Z,fe({variant:"flat",class:"timetable-controls__date-button"},O),{default:J(()=>[dt(we(te.value),1)]),_:1},16)]),default:J(()=>[r(Nt,{modelValue:_.value,"onUpdate:modelValue":[b[1]||(b[1]=O=>_.value=O),L],color:"primary",min:oe.value,max:ae.value,"allowed-dates":le},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"]),r(Z,{variant:"flat",icon:"",size:"small",disabled:!E.value,onClick:d},{default:J(()=>[r(C,{icon:"fluent:chevron-right-20-regular",width:"20px"})]),_:1},8,["disabled"])]),r(Fe,{class:"timetable-controls__time",variant:"outlined",density:"compact","hide-details":"",items:q.value,modelValue:W.value,"onUpdate:modelValue":[b[3]||(b[3]=O=>W.value=O),y]},null,8,["items","modelValue"]),ct((Y(),he(Z,{variant:"flat",class:"timetable-controls__now-button",icon:"",onClick:A},{default:J(()=>[r(C,{icon:"fluent:clock-20-regular",width:"22px"})]),_:1})),[[z,"現在時刻に移動",void 0,{bottom:!0}]]),ct((Y(),he(Z,{variant:"flat",class:"timetable-controls__settings-button",icon:"",onClick:b[4]||(b[4]=O=>u.value=!0)},{default:J(()=>[r(C,{icon:"fluent:settings-20-regular",width:"22px"})]),_:1})),[[z,"番組表の表示設定",void 0,{bottom:!0}]])])]),key:"0"}]),1024),$("main",null,[r(ya,{"icon-only":P.value},null,8,["icon-only"]),$("div",{class:Qe(["timetable-container",{"timetable-container--loading":qe(a).is_loading}])},[r(_a),g.value?(Y(),Q("div",Fl,[$("div",Gl,[r(Fe,{class:"timetable-controls-mobile__channel-type",variant:"outlined",density:"compact","hide-details":"",items:U.value,modelValue:j.value,"onUpdate:modelValue":[b[5]||(b[5]=O=>j.value=O),ne]},null,8,["items","modelValue"]),$("div",jl,[r(Mt,{modelValue:n.value,"onUpdate:modelValue":b[7]||(b[7]=O=>n.value=O),"close-on-content-click":!1},{activator:J(({props:O})=>[r(Z,fe({variant:"flat",class:"timetable-controls-mobile__date-button",size:"small"},O),{default:J(()=>[dt(we(te.value),1)]),_:1},16)]),default:J(()=>[r(Nt,{modelValue:_.value,"onUpdate:modelValue":[b[6]||(b[6]=O=>_.value=O),L],color:"primary",min:oe.value,max:ae.value,"allowed-dates":le},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"])]),r(Fe,{class:"timetable-controls-mobile__time",variant:"outlined",density:"compact","hide-details":"",items:q.value,modelValue:W.value,"onUpdate:modelValue":[b[8]||(b[8]=O=>W.value=O),y]},null,8,["items","modelValue"]),r(Z,{variant:"flat",class:"timetable-controls-mobile__now-button",icon:"",size:"small",onClick:A},{default:J(()=>[r(C,{icon:"fluent:clock-20-regular",width:"18px"})]),_:1}),r(Z,{variant:"flat",class:"timetable-controls-mobile__settings-button",icon:"",size:"small",onClick:b[9]||(b[9]=O=>u.value=!0)},{default:J(()=>[r(C,{icon:"fluent:settings-20-regular",width:"18px"})]),_:1})])])):ve("",!0),r(Al,{ref_key:"timetableGridRef",ref:v,channels:qe(a).channels_data,is36HourDisplay:qe(a).is_36hour_display,canGoPreviousDay:V.value,canGoNextDay:E.value,onTimeSlotChange:R,onDateDisplayOffsetChange:K,onShowProgramDetail:ce,onQuickReserve:Te,onGoToNextDay:d,onGoToPreviousDay:I},null,8,["channels","is36HourDisplay","canGoPreviousDay","canGoNextDay"])],2)]),r(Sa,{isOpen:u.value,"onUpdate:isOpen":b[10]||(b[10]=O=>u.value=O)},null,8,["isOpen"]),r(ka,{modelValue:S.value,"onUpdate:modelValue":b[11]||(b[11]=O=>S.value=O),reservation:T.value,program:x.value,channel:H.value,isPastProgram:p.value,onAdded:se,onUpdated:de,onDeleted:Se},null,8,["modelValue","reservation","program","channel","isPastProgram"])])}}}),mn=Re(Xl,[["__scopeId","data-v-06be0139"]]);export{mn as default};
