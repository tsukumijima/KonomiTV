import{D as ke,E as xe,T as Ce,S as Pe,G as h,O as De,Y as $e,W as Se,a as t,Q as re,d as Y,U as ae,P as K,_ as Z,c as g,e as k,b as e,t as V,F as Q,g as se,r as X,o as d,q as P,aJ as O,s as W,x as ge,l as y,B as G,i as Ee,a7 as p,ae as Re,aK as Ue,aL as Be,n as M,w as N,k as j,h as b,V as T,M as F,R as q}from"./index-Cpp2ozZy.js";import{u as Ie}from"./SPHeaderBar-CRbYowl_.js";import{V as Te}from"./VSwitch-BXp2-KB_.js";import{V as Fe}from"./VSlider-DIBb1gct.js";import{u as Le,m as Me,V as te,c as A}from"./VTextField-FMb_BoiY.js";import{m as Ae,e as ne,c as z}from"./VSelect-DJ_LwDZn.js";import{V as ie}from"./VDialog-afg5vDEp.js";import{a as oe,V as le,b as de,c as ue}from"./VCard-DDuB-Wxz.js";import{V as ce}from"./ssrBoot-Fpn0o8Uo.js";const Ge=xe({...Me(),...$e(Ae(),["inline"])},"VCheckbox"),Oe=ke()({name:"VCheckbox",inheritAttrs:!1,props:Ge(),emits:{"update:modelValue":r=>!0,"update:focused":r=>!0},setup(r,u){let{attrs:n,slots:_}=u;const o=Ce(r,"modelValue"),{isFocused:i,focus:S,blur:m}=Le(r),f=Pe(),E=h(()=>r.id||`checkbox-${f}`);return De(()=>{const[C,$]=Se(n),R=te.filterProps(r),U=ne.filterProps(r);return t(te,re({class:["v-checkbox",r.class]},C,R,{modelValue:o.value,"onUpdate:modelValue":B=>o.value=B,id:E.value,focused:i.value,style:r.style}),{..._,default:B=>{let{id:x,messagesId:L,isDisabled:w,isReadonly:a,isValid:I}=B;return t(ne,re(U,{id:x.value,"aria-describedby":L.value,disabled:w.value,readonly:a.value},$,{error:I.value===!1,modelValue:o.value,"onUpdate:modelValue":c=>o.value=c,onFocus:S,onBlur:m}),_)}})}),{}}}),He=Y({name:"ReservationProgramInfo",props:{reservation:{type:Object,default:null},program:{type:Object,default:null},channel:{type:Object,default:null}},data(){return{Utils:Object.freeze(ae),ProgramUtils:Object.freeze(K)}},computed:{displayProgram(){var r;return((r=this.reservation)==null?void 0:r.program)??this.program},displayChannel(){var r;return((r=this.reservation)==null?void 0:r.channel)??this.channel}},methods:{onLogoError(r){const u=r.target;u.src=`${ae.api_base_url}/channels/gr001/logo`}}}),Ne={key:0,class:"program-container"},je={class:"program-info"},qe=["innerHTML"],ze={class:"program-info__broadcaster"},Je=["src"],Ke={class:"program-info__broadcaster-container"},Qe={class:"d-flex align-center"},We={class:"program-info__broadcaster-number"},Ye={class:"program-info__broadcaster-name"},Ze={class:"program-info__broadcaster-time"},Xe=["innerHTML"],er={key:0,class:"program-info__genre-container"},rr={class:"mt-5"},ar={key:0,class:"program-info__status"},sr={class:"ml-2"},tr={class:"program-info__status"},nr={class:"ml-2"},ir={key:1,class:"program-info__status"},or={class:"ml-2"},lr={class:"program-detail-container"},dr={class:"program-detail__heading"},ur=["innerHTML"];function cr(r,u,n,_,o,i){const S=X("Icon");return r.displayProgram&&r.displayChannel?(d(),g("div",Ne,[e("section",je,[e("h1",{class:"program-info__title",innerHTML:r.ProgramUtils.decorateProgramInfo(r.displayProgram,"title")},null,8,qe),e("div",ze,[e("img",{class:"program-info__broadcaster-icon",src:`${r.Utils.api_base_url}/channels/${r.displayChannel.id}/logo`,onError:u[0]||(u[0]=(...m)=>r.onLogoError&&r.onLogoError(...m))},null,40,Je),e("div",Ke,[e("div",Qe,[e("div",We,"Ch: "+V(r.displayChannel.channel_number),1),e("div",Ye,V(r.displayChannel.name),1)]),e("div",Ze,V(r.ProgramUtils.getProgramTime(r.displayProgram)),1)])]),e("div",{class:"program-info__description",innerHTML:r.ProgramUtils.decorateProgramInfo(r.displayProgram,"description")},null,8,Xe),r.displayProgram.genres&&r.displayProgram.genres.length>0?(d(),g("div",er,[(d(!0),g(Q,null,se(r.displayProgram.genres,(m,f)=>(d(),g("div",{class:"program-info__genre",key:f},V(m.major)+" / "+V(m.middle),1))),128))])):k("",!0),e("div",rr,[r.displayProgram.video_codec&&r.displayProgram.video_resolution?(d(),g("div",ar,[t(S,{icon:"fluent:video-16-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",sr,"映像: "+V(r.displayProgram.video_codec)+" / "+V(r.displayProgram.video_resolution),1)])):k("",!0),e("div",tr,[t(S,{icon:"fluent:headphones-sound-wave-20-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",nr,"主音声: "+V(r.displayProgram.primary_audio_type)+" "+V(r.displayProgram.primary_audio_sampling_rate||"Unknown")+" / "+V(r.displayProgram.primary_audio_language),1)]),r.displayProgram.secondary_audio_type?(d(),g("div",ir,[t(S,{icon:"fluent:headphones-sound-wave-20-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",or,"副音声: "+V(r.displayProgram.secondary_audio_type)+" "+V(r.displayProgram.secondary_audio_sampling_rate||"Unknown")+" / "+V(r.displayProgram.secondary_audio_language),1)])):k("",!0)])]),e("section",lr,[(d(!0),g(Q,null,se(r.displayProgram.detail??{},(m,f)=>(d(),g("div",{class:"program-detail",key:f},[e("h2",dr,V(f),1),e("div",{class:"program-detail__text",innerHTML:r.Utils.URLtoLink(m)},null,8,ur)]))),128))])])):k("",!0)}const gr=Z(He,[["render",cr],["__scopeId","data-v-21faec51"]]),vr={class:"reservation-recording-settings"},_r={key:0,class:"recording-warning-banner"},mr={class:"reservation-recording-settings__section"},pr={class:"reservation-recording-settings__header"},fr={class:"reservation-recording-settings__section"},br={class:"reservation-recording-settings__slider"},hr={class:"reservation-recording-settings__section"},yr={class:"reservation-recording-settings__section"},wr={class:"reservation-recording-settings__section"},Vr={class:"reservation-recording-settings__margin-default"},kr={class:"reservation-recording-settings__margin-controls"},xr={class:"reservation-recording-settings__section"},Cr={class:"reservation-recording-settings__section"},Pr={class:"reservation-recording-settings__section"},Dr={class:"reservation-recording-settings__section"},$r={class:"reservation-recording-settings__description"},Sr=Y({__name:"ReservationRecordingSettings",props:{reservation:{},hasChanges:{type:Boolean}},emits:["updateSettings","changesDetected"],setup(r,{emit:u}){const n=r,_=u,o=Ie(),i=P(structuredClone(O(n.reservation.record_settings))),S=P(structuredClone(O(n.reservation.record_settings))),m=h({get:()=>i.value.recording_folders.length>0?i.value.recording_folders[0].recording_folder_path:"",set:w=>{E(w,f.value)}}),f=h({get:()=>i.value.recording_folders.length>0&&i.value.recording_folders[0].recording_file_name_template||"",set:w=>{E(m.value,w)}}),E=(w,a)=>{const I=w.trim()!=="",c=a.trim()!=="";!I&&!c?i.value.recording_folders=[]:(i.value.recording_folders.length===0&&i.value.recording_folders.push({recording_folder_path:"",recording_file_name_template:null,is_oneseg_separate_recording_folder:!1}),i.value.recording_folders[0].recording_folder_path=w,i.value.recording_folders[0].recording_file_name_template=a||null)},C=P(i.value.recording_start_margin===null&&i.value.recording_end_margin===null),$=[{title:"デフォルト設定を使う",value:"Default"},{title:"録画する",value:"Enable"},{title:"録画しない",value:"Disable"}],R=[{title:"デフォルト設定を使う",value:"Default"},{title:"録画する",value:"Enable"},{title:"録画しない",value:"Disable"}],U=[{title:"デフォルト設定を使う",value:"Default"},{title:"何もしない",value:"Nothing"},{title:"スタンバイ",value:"Standby"},{title:"スタンバイ(復帰後再起動)",value:"StandbyAndReboot"},{title:"サスペンド",value:"Suspend"},{title:"サスペンド(復帰後再起動)",value:"SuspendAndReboot"},{title:"シャットダウン",value:"Shutdown"}],B=h(()=>JSON.stringify(i.value)!==JSON.stringify(S.value));W(B,w=>{_("changesDetected",w)});const x=()=>{_("updateSettings",i.value)},L=()=>{C.value?(i.value.recording_start_margin=null,i.value.recording_end_margin=null):(i.value.recording_start_margin=10,i.value.recording_end_margin=5),x()};return W(()=>n.reservation,w=>{i.value=structuredClone(O(w.record_settings)),S.value=structuredClone(O(w.record_settings))},{deep:!0}),ge(async()=>{await o.fetchServerVersion()}),(w,a)=>{const I=X("Icon");return d(),g("div",vr,[r.reservation.is_recording_in_progress?(d(),g("div",_r,[t(I,{icon:"fluent:warning-16-filled",class:"recording-warning-banner__icon"}),a[11]||(a[11]=e("span",{class:"recording-warning-banner__text"}," 録画中の録画設定の変更はできません。 ",-1))])):k("",!0),e("div",mr,[e("div",pr,[a[12]||(a[12]=e("div",{class:"reservation-recording-settings__label"},"録画予約の有効/無効",-1)),t(Te,{disabled:r.reservation.is_recording_in_progress,style:{height:"0","margin-top":"-40px","margin-right":"6px"},modelValue:i.value.is_enabled,"onUpdate:modelValue":[a[0]||(a[0]=c=>i.value.is_enabled=c),x],color:"primary",density:"compact","hide-details":""},null,8,["disabled","modelValue"])]),a[13]||(a[13]=e("div",{class:"reservation-recording-settings__description mb-0"},[y(" 予約が無効なときは、この番組の録画動作を行いません。"),e("br"),y(" キーワード自動予約条件により不必要な番組が予約されてしまっているときは、予約を無効にしてみてください。(予約削除ではすぐ再追加されてしまい意味がありません。) ")],-1))]),e("div",fr,[a[14]||(a[14]=e("div",{class:"reservation-recording-settings__label"},"録画予約の優先度",-1)),a[15]||(a[15]=e("div",{class:"reservation-recording-settings__description mb-0"}," 放送時間が重なりチューナーが足りないときは、より優先度が高い予約から優先的に録画します。 ",-1)),e("div",br,[t(Fe,{disabled:r.reservation.is_recording_in_progress,modelValue:i.value.priority,"onUpdate:modelValue":[a[1]||(a[1]=c=>i.value.priority=c),x],min:1,max:5,step:1,color:"primary",density:"compact","show-ticks":"always","thumb-label":"","hide-details":""},null,8,["disabled","modelValue"])])]),e("div",hr,[a[16]||(a[16]=e("div",{class:"reservation-recording-settings__label"},"録画フォルダのパス",-1)),a[17]||(a[17]=e("div",{class:"reservation-recording-settings__description"}," 空欄にすると、デフォルトの録画フォルダに保存されます。 ",-1)),t(A,{disabled:r.reservation.is_recording_in_progress,modelValue:m.value,"onUpdate:modelValue":[a[2]||(a[2]=c=>m.value=c),x],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:G(o).is_linux_environment?"/mnt/hdd/Records/2025年春アニメ":"E:\\Records\\2025年春アニメ"},null,8,["disabled","modelValue","placeholder"])]),e("div",yr,[a[18]||(a[18]=Ee('<div class="reservation-recording-settings__label" data-v-de631340>録画ファイル名テンプレート (マクロ)</div><div class="reservation-recording-settings__description" data-v-de631340> 空欄にすると、デフォルトの録画ファイル名テンプレート (マクロ) が録画ファイル名の変更に利用されます。<br data-v-de631340><div class="mt-1" data-v-de631340><a class="link" href="https://github.com/xtne6f/EDCB/blob/work-plus-s/Document/Readme_EpgTimer.txt#L929-L1008" target="_blank" data-v-de631340>テンプレート構文の一覧</a> / <a class="link" href="https://github.com/xtne6f/EDCB/blob/work-plus-s/Document/Readme_Mod.txt#%E3%83%9E%E3%82%AF%E3%83%AD" target="_blank" data-v-de631340>xtne6f 版での追加差分</a></div></div>',2)),t(A,{disabled:r.reservation.is_recording_in_progress,modelValue:f.value,"onUpdate:modelValue":[a[3]||(a[3]=c=>f.value=c),x],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:"$ZtoH(Title)$.ts"},null,8,["disabled","modelValue"])]),e("div",wr,[a[20]||(a[20]=e("div",{class:"reservation-recording-settings__label"},"録画マージン (秒)",-1)),a[21]||(a[21]=e("div",{class:"reservation-recording-settings__description"}," 番組開始時刻の何秒前から録画を開始し、番組終了時刻の何秒後に録画を終了するかの設定です。最低でも5秒以上をおすすめします。(0秒だと番組の冒頭/末尾が欠けてしまいます。) ",-1)),e("div",Vr,[t(Oe,{disabled:r.reservation.is_recording_in_progress,id:"use-default-margin",modelValue:C.value,"onUpdate:modelValue":[a[4]||(a[4]=c=>C.value=c),L],color:"primary",density:"compact","hide-details":""},null,8,["disabled","modelValue"]),a[19]||(a[19]=e("label",{class:"reservation-recording-settings__margin-default-text",for:"use-default-margin",style:{"user-select":"none"}}," デフォルト設定を使う ",-1))]),e("div",kr,[t(A,{disabled:r.reservation.is_recording_in_progress||C.value,modelValue:i.value.recording_start_margin,"onUpdate:modelValue":[a[5]||(a[5]=c=>i.value.recording_start_margin=c),x],modelModifiers:{number:!0},color:"primary",variant:"outlined",density:"compact",type:"number","hide-details":"",prefix:"番組開始",suffix:"秒前",style:{width:"160px"}},null,8,["disabled","modelValue"]),t(A,{disabled:r.reservation.is_recording_in_progress||C.value,modelValue:i.value.recording_end_margin,"onUpdate:modelValue":[a[6]||(a[6]=c=>i.value.recording_end_margin=c),x],modelModifiers:{number:!0},color:"primary",variant:"outlined",density:"compact",type:"number","hide-details":"",prefix:"番組終了",suffix:"秒後",style:{width:"166px"}},null,8,["disabled","modelValue"])])]),e("div",xr,[a[22]||(a[22]=e("div",{class:"reservation-recording-settings__label"},"字幕データ録画設定",-1)),a[23]||(a[23]=e("div",{class:"reservation-recording-settings__description"},[y(" 字幕データはほとんど録画容量を消費しません。"),e("br"),y(" [録画する] に設定しておくことを強くおすすめします。 ")],-1)),t(z,{disabled:r.reservation.is_recording_in_progress,modelValue:i.value.caption_recording_mode,"onUpdate:modelValue":[a[7]||(a[7]=c=>i.value.caption_recording_mode=c),x],items:$,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue"])]),e("div",Cr,[a[24]||(a[24]=e("div",{class:"reservation-recording-settings__label"},"データ放送録画設定",-1)),a[25]||(a[25]=e("div",{class:"reservation-recording-settings__description"},[y(" データ放送は30分で 500MB 以上録画容量を消費する上、KonomiTV は録画再生時のデータ放送表示に非対応です。"),e("br"),y(" [録画しない] に設定しておくことを強くおすすめします。 ")],-1)),t(z,{disabled:r.reservation.is_recording_in_progress,modelValue:i.value.data_broadcasting_recording_mode,"onUpdate:modelValue":[a[8]||(a[8]=c=>i.value.data_broadcasting_recording_mode=c),x],items:R,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue"])]),e("div",Pr,[a[26]||(a[26]=e("div",{class:"reservation-recording-settings__label"},"録画後動作設定",-1)),a[27]||(a[27]=e("div",{class:"reservation-recording-settings__description"}," 通常は [何もしない] のままで大丈夫です。録画後に録画 PC をスリープさせておきたい方のみ設定してください。環境によっては復帰できず以降の録画に失敗することがあります。 ",-1)),t(z,{disabled:r.reservation.is_recording_in_progress,modelValue:i.value.post_recording_mode,"onUpdate:modelValue":[a[9]||(a[9]=c=>i.value.post_recording_mode=c),x],items:U,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue"])]),e("div",Dr,[a[28]||(a[28]=e("div",{class:"reservation-recording-settings__label"},"録画後実行スクリプトのパス",-1)),e("div",$r," 通常は空欄のままで大丈夫です。録画後に指定の "+V(G(o).is_linux_environment?".sh / .lua":".bat / .ps1 / .lua")+" スクリプトを実行させたい方のみ設定してください。 ",1),t(A,{disabled:r.reservation.is_recording_in_progress,modelValue:i.value.post_recording_bat_file_path,"onUpdate:modelValue":[a[10]||(a[10]=c=>i.value.post_recording_bat_file_path=c),x],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:G(o).is_linux_environment?"/var/local/edcb/transcode.sh":"C:\\DTV\\EDCB\\Transcode.bat"},null,8,["disabled","modelValue","placeholder"])])])}}}),Er=Z(Sr,[["__scopeId","data-v-de631340"]]),oa={is_enabled:!0,priority:2,recording_folders:[],recording_start_margin:null,recording_end_margin:null,recording_mode:"SpecifiedService",caption_recording_mode:"Default",data_broadcasting_recording_mode:"Default",post_recording_mode:"Default",post_recording_bat_file_path:null,is_event_relay_follow_enabled:!0,is_exact_recording_enabled:!1,is_oneseg_separate_output_enabled:!1,is_sequential_recording_in_single_file_enabled:!1,forced_tuner_id:null};class J{static async fetchReservations(){const u=await p.get("/recording/reservations");return u.type==="error"?(p.showGenericError(u,"録画予約一覧を取得できませんでした。"),null):u.data}static async fetchReservation(u){const n=await p.get(`/recording/reservations/${u}`);return n.type==="error"?(p.showGenericError(n,"録画予約情報を取得できませんでした。"),null):n.data}static async addReservation(u,n){const _={program_id:u,record_settings:n},o=await p.post("/recording/reservations",_);if(o.type==="error"){switch(o.data.detail){case"This API is only available when the backend is EDCB":p.showGenericError(o,"この機能は EDCB バックエンド利用時のみ使用できます。");break;case"Specified program was not found":p.showGenericError(o,"指定された番組が見つかりませんでした。");break;case"Specified channel was not found":p.showGenericError(o,"指定されたチャンネルが見つかりませんでした。");break;case"The same program_id is already reserved":p.showGenericError(o,"この番組は既に録画予約されています。");break;case"Failed to add a recording reservation":p.showGenericError(o,"録画予約の追加に失敗しました。");break;default:p.showGenericError(o,"録画予約の追加に失敗しました。");break}return!1}return!0}static async updateReservation(u,n){const _={record_settings:n},o=await p.put(`/recording/reservations/${u}`,_);if(o.type==="error"){switch(o.data.detail){case"This API is only available when the backend is EDCB":p.showGenericError(o,"この機能は EDCB バックエンド利用時のみ使用できます。");break;case"Specified reservation_id was not found":p.showGenericError(o,"指定された録画予約が見つかりませんでした。");break;case"Failed to update the specified recording reservation":p.showGenericError(o,"録画予約の更新に失敗しました。");break;default:p.showGenericError(o,"録画予約の更新に失敗しました。");break}return null}return o.data}static async deleteReservation(u){const n=await p.delete(`/recording/reservations/${u}`);if(n.type==="error"){switch(n.data.detail){case"This API is only available when the backend is EDCB":p.showGenericError(n,"この機能は EDCB バックエンド利用時のみ使用できます。");break;case"Specified reservation_id was not found":p.showGenericError(n,"指定された録画予約が見つかりませんでした。");break;case"Failed to delete the specified recording reservation":p.showGenericError(n,"録画予約の削除に失敗しました。");break;default:p.showGenericError(n,`録画予約 (ID: ${u}) の削除に失敗しました。`);break}return!1}return!0}}const Rr=Re("serverSettings",()=>{const r=P(structuredClone(Ue)),u=P(!1),n=P(!1);let _=null;async function o(){return u.value?r.value:_!==null?await _:(n.value=!0,_=Be.fetchServerSettings().then(i=>(i!==null&&(r.value=i,u.value=!0),i)).finally(()=>{n.value=!1,_=null}),await _)}return{server_settings:r,is_loaded:u,is_loading:n,fetchServerSettingsOnce:o}}),Ur={class:"reservation-detail-drawer__header"},Br={class:"reservation-detail-drawer__tab-text"},Ir={class:"reservation-detail-drawer__content"},Tr={key:0,class:"reservation-detail-drawer__info"},Fr={key:0,class:"status-banner status-banner--warning mb-4"},Lr={key:1,class:"status-banner status-banner--error mb-4"},Mr={key:2,class:"status-banner status-banner--info mb-4"},Ar={key:1,class:"reservation-detail-drawer__settings"},Gr={key:0,class:"reservation-detail-drawer__footer"},Or={class:"reservation-detail-drawer__actions"},Hr={key:1,class:"reservation-detail-drawer__footer"},Nr={class:"reservation-detail-drawer__actions"},jr={key:0,class:"mb-4"},qr=["innerHTML"],zr={class:"text-body-2 text-text-darken-1"},Jr={key:1,class:"warning-banner warning-banner--recording"},Kr={key:2,class:"warning-banner warning-banner--normal"},Qr={key:3,class:"warning-banner warning-banner--keyword mt-3"},Wr={class:"warning-banner warning-banner--normal"},Yr=Y({__name:"ReservationDetailDrawer",props:{reservation:{},program:{},channel:{},isPastProgram:{type:Boolean},modelValue:{type:Boolean}},emits:["update:modelValue","updated","deleted","added"],setup(r,{emit:u}){const n=r,_=u,o=h({get:()=>n.modelValue,set:l=>_("update:modelValue",l)}),i=Rr(),S=h(()=>i.server_settings),m=P("info"),f=P(!1),E=P(!1),C=P(!1),$=P(null),R=P(!1),U=P(!1),B=h(()=>n.reservation!==null),x=h(()=>n.reservation!==null&&n.reservation.id===-1),L=h(()=>B.value&&!x.value),w=h(()=>{var l;return((l=n.reservation)==null?void 0:l.program)??n.program??null}),a=h(()=>S.value.general.backend==="EDCB"),I=h(()=>B.value&&!n.isPastProgram),c=h(()=>x.value&&!n.isPastProgram),ve=h(()=>{var l;return((l=n.reservation)==null?void 0:l.comment.includes("EPG自動予約"))??!1}),_e=h(()=>{var l;return((l=n.reservation)==null?void 0:l.is_recording_in_progress)??!1}),ee=h(()=>{var l;return((l=n.reservation)==null?void 0:l.recording_availability)??"Full"}),me=h(()=>ee.value==="Partial"),pe=h(()=>ee.value==="Unavailable");ge(async()=>{await i.fetchServerSettingsOnce()}),W(o,l=>{l?(m.value="info",f.value=!1,document.documentElement.classList.add("v-overlay-scroll-blocked")):document.documentElement.classList.remove("v-overlay-scroll-blocked")});const H=()=>{if(f.value){U.value=!0;return}o.value=!1},fe=()=>{U.value=!1,f.value=!1,o.value=!1},be=l=>{$.value=l},he=async()=>{if(!f.value||E.value||!$.value||!n.reservation)return;const l=$.value.caption_recording_mode==="Default",s=$.value.data_broadcasting_recording_mode==="Default";if(l!==s){F.warning("字幕データ録画設定・データ放送録画設定を明示的に設定する際は、両方とも「デフォルト設定を使う」以外に設定してください。");return}E.value=!0;try{if(await J.updateReservation(n.reservation.id,$.value)){F.success("録画設定の変更を保存しました。");const D={...n.reservation,record_settings:$.value};_("updated",D),f.value=!1}}catch(v){console.error("Failed to save settings:",v),F.error("録画設定の保存に失敗しました。")}finally{E.value=!1}},ye=()=>{R.value=!0},we=async()=>{if(R.value=!1,!!n.reservation)try{await J.deleteReservation(n.reservation.id)&&(F.success("録画予約を削除しました。"),_("deleted",n.reservation.id),o.value=!1)}catch(l){console.error("Failed to delete reservation:",l)}},Ve=async()=>{if(!(C.value||!w.value||!n.reservation)){if(!a.value){F.error("録画予約機能は EDCB バックエンド利用時のみ使用できます。");return}C.value=!0;try{const l=$.value??n.reservation.record_settings,s=l.caption_recording_mode==="Default",v=l.data_broadcasting_recording_mode==="Default";if(s!==v){F.warning("字幕データ録画設定・データ放送録画設定を明示的に設定する際は、両方とも「デフォルト設定を使う」以外に設定してください。"),C.value=!1;return}await J.addReservation(w.value.id,l)&&(F.success("録画予約を追加しました。"),_("added"),o.value=!1)}catch(l){console.error("Failed to add reservation:",l),F.error("録画予約の追加に失敗しました。")}finally{C.value=!1}}};return(l,s)=>{const v=X("Icon");return d(),g(Q,null,[e("div",{class:M(["reservation-detail-drawer__scrim",{"reservation-detail-drawer__scrim--visible":o.value}]),onClick:H},null,2),e("div",{class:M(["reservation-detail-drawer",{"reservation-detail-drawer--visible":o.value}])},[e("div",Ur,[e("div",{class:M(["reservation-detail-drawer__tabs",{"reservation-detail-drawer__tabs--single":!I.value}])},[N((d(),g("div",{class:M(["reservation-detail-drawer__tab",{"reservation-detail-drawer__tab--active":m.value==="info"}]),onClick:s[0]||(s[0]=D=>m.value="info")},[t(v,{icon:"fluent:info-12-regular",width:"20px",height:"20px"}),e("span",Br,"番組情報 "+V(I.value?"":"（終了済み）"),1)],2)),[[q]]),I.value?N((d(),g("div",{key:0,class:M(["reservation-detail-drawer__tab",{"reservation-detail-drawer__tab--active":m.value==="settings"}]),onClick:s[1]||(s[1]=D=>m.value="settings")},[t(v,{icon:"material-symbols:settings-video-camera-outline-rounded",width:"20px",height:"20px"}),s[7]||(s[7]=e("span",{class:"reservation-detail-drawer__tab-text"},"録画設定",-1))],2)),[[q]]):k("",!0)],2),N((d(),g("div",{class:"reservation-detail-drawer__close",onClick:H},[t(v,{icon:"fluent:dismiss-16-filled",width:"22px",height:"22px"})])),[[q]])]),e("div",Ir,[m.value==="info"?(d(),g("div",Tr,[me.value?(d(),g("div",Fr,[t(v,{icon:"fluent:warning-16-filled",class:"status-banner__icon"}),s[8]||(s[8]=e("span",{class:"status-banner__text"},[y(" チューナー不足のため、この番組は一部のみ録画されます。"),e("br"),y(" 優先度を上げるか、重複する録画予約を調整してください。 ")],-1))])):k("",!0),pe.value?(d(),g("div",Lr,[t(v,{icon:"fluent:error-circle-16-filled",class:"status-banner__icon"}),s[9]||(s[9]=e("span",{class:"status-banner__text"},[y(" チューナー不足のため、この番組は録画できません。"),e("br"),y(" 優先度を上げるか、重複する録画予約を削除してください。 ")],-1))])):k("",!0),!a.value&&!r.isPastProgram&&!B.value?(d(),g("div",Mr,[t(v,{icon:"fluent:info-16-regular",class:"status-banner__icon"}),s[10]||(s[10]=e("span",{class:"status-banner__text"}," 録画予約機能は EDCB バックエンド利用時のみ使用できます。 ",-1))])):k("",!0),t(gr,{reservation:r.reservation,program:r.program,channel:r.channel},null,8,["reservation","program","channel"])])):k("",!0),m.value==="settings"&&r.reservation?(d(),g("div",Ar,[t(Er,{reservation:r.reservation,"has-changes":f.value,onUpdateSettings:be,onChangesDetected:s[2]||(s[2]=D=>f.value=D)},null,8,["reservation","has-changes"])])):k("",!0)]),r.isPastProgram?(d(),g("div",Hr,[e("div",Nr,[t(T,{class:"px-3",variant:"text",onClick:H},{default:b(()=>[t(v,{icon:"fluent:dismiss-16-regular",width:"20px",height:"20px"}),s[14]||(s[14]=e("span",{class:"ml-1"},"閉じる",-1))]),_:1})])])):(d(),g("div",Gr,[e("div",Or,[L.value?(d(),j(T,{key:0,class:"px-3",variant:"text",onClick:ye},{default:b(()=>[t(v,{icon:"fluent:delete-16-regular",width:"20px",height:"20px"}),s[11]||(s[11]=e("span",{class:"ml-1"},"予約を削除",-1))]),_:1})):k("",!0),L.value&&m.value==="settings"?(d(),j(T,{key:1,class:"px-3",color:"secondary",variant:"flat",disabled:!f.value,loading:E.value,onClick:he},{default:b(()=>[t(v,{icon:"fluent:save-16-regular",width:"20px",height:"20px"}),s[12]||(s[12]=e("span",{class:"ml-1"},"変更を保存",-1))]),_:1},8,["disabled","loading"])):k("",!0),c.value?(d(),j(T,{key:2,class:"px-3",color:"secondary",variant:"flat",disabled:!a.value,loading:C.value,onClick:Ve},{default:b(()=>[t(v,{icon:"fluent:timer-16-regular",width:"20px",height:"20px"}),s[13]||(s[13]=e("span",{class:"ml-1"},"予約を追加",-1))]),_:1},8,["disabled","loading"])):k("",!0)])]))],2),t(ie,{modelValue:R.value,"onUpdate:modelValue":s[4]||(s[4]=D=>R.value=D),"max-width":"715"},{default:b(()=>[t(oe,null,{default:b(()=>[t(le,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:b(()=>[...s[15]||(s[15]=[y(" 録画予約を削除しますか？ ",-1)])]),_:1}),t(de,{class:"pt-2 pb-0"},{default:b(()=>[r.reservation?(d(),g("div",jr,[e("div",{class:"text-h6 text-text mb-2",innerHTML:G(K).decorateProgramInfo(r.reservation.program,"title")},null,8,qr),e("div",zr,V(G(K).getProgramTime(r.reservation.program)),1)])):k("",!0),_e.value&&r.reservation?(d(),g("div",Jr,[t(v,{icon:"fluent:warning-16-filled",class:"warning-banner__icon"}),s[16]||(s[16]=e("span",{class:"warning-banner__text"},[y(" この番組は現在録画中です。"),e("br"),y(" 予約を削除すると、現在までの録画ファイルは残りますが、残りの期間の録画は中断されます。 ")],-1))])):r.reservation?(d(),g("div",Kr,[t(v,{icon:"fluent:info-16-regular",class:"warning-banner__icon"}),s[17]||(s[17]=e("span",{class:"warning-banner__text"}," 録画予約を削除すると、番組開始時刻までに再度予約を追加しない限り、この番組は録画されません。 ",-1))])):k("",!0),ve.value&&r.reservation?(d(),g("div",Qr,[t(v,{icon:"fluent:warning-16-filled",class:"warning-banner__icon"}),s[18]||(s[18]=e("span",{class:"warning-banner__text"},[y(" この予約はキーワード自動予約で追加されました。削除してもすぐに再追加される可能性があります。"),e("br"),y(" 録画が不要な場合は削除ではなく「無効」にすることをおすすめします。 ")],-1))])):k("",!0)]),_:1}),t(ue,{class:"pt-4 px-6 pb-6"},{default:b(()=>[t(ce),t(T,{color:"text",variant:"text",onClick:s[3]||(s[3]=D=>R.value=!1)},{default:b(()=>[t(v,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),s[19]||(s[19]=e("span",{class:"ml-1"},"キャンセル",-1))]),_:1}),t(T,{class:"px-3",color:"error",variant:"flat",onClick:we},{default:b(()=>[t(v,{icon:"fluent:delete-20-regular",width:"18px",height:"18px"}),s[20]||(s[20]=e("span",{class:"ml-1"},"予約を削除",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ie,{modelValue:U.value,"onUpdate:modelValue":s[6]||(s[6]=D=>U.value=D),"max-width":"500"},{default:b(()=>[t(oe,null,{default:b(()=>[t(le,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:b(()=>[...s[21]||(s[21]=[y(" 変更を破棄しますか？ ",-1)])]),_:1}),t(de,{class:"pt-2 pb-0"},{default:b(()=>[e("div",Wr,[t(v,{icon:"fluent:info-16-regular",class:"warning-banner__icon"}),s[22]||(s[22]=e("span",{class:"warning-banner__text"},[y(" 録画設定の変更がまだ保存されていません。"),e("br"),y(" このまま閉じると、変更内容は破棄されます。 ")],-1))])]),_:1}),t(ue,{class:"pt-4 px-6 pb-6"},{default:b(()=>[t(ce),t(T,{color:"text",variant:"text",onClick:s[5]||(s[5]=D=>U.value=!1)},{default:b(()=>[t(v,{icon:"fluent:arrow-left-20-regular",width:"18px",height:"18px"}),s[23]||(s[23]=e("span",{class:"ml-1"},"編集に戻る",-1))]),_:1}),t(T,{class:"px-3",color:"secondary",variant:"flat",onClick:fe},{default:b(()=>[t(v,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),s[24]||(s[24]=e("span",{class:"ml-1"},"変更を破棄",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),la=Z(Yr,[["__scopeId","data-v-a317a8d7"]]);export{oa as I,la as R,J as a,Rr as u};
