import{H as pa,N as ya}from"./Navigation-BgRKLSNg.js";import{u as _a,R as ba}from"./ReservationDetailDrawer-BpN0FG7Z.js";import{T as ve,a as ka}from"./TimeTableSettings-D7Y67QAH.js";import{S as Sa}from"./SPHeaderBar-f4zP5ny9.js";import{F as Be,d,X as Pe,w as ct,r as Nt,M as ge,Z as Qe,a0 as re,J as X,L as R,a5 as _e,O as Te,U as Y,_ as Ie,a6 as Da,Q as Ye,G as _,a7 as Re,a8 as F,a9 as be,aa as Ta,ab as Je,ac as vt,H as Z,N as ue,$ as Ke,c as o,a4 as Pt,P as q,Y as Ue,ad as Ce,a1 as De,a2 as Ae,ae as wa,af as Ct,g as we,p as ke,u as He,I as Xe,a as mt,V as Ze,ag as Pa,ah as Ee,ai as xe,aj as qe,ak as Ca,K as dt,al as $e,am as Wt,an as Ut,ao as he,ap as Ft,aq as xa,x as Ha,z as Gt,ar as Ma,b as Va,j as Ba,as as Ia,at as Oa,k as Aa,B as Ra,l as $a,n as Ya,au as Ea,av as La,q as Na,f as Wa,m as Ua,aw as Fa,ax as Ga,ay as ja,S as ut}from"./index-LUcZSfg3.js";import{u as za,P as Xa}from"./ChannelsStore-Bh6nu84X.js";import{R as Fe,I as xt}from"./Reservations-Bw3X7ADR.js";import{V as Ge,a as Ht}from"./VSelect-BmKGxRth.js";import{V as qa,c as Ka}from"./VSpacer-ChgMJFbm.js";import{M as jt}from"./VAvatar-DFvMdaEn.js";import{b as Qa}from"./VTextField-BDf-Yp3u.js";import"./BottomNavigation-DprrKkNz.js";import"./VSwitch-BUkBw4sR.js";import"./VSelectionControl-B5SCUdJT.js";import"./lazy-BNtSIMgY.js";import"./VSlider-B5M6i1zC.js";import"./VDialog-BBKQPlvn.js";import"./VCard-BS7Vnm3K.js";import"./VDivider-BSQIFqDW.js";const Ja={class:"timetable-channel-header__logo-wrapper"},Za=["src","alt"],el={class:"timetable-channel-header__info"},tl={class:"timetable-channel-header__number"},al={class:"timetable-channel-header__name"},ll=Be({__name:"TimeTableChannelHeader",props:{channel:{},width:{},height:{}},setup(e){const l=e,v=d(()=>Math.round(Math.min(46,Math.max(32,l.width*.27)))),s=d(()=>Math.round(v.value*(3/4))),t=d(()=>Math.min(14,Math.max(13,l.width*.06))),g=d(()=>Math.min(13.5,Math.max(Pe.isSmartphoneVertical()?10:12,l.width*.08))),r=d(()=>`${l.channel.name} を視聴`);return(m,a)=>{const i=Qe("router-link"),c=Nt("ftooltip");return ct((Y(),ge(i,{class:"timetable-channel-header",to:`/tv/watch/${e.channel.display_channel_id}`,style:re({width:`${e.width}px`,height:`${e.height}px`,"--timetable-channel-logo-width":`${v.value}px`,"--timetable-channel-logo-height":`${s.value}px`,"--timetable-channel-number-size":`${t.value}px`,"--timetable-channel-name-size":`${g.value}px`})},{default:X(()=>[R("div",Ja,[R("img",{class:"timetable-channel-header__logo",loading:"lazy",decoding:"async",src:`${_e(Pe).api_base_url}/channels/${e.channel.id}/logo`,alt:e.channel.name},null,8,Za)]),R("div",el,[R("span",tl,Te(e.channel.channel_number),1),R("span",al,Te(e.channel.name),1)])]),_:1},8,["to","style"])),[[c,r.value,void 0,{bottom:!0}]])}}}),nl=Ie(ll,[["__scopeId","data-v-eed1aa3d"]]),zt=["ピン留め","地デジ","BS","CS","CATV","SKY","BS4K"],il=new Map([["地デジ","GR"],["BS","BS"],["CS","CS"],["CATV","CATV"],["SKY","SKY"],["BS4K","BS4K"]]),Le=Da("timetable",()=>{const e=Ye(),l=za(),v=_(null),s=_(T()),t=_({x:0,y:0}),g=Re([]),r=_(null),m=_(null),a=_(!1),i=_(!1),c=_(!0),u=_(!1),x=_(null);function G(){const f=F(),D=T();if(s.value.isSame(D,"day")===!1)return!1;let $=f.hour();return $<4&&($+=24),$>=17}function b(){const f=F(),D=T();if(s.value.isSame(D,"day")===!1)return null;const $=f.startOf("hour").subtract(1,"hour"),le=w();return $.isBefore(le)?le:$}function w(){return u.value?s.value.add(12,"hour"):s.value}function T(){const f=F();let D=f.hour(4).minute(0).second(0).millisecond(0);return f.hour()<4&&(D=D.subtract(1,"day")),D}function H(f,D=!1){return D?f.add(36,"hour"):f.add(1,"day")}const y=d(()=>u.value?s.value.add(12,"hour"):s.value),E=d(()=>u.value?y.value.add(36,"hour"):s.value.add(24,"hour")),W=d(()=>{if(r.value===null)return[];const f=[];let D=r.value.earliest.hour(4).minute(0).second(0).millisecond(0);r.value.earliest.hour()<4&&(D=D.subtract(1,"day"));const $=r.value.latest;for(;D.isSameOrBefore($);)f.push(D),D=D.add(1,"day");return f}),U=d(()=>{const f=new Set;if(l.is_channels_list_initial_updated===!1)return f;for(const D of l.channels_list_with_pinned.keys()){if(D==="ピン留め"){const $=l.channels_list_with_pinned.get("ピン留め");if($===void 0||$.length===0)continue}f.add(D)}return f});function ne(){return v.value===null?K():U.value.has(v.value)?null:K()}function K(){if(U.value.has("ピン留め"))return"ピン留め";if(U.value.has("地デジ"))return"地デジ";for(const f of zt)if(U.value.has(f))return f;return"地デジ"}async function j(f,D,$,le){u.value=G(),x.value=b();const se=f??w(),k=D??H(se,u.value),p=$??v.value??"地デジ",O=p==="ピン留め"?le??e.settings.pinned_channel_ids:void 0,oe=il.get(p),V=await Xa.fetchTimeTable(se,k,oe,O);return V===null?!1:(g.value=V.channels,r.value={earliest:F(V.date_range.earliest),latest:F(V.date_range.latest)},!0)}async function S(){a.value=!0,i.value=!1,m.value=null;try{if(await l.update(),s.value=T(),v.value=K(),await j()===!1){a.value=!1;return}i.value=!0}finally{a.value=!1}}async function M(f){a.value=!0,m.value=null;try{s.value=f,await j()}finally{a.value=!1}}async function A(f){a.value=!0,m.value=null;try{v.value=f,await j()}finally{a.value=!1}}async function ee(){if(r.value===null)return;const f=s.value.subtract(1,"day");f.isBefore(r.value.earliest,"day")||await M(f)}async function ie(){if(r.value===null)return;const f=s.value.add(1,"day");f.isAfter(r.value.latest,"day")||await M(f)}async function Q(){c.value=!0;const f=T();s.value.isSame(f,"day")===!1&&await M(f)}function ae(f){m.value=f}function L(f,D){t.value={x:f,y:D}}function pe(){c.value=!1}function Se(){c.value=!0}function C(){g.value=[],r.value=null,m.value=null,a.value=!1,i.value=!1,c.value=!0,u.value=!1,x.value=null,t.value={x:0,y:0},v.value=null}return be(()=>e.settings.pinned_channel_ids,async(f,D)=>{v.value==="ピン留め"&&i.value!==!1&&Ta(f,D)===!1&&await j()},{deep:!0}),be(()=>l.channels_list_with_pinned,async()=>{if(i.value===!1)return;const f=ne();f!==null&&await A(f)},{deep:!0}),{selected_channel_type:v,selected_date:s,scroll_position:t,channels_data:g,date_range:r,selected_program_id:m,is_loading:a,is_initial_load_completed:i,is_auto_scroll_enabled:c,is_36hour_display:u,scroll_top_limit_time:x,selectable_dates:W,available_channel_types:U,display_start_time:y,display_end_time:E,getTodayStartTime:T,getDayEndTime:H,getDisplayStartTime:w,fetchTimeTableData:j,initialLoad:S,changeDate:M,changeChannelType:A,goToPreviousDay:ee,goToNextDay:ie,goToCurrentTime:Q,selectProgram:ae,updateScrollPosition:L,disableAutoScroll:pe,enableAutoScroll:Se,reset:C}}),ol=Be({__name:"TimeTableCurrentTimeLine",props:{selectedDate:{},hourHeight:{},totalWidth:{},channelHeaderHeight:{}},setup(e){const l=e,v=Le(),s=_(F());let t=null,g=null;const r=d(()=>{const a=s.value,i=v.getDisplayStartTime(),c=v.getDayEndTime(i,v.is_36hour_display);return a.isSameOrAfter(i)&&a.isBefore(c)}),m=d(()=>{if(!r.value)return 0;const a=v.getDisplayStartTime();return ve.calculateCurrentTimeY(s.value,a,l.hourHeight,l.channelHeaderHeight)-l.channelHeaderHeight});return Je(()=>{const a=F(),i=a.add(1,"minute").startOf("minute"),c=Math.max(0,i.valueOf()-a.valueOf());g=setTimeout(()=>{s.value=F(),t=setInterval(()=>{s.value=F()},60*1e3)},c)}),vt(()=>{g!==null&&clearTimeout(g),t!==null&&clearInterval(t)}),(a,i)=>r.value?(Y(),Z("div",{key:0,class:"timetable-current-time-line",style:re({top:`${m.value}px`,width:`${e.totalWidth}px`})},[...i[0]||(i[0]=[R("div",{class:"timetable-current-time-line__indicator"},null,-1),R("div",{class:"timetable-current-time-line__line"},null,-1)])],4)):ue("",!0)}}),sl=Ie(ol,[["__scopeId","data-v-9c632953"]]),rl={class:"timetable-program-cell__content"},ul={class:"timetable-program-cell__header"},cl={class:"timetable-program-cell__start-minute"},dl={key:0,class:"timetable-program-cell__reservation-icon"},vl={key:0,class:"timetable-program-cell__recording-icon"},ml=["innerHTML"],fl=["innerHTML"],hl={key:0,class:"timetable-program-cell__actions"},gl="fluent:timer-16-filled",pl="mdi:timer-pause-outline",yl=Be({__name:"TimeTableProgramCell",props:{program:{},channel:{},selectedDate:{},hourHeight:{},channelWidth:{},fullChannelWidth:{},viewportHeight:{},channelHeaderHeight:{},isScrollAtBottom:{type:Boolean},isSubchannel:{type:Boolean},isSplit:{type:Boolean},isSelected:{type:Boolean},isPast:{type:Boolean},is36HourDisplay:{type:Boolean}},emits:["click","show-detail","quick-reserve"],setup(e,{emit:l}){const v=new Map;function s(C,f){const D=C.title,$=C.description;if(D===null||$===null)return Ue.decorateProgramInfo(C,f);const le=v.get(C.id);if(le===void 0||le.raw_title!==D||le.raw_description!==$){const k=Ue.decorateProgramInfo(C,"title"),p=Ue.decorateProgramInfo(C,"description");v.set(C.id,{raw_title:D,raw_description:$,title:k,description:p})}const se=v.get(C.id);return se===void 0?Ue.decorateProgramInfo(C,f):f==="title"?se.title:se.description}const t=e,g=l,r=Ye(),m=Le(),a=_(!1),i=_(null),c=_(0),u=d(()=>Pe.isTouchDevice()?t.isSelected:t.isSelected||r.settings.timetable_hover_expand&&a.value),x=d(()=>t.program.reservation!==null),G=d(()=>{var C;return((C=t.program.reservation)==null?void 0:C.status)==="Recording"}),b=d(()=>{var C;return((C=t.program.reservation)==null?void 0:C.status)==="Disabled"}),w=d(()=>{var C;return((C=t.program.reservation)==null?void 0:C.recording_availability)==="Partial"}),T=d(()=>{var C;return((C=t.program.reservation)==null?void 0:C.recording_availability)==="Unavailable"}),H=d(()=>T.value?"rgb(var(--v-theme-error))":w.value?"rgb(var(--v-theme-warning))":b.value?"rgb(var(--v-theme-text-darken-2))":"rgb(var(--v-theme-success))"),y=d(()=>b.value?pl:gl),E=d(()=>x.value?b.value?"mdi:timer-play-outline":"mdi:timer-pause-outline":"mdi:timer-plus-outline"),W=d(()=>x.value?b.value?"予約を有効化":"予約を無効化":"録画予約"),U=d(()=>F(t.program.start_time).minute().toString().padStart(2,"0")),ne=d(()=>{var D,$;const C=($=(D=t.program.genres)==null?void 0:D[0])==null?void 0:$.major;return ve.getGenreColors(C,r.settings.timetable_genre_colors).highlight}),K=d(()=>t.isPast?"#b0b0b0":ne.value),j=d(()=>{var D,$;if(t.isPast)return"#e6e6e6";if(T.value)return"#f8d7da";if(w.value)return"#fff3cd";const C=($=(D=t.program.genres)==null?void 0:D[0])==null?void 0:$.major;return ve.getGenreColors(C,r.settings.timetable_genre_colors).background}),S=d(()=>{const C=F(t.program.start_time),f=m.getDisplayStartTime();return ve.calculateProgramY(C,f,t.hourHeight,t.channelHeaderHeight)-t.channelHeaderHeight}),M=d(()=>(t.is36HourDisplay?36:24)*t.hourHeight),A=d(()=>{const C=ve.calculateProgramHeight(t.program.duration,t.hourHeight);if(S.value+C>M.value){const D=M.value-S.value;return Math.max(D,20)}return Math.max(C,20)}),ee=d(()=>{const C=t.fullChannelWidth??t.channelWidth,f=t.isSplit===!0&&t.channelWidth<C,D=u.value&&c.value>0?c.value:A.value,$=t.isSubchannel&&f?t.channelWidth:0,le=u.value&&f?0:$,se=u.value&&f?C:t.channelWidth,k={top:`${S.value}px`,left:`${le}px`,width:`${se}px`,minHeight:`${A.value}px`,background:j.value,"--timetable-cell-height":`${D}px`};if(u.value||(k.height=`${A.value}px`),u.value&&t.viewportHeight>0&&t.isScrollAtBottom===!0){const p=c.value>0?c.value:A.value,O=Math.max(0,M.value-t.viewportHeight),oe=O+t.viewportHeight,V=S.value+p,J=S.value+A.value>=M.value-1;if(V>oe&&J){const me=V-oe,ce=Math.max(0,S.value-O),z=Math.min(me,ce);z>0&&(k.transform=`translateY(-${z}px)`)}}return k}),ie=d(()=>s(t.program,"title")),Q=d(()=>s(t.program,"description"));function ae(){g("click")}function L(){a.value=!0}function pe(){a.value=!1}function Se(){g("quick-reserve")}return be(u,async C=>{if(C===!1){c.value=0;return}await Ce(),i.value!==null&&(c.value=Math.max(i.value.getBoundingClientRect().height,A.value))}),(C,f)=>{const D=Qe("Icon");return Y(),Z("div",{class:Ke(["timetable-program-cell",{"timetable-program-cell--selected":e.isSelected,"timetable-program-cell--expanded":u.value,"timetable-program-cell--past":e.isPast,"timetable-program-cell--subchannel":e.isSubchannel,"timetable-program-cell--reserved":x.value,"timetable-program-cell--recording":G.value,"timetable-program-cell--partial":w.value,"timetable-program-cell--unavailable":T.value,"timetable-program-cell--disabled":b.value}]),ref_key:"cellRef",ref:i,style:re(ee.value),onClick:ae,onMouseenter:L,onMouseleave:pe},[R("div",{class:"timetable-program-cell__highlight",style:re({background:K.value})},null,4),R("div",rl,[R("div",ul,[R("span",cl,Te(U.value),1),x.value?(Y(),Z("div",dl,[o(D,{icon:y.value,width:"14px",style:re({color:H.value})},null,8,["icon","style"]),G.value?(Y(),Z("div",vl)):ue("",!0),w.value?(Y(),ge(D,{key:1,icon:"fluent:warning-16-filled",width:"12px",class:"timetable-program-cell__warning-icon"})):ue("",!0),T.value?(Y(),ge(D,{key:2,icon:"fluent:dismiss-circle-16-filled",width:"12px",class:"timetable-program-cell__error-icon"})):ue("",!0)])):ue("",!0)]),R("div",{class:"timetable-program-cell__title",innerHTML:ie.value},null,8,ml),R("div",{class:"timetable-program-cell__description",innerHTML:Q.value},null,8,fl),u.value?(Y(),Z("div",hl,[o(q,{variant:"flat",size:"small",class:"timetable-program-cell__action-button",onClick:f[0]||(f[0]=Pt($=>C.$emit("show-detail"),["stop"]))},{default:X(()=>[o(D,{icon:"fluent:info-12-regular",width:"16px"}),f[1]||(f[1]=R("span",null,"番組詳細",-1))]),_:1}),e.isPast?ue("",!0):(Y(),ge(q,{key:0,variant:"flat",size:"small",class:Ke(["timetable-program-cell__action-button",{"timetable-program-cell__action-button--reserved":x.value&&!b.value,"timetable-program-cell__action-button--disabled-reservation":b.value}]),onClick:Pt(Se,["stop"])},{default:X(()=>[o(D,{icon:E.value,width:"16px"},null,8,["icon"]),R("span",null,Te(W.value),1)]),_:1},8,["class"]))])):ue("",!0)])],38)}}}),Mt=Ie(yl,[["__scopeId","data-v-0b58c3a6"]]),_l={class:"timetable-time-scale"},bl={class:"timetable-time-scale__label"},kl={key:0,class:"timetable-time-scale__date"},Sl={class:"timetable-time-scale__hour-number"},Dl=Be({__name:"TimeTableTimeScale",props:{selectedDate:{},hourHeight:{},is36HourDisplay:{type:Boolean}},setup(e){const l=e,v=Ye(),s=Le(),t=d(()=>{const i=l.is36HourDisplay?36:24,c=s.display_start_time,u=[];for(let x=0;x<i;x++)u.push(c.add(x,"hour"));return u});function g(i){return ve.getTimeScaleColor(i.hour())}function r(i){const c=i.hour();return v.settings.use_28hour_clock&&c>=0&&c<=3?(c+24).toString().padStart(2,"0"):c.toString().padStart(2,"0")}function m(i){const c=i.hour(),u=s.display_start_time;return!([0,4,8,12,16,20].includes(c)===!1||l.is36HourDisplay&&c===4&&u.hour()===4)}function a(i){return`${i.month()+1}/${i.date()}`}return(i,c)=>(Y(),Z("div",_l,[(Y(!0),Z(De,null,Ae(t.value,u=>(Y(),Z("div",{class:"timetable-time-scale__hour",key:u.valueOf(),style:re({height:`${l.hourHeight}px`,background:g(u)})},[R("div",bl,[m(u)?(Y(),Z("span",kl,Te(a(u)),1)):ue("",!0),R("span",Sl,Te(r(u)),1),c[0]||(c[0]=R("span",{class:"timetable-time-scale__hour-label"},"時",-1))])],4))),128))]))}}),Tl=Ie(Dl,[["__scopeId","data-v-22a4db64"]]),wl={class:"timetable-grid__channel-headers"},Pl={class:"timetable-grid__content"},Cl=2,xl=3,Hl=.5,Vt=1,Ml=60,Vl=2,Bl=120,Bt=.95,je=.5,ze=5,Il=Be({__name:"TimeTableGrid",props:{channels:{},selectedDate:{},isLoading:{type:Boolean},is36HourDisplay:{type:Boolean},canGoPreviousDay:{type:Boolean},canGoNextDay:{type:Boolean}},emits:["scroll-position-change","time-slot-change","date-display-offset-change","program-select","show-program-detail","quick-reserve","go-to-next-day","go-to-previous-day"],setup(e,{expose:l,emit:v}){const s=ve.EMPTY_CELL_BACKGROUND_COLOR,t=e,g=v,r=Ye(),m=Le(),a=_(null),i=_(null),c=_(!1),u=_(!1),x=_(!1);let G=0;const b=_(0),w=_(!1),T=_(0),H=_(0),y=_(0),E=_(0),W=_(null);let U=0,ne=0,K=null,j=null;const S=_(0),M=new Set;let A=null,ee=null,ie=null;const Q=_(!1),ae=_(!1),L=_(!1),pe=_(null),Se=_(0),C=_(0),f=_(0),D=_(0),$=_(!1),le=_(!1),se=_(0),k=_(0),p=_(0),O=_(0),oe=_(0),V=_(0),J=_(null),me=d(()=>ve.getDeviceType()),ce=d(()=>ve.getChannelWidth(r.settings.timetable_channel_width,me.value)),z=d(()=>ve.getHourHeight(r.settings.timetable_hour_height,me.value)),ft=d(()=>me.value==="Smartphone"?xl:Cl),fe=d(()=>ve.getChannelHeaderHeight(ce.value)),et=d(()=>ve.getTimeScaleWidth(me.value,Pe.isSmartphoneVertical())),ht=d(()=>t.channels.length*ce.value),Ne=d(()=>(t.is36HourDisplay?36:24)*z.value);function ea(n){return n.subchannel_programs===null?!1:Object.values(n.subchannel_programs).flat().length>0}const tt=new Map,Me=new Map;function at(n){if(n==null)return{start:0,end:0};const h=tt.get(n.id);if(h!==void 0)return h;const B={start:F(n.start_time).valueOf(),end:F(n.end_time).valueOf()};return tt.set(n.id,B),B}function gt(n,h){const B=at(n);return h.some(P=>{const N=at(P);return N.start<B.end&&N.end>B.start})}function lt(n,h,B){const P=`${h.id}:${B?"sub":"main"}`,N=Me.get(P);if(N!==void 0)return N;if(n.subchannel_programs===null)return Me.set(P,!1),!1;const I=Object.values(n.subchannel_programs).flat();if(I.length===0)return Me.set(P,!1),!1;if(B){const ye=gt(h,n.programs);return Me.set(P,ye),ye}const te=gt(h,I);return Me.set(P,te),te}function pt(n,h,B){return lt(n,h,B)?ce.value/2:ce.value}function Ve(n){const h=z.value*ft.value;T.value=Math.max(0,n-h),H.value=n+b.value+h}function ta(n){const B=z.value*ft.value*Hl,P=n+b.value;return b.value<=0||H.value===0||n<T.value+B||P>H.value-B?(Ve(n),!0):!1}function yt(n){const h=at(n),B=(h.start-S.value)/(1e3*60*60)*z.value;return(h.end-S.value)/(1e3*60*60)*z.value>=T.value&&B<=H.value}function aa(n){return n.subchannel_programs===null?[]:Object.values(n.subchannel_programs).flat()}function _t(n){return F(n.end_time).isBefore(F())}function bt(){if(a.value===null)return;const n=y.value,h=E.value;G=h;const B=a.value.clientHeight-fe.value;b.value!==B&&(b.value=B);const P=a.value.scrollHeight-a.value.clientHeight,N=h>=P-1;w.value!==N&&(w.value=N),ta(h)&&Oe(),(Math.abs(n-U)>=Vt||Math.abs(h-ne)>=Vt)&&(g("scroll-position-change",{x:n,y:h}),U=n,ne=h);const te=h>P-100&&t.canGoNextDay,ye=h<100&&t.canGoPreviousDay;c.value!==te&&(c.value=te),u.value!==ye&&(u.value=ye);const de=m.getDisplayStartTime(),it=Math.floor(h/z.value);let ot=de.add(it,"hour").hour();ot<4&&(ot+=24);const fa=Math.floor((ot-4)/4)*4+4,st=Math.max(4,Math.min(24,fa));if(K!==st&&(g("time-slot-change",st),K=st),t.is36HourDisplay){const ha=r.settings.use_28hour_clock?4:0;let We=de.hour(ha).minute(0).second(0).millisecond(0);We.isSameOrBefore(de)&&(We=We.add(1,"day"));const ga=(We.valueOf()-de.valueOf())/(1e3*60*60)*z.value,rt=h>=ga?1:0;j!==rt&&(g("date-display-offset-change",rt),j=rt)}else j!==0&&(g("date-display-offset-change",0),j=0);kt()}function la(){W.value===null&&(W.value=requestAnimationFrame(()=>{W.value=null,bt()}))}function Oe(){ie===null&&(ie=requestAnimationFrame(()=>{ie=null,St()}))}function kt(){ee===null&&(ee=requestAnimationFrame(()=>{ee=null,na()}))}function St(){a.value!==null&&(A!==null&&(A.disconnect(),M.clear()),A=new IntersectionObserver(n=>{for(const h of n){const B=h.target,P=h.rootBounds;if(P===null)continue;const N=h.intersectionRect.top<=P.top,I=h.intersectionRect.height<h.boundingClientRect.height,te=P.height<h.boundingClientRect.height;if(h.isIntersecting&&N&&(I||te))M.add(B),B.classList.add("timetable-program-cell--fixed");else{M.delete(B),B.classList.remove("timetable-program-cell--fixed");const de=B.querySelector(".timetable-program-cell__content");de!==null&&(de.style.paddingTop="")}}kt()},{root:a.value,rootMargin:`-${fe.value}px 0px 0px 0px`,threshold:[0,1]}),a.value.querySelectorAll(".timetable-program-cell").forEach(n=>{A==null||A.observe(n)}))}function na(){if(a.value===null||M.size===0)return;const n=a.value.getBoundingClientRect().top+fe.value;M.forEach(h=>{const B=h.querySelector(".timetable-program-cell__content");if(B===null)return;const P=h.getBoundingClientRect().top,N=n-P;if(N<=0){B.style.paddingTop="";return}const I=h.style.getPropertyValue("--timetable-cell-height"),te=I?Number.parseFloat(I):h.getBoundingClientRect().height,ye=Math.max(0,te-Ml),de=h.classList.contains("timetable-program-cell--reserved")?3:0,it=Math.min(N,ye);B.style.paddingTop=`${Vl+Math.max(it-de,0)}px`})}function ia(){a.value!==null&&(y.value=a.value.scrollLeft,E.value=a.value.scrollTop,la())}function Dt(n){a.value!==null&&(J.value!==null&&(cancelAnimationFrame(J.value),J.value=null),n.deltaX!==0&&(n.preventDefault(),a.value.scrollLeft+=n.deltaX),n.shiftKey&&n.deltaY!==0?(n.preventDefault(),a.value.scrollLeft+=n.deltaY):n.deltaY!==0&&n.deltaX===0&&(n.preventDefault(),a.value.scrollTop+=n.deltaY))}function oa(n){if(n.pointerType!=="mouse"||a.value===null)return;const h=n.target;h.closest(".v-btn")||h.closest("a")||(ae.value=!0,Q.value=!1,$.value=!1,Se.value=n.clientX,C.value=n.clientY,f.value=a.value.scrollLeft,D.value=a.value.scrollTop,J.value!==null&&(cancelAnimationFrame(J.value),J.value=null),k.value=0,p.value=0,O.value=performance.now(),oe.value=n.clientX,V.value=n.clientY)}function sa(n){if(n.pointerType!=="mouse"||ae.value===!1||a.value===null)return;const h=Se.value-n.clientX,B=C.value-n.clientY;if((Math.abs(h)>ze||Math.abs(B)>ze)&&Q.value===!1&&a.value!==null&&(Q.value=!0,$.value=!0,a.value.setPointerCapture(n.pointerId),L.value=!0,pe.value=n.pointerId),Q.value===!1)return;n.preventDefault(),(Math.abs(h)>ze||Math.abs(B)>ze)&&($.value=!0),a.value.scrollLeft=f.value+h,a.value.scrollTop=D.value+B;const P=performance.now(),N=P-O.value;if(N>0){const I=n.clientX-oe.value,te=n.clientY-V.value;k.value=-I/N*16,p.value=-te/N*16}O.value=P,oe.value=n.clientX,V.value=n.clientY}function Tt(n){if(n.pointerType==="mouse"&&ae.value!==!1){if(ae.value=!1,Q.value=!1,a.value!==null&&L.value&&pe.value!==null)try{a.value.releasePointerCapture(pe.value)}catch{}L.value=!1,pe.value=null,$.value?(ua(),le.value=!0,se.value=performance.now()):(le.value=!1,se.value=0)}}function ra(n){if(le.value===!1)return;performance.now()-se.value<=Bl&&(n.preventDefault(),n.stopPropagation()),le.value=!1}function ua(){if(a.value===null||Math.abs(k.value)<je&&Math.abs(p.value)<je)return;const n=()=>{if(a.value!==null){if(k.value*=Bt,p.value*=Bt,a.value.scrollLeft+=k.value,a.value.scrollTop+=p.value,Math.abs(k.value)<je&&Math.abs(p.value)<je){J.value=null;return}J.value=requestAnimationFrame(n)}};J.value=requestAnimationFrame(n)}function wt(n){i.value===n.id?(i.value=null,g("program-select",null)):(i.value=n.id,g("program-select",n.id))}function ca(n){if(a.value===null)return;const B=m.getDisplayStartTime().hour();let N=(n===24?0:n)-B;N<0&&(N+=24);const I=N*z.value;a.value.scrollTo({top:I,behavior:"smooth"})}function da(){const n=m.scroll_top_limit_time;if(n===null)return 0;const h=m.getDisplayStartTime(),P=(n.valueOf()-h.valueOf())/(1e3*60*60);return Math.max(0,P*z.value)}function nt(n=!0,h=!1){if(a.value===null)return;const B=F(),P=m.getDisplayStartTime(),N=da(),ye=(B.subtract(30,"minute").valueOf()-P.valueOf())/(1e3*60*60),de=Math.max(N,ye*z.value);if(h){a.value.scrollTo({top:de,behavior:n?"smooth":"instant"});return}if(N===0){a.value.scrollTo({top:0,behavior:"instant"});return}a.value.scrollTo({top:N,behavior:"instant"}),n&&setTimeout(()=>{a.value!==null&&a.value.scrollTo({top:de,behavior:"smooth"})},50)}function va(){a.value!==null&&a.value.scrollTo({top:0,behavior:"instant"})}function ma(){if(a.value===null)return;const n=a.value.scrollHeight-a.value.clientHeight;a.value.scrollTo({top:n,behavior:"instant"})}return l({scrollToHour:ca,scrollToCurrentTime:nt,scrollToStart:va,scrollToEnd:ma}),Je(async()=>{a.value!==null&&a.value.addEventListener("wheel",Dt,{passive:!1}),await Ce(),a.value!==null&&(y.value=a.value.scrollLeft,E.value=a.value.scrollTop,bt(),St()),setTimeout(()=>{nt(),Ve(G)},100)}),wa(()=>{a.value!==null&&a.value.removeEventListener("wheel",Dt),W.value!==null&&cancelAnimationFrame(W.value),ee!==null&&cancelAnimationFrame(ee),ie!==null&&cancelAnimationFrame(ie),A!==null&&(A.disconnect(),A=null,M.clear()),J.value!==null&&cancelAnimationFrame(J.value)}),vt(()=>{J.value!==null&&cancelAnimationFrame(J.value)}),be(()=>t.channels,async(n,h)=>{tt.clear(),Me.clear(),Ve(G),Oe(),h.length===0&&n.length>0&&(await Ce(),setTimeout(()=>{nt(),x.value=!0,Oe()},100))},{deep:!1}),be([z,b],()=>{Ve(G),Oe()}),be(fe,()=>{Oe()}),be(()=>m.display_start_time,n=>{S.value=n.valueOf()},{immediate:!0}),(n,h)=>{const B=Qe("Icon");return Y(),Z("div",{class:"timetable-grid",style:re({"--timetable-channel-header-height":`${fe.value}px`})},[R("div",{class:Ke(["timetable-grid__scroll-area",{"timetable-grid__scroll-area--dragging":Q.value}]),ref_key:"scrollAreaRef",ref:a,onScroll:ia,onPointerdown:oa,onPointermove:sa,onPointerup:Tt,onPointercancel:Tt,onClickCapture:ra},[R("div",{class:"timetable-grid__layout",style:re({width:`${et.value+ht.value}px`,height:`${fe.value+Ne.value}px`})},[R("div",{class:"timetable-grid__header-row",style:re({height:`${fe.value}px`})},[R("div",{class:"timetable-grid__corner",style:re({width:`${et.value}px`})},null,4),R("div",wl,[(Y(!0),Z(De,null,Ae(e.channels,P=>(Y(),ge(nl,{key:P.channel.id,channel:P.channel,width:ce.value,height:fe.value},null,8,["channel","width","height"]))),128))])],4),R("div",{class:"timetable-grid__body-row",style:re({height:`${Ne.value}px`})},[R("div",{class:"timetable-grid__time-scale",style:re({width:`${et.value}px`})},[o(Tl,{selectedDate:t.selectedDate,hourHeight:z.value,is36HourDisplay:t.is36HourDisplay},null,8,["selectedDate","hourHeight","is36HourDisplay"])],4),R("div",Pl,[(Y(!0),Z(De,null,Ae(e.channels,(P,N)=>(Y(),Z("div",{class:"timetable-grid__channel-column",key:P.channel.id,style:re({left:`${N*ce.value}px`,width:`${ce.value}px`,height:`${Ne.value}px`})},[R("div",{class:"timetable-grid__channel-background",style:re({height:`${Ne.value}px`,background:_e(s)})},null,4),(Y(!0),Z(De,null,Ae(P.programs,I=>(Y(),Z(De,{key:I.id},[yt(I)?(Y(),ge(Mt,{key:0,program:I,channel:P.channel,selectedDate:t.selectedDate,hourHeight:z.value,channelWidth:pt(P,I,!1),fullChannelWidth:ce.value,isSplit:lt(P,I,!1),viewportHeight:b.value,channelHeaderHeight:fe.value,isScrollAtBottom:w.value,isSelected:i.value===I.id,isPast:_t(I),is36HourDisplay:t.is36HourDisplay,onClick:te=>wt(I),onShowDetail:te=>n.$emit("show-program-detail",I.id,P,I),onQuickReserve:te=>n.$emit("quick-reserve",I.id,P,I)},null,8,["program","channel","selectedDate","hourHeight","channelWidth","fullChannelWidth","isSplit","viewportHeight","channelHeaderHeight","isScrollAtBottom","isSelected","isPast","is36HourDisplay","onClick","onShowDetail","onQuickReserve"])):ue("",!0)],64))),128)),ea(P)?(Y(!0),Z(De,{key:0},Ae(aa(P),I=>(Y(),Z(De,{key:I.id},[yt(I)?(Y(),ge(Mt,{key:0,program:I,channel:P.channel,selectedDate:t.selectedDate,hourHeight:z.value,channelWidth:pt(P,I,!0),fullChannelWidth:ce.value,isSplit:lt(P,I,!0),viewportHeight:b.value,channelHeaderHeight:fe.value,isScrollAtBottom:w.value,isSubchannel:!0,isSelected:i.value===I.id,isPast:_t(I),is36HourDisplay:t.is36HourDisplay,onClick:te=>wt(I),onShowDetail:te=>n.$emit("show-program-detail",I.id,P,I),onQuickReserve:te=>n.$emit("quick-reserve",I.id,P,I)},null,8,["program","channel","selectedDate","hourHeight","channelWidth","fullChannelWidth","isSplit","viewportHeight","channelHeaderHeight","isScrollAtBottom","isSelected","isPast","is36HourDisplay","onClick","onShowDetail","onQuickReserve"])):ue("",!0)],64))),128)):ue("",!0)],4))),128)),o(sl,{selectedDate:t.selectedDate,hourHeight:z.value,totalWidth:ht.value,channelHeaderHeight:fe.value},null,8,["selectedDate","hourHeight","totalWidth","channelHeaderHeight"])])],4)],4)],34),o(Ct,{name:"fade"},{default:X(()=>[c.value?(Y(),ge(q,{key:0,class:"timetable-grid__next-day-button",variant:"elevated",color:"background-lighten-1",onClick:h[0]||(h[0]=P=>n.$emit("go-to-next-day"))},{default:X(()=>[o(B,{icon:"fluent:chevron-down-20-regular",width:"20px"}),h[2]||(h[2]=R("span",null,"次の日を見る",-1))]),_:1})):ue("",!0)]),_:1}),o(Ct,{name:"fade"},{default:X(()=>[u.value?(Y(),ge(q,{key:0,class:"timetable-grid__prev-day-button",variant:"elevated",color:"background-lighten-1",onClick:h[1]||(h[1]=P=>n.$emit("go-to-previous-day"))},{default:X(()=>[o(B,{icon:"fluent:chevron-up-20-regular",width:"20px"}),h[3]||(h[3]=R("span",null,"前の日を見る",-1))]),_:1})):ue("",!0)]),_:1})],4)}}}),Ol=Ie(Il,[["__scopeId","data-v-85ee50b6"]]),Xt=ke({active:{type:[String,Array],default:void 0},disabled:{type:[Boolean,String,Array],default:null},nextIcon:{type:Xe,default:"$next"},prevIcon:{type:Xe,default:"$prev"},modeIcon:{type:Xe,default:"$subgroup"},text:String,viewMode:{type:String,default:"month"}},"VDatePickerControls"),It=we()({name:"VDatePickerControls",props:Xt(),emits:{"click:year":()=>!0,"click:month":()=>!0,"click:prev":()=>!0,"click:next":()=>!0,"click:text":()=>!0},setup(e,l){let{emit:v}=l;const s=d(()=>Array.isArray(e.disabled)?e.disabled.includes("text"):!!e.disabled),t=d(()=>Array.isArray(e.disabled)?e.disabled.includes("mode"):!!e.disabled),g=d(()=>Array.isArray(e.disabled)?e.disabled.includes("prev"):!!e.disabled),r=d(()=>Array.isArray(e.disabled)?e.disabled.includes("next"):!!e.disabled);function m(){v("click:prev")}function a(){v("click:next")}function i(){v("click:year")}function c(){v("click:month")}return He(()=>o("div",{class:["v-date-picker-controls"]},[o(q,{class:"v-date-picker-controls__month-btn","data-testid":"month-btn",disabled:s.value,text:e.text,variant:"text",rounded:!0,onClick:c},null),o(q,{class:"v-date-picker-controls__mode-btn","data-testid":"year-btn",disabled:t.value,density:"comfortable",icon:e.modeIcon,variant:"text",onClick:i},null),o(qa,null,null),o("div",{class:"v-date-picker-controls__month"},[o(q,{"data-testid":"prev-month",disabled:g.value,icon:e.prevIcon,variant:"text",onClick:m},null),o(q,{"data-testid":"next-month",disabled:r.value,icon:e.nextIcon,variant:"text",onClick:a},null)])])),{}}}),Al=ke({appendIcon:Xe,color:String,header:String,transition:String,onClick:Pa()},"VDatePickerHeader"),Ot=we()({name:"VDatePickerHeader",props:Al(),emits:{click:()=>!0,"click:append":()=>!0},setup(e,l){let{emit:v,slots:s}=l;const{backgroundColorClasses:t,backgroundColorStyles:g}=mt(e,"color");function r(){v("click")}function m(){v("click:append")}return He(()=>{const a=!!(s.default||e.header),i=!!(s.append||e.appendIcon);return o("div",{class:["v-date-picker-header",{"v-date-picker-header--clickable":!!e.onClick},t.value],style:g.value,onClick:r},[s.prepend&&o("div",{key:"prepend",class:"v-date-picker-header__prepend"},[s.prepend()]),a&&o(jt,{key:"content",name:e.transition},{default:()=>{var c;return[o("div",{key:e.header,class:"v-date-picker-header__content"},[((c=s.default)==null?void 0:c.call(s))??e.header])]}}),i&&o("div",{class:"v-date-picker-header__append"},[s.append?o(Ze,{key:"append-defaults",disabled:!e.appendIcon,defaults:{VBtn:{icon:e.appendIcon,variant:"text"}}},{default:()=>{var c;return[(c=s.append)==null?void 0:c.call(s)]}}):o(q,{key:"append-btn",icon:e.appendIcon,variant:"text",onClick:m},null)])])}),{}}}),Rl=ke({allowedDates:[Array,Function],disabled:{type:Boolean,default:null},displayValue:null,modelValue:Array,month:[Number,String],max:null,min:null,showAdjacentMonths:Boolean,year:[Number,String],weekdays:{type:Array,default:()=>[0,1,2,3,4,5,6]},weeksInMonth:{type:String,default:"dynamic"},firstDayOfWeek:[Number,String]},"calendar");function $l(e){const l=Ee(),v=xe(e,"modelValue",[],b=>qe(b).map(w=>l.date(w))),s=d(()=>e.displayValue?l.date(e.displayValue):v.value.length>0?l.date(v.value[0]):e.min?l.date(e.min):Array.isArray(e.allowedDates)?l.date(e.allowedDates[0]):l.date()),t=xe(e,"year",void 0,b=>{const w=b!=null?Number(b):l.getYear(s.value);return l.startOfYear(l.setYear(l.date(),w))},b=>l.getYear(b)),g=xe(e,"month",void 0,b=>{const w=b!=null?Number(b):l.getMonth(s.value),T=l.setYear(l.startOfMonth(l.date()),l.getYear(t.value));return l.setMonth(T,w)},b=>l.getMonth(b)),r=d(()=>e.firstDayOfWeek??e.weekdays[0]),m=d(()=>{const b=Number(e.firstDayOfWeek??0);return e.weekdays.map(w=>(w+b)%7)}),a=d(()=>{const b=l.getWeekArray(g.value,r.value),w=b.flat(),T=6*7;if(e.weeksInMonth==="static"&&w.length<T){const H=w[w.length-1];let y=[];for(let E=1;E<=T-w.length;E++)y.push(l.addDays(H,E)),E%7===0&&(b.push(y),y=[])}return b});function i(b,w){return b.filter(T=>m.value.includes(l.toJsDate(T).getDay())).map((T,H)=>{const y=l.toISO(T),E=!l.isSameMonth(T,g.value),W=l.isSameDay(T,l.startOfMonth(g.value)),U=l.isSameDay(T,l.endOfMonth(g.value)),ne=l.isSameDay(T,g.value);return{date:T,isoDate:y,formatted:l.format(T,"keyboardDate"),year:l.getYear(T),month:l.getMonth(T),isDisabled:G(T),isWeekStart:H%7===0,isWeekEnd:H%7===6,isToday:l.isSameDay(T,w),isAdjacent:E,isHidden:E&&!e.showAdjacentMonths,isStart:W,isSelected:v.value.some(K=>l.isSameDay(T,K)),isEnd:U,isSame:ne,localized:l.format(T,"dayOfMonth")}})}const c=d(()=>{const b=l.startOfWeek(s.value,e.firstDayOfWeek),w=[];for(let H=0;H<=6;H++)w.push(l.addDays(b,H));const T=l.date();return i(w,T)}),u=d(()=>{const b=a.value.flat(),w=l.date();return i(b,w)}),x=d(()=>a.value.map(b=>b.length?Ca(l,b[0]):null));function G(b){if(e.disabled)return!0;const w=l.date(b);return e.min&&l.isAfter(l.date(e.min),w)||e.max&&l.isAfter(w,l.date(e.max))?!0:Array.isArray(e.allowedDates)&&e.allowedDates.length>0?!e.allowedDates.some(T=>l.isSameDay(l.date(T),w)):typeof e.allowedDates=="function"?!e.allowedDates(w):!1}return{displayValue:s,daysInMonth:u,daysInWeek:c,genDays:i,model:v,weeksInMonth:a,weekDays:m,weekNumbers:x}}const qt=ke({color:String,hideWeekdays:Boolean,multiple:[Boolean,Number,String],showWeek:Boolean,transition:{type:String,default:"picker-transition"},reverseTransition:{type:String,default:"picker-reverse-transition"},...$e(Rl(),["displayValue"])},"VDatePickerMonth"),At=we()({name:"VDatePickerMonth",props:qt(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0},setup(e,l){let{emit:v,slots:s}=l;const t=_(),{daysInMonth:g,model:r,weekNumbers:m}=$l(e),a=Ee(),i=Re(),c=Re(),u=Re(!1),x=d(()=>u.value?e.reverseTransition:e.transition);e.multiple==="range"&&r.value.length>0&&(i.value=r.value[0],r.value.length>1&&(c.value=r.value[r.value.length-1]));const G=d(()=>{const H=["number","string"].includes(typeof e.multiple)?Number(e.multiple):1/0;return r.value.length>=H});be(g,(H,y)=>{y&&(u.value=a.isBefore(H[0].date,y[0].date))});function b(H){const y=a.startOfDay(H);if(r.value.length===0?i.value=void 0:r.value.length===1&&(i.value=r.value[0],c.value=void 0),!i.value)i.value=y,r.value=[i.value];else if(c.value)i.value=H,c.value=void 0,r.value=[i.value];else{if(a.isSameDay(y,i.value)){i.value=void 0,r.value=[];return}else a.isBefore(y,i.value)?(c.value=a.endOfDay(i.value),i.value=y):c.value=a.endOfDay(y);const E=a.getDiff(c.value,i.value,"days"),W=[i.value];for(let U=1;U<E;U++){const ne=a.addDays(i.value,U);W.push(ne)}W.push(c.value),r.value=W}}function w(H){const y=r.value.findIndex(E=>a.isSameDay(E,H));if(y===-1)r.value=[...r.value,H];else{const E=[...r.value];E.splice(y,1),r.value=E}}function T(H){e.multiple==="range"?b(H):e.multiple?w(H):r.value=[H]}return()=>o("div",{class:"v-date-picker-month"},[e.showWeek&&o("div",{key:"weeks",class:"v-date-picker-month__weeks"},[!e.hideWeekdays&&o("div",{key:"hide-week-days",class:"v-date-picker-month__day"},[dt(" ")]),m.value.map(H=>o("div",{class:["v-date-picker-month__day","v-date-picker-month__day--adjacent"]},[H]))]),o(jt,{name:x.value},{default:()=>{var H;return[o("div",{ref:t,key:(H=g.value[0].date)==null?void 0:H.toString(),class:"v-date-picker-month__days"},[!e.hideWeekdays&&a.getWeekdays(e.firstDayOfWeek).map(y=>o("div",{class:["v-date-picker-month__day","v-date-picker-month__weekday"]},[y])),g.value.map((y,E)=>{const W={props:{onClick:()=>T(y.date)},item:y,i:E};return G.value&&!y.isSelected&&(y.isDisabled=!0),o("div",{class:["v-date-picker-month__day",{"v-date-picker-month__day--adjacent":y.isAdjacent,"v-date-picker-month__day--hide-adjacent":y.isHidden,"v-date-picker-month__day--selected":y.isSelected,"v-date-picker-month__day--week-end":y.isWeekEnd,"v-date-picker-month__day--week-start":y.isWeekStart}],"data-v-date":y.isDisabled?void 0:y.isoDate},[(e.showAdjacentMonths||!y.isAdjacent)&&o(Ze,{defaults:{VBtn:{class:"v-date-picker-month__day-btn",color:(y.isSelected||y.isToday)&&!y.isDisabled?e.color:void 0,disabled:y.isDisabled,icon:!0,ripple:!1,text:y.localized,variant:y.isDisabled?y.isToday?"outlined":"text":y.isToday&&!y.isSelected?"outlined":"flat",onClick:()=>T(y.date)}}},{default:()=>{var U;return[((U=s.day)==null?void 0:U.call(s,W))??o(q,W.props,null)]}})])})])]}})])}}),Kt=ke({color:String,height:[String,Number],min:null,max:null,modelValue:Number,year:Number},"VDatePickerMonths"),Rt=we()({name:"VDatePickerMonths",props:Kt(),emits:{"update:modelValue":e=>!0},setup(e,l){let{emit:v,slots:s}=l;const t=Ee(),g=xe(e,"modelValue"),r=d(()=>{let m=t.startOfYear(t.date());return e.year&&(m=t.setYear(m,e.year)),Wt(12).map(a=>{const i=t.format(m,"monthShort"),c=!!(e.min&&t.isAfter(t.startOfMonth(t.date(e.min)),m)||e.max&&t.isAfter(m,t.startOfMonth(t.date(e.max))));return m=t.getNextMonth(m),{isDisabled:c,text:i,value:a}})});return Ut(()=>{g.value=g.value??t.getMonth(t.date())}),He(()=>o("div",{class:"v-date-picker-months",style:{height:Ft(e.height)}},[o("div",{class:"v-date-picker-months__content"},[r.value.map((m,a)=>{var u;const i={active:g.value===a,color:g.value===a?e.color:void 0,disabled:m.isDisabled,rounded:!0,text:m.text,variant:g.value===m.value?"flat":"text",onClick:()=>c(a)};function c(x){if(g.value===x){v("update:modelValue",g.value);return}g.value=x}return((u=s.month)==null?void 0:u.call(s,{month:m,i:a,props:i}))??o(q,he({key:"month"},i),null)})])])),{}}}),Qt=ke({color:String,height:[String,Number],min:null,max:null,modelValue:Number},"VDatePickerYears"),$t=we()({name:"VDatePickerYears",props:Qt(),emits:{"update:modelValue":e=>!0},setup(e,l){let{emit:v,slots:s}=l;const t=Ee(),g=xe(e,"modelValue"),r=d(()=>{const a=t.getYear(t.date());let i=a-100,c=a+52;e.min&&(i=t.getYear(t.date(e.min))),e.max&&(c=t.getYear(t.date(e.max)));let u=t.startOfYear(t.date());return u=t.setYear(u,i),Wt(c-i+1,i).map(x=>{const G=t.format(u,"year");return u=t.setYear(u,t.getYear(u)+1),{text:G,value:x}})});Ut(()=>{g.value=g.value??t.getYear(t.date())});const m=xa();return Je(async()=>{var a;await Ce(),(a=m.el)==null||a.scrollIntoView({block:"center"})}),He(()=>o("div",{class:"v-date-picker-years",style:{height:Ft(e.height)}},[o("div",{class:"v-date-picker-years__content"},[r.value.map((a,i)=>{var u;const c={ref:g.value===a.value?m:void 0,active:g.value===a.value,color:g.value===a.value?e.color:void 0,rounded:!0,text:a.text,variant:g.value===a.value?"flat":"text",onClick:()=>{if(g.value===a.value){v("update:modelValue",g.value);return}g.value=a.value}};return((u=s.year)==null?void 0:u.call(s,{year:a,i,props:c}))??o(q,he({key:"month"},c),null)})])])),{}}}),Yl=Ka("v-picker-title"),Jt=ke({color:String,...Fa(),...Ua(),...Wa(),...Na(),...La(),...Ea(),...Ya(),...$a(),...Ra()},"VSheet"),Yt=we()({name:"VSheet",props:Jt(),setup(e,l){let{slots:v}=l;const{themeClasses:s}=Ha(e),{backgroundColorClasses:t,backgroundColorStyles:g}=mt(Gt(e,"color")),{borderClasses:r}=Ma(e),{dimensionStyles:m}=Va(e),{elevationClasses:a}=Ba(e),{locationStyles:i}=Ia(e),{positionClasses:c}=Oa(e),{roundedClasses:u}=Aa(e);return He(()=>o(e.tag,{class:["v-sheet",s.value,t.value,r.value,a.value,c.value,u.value,e.class],style:[g.value,m.value,i.value,e.style]},v)),{}}}),Zt=ke({bgColor:String,landscape:Boolean,title:String,hideHeader:Boolean,...Jt()},"VPicker"),Et=we()({name:"VPicker",props:Zt(),setup(e,l){let{slots:v}=l;const{backgroundColorClasses:s,backgroundColorStyles:t}=mt(Gt(e,"color"));return He(()=>{const g=Yt.filterProps(e),r=!!(e.title||v.title);return o(Yt,he(g,{color:e.bgColor,class:["v-picker",{"v-picker--landscape":e.landscape,"v-picker--with-actions":!!v.actions},e.class],style:e.style}),{default:()=>{var m;return[!e.hideHeader&&o("div",{key:"header",class:[s.value],style:[t.value]},[r&&o(Yl,{key:"picker-title"},{default:()=>{var a;return[((a=v.title)==null?void 0:a.call(v))??e.title]}}),v.header&&o("div",{class:"v-picker__header"},[v.header()])]),o("div",{class:"v-picker__body"},[(m=v.default)==null?void 0:m.call(v)]),v.actions&&o(Ze,{defaults:{VBtn:{slim:!0,variant:"text"}}},{default:()=>[o("div",{class:"v-picker__actions"},[v.actions()])]})]}})}),{}}}),El=ke({header:{type:String,default:"$vuetify.datePicker.header"},...Xt(),...qt({weeksInMonth:"static"}),...$e(Kt(),["modelValue"]),...$e(Qt(),["modelValue"]),...Zt({title:"$vuetify.datePicker.title"}),modelValue:null},"VDatePicker"),Lt=we()({name:"VDatePicker",props:El(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0,"update:viewMode":e=>!0},setup(e,l){let{emit:v,slots:s}=l;const t=Ee(),{t:g}=Ga(),r=xe(e,"modelValue",void 0,S=>qe(S).map(M=>t.date(M)),S=>e.multiple?S:S[0]),m=xe(e,"viewMode"),a=d(()=>{const S=t.date(e.min);return e.min&&t.isValid(S)?S:null}),i=d(()=>{const S=t.date(e.max);return e.max&&t.isValid(S)?S:null}),c=d(()=>{var A;const S=t.date();let M=S;return(A=r.value)!=null&&A[0]?M=t.date(r.value[0]):a.value&&t.isBefore(S,a.value)?M=a.value:i.value&&t.isAfter(S,i.value)&&(M=i.value),M&&t.isValid(M)?M:S}),u=_(Number(e.month??t.getMonth(t.startOfMonth(c.value)))),x=_(Number(e.year??t.getYear(t.startOfYear(t.setMonth(c.value,u.value))))),G=Re(!1),b=d(()=>e.multiple&&r.value.length>1?g("$vuetify.datePicker.itemsSelected",r.value.length):r.value[0]&&t.isValid(r.value[0])?t.format(t.date(r.value[0]),"normalDateWithWeekday"):g(e.header)),w=d(()=>{let S=t.date();return S=t.setDate(S,1),S=t.setMonth(S,u.value),S=t.setYear(S,x.value),t.format(S,"monthAndYear")}),T=d(()=>`date-picker-header${G.value?"-reverse":""}-transition`),H=d(()=>{if(e.disabled)return!0;const S=[];if(m.value!=="month")S.push("prev","next");else{let M=t.date();if(M=t.startOfMonth(M),M=t.setMonth(M,u.value),M=t.setYear(M,x.value),a.value){const A=t.addDays(t.startOfMonth(M),-1);t.isAfter(a.value,A)&&S.push("prev")}if(i.value){const A=t.addDays(t.endOfMonth(M),1);t.isAfter(A,i.value)&&S.push("next")}}return S});function y(){u.value<11?u.value++:(x.value++,u.value=0,j(x.value)),K(u.value)}function E(){u.value>0?u.value--:(x.value--,u.value=11,j(x.value)),K(u.value)}function W(){m.value="month"}function U(){m.value=m.value==="months"?"month":"months"}function ne(){m.value=m.value==="year"?"month":"year"}function K(S){m.value==="months"&&U(),v("update:month",S)}function j(S){m.value==="year"&&ne(),v("update:year",S)}return be(r,(S,M)=>{const A=qe(M),ee=qe(S);if(!ee.length)return;const ie=t.date(A[A.length-1]),Q=t.date(ee[ee.length-1]),ae=t.getMonth(Q),L=t.getYear(Q);ae!==u.value&&(u.value=ae,K(u.value)),L!==x.value&&(x.value=L,j(x.value)),G.value=t.isBefore(ie,Q)}),He(()=>{const S=Et.filterProps(e),M=It.filterProps(e),A=Ot.filterProps(e),ee=At.filterProps(e),ie=$e(Rt.filterProps(e),["modelValue"]),Q=$e($t.filterProps(e),["modelValue"]),ae={header:b.value,transition:T.value};return o(Et,he(S,{class:["v-date-picker",`v-date-picker--${m.value}`,{"v-date-picker--show-week":e.showWeek},e.class],style:e.style}),{title:()=>{var L;return((L=s.title)==null?void 0:L.call(s))??o("div",{class:"v-date-picker__title"},[g(e.title)])},header:()=>s.header?o(Ze,{defaults:{VDatePickerHeader:{...ae}}},{default:()=>{var L;return[(L=s.header)==null?void 0:L.call(s,ae)]}}):o(Ot,he({key:"header"},A,ae,{onClick:m.value!=="month"?W:void 0}),{...s,default:void 0}),default:()=>o(De,null,[o(It,he(M,{disabled:H.value,text:w.value,"onClick:next":y,"onClick:prev":E,"onClick:month":U,"onClick:year":ne}),null),o(Qa,{hideOnLeave:!0},{default:()=>[m.value==="months"?o(Rt,he({key:"date-picker-months"},ie,{modelValue:u.value,"onUpdate:modelValue":[L=>u.value=L,K],min:a.value,max:i.value,year:x.value}),null):m.value==="year"?o($t,he({key:"date-picker-years"},Q,{modelValue:x.value,"onUpdate:modelValue":[L=>x.value=L,j],min:a.value,max:i.value}),null):o(At,he({key:"date-picker-month"},ee,{modelValue:r.value,"onUpdate:modelValue":L=>r.value=L,month:u.value,"onUpdate:month":[L=>u.value=L,K],year:x.value,"onUpdate:year":[L=>x.value=L,j],min:a.value,max:i.value}),null)]})]),actions:s.actions})}),{}}}),Ll={class:"route-container"},Nl={class:"timetable-controls"},Wl={class:"timetable-controls__date"},Ul={key:0,class:"timetable-controls-mobile"},Fl={class:"timetable-controls-mobile__date"},Gl=Be({__name:"TimeTable",setup(e){Ye();const l=Le(),v=_(null),s=_a(),t=d(()=>s.server_settings),g=d(()=>t.value.general.backend==="EDCB"),r=_(!1),m=_(!1),a=_(0),i=_(!1),c=_(null),u=_(null),x=_(null),G=_(!1),b=d(()=>{const k=[],p=l.available_channel_types;for(const O of zt)p.has(O)&&k.push({title:O,value:O});return k}),w=d({get:()=>l.selected_channel_type,set:k=>{l.changeChannelType(k)}}),T=d(()=>{const k=[];for(let p=4;p<=24;p+=4){const O=p;k.push({title:`${O.toString().padStart(2,"0")}時`,value:p})}return k});function H(){let p=F().hour();return p<4&&(p+=24),Math.floor((p-4)/4)*4+4}const y=_(H()),E=d(()=>{const k=l.selected_date.add(a.value,"day"),p=k.month()+1,O=k.date(),oe=["日","月","火","水","木","金","土"][k.day()];return`${p}/${O} (${oe})`}),W=d({get:()=>l.selected_date.toDate(),set:k=>{const p=F(k).hour(4).minute(0).second(0).millisecond(0);l.changeDate(p)}}),U=d(()=>l.date_range===null?!1:l.selected_date.subtract(1,"day").isSameOrAfter(l.date_range.earliest,"day")),ne=d(()=>l.date_range===null?!1:l.selected_date.add(1,"day").isSameOrBefore(l.date_range.latest,"day")),K=d(()=>{if(l.date_range!==null)return l.date_range.earliest.toDate()}),j=d(()=>{if(l.date_range!==null)return l.date_range.latest.toDate()});function S(k){l.changeChannelType(k)}function M(k){m.value=!1;const p=F(k).hour(4).minute(0).second(0).millisecond(0);l.changeDate(p)}function A(k){k===null||v.value===null||v.value.scrollToHour(k)}async function ee(){await l.goToPreviousDay(),await Ce(),v.value!==null&&v.value.scrollToEnd()}async function ie(){await l.goToNextDay(),await Ce(),v.value!==null&&v.value.scrollToStart()}async function Q(){await l.goToCurrentTime(),await Ce(),v.value!==null&&v.value.scrollToCurrentTime(!0,!0)}function ae(k){l.updateScrollPosition(k.x,k.y)}function L(k){const p=Math.floor((k-4)/4)*4+4,O=Math.max(4,Math.min(24,p));y.value=O}function pe(k){a.value=k}function Se(k){l.selectProgram(k)}async function C(k,p,O){const oe=F(O.end_time);if(G.value=oe.isBefore(F()),O.reservation!==null){const V=await Fe.fetchReservation(O.reservation.id);V!==null?(c.value=V,u.value=null,x.value=null):(c.value=f(O,p.channel),u.value=null,x.value=null)}else c.value=f(O,p.channel),u.value=null,x.value=null;i.value=!0}function f(k,p){return{id:-1,channel:p,program:k,is_recording_in_progress:!1,recording_availability:"Full",comment:"",scheduled_recording_file_name:"",estimated_recording_file_size:0,record_settings:structuredClone(xt)}}async function D(){await l.fetchTimeTableData()}async function $(){await l.fetchTimeTableData()}async function le(){await l.fetchTimeTableData()}async function se(k,p,O){if(F(O.end_time).isBefore(F()))return;if(g.value===!1){ut.warning("録画予約機能は EDCB バックエンド利用時のみ使用できます。");return}if(O.reservation!==null){const J=await Fe.fetchReservation(O.reservation.id);if(J===null)return;const me=structuredClone(J.record_settings);if(me.is_enabled=!me.is_enabled,await Fe.updateReservation(J.id,me)!==null){const z=me.is_enabled?`録画予約を有効にしました。
番組開始時刻になると自動的に録画が開始されます。`:`録画予約を無効にしました。
番組開始時刻までに再度予約を有効にしない限り、この番組は録画されません。`;ut.success(z),await l.fetchTimeTableData()}return}await Fe.addReservation(k,structuredClone(xt))&&(ut.success("録画予約を追加しました。"),await l.fetchTimeTableData())}return Je(async()=>{await s.fetchServerSettingsOnce(),await l.initialLoad()}),vt(()=>{l.reset()}),be(()=>l.selected_date,()=>{a.value=0}),(k,p)=>{const O=Qe("Icon"),oe=Nt("ftooltip");return Y(),Z("div",Ll,[o(pa,null,ja({_:2},[_e(Pe).isSmartphoneVertical()?void 0:{name:"timetable-controls",fn:X(()=>[R("div",Nl,[o(Ge,{class:"timetable-controls__channel-type",variant:"outlined",density:"compact","hide-details":"",items:b.value,modelValue:w.value,"onUpdate:modelValue":[p[0]||(p[0]=V=>w.value=V),S]},null,8,["items","modelValue"]),R("div",Wl,[o(q,{variant:"flat",icon:"",size:"small",disabled:!U.value,onClick:ee},{default:X(()=>[o(O,{icon:"fluent:chevron-left-20-regular",width:"20px"})]),_:1},8,["disabled"]),o(Ht,{modelValue:m.value,"onUpdate:modelValue":p[2]||(p[2]=V=>m.value=V),"close-on-content-click":!1},{activator:X(({props:V})=>[o(q,he({variant:"flat",class:"timetable-controls__date-button"},V),{default:X(()=>[dt(Te(E.value),1)]),_:1},16)]),default:X(()=>[o(Lt,{modelValue:W.value,"onUpdate:modelValue":[p[1]||(p[1]=V=>W.value=V),M],color:"primary",min:K.value,max:j.value},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"]),o(q,{variant:"flat",icon:"",size:"small",disabled:!ne.value,onClick:ie},{default:X(()=>[o(O,{icon:"fluent:chevron-right-20-regular",width:"20px"})]),_:1},8,["disabled"])]),o(Ge,{class:"timetable-controls__time",variant:"outlined",density:"compact","hide-details":"",items:T.value,modelValue:y.value,"onUpdate:modelValue":[p[3]||(p[3]=V=>y.value=V),A]},null,8,["items","modelValue"]),ct((Y(),ge(q,{variant:"flat",class:"timetable-controls__now-button",icon:"",onClick:Q},{default:X(()=>[o(O,{icon:"fluent:clock-20-regular",width:"22px"})]),_:1})),[[oe,"現在時刻に移動",void 0,{bottom:!0}]]),ct((Y(),ge(q,{variant:"flat",class:"timetable-controls__settings-button",icon:"",onClick:p[4]||(p[4]=V=>r.value=!0)},{default:X(()=>[o(O,{icon:"fluent:settings-20-regular",width:"22px"})]),_:1})),[[oe,"番組表の表示設定",void 0,{bottom:!0}]])])]),key:"0"}]),1024),R("main",null,[o(ya,{"icon-only":!_e(Pe).isSmartphoneVertical()},null,8,["icon-only"]),R("div",{class:Ke(["timetable-container",{"timetable-container--loading":_e(l).is_loading}])},[o(Sa),_e(Pe).isSmartphoneVertical()?(Y(),Z("div",Ul,[o(Ge,{class:"timetable-controls-mobile__channel-type",variant:"outlined",density:"compact","hide-details":"",items:b.value,modelValue:w.value,"onUpdate:modelValue":[p[5]||(p[5]=V=>w.value=V),S]},null,8,["items","modelValue"]),R("div",Fl,[o(Ht,{modelValue:m.value,"onUpdate:modelValue":p[7]||(p[7]=V=>m.value=V),"close-on-content-click":!1},{activator:X(({props:V})=>[o(q,he({variant:"flat",class:"timetable-controls-mobile__date-button",size:"small"},V),{default:X(()=>[dt(Te(E.value),1)]),_:1},16)]),default:X(()=>[o(Lt,{modelValue:W.value,"onUpdate:modelValue":[p[6]||(p[6]=V=>W.value=V),M],color:"primary",min:K.value,max:j.value},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"])]),o(Ge,{class:"timetable-controls-mobile__time",variant:"outlined",density:"compact","hide-details":"",items:T.value,modelValue:y.value,"onUpdate:modelValue":[p[8]||(p[8]=V=>y.value=V),A]},null,8,["items","modelValue"]),o(q,{variant:"flat",class:"timetable-controls-mobile__now-button",icon:"",size:"small",onClick:Q},{default:X(()=>[o(O,{icon:"fluent:clock-20-regular",width:"18px"})]),_:1}),o(q,{variant:"flat",class:"timetable-controls-mobile__settings-button",icon:"",size:"small",onClick:p[9]||(p[9]=V=>r.value=!0)},{default:X(()=>[o(O,{icon:"fluent:settings-20-regular",width:"18px"})]),_:1})])):ue("",!0),o(Ol,{ref_key:"timetableGridRef",ref:v,channels:_e(l).channels_data,selectedDate:_e(l).selected_date,isLoading:_e(l).is_loading,is36HourDisplay:_e(l).is_36hour_display,canGoPreviousDay:U.value,canGoNextDay:ne.value,onScrollPositionChange:ae,onTimeSlotChange:L,onDateDisplayOffsetChange:pe,onProgramSelect:Se,onShowProgramDetail:C,onQuickReserve:se,onGoToNextDay:ie,onGoToPreviousDay:ee},null,8,["channels","selectedDate","isLoading","is36HourDisplay","canGoPreviousDay","canGoNextDay"])],2)]),o(ka,{isOpen:r.value,"onUpdate:isOpen":p[10]||(p[10]=V=>r.value=V)},null,8,["isOpen"]),o(ba,{modelValue:i.value,"onUpdate:modelValue":p[11]||(p[11]=V=>i.value=V),reservation:c.value,program:u.value,channel:x.value,isPastProgram:G.value,onAdded:D,onUpdated:$,onDeleted:le},null,8,["modelValue","reservation","program","channel","isPastProgram"])])}}}),hn=Ie(Gl,[["__scopeId","data-v-1b81b682"]]);export{hn as default};
