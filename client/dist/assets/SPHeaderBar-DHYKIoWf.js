import{d as R,q as V,x as L,s as Q,G as $,A as U,c as _,w as m,a as o,cd as H,e as w,b as y,k as S,h as p,a3 as z,r as O,v as F,B as j,V as W,C as A,l as x,o as r,R as k,_ as E,D as J,E as X,dQ as Y,au as Z,ai as tt,at as I,d6 as et,aw as nt,az as it,T as at,dR as st,d3 as ot,aO as rt,O as lt,aq as ct,aA as ut,dK as vt,I as dt,dS as ht,aB as _t,aE as ft,aS as pt,J as gt,aG as mt,dT as yt,n as h,a7 as D,ae as kt,U as N,m as bt,j as wt,t as St,F as $t}from"./index-Da91cxHn.js";import{V as q,_ as G,u as Ot}from"./ssrBoot-uJDF8aJ1.js";function Ct(t,a,e,u){function s(i){return i instanceof e?i:new e(function(l){l(i)})}return new(e||(e=Promise))(function(i,l){function d(f){try{n(u.next(f))}catch(c){l(c)}}function b(f){try{n(u.throw(f))}catch(c){l(c)}}function n(f){f.done?i(f.value):s(f.value).then(d,b)}n((u=u.apply(t,[])).next())})}function Wt(t,a){var e={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},u,s,i,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(n){return function(f){return b([n,f])}}function b(n){if(u)throw new TypeError("Generator is already executing.");for(;l&&(l=0,n[0]&&(e=0)),e;)try{if(u=1,s&&(i=n[0]&2?s.return:n[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,n[1])).done)return i;switch(s=0,i&&(n=[n[0]&2,i.value]),n[0]){case 0:case 1:i=n;break;case 4:return e.label++,{value:n[1],done:!1};case 5:e.label++,s=n[1],n=[0];continue;case 7:n=e.ops.pop(),e.trys.pop();continue;default:if(i=e.trys,!(i=i.length>0&&i[i.length-1])&&(n[0]===6||n[0]===2)){e=0;continue}if(n[0]===3&&(!i||n[1]>i[0]&&n[1]<i[3])){e.label=n[1];break}if(n[0]===6&&e.label<i[1]){e.label=i[1],i=n;break}if(i&&e.label<i[2]){e.label=i[2],e.ops.push(n);break}i[2]&&e.ops.pop(),e.trys.pop();continue}n=a.call(t,e)}catch(f){n=[6,f],s=0}finally{u=i=0}if(n[0]&5)throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}var Bt=function(){function t(){var a=this;this.event=null,this.callbacks=[],this.install=function(){return Ct(a,void 0,void 0,function(){var e=this;return Wt(this,function(u){switch(u.label){case 0:return this.event?(this.event.prompt(),[4,this.event.userChoice.then(function(s){var i=s.outcome;return e.updateEvent(null),i==="accepted"})]):[3,2];case 1:return[2,u.sent()];case 2:throw new Error("Not allowed to prompt.")}})})},!(typeof window>"u")&&(window.addEventListener("beforeinstallprompt",function(e){e.preventDefault(),a.updateEvent(e)}),window.addEventListener("appinstalled",function(){a.updateEvent(null)}))}return t.prototype.getEvent=function(){return this.event},t.prototype.canInstall=function(){return this.event!==null},t.prototype.updateEvent=function(a){var e=this;a!==this.event&&(this.event=a,this.callbacks.forEach(function(u){return u(e.canInstall())}))},t.prototype.addListener=function(a){a(this.canInstall()),this.callbacks.push(a)},t.prototype.removeListener=function(a){this.callbacks=this.callbacks.filter(function(e){return a!==e})},t}(),T=new Bt;const It={class:"header"},Vt={key:0,class:"search-box"},Et=["placeholder"],Pt=R({__name:"HeaderBar",setup(t){const a=V(!1),e=V(""),u=A(),s=U(),i=()=>{s.path.endsWith("/search")&&s.query.query&&(e.value=decodeURIComponent(s.query.query))};L(()=>{T.addListener(c=>{a.value=c}),i()}),Q(()=>s.fullPath,i);const l=$(()=>s.path.startsWith("/videos")||s.path.startsWith("/mylist")||s.path.startsWith("/watched-history")?"録画番組を検索...":"放送予定の番組を検索..."),d=()=>s.path.startsWith("/videos")||s.path.startsWith("/mylist")||s.path.startsWith("/watched-history")?"/videos/search":"/tv/search",b=c=>{c.key==="Enter"&&!c.isComposing&&n()},n=()=>{if(e.value.trim()){const c=d();u.push(`${c}?query=${encodeURIComponent(e.value.trim())}`)}},f=$(()=>{const c=s.path;return!c.startsWith("/captures")&&!c.startsWith("/settings")&&!c.startsWith("/login")&&!c.startsWith("/register")});return(c,g)=>{const B=O("router-link"),v=O("Icon");return r(),_("header",It,[m((r(),S(B,{class:"konomitv-logo ml-3 ml-md-6",to:"/tv/"},{default:p(()=>[...g[2]||(g[2]=[y("img",{class:"konomitv-logo__image",src:G,height:"21"},null,-1)])]),_:1})),[[k]]),o(q),H(c.$slots,"timetable-controls",{},void 0,!0),f.value?(r(),_("div",Vt,[m(y("input",{class:"search-input",type:"search",enterkeyhint:"search",placeholder:l.value,"onUpdate:modelValue":g[0]||(g[0]=C=>e.value=C),onKeydown:b},null,40,Et),[[z,e.value]]),o(v,{class:"search-input__icon",icon:"fluent:search-20-filled",height:"24px",onClick:n})])):w("",!0),m(o(W,{variant:"flat",class:"pwa-install-button",onClick:g[1]||(g[1]=C=>j(T).install())},{default:p(()=>[o(v,{icon:"material-symbols:install-desktop-rounded",height:"20px",class:"mr-1"}),g[3]||(g[3]=x(" アプリとしてインストール ",-1))]),_:1},512),[[F,a.value]]),g[4]||(g[4]=y("div",{class:"mr-3 mr-md-6"},null,-1))])}}}),ie=E(Pt,[["__scopeId","data-v-10752bcd"]]),Nt=X({baseColor:String,bgColor:String,color:String,grow:Boolean,mode:{type:String,validator:t=>!t||["horizontal","shift"].includes(t)},height:{type:[Number,String],default:56},active:{type:Boolean,default:!0},...mt(),...gt(),...pt(),...ft(),..._t(),...ht({name:"bottom-navigation"}),...dt({tag:"header"}),...vt({selectedClass:"v-btn--selected"}),...ut()},"VBottomNavigation"),Rt=J()({name:"VBottomNavigation",props:Nt(),emits:{"update:active":t=>!0,"update:modelValue":t=>!0},setup(t,a){let{slots:e}=a;const{themeClasses:u}=Y(),{borderClasses:s}=Z(t),{backgroundColorClasses:i,backgroundColorStyles:l}=tt(I(t,"bgColor")),{densityClasses:d}=et(t),{elevationClasses:b}=nt(t),{roundedClasses:n}=it(t),{ssrBootStyles:f}=Ot(),c=$(()=>Number(t.height)-(t.density==="comfortable"?8:0)-(t.density==="compact"?16:0)),g=at(t,"active",t.active),{layoutItemStyles:B}=st({id:t.name,order:$(()=>parseInt(t.order,10)),position:$(()=>"bottom"),layoutSize:$(()=>g.value?c.value:0),elementSize:c,active:g,absolute:I(t,"absolute")});return ot(t,yt),rt({VBtn:{baseColor:I(t,"baseColor"),color:I(t,"color"),density:I(t,"density"),stacked:$(()=>t.mode!=="horizontal"),variant:"text"}},{scoped:!0}),lt(()=>o(t.tag,{class:["v-bottom-navigation",{"v-bottom-navigation--active":g.value,"v-bottom-navigation--grow":t.grow,"v-bottom-navigation--shift":t.mode==="shift"},u.value,i.value,s.value,d.value,b.value,n.value,t.class],style:[l.value,B.value,{height:ct(c.value)},f.value,t.style]},{default:()=>[e.default&&o("div",{class:"v-bottom-navigation__content"},[e.default()])]})),{}}}),qt={};function Dt(t,a){const e=O("Icon");return r(),S(Rt,{class:"bottom-navigation-container elevation-12",color:"primary",grow:"",active:""},{default:p(()=>[o(W,{class:h(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/tv")}]),to:"/tv/"},{default:p(()=>[o(e,{icon:"fluent:tv-20-regular",width:"30px"}),a[0]||(a[0]=y("span",{class:"mt-1"},"テレビをみる",-1))]),_:1},8,["class"]),o(W,{class:h(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/videos")}]),to:"/videos/"},{default:p(()=>[o(e,{icon:"fluent:movies-and-tv-20-regular",width:"30px"}),a[1]||(a[1]=y("span",{class:"mt-1"},"ビデオをみる",-1))]),_:1},8,["class"]),o(W,{class:h(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/reservations")}]),to:"/reservations/"},{default:p(()=>[o(e,{icon:"fluent:timer-16-regular",width:"30px"}),a[2]||(a[2]=y("span",{class:"mt-1"},"録画予約",-1))]),_:1},8,["class"]),o(W,{class:h(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/captures")}]),to:"/captures/"},{default:p(()=>[o(e,{icon:"fluent:image-multiple-24-regular",width:"30px"}),a[3]||(a[3]=y("span",{class:"mt-1"},"キャプチャ",-1))]),_:1},8,["class"]),o(W,{class:h(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/mypage")}]),to:"/mypage/"},{default:p(()=>[o(e,{icon:"fluent:person-20-regular",width:"30px"}),a[4]||(a[4]=y("span",{class:"mt-1"},"マイページ",-1))]),_:1},8,["class"])]),_:1})}const Tt=E(qt,[["render",Dt],["__scopeId","data-v-58f8356e"]]);class Lt{static async fetchServerVersion(a=!1){const e=await D.get("/version");return e.type==="error"?(a===!1&&D.showGenericError(e,"バージョン情報を取得できませんでした。"),null):e.data}}const Ut=kt("version",{state:()=>({server_version_info:null,last_updated_at:0}),getters:{client_version(){return N.version},server_version(){var t;return((t=this.server_version_info)==null?void 0:t.version)??null},latest_version(){var t;return((t=this.server_version_info)==null?void 0:t.latest_version)??null},is_client_develop_version(){return this.client_version.includes("-dev")},is_server_develop_version(){var t;return((t=this.server_version)==null?void 0:t.includes("-dev"))??!1},is_update_available(){return this.server_version===null||this.latest_version===null?!1:this.is_server_develop_version===!1&&this.server_version!==this.latest_version||this.is_server_develop_version===!0&&this.server_version.replace("-dev","")===this.latest_version},is_version_mismatch(){return this.server_version===null?!1:this.client_version!==this.server_version},server_environment(){var t;return((t=this.server_version_info)==null?void 0:t.environment)??null},is_linux_environment(){const t=this.server_environment;return t==="Linux"||t==="Linux-Docker"||t==="Linux-ARM"}},actions:{async fetchServerVersion(t=!1){if(this.server_version_info!==null&&t===!1)return N.time()-this.last_updated_at>60&&this.fetchServerVersion(!0),this.server_version_info;const a=await Lt.fetchServerVersion();return a===null?null:(this.server_version_info=a,this.last_updated_at=N.time(),this.server_version_info)}}}),Ht=R({name:"Navigation",components:{BottomNavigation:Tt},props:{iconOnly:{type:Boolean,default:!1}},computed:{...bt(Ut)},async created(){await this.versionStore.fetchServerVersion()}}),zt={key:0,class:"navigation__link-text"},At={key:0,class:"navigation__link-text"},Gt={key:0,class:"navigation__link-text"},Kt={key:0,class:"navigation__link-text"},Mt={key:0,class:"navigation__link-text"},Qt={key:0,class:"navigation__link-text"},Ft={key:0,class:"navigation__link-text"},jt={key:0,class:"navigation__link-text"},xt={key:0,class:"navigation__link-text"};function Jt(t,a,e,u,s,i){const l=O("Icon"),d=O("router-link"),b=O("BottomNavigation"),n=wt("ftooltip");return r(),_("div",null,[y("div",{class:h(["navigation-container elevation-8",{"navigation-container--icon-only":t.iconOnly}])},[y("nav",{class:h(["navigation",{"navigation--icon-only":t.iconOnly}])},[y("div",{class:h(["navigation-scroll",{"navigation-scroll--icon-only":t.iconOnly}])},[m((r(),S(d,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/tv"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/tv/"},{default:p(()=>[o(l,{class:"navigation__link-icon",icon:"fluent:tv-20-regular",width:"26px"}),t.iconOnly?w("",!0):(r(),_("span",zt,"テレビをみる"))]),_:1},8,["class"])),[[k],[n,t.iconOnly?"テレビをみる":"",void 0,{right:!0}]]),m((r(),S(d,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/videos"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/videos/"},{default:p(()=>[o(l,{class:"navigation__link-icon",icon:"fluent:movies-and-tv-20-regular",width:"26px"}),t.iconOnly?w("",!0):(r(),_("span",At,"ビデオをみる"))]),_:1},8,["class"])),[[k],[n,t.iconOnly?"ビデオをみる":"",void 0,{right:!0}]]),m((r(),S(d,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/timetable"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/timetable/"},{default:p(()=>[o(l,{class:"navigation__link-icon",icon:"fluent:calendar-ltr-20-regular",width:"26px"}),t.iconOnly?w("",!0):(r(),_("span",Gt,"番組表"))]),_:1},8,["class"])),[[k],[n,t.iconOnly?"番組表":"",void 0,{right:!0}]]),m((r(),S(d,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/reservations"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/reservations/"},{default:p(()=>[o(l,{class:"navigation__link-icon",icon:"fluent:timer-16-regular",width:"26px",style:{padding:"0.5px"}}),t.iconOnly?w("",!0):(r(),_("span",Kt,"録画予約"))]),_:1},8,["class"])),[[k],[n,t.iconOnly?"録画予約":"",void 0,{right:!0}]]),m((r(),S(d,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/captures"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/captures/"},{default:p(()=>[o(l,{class:"navigation__link-icon",icon:"fluent:image-multiple-24-regular",width:"26px"}),t.iconOnly?w("",!0):(r(),_("span",Mt,"キャプチャ"))]),_:1},8,["class"])),[[k],[n,t.iconOnly?"キャプチャ":"",void 0,{right:!0}]]),m((r(),S(d,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/mylist"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/mylist/"},{default:p(()=>[o(l,{class:"navigation__link-icon",icon:"ic:round-playlist-play",width:"26px"}),t.iconOnly?w("",!0):(r(),_("span",Qt,"マイリスト"))]),_:1},8,["class"])),[[k],[n,t.iconOnly?"マイリスト":"",void 0,{right:!0}]]),m((r(),S(d,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/watched-history"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/watched-history/"},{default:p(()=>[o(l,{class:"navigation__link-icon",icon:"fluent:history-20-regular",width:"26px"}),t.iconOnly?w("",!0):(r(),_("span",Ft,"視聴履歴"))]),_:1},8,["class"])),[[k],[n,t.iconOnly?"視聴履歴":"",void 0,{right:!0}]]),o(q),m((r(),S(d,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/settings"),"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",to:"/settings/"},{default:p(()=>[o(l,{class:"navigation__link-icon",icon:"fluent:settings-20-regular",width:"26px"}),t.iconOnly?w("",!0):(r(),_("span",jt,"設定"))]),_:1},8,["class"])),[[k],[n,t.iconOnly?"設定":"",void 0,{right:!0}]]),m((r(),_("a",{class:h(["navigation__link",{"navigation__link--develop-version":t.versionStore.is_client_develop_version,"navigation__link--highlight":t.versionStore.is_update_available,"navigation__link--icon-only":t.iconOnly}]),"active-class":"navigation__link--active",href:"https://github.com/tsukumijima/KonomiTV",target:"_blank"},[o(l,{class:"navigation__link-icon",icon:"fluent:info-16-regular",width:"26px"}),t.iconOnly?w("",!0):(r(),_("span",xt,"version "+St(t.versionStore.client_version),1))],2)),[[k],[n,t.iconOnly?t.versionStore.is_update_available?`アップデートがあります (version ${t.versionStore.latest_version})`:`version ${t.versionStore.client_version}`:t.versionStore.is_update_available?`アップデートがあります (version ${t.versionStore.latest_version})`:"",void 0,{right:!0}]])],2)],2)],2),o(b)])}const ae=E(Ht,[["render",Jt],["__scopeId","data-v-60019fe5"]]),Xt={key:1,class:"search-box"},Yt={class:"search-box__icon"},Zt=["placeholder"],te=R({__name:"SPHeaderBar",props:{hideOnSmartphoneVertical:{type:Boolean,default:!1}},setup(t){const a=A(),e=U(),u=V(null),s=V(!1),i=V(""),l=$(()=>{const v=e.path;return!v.startsWith("/captures")&&!v.startsWith("/settings")&&!v.startsWith("/login")&&!v.startsWith("/register")}),d=$(()=>b(e.path)?"録画番組やシリーズを検索...":"放送予定の番組を検索..."),b=v=>v.startsWith("/videos")||v.startsWith("/mylist")||v.startsWith("/watched-history"),n=()=>b(e.path)?"/videos/search":"/tv/search",f=()=>{s.value=!0,setTimeout(()=>{var v;(v=u.value)==null||v.focus()},0)},c=()=>{s.value=!1,i.value=""},g=()=>{if(i.value.trim()){const v=n();a.push(`${v}?query=${encodeURIComponent(i.value.trim())}`)}},B=v=>{v.key==="Enter"?g():v.key==="Escape"&&c()};return L(()=>{e.path.endsWith("/search")&&e.query.query&&(i.value=decodeURIComponent(e.query.query),s.value=!0)}),(v,C)=>{const K=O("router-link"),P=O("Icon");return r(),_("header",{class:h(["header",{"search-active":s.value,"header--hide-on-sp-vertical":t.hideOnSmartphoneVertical}])},[s.value?(r(),_("div",Xt,[y("div",Yt,[o(P,{icon:"fluent:search-20-filled",height:"20px"})]),m(y("input",{ref_key:"searchInput",ref:u,type:"search",enterkeyhint:"search",placeholder:d.value,"onUpdate:modelValue":C[0]||(C[0]=M=>i.value=M),onKeydown:B},null,40,Zt),[[z,i.value]]),m((r(),_("div",{class:"search-box__close",onClick:c},[o(P,{icon:"fluent:dismiss-20-filled",height:"24px"})])),[[k]])])):(r(),_($t,{key:0},[m((r(),S(K,{class:"konomitv-logo",to:"/tv/"},{default:p(()=>[...C[1]||(C[1]=[y("img",{class:"konomitv-logo__image",src:G,height:"21"},null,-1)])]),_:1})),[[k]]),o(q),H(v.$slots,"timetable-controls",{},void 0,!0),l.value?m((r(),_("div",{key:0,class:"search-button",onClick:f},[o(P,{icon:"fluent:search-20-filled",height:"24px"})])),[[k]]):w("",!0)],64))],2)}}}),se=E(te,[["__scopeId","data-v-0283bb75"]]);export{ie as H,ae as N,se as S,Lt as V,Ut as u};
