import{H as _a,N as ba,S as ka}from"./SPHeaderBar-Chf0UYUT.js";import{R as Sa}from"./ReservationDetailDrawer-ShI1R4Va.js";import{T as ye,a as Ta}from"./TimeTableSettings-DIfQ0Gcg.js";import{d as Ie,G as c,U as ge,w as dt,j as zt,k as he,r as Ze,f as me,h as Q,b as $,B as Xe,t as Te,o as Y,_ as Re,af as wa,u as We,q as k,ag as Ye,N as z,s as _e,a8 as Da,x as et,z as mt,c as X,e as de,P as Ee,n as Je,a as r,p as Mt,V as J,a2 as Ce,F as pe,g as Be,ad as xa,ah as Vt,D as we,E as ke,O as Me,X as Ke,ai as ft,aj as tt,ak as Pa,al as Le,T as He,am as Qe,an as Ca,l as vt,Y as Ne,ao as Ft,ap as Gt,Q as fe,aq as jt,ar as Ha,as as Ma,at as qt,au as Va,av as Ba,aw as Ia,ax as Ra,ay as Oa,az as Aa,aA as $a,I as Ea,aB as Ya,aC as Na,aD as Wa,aE as La,aF as Ua,J as za,aG as Fa,aH as Ga,aI as ja,M as ct}from"./index-C90hjLTU.js";import{u as qa,P as Xa}from"./ChannelsStore-EWe2Nuou.js";import{u as Ka,R as Fe,I as Bt}from"./ServerSettingsStore-vpXqLwW5.js";import{c as Ge,d as It}from"./VSelect-CWOpdxGi.js";import{V as Qa,c as Ja}from"./ssrBoot-OnzqbV2B.js";import{M as Xt}from"./VAvatar-D6Bl7QrI.js";import{b as Za}from"./VTextField-DDySwIAQ.js";import"./VSwitch-DhhO6NGN.js";import"./VChip-CD6qvBgt.js";import"./VSlider-DQxJb1-U.js";import"./VDialog-CA4CK2fk.js";import"./VCard-BjWulXRM.js";const el={class:"timetable-channel-header__logo-wrapper"},tl=["src","alt"],al={class:"timetable-channel-header__info"},ll={class:"timetable-channel-header__number"},nl={class:"timetable-channel-header__name"},il=Ie({__name:"TimeTableChannelHeader",props:{channel:{},width:{},height:{},resizeTrigger:{}},setup(e){const a=e,v=c(()=>Math.round(Math.min(46,Math.max(32,a.width*.27)))),s=c(()=>Math.round(v.value*(3/4))),t=c(()=>Math.min(14,Math.max(13,a.width*.06))),m=c(()=>(a.resizeTrigger,Math.min(13.5,Math.max(ge.isSmartphoneVertical()?10:12,a.width*.08)))),u=c(()=>`${a.channel.name} を視聴`);return(n,i)=>{const o=Ze("router-link"),f=zt("ftooltip");return dt((Y(),he(o,{class:"timetable-channel-header",to:`/tv/watch/${e.channel.display_channel_id}`,style:me({width:`${e.width}px`,height:`${e.height}px`,"--timetable-channel-logo-width":`${v.value}px`,"--timetable-channel-logo-height":`${s.value}px`,"--timetable-channel-number-size":`${t.value}px`,"--timetable-channel-name-size":`${m.value}px`})},{default:Q(()=>[$("div",el,[$("img",{class:"timetable-channel-header__logo",loading:"lazy",decoding:"async",src:`${Xe(ge).api_base_url}/channels/${e.channel.id}/logo`,alt:e.channel.name},null,8,tl)]),$("div",al,[$("span",ll,Te(e.channel.channel_number),1),$("span",nl,Te(e.channel.name),1)])]),_:1},8,["to","style"])),[[f,u.value,void 0,{bottom:!0}]])}}}),sl=Re(il,[["__scopeId","data-v-6ab34174"]]),Kt=["ピン留め","地デジ","BS","CS","CATV","SKY","BS4K"],ol=new Map([["地デジ","GR"],["BS","BS"],["CS","CS"],["CATV","CATV"],["SKY","SKY"],["BS4K","BS4K"]]),Ue=wa("timetable",()=>{const e=We(),a=qa(),v=k(null),s=k(T()),t=Ye([]),m=k(null),u=k(!1),n=k(!1),i=k(!1),o=k(0),f=k(null);function g(){const _=z(),O=T();if(s.value.isSame(O,"day")===!1)return!1;let d=_.hour();return d<4&&(d+=24),d>=17}function H(){const _=z(),O=T();if(s.value.isSame(O,"day")===!1)return null;const d=_.startOf("hour").subtract(1,"hour"),R=q();return d.isBefore(R)?R:d}function q(){return i.value?s.value.add(12,"hour"):s.value}function S(_){return _.subtract(1,"millisecond").subtract(4,"hour").startOf("day").add(4,"hour")}function T(){const _=z();let O=_.hour(4).minute(0).second(0).millisecond(0);return _.hour()<4&&(O=O.subtract(1,"day")),O}function x(_,O=!1){return O?_.add(36,"hour"):_.add(1,"day")}const V=c(()=>i.value?s.value.add(12,"hour"):s.value),p=c(()=>{const _=new Set;if(a.is_channels_list_initial_updated===!1)return _;for(const O of a.channels_list_with_pinned.keys()){if(O==="ピン留め"){const d=a.channels_list_with_pinned.get("ピン留め");if(d===void 0||d.length===0)continue}_.add(O)}return _});function L(){return v.value===null?F():p.value.has(v.value)?null:F()}function F(){if(p.value.has("ピン留め"))return"ピン留め";if(p.value.has("地デジ"))return"地デジ";for(const _ of Kt)if(p.value.has(_))return _;return"地デジ"}async function G(_,O,d,R){i.value=g(),f.value=H();const A=_??q(),K=O??x(A,i.value),ne=d??v.value??"地デジ",ie=ne==="ピン留め"?R??e.settings.pinned_channel_ids:void 0,ve=ol.get(ne),ce=await Xa.fetchTimeTable(A,K,ve,ie);return ce===null?!1:(t.value=ce.channels,m.value={earliest:z(ce.date_range.earliest),latest:z(ce.date_range.latest)},!0)}async function Z(){u.value=!0,n.value=!1;try{if(await a.update(),s.value=T(),v.value=F(),await G()===!1){u.value=!1;return}n.value=!0}finally{u.value=!1}}async function N(_){u.value=!0;try{s.value=_,await G()}finally{u.value=!1}}async function ee(_){u.value=!0;try{v.value=_,await G()}finally{u.value=!1}}function b(){let O=z().hour();return O<4&&(O+=24),O>=17}async function I(){if(m.value===null)return;const _=T(),O=b();let d;if(i.value)d=s.value.subtract(1,"day");else if(O){const A=s.value.subtract(1,"day");A.isSame(_.add(1,"day"),"day")?d=_:d=A}else d=s.value.subtract(1,"day");const R=S(m.value.earliest);d.isBefore(R,"day")||await N(d)}async function j(){if(m.value===null)return;let _;i.value?_=s.value.add(2,"day"):_=s.value.add(1,"day");const O=S(m.value.latest);_.isAfter(O,"day")||await N(_)}async function te(){const _=T();s.value.isSame(_,"day")===!1&&await N(_)}function re(_){o.value=_}const se=c(()=>{if(m.value===null)return!1;const _=T(),O=b();let d;if(i.value)d=s.value.subtract(1,"day");else if(O){const A=s.value.subtract(1,"day");A.isSame(_.add(1,"day"),"day")?d=_:d=A}else d=s.value.subtract(1,"day");const R=S(m.value.earliest);return d.isSameOrAfter(R,"day")}),ae=c(()=>{if(m.value===null)return!1;let _;i.value?_=s.value.add(2,"day"):_=s.value.add(1,"day");const O=S(m.value.latest);return _.isSameOrBefore(O,"day")});function U(){t.value=[],m.value=null,u.value=!1,n.value=!1,i.value=!1,o.value=0,f.value=null,v.value=null}return _e(()=>e.settings.pinned_channel_ids,async(_,O)=>{v.value==="ピン留め"&&n.value!==!1&&Da(_,O)===!1&&await G()},{deep:!0}),_e(()=>a.channels_list_with_pinned,async()=>{if(n.value===!1)return;const _=L();_!==null&&await ee(_)},{deep:!0}),{selected_channel_type:v,selected_date:s,channels_data:t,date_range:m,is_loading:u,is_initial_load_completed:n,is_36hour_display:i,date_display_offset:o,scroll_top_limit_time:f,available_channel_types:p,display_start_time:V,can_go_previous_day:se,can_go_next_day:ae,getBroadcastDate:S,getTodayStartTime:T,getDayEndTime:x,getDisplayStartTime:q,setDateDisplayOffset:re,fetchTimeTableData:G,initialLoad:Z,changeDate:N,changeChannelType:ee,goToPreviousDay:I,goToNextDay:j,goToCurrentTime:te,reset:U}}),rl=Ie({__name:"TimeTableCurrentTimeLine",props:{hourHeight:{},totalWidth:{},channelHeaderHeight:{}},setup(e){const a=e,v=Ue(),s=k(z());let t=null,m=null;const u=c(()=>{const i=s.value,o=v.getDisplayStartTime(),f=v.getDayEndTime(o,v.is_36hour_display);return i.isSameOrAfter(o)&&i.isBefore(f)}),n=c(()=>{if(!u.value)return 0;const i=v.getDisplayStartTime();return ye.calculateCurrentTimeY(s.value,i,a.hourHeight,a.channelHeaderHeight)-a.channelHeaderHeight});return et(()=>{const i=z(),o=i.add(1,"minute").startOf("minute"),f=Math.max(0,o.valueOf()-i.valueOf());m=setTimeout(()=>{s.value=z(),t=setInterval(()=>{s.value=z()},60*1e3)},f)}),mt(()=>{m!==null&&clearTimeout(m),t!==null&&clearInterval(t)}),(i,o)=>u.value?(Y(),X("div",{key:0,class:"timetable-current-time-line",style:me({top:`${n.value}px`,width:`${e.totalWidth}px`})},[...o[0]||(o[0]=[$("div",{class:"timetable-current-time-line__indicator"},null,-1),$("div",{class:"timetable-current-time-line__line"},null,-1)])],4)):de("",!0)}}),ul=Re(rl,[["__scopeId","data-v-8d4f4a9f"]]),cl={class:"timetable-program-cell__content"},dl={class:"timetable-program-cell__header"},vl={class:"timetable-program-cell__start-minute"},ml={key:0,class:"timetable-program-cell__reservation-icon"},fl={key:0,class:"timetable-program-cell__recording-icon"},hl=["innerHTML"],gl=["innerHTML"],pl={key:0,class:"timetable-program-cell__actions"},yl="fluent:timer-16-filled",_l="mdi:timer-pause-outline",bl=Ie({__name:"TimeTableProgramCell",props:{program:{},channel:{},hourHeight:{},channelWidth:{},fullChannelWidth:{},viewportHeight:{},channelHeaderHeight:{},isScrollAtBottom:{type:Boolean},isSubchannel:{type:Boolean},isSplit:{type:Boolean},isSelected:{type:Boolean},isPast:{type:Boolean},is36HourDisplay:{type:Boolean},isNextReserved:{type:Boolean},resizeTrigger:{}},emits:["click","show-detail","quick-reserve"],setup(e,{emit:a}){const v=new Map;function s(d,R){const A=d.title,K=d.description;if(A===null||K===null)return Ee.decorateProgramInfo(d,R);const ne=v.get(d.id);if(ne===void 0||ne.raw_title!==A||ne.raw_description!==K){const ve=Ee.decorateProgramInfo(d,"title"),ce=Ee.decorateProgramInfo(d,"description");v.set(d.id,{raw_title:A,raw_description:K,title:ve,description:ce})}const ie=v.get(d.id);return ie===void 0?Ee.decorateProgramInfo(d,R):R==="title"?ie.title:ie.description}const t=e,m=a,u=We(),n=Ue(),i=k(!1),o=k(null),f=k(0),g=c(()=>(t.resizeTrigger,ge.isTouchDevice()?t.isSelected:t.isSelected||u.settings.timetable_hover_expand&&i.value)),H=c(()=>t.program.reservation!==null),q=c(()=>{var d;return((d=t.program.reservation)==null?void 0:d.status)==="Recording"}),S=c(()=>{var d;return((d=t.program.reservation)==null?void 0:d.status)==="Disabled"}),T=c(()=>{var d;return((d=t.program.reservation)==null?void 0:d.recording_availability)==="Partial"}),x=c(()=>{var d;return((d=t.program.reservation)==null?void 0:d.recording_availability)==="Unavailable"}),V=c(()=>u.settings.timetable_dim_shopping_programs===!1?!1:Ee.isShoppingProgram(t.program)),p=c(()=>x.value?"rgb(var(--v-theme-error))":T.value?"rgb(var(--v-theme-warning))":S.value?"rgb(var(--v-theme-text-darken-2))":"rgb(var(--v-theme-secondary))"),L=c(()=>S.value?_l:yl),F=c(()=>H.value?S.value?"mdi:timer-play-outline":"mdi:timer-pause-outline":"mdi:timer-plus-outline"),G=c(()=>{if(t.resizeTrigger,!H.value)return"録画予約";const d=u.settings.timetable_channel_width==="Narrow",R=u.settings.timetable_channel_width!=="Wide",A=ge.isSmartphoneVertical()&&R||(ge.isSmartphoneHorizontal()||ge.isTabletVertical())&&d;return S.value?A?"有効化":"予約を有効化":A?"無効化":"予約を無効化"}),Z=c(()=>z(t.program.start_time).minute().toString().padStart(2,"0")),N=c(()=>{var A,K;const d=(K=(A=t.program.genres)==null?void 0:A[0])==null?void 0:K.major;return ye.getGenreColors(d,u.settings.timetable_genre_colors).highlight}),ee=c(()=>{var A,K;if(x.value)return"#f8d7da";if(T.value)return"#fff3cd";const d=(K=(A=t.program.genres)==null?void 0:A[0])==null?void 0:K.major;return ye.getGenreColors(d,u.settings.timetable_genre_colors).background}),b=c(()=>{const d=z(t.program.start_time),R=n.getDisplayStartTime();return ye.calculateProgramY(d,R,t.hourHeight,t.channelHeaderHeight)-t.channelHeaderHeight}),I=c(()=>(t.is36HourDisplay?36:24)*t.hourHeight),j=c(()=>{const d=ye.calculateProgramHeight(t.program.duration,t.hourHeight);return b.value+d>I.value?Math.max(0,I.value-b.value):Math.max(d,20)}),te=c(()=>{const d=t.fullChannelWidth??t.channelWidth,R=t.isSplit===!0&&t.channelWidth<d,A=g.value&&f.value>0?f.value:j.value,K=t.isSubchannel&&R?t.channelWidth:0,ne=g.value&&R?0:K,ie=g.value&&R?d:t.channelWidth,ve={top:`${b.value}px`,left:`${ne}px`,width:`${ie}px`,minHeight:`${j.value}px`,"--timetable-cell-height":`${A}px`,"--timetable-program-base-background":ee.value,"--timetable-program-base-highlight":N.value};if(g.value||(ve.height=`${j.value}px`),g.value&&t.viewportHeight>0&&t.isScrollAtBottom===!0){const ce=f.value>0?f.value:j.value,Se=Math.max(0,I.value-t.viewportHeight),le=Se+t.viewportHeight,M=b.value+ce,y=b.value+j.value>=I.value-1;if(M>le&&y){const w=M-le,oe=Math.max(0,b.value-Se),P=Math.min(w,oe);P>0&&(ve.transform=`translateY(-${P}px)`)}}return ve}),re=c(()=>s(t.program,"title")),se=c(()=>s(t.program,"description"));function ae(){m("click")}function U(){i.value=!0}function _(){i.value=!1}function O(){m("quick-reserve")}return _e(g,async d=>{if(d===!1){f.value=0;return}await Ce(),o.value!==null&&(f.value=Math.max(o.value.getBoundingClientRect().height,j.value))}),(d,R)=>{const A=Ze("Icon");return Y(),X("div",{class:Je(["timetable-program-cell",{"timetable-program-cell--selected":e.isSelected,"timetable-program-cell--expanded":g.value,"timetable-program-cell--past":e.isPast,"timetable-program-cell--subchannel":e.isSubchannel,"timetable-program-cell--reserved":H.value,"timetable-program-cell--recording":q.value,"timetable-program-cell--partial":T.value,"timetable-program-cell--unavailable":x.value,"timetable-program-cell--disabled":S.value,"timetable-program-cell--shopping":V.value,"timetable-program-cell--next-reserved":H.value&&e.isNextReserved}]),ref_key:"cellRef",ref:o,style:me(te.value),onClick:ae,onMouseenter:U,onMouseleave:_},[R[2]||(R[2]=$("div",{class:"timetable-program-cell__highlight"},null,-1)),$("div",cl,[$("div",dl,[$("span",vl,Te(Z.value),1),H.value?(Y(),X("div",ml,[r(A,{icon:L.value,width:"14px",style:me({color:p.value})},null,8,["icon","style"]),q.value?(Y(),X("div",fl)):de("",!0),T.value?(Y(),he(A,{key:1,icon:"fluent:warning-16-filled",width:"12px",class:"timetable-program-cell__warning-icon"})):de("",!0),x.value?(Y(),he(A,{key:2,icon:"fluent:dismiss-circle-16-filled",width:"12px",class:"timetable-program-cell__error-icon"})):de("",!0)])):de("",!0)]),$("div",{class:"timetable-program-cell__title",innerHTML:re.value},null,8,hl),$("div",{class:"timetable-program-cell__description",innerHTML:se.value},null,8,gl),g.value?(Y(),X("div",pl,[r(J,{variant:"flat",size:"small",class:"timetable-program-cell__action-button",onClick:R[0]||(R[0]=Mt(K=>d.$emit("show-detail"),["stop"]))},{default:Q(()=>[r(A,{icon:"fluent:info-12-regular",width:"16px"}),R[1]||(R[1]=$("span",null,"番組詳細",-1))]),_:1}),e.isPast?de("",!0):(Y(),he(J,{key:0,variant:"flat",size:"small",class:Je(["timetable-program-cell__action-button",{"timetable-program-cell__action-button--reserved":H.value&&!S.value,"timetable-program-cell__action-button--disabled-reservation":S.value}]),onClick:Mt(O,["stop"])},{default:Q(()=>[r(A,{icon:F.value,width:"16px"},null,8,["icon"]),$("span",null,Te(G.value),1)]),_:1},8,["class"]))])):de("",!0)])],38)}}}),Rt=Re(bl,[["__scopeId","data-v-8603e6bf"]]),kl={class:"timetable-time-scale"},Sl=["data-hour"],Tl={class:"timetable-time-scale__label"},wl={key:0,class:"timetable-time-scale__date"},Dl={class:"timetable-time-scale__hour-number"},xl=Ie({__name:"TimeTableTimeScale",props:{hourHeight:{},is36HourDisplay:{type:Boolean}},setup(e){const a=e,v=We(),s=Ue(),t=c(()=>{const i=a.is36HourDisplay?36:24,o=s.display_start_time,f=[];for(let g=0;g<i;g++)f.push(o.add(g,"hour"));return f});function m(i){const o=i.hour();return v.settings.use_28hour_clock&&o>=0&&o<=3?(o+24).toString().padStart(2,"0"):o.toString().padStart(2,"0")}function u(i){const o=i.hour(),f=s.display_start_time;return!([0,4,8,12,16,20].includes(o)===!1||a.is36HourDisplay&&o===4&&f.hour()===4)}function n(i){return`${i.month()+1}/${i.date()}`}return(i,o)=>(Y(),X("div",kl,[(Y(!0),X(pe,null,Be(t.value,f=>(Y(),X("div",{class:"timetable-time-scale__hour",key:f.valueOf(),style:me({height:`${a.hourHeight}px`}),"data-hour":f.hour()},[$("div",Tl,[u(f)?(Y(),X("span",wl,Te(n(f)),1)):de("",!0),$("span",Dl,Te(m(f)),1),o[0]||(o[0]=$("span",{class:"timetable-time-scale__hour-label"},"時",-1))])],12,Sl))),128))]))}}),Pl=Re(xl,[["__scopeId","data-v-fe795608"]]),Cl={class:"timetable-grid__channel-headers"},Hl={class:"timetable-grid__content"},Ml=2,Vl=3,Bl=.5,Il=60,Rl=2,Ol=500,Al=120,Ot=.95,je=.5,qe=5,$l=100,El=Ie({__name:"TimeTableGrid",props:{channels:{},is36HourDisplay:{type:Boolean},canGoPreviousDay:{type:Boolean},canGoNextDay:{type:Boolean}},emits:["time-slot-change","date-display-offset-change","show-program-detail","quick-reserve","go-to-next-day","go-to-previous-day"],setup(e,{expose:a,emit:v}){const s=e,t=v,m=We(),u=Ue(),n=k(null),i=k(null),o=k(!1),f=k(!1);let g=0;const H=k(0),q=k(!1),S=k(0),T=k(0),x=k(0),V=k(0),p=k(null);let L=null,F=null;const G=k(0),Z=new Set;let N=null,ee=null,b=null;const I=k(0),j=k(0),te=k(!1),re=k(!1),se=k(!1),ae=k(null),U=k(0),_=k(0),O=k(0),d=k(0),R=k(!1),A=k(!1),K=k(0),ne=k(0),ie=k(0),ve=k(0),ce=k(0),Se=k(0),le=k(null),M=c(()=>(I.value,ye.getDeviceType())),y=c(()=>ye.getChannelWidth(m.settings.timetable_channel_width,M.value)),w=c(()=>ye.getHourHeight(m.settings.timetable_hour_height,M.value)),oe=c(()=>M.value==="Smartphone"?Vl:Ml),P=c(()=>ye.getChannelHeaderHeight(y.value)),De=c(()=>(I.value,ye.getTimeScaleWidth(M.value,ge.isSmartphoneVertical()))),xe=c(()=>s.channels.length*y.value),Oe=c(()=>(s.is36HourDisplay?36:24)*w.value);function at(l){return l.subchannels===null||l.subchannels.length===0?!1:l.subchannels.some(h=>h.programs.length>0)}const lt=new Map,Ae=new Map;function nt(l){if(l==null)return{start:0,end:0};const h=lt.get(l.id);if(h!==void 0)return h;const C={start:z(l.start_time).valueOf(),end:z(l.end_time).valueOf()};return lt.set(l.id,C),C}function ht(l,h){const C=nt(l);return h.some(D=>{const W=nt(D);return W.start<C.end&&W.end>C.start})}function it(l,h,C){const D=`${h.id}:${C?"sub":"main"}`,W=Ae.get(D);if(W!==void 0)return W;const B=yt(l);if(B.length===0)return Ae.set(D,!1),!1;if(C){const ue=ht(h,l.programs);return Ae.set(D,ue),ue}const E=ht(h,B);return Ae.set(D,E),E}function gt(l,h,C){return it(l,h,C)?y.value/2:y.value}function Ve(l){const h=w.value*oe.value;S.value=Math.max(0,l-h),T.value=l+H.value+h}function la(l){const C=w.value*oe.value*Bl,D=l+H.value;return H.value<=0||T.value===0||l<S.value+C||D>T.value-C?(Ve(l),!0):!1}function pt(l){const h=nt(l),C=(h.start-G.value)/(1e3*60*60)*w.value;return(h.end-G.value)/(1e3*60*60)*w.value>=S.value&&C<=T.value}function na(l){return l.subchannels===null?[]:l.subchannels}function yt(l){return l.subchannels===null?[]:l.subchannels.flatMap(h=>h.programs)}function _t(l){return z(l.end_time).isBefore(z())}function bt(l,h,C){const D=C?yt(l):l.programs,W=z(h.end_time).valueOf(),B=D.find(E=>z(E.start_time).valueOf()===W);return B!==void 0&&B.reservation!==null}function kt(){if(n.value===null)return;x.value;const l=V.value;g=l;const h=n.value.clientHeight-P.value;H.value!==h&&(H.value=h);const C=n.value.scrollHeight-n.value.clientHeight,D=l>=C-1;q.value!==D&&(q.value=D),la(l)&&$e();const B=l>C-100&&s.canGoNextDay,E=l<100&&s.canGoPreviousDay;o.value!==B&&(o.value=B),f.value!==E&&(f.value=E);const ue=u.getDisplayStartTime(),be=Math.floor(l/w.value);let ot=ue.add(be,"hour").hour();ot<4&&(ot+=24);const ga=Math.floor((ot-4)/4)*4+4,rt=Math.max(4,Math.min(24,ga));if(L!==rt&&(t("time-slot-change",rt),L=rt),s.is36HourDisplay){const pa=m.settings.use_28hour_clock?4:0;let ze=ue.hour(pa).minute(0).second(0).millisecond(0);ze.isSameOrBefore(ue)&&(ze=ze.add(1,"day"));const ya=(ze.valueOf()-ue.valueOf())/(1e3*60*60)*w.value,ut=l>=ya?1:0;F!==ut&&(t("date-display-offset-change",ut),F=ut)}else F!==0&&(t("date-display-offset-change",0),F=0);St()}function ia(){p.value===null&&(p.value=requestAnimationFrame(()=>{p.value=null,kt()}))}function $e(){b===null&&(b=requestAnimationFrame(()=>{b=null,Tt()}))}function St(){ee===null&&(ee=requestAnimationFrame(()=>{ee=null,sa()}))}function Tt(){n.value!==null&&(N!==null&&(N.disconnect(),Z.clear()),N=new IntersectionObserver(l=>{for(const h of l){const C=h.target,D=h.rootBounds;if(D===null)continue;const W=h.intersectionRect.top<=D.top,B=h.intersectionRect.height<h.boundingClientRect.height,E=D.height<h.boundingClientRect.height;if(h.isIntersecting&&W&&(B||E))Z.add(C),C.classList.add("timetable-program-cell--fixed");else{Z.delete(C),C.classList.remove("timetable-program-cell--fixed");const be=C.querySelector(".timetable-program-cell__content");be!==null&&(be.style.paddingTop="")}}St()},{root:n.value,rootMargin:`-${P.value}px 0px 0px 0px`,threshold:[0,1]}),n.value.querySelectorAll(".timetable-program-cell").forEach(l=>{N==null||N.observe(l)}))}function sa(){if(n.value===null||Z.size===0)return;const l=n.value.getBoundingClientRect().top+P.value;Z.forEach(h=>{const C=h.querySelector(".timetable-program-cell__content");if(C===null)return;const D=h.getBoundingClientRect().top,W=l-D;if(W<=0){C.style.paddingTop="";return}const B=h.style.getPropertyValue("--timetable-cell-height"),E=B?Number.parseFloat(B):h.getBoundingClientRect().height,ue=Math.max(0,E-Il),be=h.classList.contains("timetable-program-cell--reserved")?3:0,Ht=Math.min(W,ue);C.style.paddingTop=`${Rl+Math.max(Ht-be,0)}px`})}let Pe=null;function wt(){Pe!==null&&clearTimeout(Pe),Pe=window.setTimeout(()=>{I.value++,Pe=null},$l)}function Dt(){j.value=performance.now()}function oa(){n.value!==null&&(x.value=n.value.scrollLeft,V.value=n.value.scrollTop,ia())}function xt(l){n.value!==null&&(le.value!==null&&(cancelAnimationFrame(le.value),le.value=null),l.deltaX!==0&&(l.preventDefault(),n.value.scrollLeft+=l.deltaX),l.shiftKey&&l.deltaY!==0?(l.preventDefault(),n.value.scrollLeft+=l.deltaY):l.deltaY!==0&&l.deltaX===0&&(l.preventDefault(),n.value.scrollTop+=l.deltaY))}function ra(l){var E;if(l.pointerType==="mouse"===!1)return;const C=((E=l.sourceCapabilities)==null?void 0:E.firesTouchEvents)===!0,W=performance.now()-j.value<=Ol;if(C||W||n.value===null)return;const B=l.target;B.closest(".v-btn")||B.closest("a")||(re.value=!0,te.value=!1,R.value=!1,U.value=l.clientX,_.value=l.clientY,O.value=n.value.scrollLeft,d.value=n.value.scrollTop,le.value!==null&&(cancelAnimationFrame(le.value),le.value=null),ne.value=0,ie.value=0,ve.value=performance.now(),ce.value=l.clientX,Se.value=l.clientY)}function ua(l){if(l.pointerType!=="mouse"||re.value===!1||n.value===null)return;const h=U.value-l.clientX,C=_.value-l.clientY;if((Math.abs(h)>qe||Math.abs(C)>qe)&&te.value===!1&&n.value!==null&&(te.value=!0,R.value=!0,n.value.setPointerCapture(l.pointerId),se.value=!0,ae.value=l.pointerId),te.value===!1)return;l.preventDefault(),(Math.abs(h)>qe||Math.abs(C)>qe)&&(R.value=!0),n.value.scrollLeft=O.value+h,n.value.scrollTop=d.value+C;const D=performance.now(),W=D-ve.value;if(W>0){const B=l.clientX-ce.value,E=l.clientY-Se.value;ne.value=-B/W*16,ie.value=-E/W*16}ve.value=D,ce.value=l.clientX,Se.value=l.clientY}function Pt(l){if(l.pointerType==="mouse"&&re.value!==!1){if(re.value=!1,te.value=!1,n.value!==null&&se.value&&ae.value!==null)try{n.value.releasePointerCapture(ae.value)}catch{}se.value=!1,ae.value=null,R.value?(da(),A.value=!0,K.value=performance.now()):(A.value=!1,K.value=0)}}function ca(l){if(A.value===!1)return;performance.now()-K.value<=Al&&(l.preventDefault(),l.stopPropagation()),A.value=!1}function da(){if(n.value===null||Math.abs(ne.value)<je&&Math.abs(ie.value)<je)return;const l=()=>{if(n.value!==null){if(ne.value*=Ot,ie.value*=Ot,n.value.scrollLeft+=ne.value,n.value.scrollTop+=ie.value,Math.abs(ne.value)<je&&Math.abs(ie.value)<je){le.value=null;return}le.value=requestAnimationFrame(l)}};le.value=requestAnimationFrame(l)}function Ct(l){i.value===l.id?i.value=null:i.value=l.id}function va(l){if(n.value===null)return;const C=u.getDisplayStartTime().hour();let W=(l===24?0:l)-C;W<0&&(W+=24);const B=W*w.value;n.value.scrollTo({top:B,behavior:"smooth"})}function ma(){const l=u.scroll_top_limit_time;if(l===null)return 0;const h=u.getDisplayStartTime(),D=(l.valueOf()-h.valueOf())/(1e3*60*60);return Math.max(0,D*w.value)}function st(l=!0,h=!1){if(n.value===null)return;const C=z(),D=u.getDisplayStartTime(),W=ma(),ue=(C.subtract(30,"minute").valueOf()-D.valueOf())/(1e3*60*60),be=Math.max(W,ue*w.value);if(h){n.value.scrollTo({top:be,behavior:l?"smooth":"instant"});return}if(W===0){n.value.scrollTo({top:0,behavior:"instant"});return}n.value.scrollTo({top:W,behavior:"instant"}),l&&setTimeout(()=>{n.value!==null&&n.value.scrollTo({top:be,behavior:"smooth"})},50)}function fa(){n.value!==null&&n.value.scrollTo({top:0,behavior:"instant"})}function ha(){if(n.value===null)return;const l=n.value.scrollHeight-n.value.clientHeight;n.value.scrollTo({top:l,behavior:"instant"})}return a({scrollToHour:va,scrollToCurrentTime:st,scrollToStart:fa,scrollToEnd:ha}),et(async()=>{window.addEventListener("resize",wt),n.value!==null&&n.value.addEventListener("wheel",xt,{passive:!1}),window.addEventListener("touchstart",Dt,{passive:!0}),await Ce(),n.value!==null&&(x.value=n.value.scrollLeft,V.value=n.value.scrollTop,kt(),Tt()),setTimeout(()=>{st(),Ve(g)},100)}),xa(()=>{window.removeEventListener("resize",wt),window.removeEventListener("touchstart",Dt),Pe!==null&&(clearTimeout(Pe),Pe=null),n.value!==null&&n.value.removeEventListener("wheel",xt),p.value!==null&&cancelAnimationFrame(p.value),ee!==null&&cancelAnimationFrame(ee),b!==null&&cancelAnimationFrame(b),N!==null&&(N.disconnect(),N=null,Z.clear()),le.value!==null&&cancelAnimationFrame(le.value)}),mt(()=>{le.value!==null&&cancelAnimationFrame(le.value)}),_e(()=>s.channels,async(l,h)=>{lt.clear(),Ae.clear(),Ve(g),$e(),h.length===0&&l.length>0&&(await Ce(),setTimeout(()=>{st(),$e()},100))},{deep:!1}),_e([w,H],()=>{Ve(g),$e()}),_e(P,()=>{$e()}),_e(()=>u.display_start_time,l=>{G.value=l.valueOf()},{immediate:!0}),(l,h)=>{const C=Ze("Icon");return Y(),X("div",{class:"timetable-grid",style:me({"--timetable-channel-header-height":`${P.value}px`})},[$("div",{class:Je(["timetable-grid__scroll-area",{"timetable-grid__scroll-area--dragging":te.value}]),ref_key:"scrollAreaRef",ref:n,onScroll:oa,onPointerdown:ra,onPointermove:ua,onPointerup:Pt,onPointercancel:Pt,onClickCapture:ca},[$("div",{class:"timetable-grid__layout",style:me({width:`${De.value+xe.value}px`,height:`${P.value+Oe.value}px`})},[$("div",{class:"timetable-grid__header-row",style:me({height:`${P.value}px`})},[$("div",{class:"timetable-grid__corner",style:me({width:`${De.value}px`})},null,4),$("div",Cl,[(Y(!0),X(pe,null,Be(e.channels,D=>(Y(),he(sl,{key:D.channel.id,channel:D.channel,width:y.value,height:P.value,resizeTrigger:I.value},null,8,["channel","width","height","resizeTrigger"]))),128))])],4),$("div",{class:"timetable-grid__body-row",style:me({height:`${Oe.value}px`})},[$("div",{class:"timetable-grid__time-scale",style:me({width:`${De.value}px`})},[r(Pl,{hourHeight:w.value,is36HourDisplay:s.is36HourDisplay},null,8,["hourHeight","is36HourDisplay"])],4),$("div",Hl,[(Y(!0),X(pe,null,Be(e.channels,(D,W)=>(Y(),X("div",{class:"timetable-grid__channel-column",key:D.channel.id,style:me({left:`${W*y.value}px`,width:`${y.value}px`,height:`${Oe.value}px`})},[$("div",{class:"timetable-grid__channel-background",style:me({height:`${Oe.value}px`})},null,4),(Y(!0),X(pe,null,Be(D.programs,B=>(Y(),X(pe,{key:B.id},[pt(B)?(Y(),he(Rt,{key:0,program:B,channel:D.channel,hourHeight:w.value,channelWidth:gt(D,B,!1),fullChannelWidth:y.value,isSplit:it(D,B,!1),viewportHeight:H.value,channelHeaderHeight:P.value,isScrollAtBottom:q.value,isSelected:i.value===B.id,isPast:_t(B),is36HourDisplay:s.is36HourDisplay,isNextReserved:bt(D,B,!1),resizeTrigger:I.value,onClick:E=>Ct(B),onShowDetail:E=>l.$emit("show-program-detail",B.id,D.channel,B),onQuickReserve:E=>l.$emit("quick-reserve",B.id,D.channel,B)},null,8,["program","channel","hourHeight","channelWidth","fullChannelWidth","isSplit","viewportHeight","channelHeaderHeight","isScrollAtBottom","isSelected","isPast","is36HourDisplay","isNextReserved","resizeTrigger","onClick","onShowDetail","onQuickReserve"])):de("",!0)],64))),128)),at(D)?(Y(!0),X(pe,{key:0},Be(na(D),B=>(Y(),X(pe,{key:B.channel.id},[(Y(!0),X(pe,null,Be(B.programs,E=>(Y(),X(pe,{key:E.id},[pt(E)?(Y(),he(Rt,{key:0,program:E,channel:B.channel,hourHeight:w.value,channelWidth:gt(D,E,!0),fullChannelWidth:y.value,isSplit:it(D,E,!0),viewportHeight:H.value,channelHeaderHeight:P.value,isScrollAtBottom:q.value,isSubchannel:!0,isSelected:i.value===E.id,isPast:_t(E),is36HourDisplay:s.is36HourDisplay,isNextReserved:bt(D,E,!0),resizeTrigger:I.value,onClick:ue=>Ct(E),onShowDetail:ue=>l.$emit("show-program-detail",E.id,B.channel,E),onQuickReserve:ue=>l.$emit("quick-reserve",E.id,B.channel,E)},null,8,["program","channel","hourHeight","channelWidth","fullChannelWidth","isSplit","viewportHeight","channelHeaderHeight","isScrollAtBottom","isSelected","isPast","is36HourDisplay","isNextReserved","resizeTrigger","onClick","onShowDetail","onQuickReserve"])):de("",!0)],64))),128))],64))),128)):de("",!0)],4))),128)),r(ul,{hourHeight:w.value,totalWidth:xe.value,channelHeaderHeight:P.value},null,8,["hourHeight","totalWidth","channelHeaderHeight"])])],4)],4)],34),r(Vt,{name:"fade"},{default:Q(()=>[o.value?(Y(),he(J,{key:0,class:"timetable-grid__next-day-button",variant:"elevated",color:"background-lighten-1",onClick:h[0]||(h[0]=D=>l.$emit("go-to-next-day"))},{default:Q(()=>[r(C,{icon:"fluent:chevron-down-20-regular",width:"20px"}),h[2]||(h[2]=$("span",null,"次の日を見る",-1))]),_:1})):de("",!0)]),_:1}),r(Vt,{name:"fade"},{default:Q(()=>[f.value?(Y(),he(J,{key:0,class:"timetable-grid__prev-day-button",variant:"elevated",color:"background-lighten-1",onClick:h[1]||(h[1]=D=>l.$emit("go-to-previous-day"))},{default:Q(()=>[r(C,{icon:"fluent:chevron-up-20-regular",width:"20px"}),h[3]||(h[3]=$("span",null,"前の日を見る",-1))]),_:1})):de("",!0)]),_:1})],4)}}}),Yl=Re(El,[["__scopeId","data-v-4bfd07bf"]]),Qt=ke({active:{type:[String,Array],default:void 0},disabled:{type:[Boolean,String,Array],default:null},nextIcon:{type:Ke,default:"$next"},prevIcon:{type:Ke,default:"$prev"},modeIcon:{type:Ke,default:"$subgroup"},text:String,viewMode:{type:String,default:"month"}},"VDatePickerControls"),At=we()({name:"VDatePickerControls",props:Qt(),emits:{"click:year":()=>!0,"click:month":()=>!0,"click:prev":()=>!0,"click:next":()=>!0,"click:text":()=>!0},setup(e,a){let{emit:v}=a;const s=c(()=>Array.isArray(e.disabled)?e.disabled.includes("text"):!!e.disabled),t=c(()=>Array.isArray(e.disabled)?e.disabled.includes("mode"):!!e.disabled),m=c(()=>Array.isArray(e.disabled)?e.disabled.includes("prev"):!!e.disabled),u=c(()=>Array.isArray(e.disabled)?e.disabled.includes("next"):!!e.disabled);function n(){v("click:prev")}function i(){v("click:next")}function o(){v("click:year")}function f(){v("click:month")}return Me(()=>r("div",{class:["v-date-picker-controls"]},[r(J,{class:"v-date-picker-controls__month-btn","data-testid":"month-btn",disabled:s.value,text:e.text,variant:"text",rounded:!0,onClick:f},null),r(J,{class:"v-date-picker-controls__mode-btn","data-testid":"year-btn",disabled:t.value,density:"comfortable",icon:e.modeIcon,variant:"text",onClick:o},null),r(Qa,null,null),r("div",{class:"v-date-picker-controls__month"},[r(J,{"data-testid":"prev-month",disabled:m.value,icon:e.prevIcon,variant:"text",onClick:n},null),r(J,{"data-testid":"next-month",disabled:u.value,icon:e.nextIcon,variant:"text",onClick:i},null)])])),{}}}),Nl=ke({appendIcon:Ke,color:String,header:String,transition:String,onClick:Pa()},"VDatePickerHeader"),$t=we()({name:"VDatePickerHeader",props:Nl(),emits:{click:()=>!0,"click:append":()=>!0},setup(e,a){let{emit:v,slots:s}=a;const{backgroundColorClasses:t,backgroundColorStyles:m}=ft(e,"color");function u(){v("click")}function n(){v("click:append")}return Me(()=>{const i=!!(s.default||e.header),o=!!(s.append||e.appendIcon);return r("div",{class:["v-date-picker-header",{"v-date-picker-header--clickable":!!e.onClick},t.value],style:m.value,onClick:u},[s.prepend&&r("div",{key:"prepend",class:"v-date-picker-header__prepend"},[s.prepend()]),i&&r(Xt,{key:"content",name:e.transition},{default:()=>{var f;return[r("div",{key:e.header,class:"v-date-picker-header__content"},[((f=s.default)==null?void 0:f.call(s))??e.header])]}}),o&&r("div",{class:"v-date-picker-header__append"},[s.append?r(tt,{key:"append-defaults",disabled:!e.appendIcon,defaults:{VBtn:{icon:e.appendIcon,variant:"text"}}},{default:()=>{var f;return[(f=s.append)==null?void 0:f.call(s)]}}):r(J,{key:"append-btn",icon:e.appendIcon,variant:"text",onClick:n},null)])])}),{}}}),Wl=ke({allowedDates:[Array,Function],disabled:{type:Boolean,default:null},displayValue:null,modelValue:Array,month:[Number,String],max:null,min:null,showAdjacentMonths:Boolean,year:[Number,String],weekdays:{type:Array,default:()=>[0,1,2,3,4,5,6]},weeksInMonth:{type:String,default:"dynamic"},firstDayOfWeek:[Number,String]},"calendar");function Ll(e){const a=Le(),v=He(e,"modelValue",[],S=>Qe(S).map(T=>a.date(T))),s=c(()=>e.displayValue?a.date(e.displayValue):v.value.length>0?a.date(v.value[0]):e.min?a.date(e.min):Array.isArray(e.allowedDates)?a.date(e.allowedDates[0]):a.date()),t=He(e,"year",void 0,S=>{const T=S!=null?Number(S):a.getYear(s.value);return a.startOfYear(a.setYear(a.date(),T))},S=>a.getYear(S)),m=He(e,"month",void 0,S=>{const T=S!=null?Number(S):a.getMonth(s.value),x=a.setYear(a.startOfMonth(a.date()),a.getYear(t.value));return a.setMonth(x,T)},S=>a.getMonth(S)),u=c(()=>e.firstDayOfWeek??e.weekdays[0]),n=c(()=>{const S=Number(e.firstDayOfWeek??0);return e.weekdays.map(T=>(T+S)%7)}),i=c(()=>{const S=a.getWeekArray(m.value,u.value),T=S.flat(),x=6*7;if(e.weeksInMonth==="static"&&T.length<x){const V=T[T.length-1];let p=[];for(let L=1;L<=x-T.length;L++)p.push(a.addDays(V,L)),L%7===0&&(S.push(p),p=[])}return S});function o(S,T){return S.filter(x=>n.value.includes(a.toJsDate(x).getDay())).map((x,V)=>{const p=a.toISO(x),L=!a.isSameMonth(x,m.value),F=a.isSameDay(x,a.startOfMonth(m.value)),G=a.isSameDay(x,a.endOfMonth(m.value)),Z=a.isSameDay(x,m.value);return{date:x,isoDate:p,formatted:a.format(x,"keyboardDate"),year:a.getYear(x),month:a.getMonth(x),isDisabled:q(x),isWeekStart:V%7===0,isWeekEnd:V%7===6,isToday:a.isSameDay(x,T),isAdjacent:L,isHidden:L&&!e.showAdjacentMonths,isStart:F,isSelected:v.value.some(N=>a.isSameDay(x,N)),isEnd:G,isSame:Z,localized:a.format(x,"dayOfMonth")}})}const f=c(()=>{const S=a.startOfWeek(s.value,e.firstDayOfWeek),T=[];for(let V=0;V<=6;V++)T.push(a.addDays(S,V));const x=a.date();return o(T,x)}),g=c(()=>{const S=i.value.flat(),T=a.date();return o(S,T)}),H=c(()=>i.value.map(S=>S.length?Ca(a,S[0]):null));function q(S){if(e.disabled)return!0;const T=a.date(S);return e.min&&a.isAfter(a.date(e.min),T)||e.max&&a.isAfter(T,a.date(e.max))?!0:Array.isArray(e.allowedDates)&&e.allowedDates.length>0?!e.allowedDates.some(x=>a.isSameDay(a.date(x),T)):typeof e.allowedDates=="function"?!e.allowedDates(T):!1}return{displayValue:s,daysInMonth:g,daysInWeek:f,genDays:o,model:v,weeksInMonth:i,weekDays:n,weekNumbers:H}}const Jt=ke({color:String,hideWeekdays:Boolean,multiple:[Boolean,Number,String],showWeek:Boolean,transition:{type:String,default:"picker-transition"},reverseTransition:{type:String,default:"picker-reverse-transition"},...Ne(Wl(),["displayValue"])},"VDatePickerMonth"),Et=we()({name:"VDatePickerMonth",props:Jt(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=k(),{daysInMonth:m,model:u,weekNumbers:n}=Ll(e),i=Le(),o=Ye(),f=Ye(),g=Ye(!1),H=c(()=>g.value?e.reverseTransition:e.transition);e.multiple==="range"&&u.value.length>0&&(o.value=u.value[0],u.value.length>1&&(f.value=u.value[u.value.length-1]));const q=c(()=>{const V=["number","string"].includes(typeof e.multiple)?Number(e.multiple):1/0;return u.value.length>=V});_e(m,(V,p)=>{p&&(g.value=i.isBefore(V[0].date,p[0].date))});function S(V){const p=i.startOfDay(V);if(u.value.length===0?o.value=void 0:u.value.length===1&&(o.value=u.value[0],f.value=void 0),!o.value)o.value=p,u.value=[o.value];else if(f.value)o.value=V,f.value=void 0,u.value=[o.value];else{if(i.isSameDay(p,o.value)){o.value=void 0,u.value=[];return}else i.isBefore(p,o.value)?(f.value=i.endOfDay(o.value),o.value=p):f.value=i.endOfDay(p);const L=i.getDiff(f.value,o.value,"days"),F=[o.value];for(let G=1;G<L;G++){const Z=i.addDays(o.value,G);F.push(Z)}F.push(f.value),u.value=F}}function T(V){const p=u.value.findIndex(L=>i.isSameDay(L,V));if(p===-1)u.value=[...u.value,V];else{const L=[...u.value];L.splice(p,1),u.value=L}}function x(V){e.multiple==="range"?S(V):e.multiple?T(V):u.value=[V]}return()=>r("div",{class:"v-date-picker-month"},[e.showWeek&&r("div",{key:"weeks",class:"v-date-picker-month__weeks"},[!e.hideWeekdays&&r("div",{key:"hide-week-days",class:"v-date-picker-month__day"},[vt(" ")]),n.value.map(V=>r("div",{class:["v-date-picker-month__day","v-date-picker-month__day--adjacent"]},[V]))]),r(Xt,{name:H.value},{default:()=>{var V;return[r("div",{ref:t,key:(V=m.value[0].date)==null?void 0:V.toString(),class:"v-date-picker-month__days"},[!e.hideWeekdays&&i.getWeekdays(e.firstDayOfWeek).map(p=>r("div",{class:["v-date-picker-month__day","v-date-picker-month__weekday"]},[p])),m.value.map((p,L)=>{const F={props:{onClick:()=>x(p.date)},item:p,i:L};return q.value&&!p.isSelected&&(p.isDisabled=!0),r("div",{class:["v-date-picker-month__day",{"v-date-picker-month__day--adjacent":p.isAdjacent,"v-date-picker-month__day--hide-adjacent":p.isHidden,"v-date-picker-month__day--selected":p.isSelected,"v-date-picker-month__day--week-end":p.isWeekEnd,"v-date-picker-month__day--week-start":p.isWeekStart}],"data-v-date":p.isDisabled?void 0:p.isoDate},[(e.showAdjacentMonths||!p.isAdjacent)&&r(tt,{defaults:{VBtn:{class:"v-date-picker-month__day-btn",color:(p.isSelected||p.isToday)&&!p.isDisabled?e.color:void 0,disabled:p.isDisabled,icon:!0,ripple:!1,text:p.localized,variant:p.isDisabled?p.isToday?"outlined":"text":p.isToday&&!p.isSelected?"outlined":"flat",onClick:()=>x(p.date)}}},{default:()=>{var G;return[((G=s.day)==null?void 0:G.call(s,F))??r(J,F.props,null)]}})])})])]}})])}}),Zt=ke({color:String,height:[String,Number],min:null,max:null,modelValue:Number,year:Number},"VDatePickerMonths"),Yt=we()({name:"VDatePickerMonths",props:Zt(),emits:{"update:modelValue":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=Le(),m=He(e,"modelValue"),u=c(()=>{let n=t.startOfYear(t.date());return e.year&&(n=t.setYear(n,e.year)),Ft(12).map(i=>{const o=t.format(n,"monthShort"),f=!!(e.min&&t.isAfter(t.startOfMonth(t.date(e.min)),n)||e.max&&t.isAfter(n,t.startOfMonth(t.date(e.max))));return n=t.getNextMonth(n),{isDisabled:f,text:o,value:i}})});return Gt(()=>{m.value=m.value??t.getMonth(t.date())}),Me(()=>r("div",{class:"v-date-picker-months",style:{height:jt(e.height)}},[r("div",{class:"v-date-picker-months__content"},[u.value.map((n,i)=>{var g;const o={active:m.value===i,color:m.value===i?e.color:void 0,disabled:n.isDisabled,rounded:!0,text:n.text,variant:m.value===n.value?"flat":"text",onClick:()=>f(i)};function f(H){if(m.value===H){v("update:modelValue",m.value);return}m.value=H}return((g=s.month)==null?void 0:g.call(s,{month:n,i,props:o}))??r(J,fe({key:"month"},o),null)})])])),{}}}),ea=ke({color:String,height:[String,Number],min:null,max:null,modelValue:Number},"VDatePickerYears"),Nt=we()({name:"VDatePickerYears",props:ea(),emits:{"update:modelValue":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=Le(),m=He(e,"modelValue"),u=c(()=>{const i=t.getYear(t.date());let o=i-100,f=i+52;e.min&&(o=t.getYear(t.date(e.min))),e.max&&(f=t.getYear(t.date(e.max)));let g=t.startOfYear(t.date());return g=t.setYear(g,o),Ft(f-o+1,o).map(H=>{const q=t.format(g,"year");return g=t.setYear(g,t.getYear(g)+1),{text:q,value:H}})});Gt(()=>{m.value=m.value??t.getYear(t.date())});const n=Ha();return et(async()=>{var i;await Ce(),(i=n.el)==null||i.scrollIntoView({block:"center"})}),Me(()=>r("div",{class:"v-date-picker-years",style:{height:jt(e.height)}},[r("div",{class:"v-date-picker-years__content"},[u.value.map((i,o)=>{var g;const f={ref:m.value===i.value?n:void 0,active:m.value===i.value,color:m.value===i.value?e.color:void 0,rounded:!0,text:i.text,variant:m.value===i.value?"flat":"text",onClick:()=>{if(m.value===i.value){v("update:modelValue",m.value);return}m.value=i.value}};return((g=s.year)==null?void 0:g.call(s,{year:i,i:o,props:f}))??r(J,fe({key:"month"},f),null)})])])),{}}}),Ul=Ja("v-picker-title"),ta=ke({color:String,...Fa(),...za(),...Ua(),...La(),...Wa(),...Na(),...Ya(),...Ea(),...$a()},"VSheet"),Wt=we()({name:"VSheet",props:ta(),setup(e,a){let{slots:v}=a;const{themeClasses:s}=Ma(e),{backgroundColorClasses:t,backgroundColorStyles:m}=ft(qt(e,"color")),{borderClasses:u}=Va(e),{dimensionStyles:n}=Ba(e),{elevationClasses:i}=Ia(e),{locationStyles:o}=Ra(e),{positionClasses:f}=Oa(e),{roundedClasses:g}=Aa(e);return Me(()=>r(e.tag,{class:["v-sheet",s.value,t.value,u.value,i.value,f.value,g.value,e.class],style:[m.value,n.value,o.value,e.style]},v)),{}}}),aa=ke({bgColor:String,landscape:Boolean,title:String,hideHeader:Boolean,...ta()},"VPicker"),Lt=we()({name:"VPicker",props:aa(),setup(e,a){let{slots:v}=a;const{backgroundColorClasses:s,backgroundColorStyles:t}=ft(qt(e,"color"));return Me(()=>{const m=Wt.filterProps(e),u=!!(e.title||v.title);return r(Wt,fe(m,{color:e.bgColor,class:["v-picker",{"v-picker--landscape":e.landscape,"v-picker--with-actions":!!v.actions},e.class],style:e.style}),{default:()=>{var n;return[!e.hideHeader&&r("div",{key:"header",class:[s.value],style:[t.value]},[u&&r(Ul,{key:"picker-title"},{default:()=>{var i;return[((i=v.title)==null?void 0:i.call(v))??e.title]}}),v.header&&r("div",{class:"v-picker__header"},[v.header()])]),r("div",{class:"v-picker__body"},[(n=v.default)==null?void 0:n.call(v)]),v.actions&&r(tt,{defaults:{VBtn:{slim:!0,variant:"text"}}},{default:()=>[r("div",{class:"v-picker__actions"},[v.actions()])]})]}})}),{}}}),zl=ke({header:{type:String,default:"$vuetify.datePicker.header"},...Qt(),...Jt({weeksInMonth:"static"}),...Ne(Zt(),["modelValue"]),...Ne(ea(),["modelValue"]),...aa({title:"$vuetify.datePicker.title"}),modelValue:null},"VDatePicker"),Ut=we()({name:"VDatePicker",props:zl(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0,"update:viewMode":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=Le(),{t:m}=Ga(),u=He(e,"modelValue",void 0,b=>Qe(b).map(I=>t.date(I)),b=>e.multiple?b:b[0]),n=He(e,"viewMode"),i=c(()=>{const b=t.date(e.min);return e.min&&t.isValid(b)?b:null}),o=c(()=>{const b=t.date(e.max);return e.max&&t.isValid(b)?b:null}),f=c(()=>{var j;const b=t.date();let I=b;return(j=u.value)!=null&&j[0]?I=t.date(u.value[0]):i.value&&t.isBefore(b,i.value)?I=i.value:o.value&&t.isAfter(b,o.value)&&(I=o.value),I&&t.isValid(I)?I:b}),g=k(Number(e.month??t.getMonth(t.startOfMonth(f.value)))),H=k(Number(e.year??t.getYear(t.startOfYear(t.setMonth(f.value,g.value))))),q=Ye(!1),S=c(()=>e.multiple&&u.value.length>1?m("$vuetify.datePicker.itemsSelected",u.value.length):u.value[0]&&t.isValid(u.value[0])?t.format(t.date(u.value[0]),"normalDateWithWeekday"):m(e.header)),T=c(()=>{let b=t.date();return b=t.setDate(b,1),b=t.setMonth(b,g.value),b=t.setYear(b,H.value),t.format(b,"monthAndYear")}),x=c(()=>`date-picker-header${q.value?"-reverse":""}-transition`),V=c(()=>{if(e.disabled)return!0;const b=[];if(n.value!=="month")b.push("prev","next");else{let I=t.date();if(I=t.startOfMonth(I),I=t.setMonth(I,g.value),I=t.setYear(I,H.value),i.value){const j=t.addDays(t.startOfMonth(I),-1);t.isAfter(i.value,j)&&b.push("prev")}if(o.value){const j=t.addDays(t.endOfMonth(I),1);t.isAfter(j,o.value)&&b.push("next")}}return b});function p(){g.value<11?g.value++:(H.value++,g.value=0,ee(H.value)),N(g.value)}function L(){g.value>0?g.value--:(H.value--,g.value=11,ee(H.value)),N(g.value)}function F(){n.value="month"}function G(){n.value=n.value==="months"?"month":"months"}function Z(){n.value=n.value==="year"?"month":"year"}function N(b){n.value==="months"&&G(),v("update:month",b)}function ee(b){n.value==="year"&&Z(),v("update:year",b)}return _e(u,(b,I)=>{const j=Qe(I),te=Qe(b);if(!te.length)return;const re=t.date(j[j.length-1]),se=t.date(te[te.length-1]),ae=t.getMonth(se),U=t.getYear(se);ae!==g.value&&(g.value=ae,N(g.value)),U!==H.value&&(H.value=U,ee(H.value)),q.value=t.isBefore(re,se)}),Me(()=>{const b=Lt.filterProps(e),I=At.filterProps(e),j=$t.filterProps(e),te=Et.filterProps(e),re=Ne(Yt.filterProps(e),["modelValue"]),se=Ne(Nt.filterProps(e),["modelValue"]),ae={header:S.value,transition:x.value};return r(Lt,fe(b,{class:["v-date-picker",`v-date-picker--${n.value}`,{"v-date-picker--show-week":e.showWeek},e.class],style:e.style}),{title:()=>{var U;return((U=s.title)==null?void 0:U.call(s))??r("div",{class:"v-date-picker__title"},[m(e.title)])},header:()=>s.header?r(tt,{defaults:{VDatePickerHeader:{...ae}}},{default:()=>{var U;return[(U=s.header)==null?void 0:U.call(s,ae)]}}):r($t,fe({key:"header"},j,ae,{onClick:n.value!=="month"?F:void 0}),{...s,default:void 0}),default:()=>r(pe,null,[r(At,fe(I,{disabled:V.value,text:T.value,"onClick:next":p,"onClick:prev":L,"onClick:month":G,"onClick:year":Z}),null),r(Za,{hideOnLeave:!0},{default:()=>[n.value==="months"?r(Yt,fe({key:"date-picker-months"},re,{modelValue:g.value,"onUpdate:modelValue":[U=>g.value=U,N],min:i.value,max:o.value,year:H.value}),null):n.value==="year"?r(Nt,fe({key:"date-picker-years"},se,{modelValue:H.value,"onUpdate:modelValue":[U=>H.value=U,ee],min:i.value,max:o.value}),null):r(Et,fe({key:"date-picker-month"},te,{modelValue:u.value,"onUpdate:modelValue":U=>u.value=U,month:g.value,"onUpdate:month":[U=>g.value=U,N],year:H.value,"onUpdate:year":[U=>H.value=U,ee],min:i.value,max:o.value}),null)]})]),actions:s.actions})}),{}}}),Fl={class:"route-container"},Gl={class:"timetable-controls"},jl={class:"timetable-controls__date"},ql={key:0,class:"timetable-controls-mobile"},Xl={class:"timetable-controls-mobile__inner"},Kl={class:"timetable-controls-mobile__date"},Ql=100,Jl=Ie({__name:"TimeTable",setup(e){We();const a=Ue(),v=k(null),s=Ka(),t=c(()=>s.server_settings),m=c(()=>t.value.general.backend==="EDCB"),u=k(!1),n=k(!1),i=k(0);let o=null;function f(){o!==null&&clearTimeout(o),o=window.setTimeout(()=>{i.value++,o=null},Ql)}const g=c(()=>(i.value,ge.isSmartphoneVertical()||ge.isSmartphoneHorizontal()||ge.isTabletVertical())),H=c(()=>(i.value,!ge.isSmartphoneVertical())),q=c(()=>a.date_display_offset),S=k(!1),T=k(null),x=k(null),V=k(null),p=k(!1),L=c(()=>{const M=[],y=a.available_channel_types;for(const w of Kt)y.has(w)&&M.push({title:w,value:w});return M}),F=c({get:()=>a.selected_channel_type,set:M=>{a.changeChannelType(M)}}),G=c(()=>{const M=[],y=a.is_36hour_display&&q.value===0;for(let w=4;w<=24;w+=4){const oe=w,P=w<=12;M.push({title:`${oe.toString().padStart(2,"0")}時`,value:w,...y&&P?{props:{disabled:!0}}:{}})}return M});function Z(){let y=z().hour();return y<4&&(y+=24),Math.floor((y-4)/4)*4+4}const N=k(Z()),ee=c(()=>{const M=a.selected_date.add(q.value,"day"),y=M.month()+1,w=M.date(),oe=["日","月","火","水","木","金","土"][M.day()];return`${y}/${w} (${oe})`}),b=c({get:()=>a.selected_date.toDate(),set:M=>{const y=z(M).hour(4).minute(0).second(0).millisecond(0);a.changeDate(y)}}),I=c(()=>a.can_go_previous_day),j=c(()=>a.can_go_next_day),te=c(()=>a.date_range===null?void 0:a.getBroadcastDate(a.date_range.earliest).startOf("day").toDate()),re=c(()=>a.date_range===null?void 0:a.getBroadcastDate(a.date_range.latest).endOf("day").toDate());function se(M){if(a.date_range===null)return!1;const y=z(M),w=a.getBroadcastDate(a.date_range.earliest),oe=a.getBroadcastDate(a.date_range.latest);return y.isSameOrAfter(w,"day")&&y.isSameOrBefore(oe,"day")}function ae(M){a.changeChannelType(M)}function U(M){n.value=!1;const y=z(M).hour(4).minute(0).second(0).millisecond(0);a.changeDate(y)}function _(M){M===null||v.value===null||v.value.scrollToHour(M)}async function O(){await a.goToPreviousDay(),await Ce(),v.value!==null&&v.value.scrollToEnd()}async function d(){await a.goToNextDay(),await Ce(),v.value!==null&&v.value.scrollToStart()}async function R(){await a.goToCurrentTime(),await Ce(),v.value!==null&&v.value.scrollToCurrentTime(!0,!0)}function A(M){const y=Math.floor((M-4)/4)*4+4,w=Math.max(4,Math.min(24,y));N.value=w}function K(M){a.setDateDisplayOffset(M)}async function ne(M,y,w){const oe=z(w.end_time);if(p.value=oe.isBefore(z()),w.reservation!==null){const P=await Fe.fetchReservation(w.reservation.id);P!==null?(T.value=P,x.value=null,V.value=null):(T.value=ie(w,y),x.value=null,V.value=null)}else T.value=ie(w,y),x.value=null,V.value=null;S.value=!0}function ie(M,y){return{id:-1,channel:y,program:M,is_recording_in_progress:!1,recording_availability:"Full",comment:"",scheduled_recording_file_name:"",estimated_recording_file_size:0,record_settings:structuredClone(Bt)}}async function ve(){await a.fetchTimeTableData()}async function ce(){await a.fetchTimeTableData()}async function Se(){await a.fetchTimeTableData()}async function le(M,y,w){if(z(w.end_time).isBefore(z()))return;if(m.value===!1){ct.warning("録画予約機能は EDCB バックエンド選択時のみ利用できます。");return}if(w.reservation!==null){const De=await Fe.fetchReservation(w.reservation.id);if(De===null)return;const xe=structuredClone(De.record_settings);if(xe.is_enabled=!xe.is_enabled,await Fe.updateReservation(De.id,xe)!==null){const at=xe.is_enabled?`録画予約を有効にしました。
番組開始時刻になると自動的に録画が開始されます。`:`録画予約を無効にしました。
番組開始時刻までに再度予約を有効にしない限り、この番組は録画されません。`;ct.success(at),await a.fetchTimeTableData()}return}await Fe.addReservation(M,structuredClone(Bt))&&(ct.success("録画予約を追加しました。"),await a.fetchTimeTableData())}return et(async()=>{window.addEventListener("resize",f),await s.fetchServerSettingsOnce(),await a.initialLoad()}),mt(()=>{window.removeEventListener("resize",f),o!==null&&(clearTimeout(o),o=null),a.reset()}),_e(()=>a.selected_date,()=>{a.setDateDisplayOffset(0)}),(M,y)=>{const w=Ze("Icon"),oe=zt("ftooltip");return Y(),X("div",Fl,[r(_a,null,ja({_:2},[g.value?void 0:{name:"timetable-controls",fn:Q(()=>[$("div",Gl,[r(Ge,{class:"timetable-controls__channel-type",variant:"outlined",density:"compact","hide-details":"",items:L.value,modelValue:F.value,"onUpdate:modelValue":[y[0]||(y[0]=P=>F.value=P),ae]},null,8,["items","modelValue"]),$("div",jl,[r(J,{variant:"flat",icon:"",size:"small",disabled:!I.value,onClick:O},{default:Q(()=>[r(w,{icon:"fluent:chevron-left-20-regular",width:"20px"})]),_:1},8,["disabled"]),r(It,{modelValue:n.value,"onUpdate:modelValue":y[2]||(y[2]=P=>n.value=P),"close-on-content-click":!1},{activator:Q(({props:P})=>[r(J,fe({variant:"flat",class:"timetable-controls__date-button"},P),{default:Q(()=>[vt(Te(ee.value),1)]),_:1},16)]),default:Q(()=>[r(Ut,{modelValue:b.value,"onUpdate:modelValue":[y[1]||(y[1]=P=>b.value=P),U],color:"primary",min:te.value,max:re.value,"allowed-dates":se},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"]),r(J,{variant:"flat",icon:"",size:"small",disabled:!j.value,onClick:d},{default:Q(()=>[r(w,{icon:"fluent:chevron-right-20-regular",width:"20px"})]),_:1},8,["disabled"])]),r(Ge,{class:"timetable-controls__time",variant:"outlined",density:"compact","hide-details":"",items:G.value,modelValue:N.value,"onUpdate:modelValue":[y[3]||(y[3]=P=>N.value=P),_]},null,8,["items","modelValue"]),dt((Y(),he(J,{variant:"flat",class:"timetable-controls__now-button",icon:"",onClick:R},{default:Q(()=>[r(w,{icon:"fluent:clock-20-regular",width:"22px"})]),_:1})),[[oe,"現在時刻に移動",void 0,{bottom:!0}]]),dt((Y(),he(J,{variant:"flat",class:"timetable-controls__settings-button",icon:"",onClick:y[4]||(y[4]=P=>u.value=!0)},{default:Q(()=>[r(w,{icon:"fluent:settings-20-regular",width:"22px"})]),_:1})),[[oe,"番組表の表示設定",void 0,{bottom:!0}]])])]),key:"0"}]),1024),$("main",null,[r(ba,{"icon-only":H.value},null,8,["icon-only"]),$("div",{class:Je(["timetable-container",{"timetable-container--loading":Xe(a).is_loading}])},[r(ka),g.value?(Y(),X("div",ql,[$("div",Xl,[r(Ge,{class:"timetable-controls-mobile__channel-type",variant:"outlined",density:"compact","hide-details":"",items:L.value,modelValue:F.value,"onUpdate:modelValue":[y[5]||(y[5]=P=>F.value=P),ae]},null,8,["items","modelValue"]),$("div",Kl,[r(It,{modelValue:n.value,"onUpdate:modelValue":y[7]||(y[7]=P=>n.value=P),"close-on-content-click":!1},{activator:Q(({props:P})=>[r(J,fe({variant:"flat",class:"timetable-controls-mobile__date-button",size:"small"},P),{default:Q(()=>[vt(Te(ee.value),1)]),_:1},16)]),default:Q(()=>[r(Ut,{modelValue:b.value,"onUpdate:modelValue":[y[6]||(y[6]=P=>b.value=P),U],color:"primary",min:te.value,max:re.value,"allowed-dates":se},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"])]),r(Ge,{class:"timetable-controls-mobile__time",variant:"outlined",density:"compact","hide-details":"",items:G.value,modelValue:N.value,"onUpdate:modelValue":[y[8]||(y[8]=P=>N.value=P),_]},null,8,["items","modelValue"]),r(J,{variant:"flat",class:"timetable-controls-mobile__now-button",icon:"",size:"small",onClick:R},{default:Q(()=>[r(w,{icon:"fluent:clock-20-regular",width:"18px"})]),_:1}),r(J,{variant:"flat",class:"timetable-controls-mobile__settings-button",icon:"",size:"small",onClick:y[9]||(y[9]=P=>u.value=!0)},{default:Q(()=>[r(w,{icon:"fluent:settings-20-regular",width:"18px"})]),_:1})])])):de("",!0),r(Yl,{ref_key:"timetableGridRef",ref:v,channels:Xe(a).channels_data,is36HourDisplay:Xe(a).is_36hour_display,canGoPreviousDay:I.value,canGoNextDay:j.value,onTimeSlotChange:A,onDateDisplayOffsetChange:K,onShowProgramDetail:ne,onQuickReserve:le,onGoToNextDay:d,onGoToPreviousDay:O},null,8,["channels","is36HourDisplay","canGoPreviousDay","canGoNextDay"])],2)]),r(Ta,{isOpen:u.value,"onUpdate:isOpen":y[10]||(y[10]=P=>u.value=P)},null,8,["isOpen"]),r(Sa,{modelValue:S.value,"onUpdate:modelValue":y[11]||(y[11]=P=>S.value=P),reservation:T.value,program:x.value,channel:V.value,isPastProgram:p.value,onAdded:ve,onUpdated:ce,onDeleted:Se},null,8,["modelValue","reservation","program","channel","isPastProgram"])])}}}),pn=Re(Jl,[["__scopeId","data-v-b97ebe40"]]);export{pn as default};
