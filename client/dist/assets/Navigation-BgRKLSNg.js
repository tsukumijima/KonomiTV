import{F as D,G as C,ab as R,a9 as A,d as N,aA as K,H as d,w as f,c as u,b4 as T,N as y,L as b,M as m,J as k,aK as U,Z as S,v as M,a5 as F,P as G,aB as Q,aC as z,aD as j,K as J,U as r,R as g,_ as H,A as L,a6 as X,X as V,W as Z,$ as p,r as Y,O as x}from"./index-LUcZSfg3.js";import{_ as nn,B as tn}from"./BottomNavigation-DprrKkNz.js";import{V as P}from"./VSpacer-ChgMJFbm.js";function en(n,l,i,c){function a(e){return e instanceof i?e:new i(function(o){o(e)})}return new(i||(i=Promise))(function(e,o){function v(_){try{t(c.next(_))}catch(O){o(O)}}function w(_){try{t(c.throw(_))}catch(O){o(O)}}function t(_){_.done?e(_.value):a(_.value).then(v,w)}t((c=c.apply(n,[])).next())})}function an(n,l){var i={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},c,a,e,o;return o={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function v(t){return function(_){return w([t,_])}}function w(t){if(c)throw new TypeError("Generator is already executing.");for(;o&&(o=0,t[0]&&(i=0)),i;)try{if(c=1,a&&(e=t[0]&2?a.return:t[0]?a.throw||((e=a.return)&&e.call(a),0):a.next)&&!(e=e.call(a,t[1])).done)return e;switch(a=0,e&&(t=[t[0]&2,e.value]),t[0]){case 0:case 1:e=t;break;case 4:return i.label++,{value:t[1],done:!1};case 5:i.label++,a=t[1],t=[0];continue;case 7:t=i.ops.pop(),i.trys.pop();continue;default:if(e=i.trys,!(e=e.length>0&&e[e.length-1])&&(t[0]===6||t[0]===2)){i=0;continue}if(t[0]===3&&(!e||t[1]>e[0]&&t[1]<e[3])){i.label=t[1];break}if(t[0]===6&&i.label<e[1]){i.label=e[1],e=t;break}if(e&&i.label<e[2]){i.label=e[2],i.ops.push(t);break}e[2]&&i.ops.pop(),i.trys.pop();continue}t=l.call(n,i)}catch(_){t=[6,_],a=0}finally{c=e=0}if(t[0]&5)throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}var sn=function(){function n(){var l=this;this.event=null,this.callbacks=[],this.install=function(){return en(l,void 0,void 0,function(){var i=this;return an(this,function(c){switch(c.label){case 0:return this.event?(this.event.prompt(),[4,this.event.userChoice.then(function(a){var e=a.outcome;return i.updateEvent(null),e==="accepted"})]):[3,2];case 1:return[2,c.sent()];case 2:throw new Error("Not allowed to prompt.")}})})},!(typeof window>"u")&&(window.addEventListener("beforeinstallprompt",function(i){i.preventDefault(),l.updateEvent(i)}),window.addEventListener("appinstalled",function(){l.updateEvent(null)}))}return n.prototype.getEvent=function(){return this.event},n.prototype.canInstall=function(){return this.event!==null},n.prototype.updateEvent=function(l){var i=this;l!==this.event&&(this.event=l,this.callbacks.forEach(function(c){return c(i.canInstall())}))},n.prototype.addListener=function(l){l(this.canInstall()),this.callbacks.push(l)},n.prototype.removeListener=function(l){this.callbacks=this.callbacks.filter(function(i){return l!==i})},n}(),q=new sn;const on={class:"header"},rn={key:0,class:"search-box"},ln=["placeholder"],cn=D({__name:"HeaderBar",setup(n){const l=C(!1),i=C(""),c=Q(),a=K(),e=s=>{if(Array.isArray(s)){const h=s[0];return typeof h=="string"?h:void 0}if(typeof s=="string")return s},o=()=>{if(a.path.startsWith("/clip-videos")){i.value=e(a.query.keyword)??"";return}if(a.path.endsWith("/search")&&a.query.query){i.value=decodeURIComponent(a.query.query);return}};R(()=>{q.addListener(s=>{l.value=s}),o()}),A(()=>a.fullPath,o);const v=N(()=>{const s=a.path;return s.startsWith("/clip-videos")?"クリップ動画を検索...":s.startsWith("/videos")||s.startsWith("/mylist")||s.startsWith("/watched-history")?"録画番組を検索...":"放送予定の番組を検索..."}),w=()=>a.path.startsWith("/clip-videos")?"/clip-videos/":a.path.startsWith("/videos")||a.path.startsWith("/mylist")||a.path.startsWith("/watched-history")?"/videos/search":"/tv/search",t=s=>{s.key==="Enter"&&!s.isComposing&&_()},_=async()=>{const s=i.value.trim();if(a.path.startsWith("/clip-videos")){const I={order:e(a.query.order)==="asc"?"asc":"desc",page:"1"};s!==""&&(I.keyword=s);try{await c.push({path:"/clip-videos/",query:I})}catch(B){if(z(B,j.duplicated)){window.dispatchEvent(new CustomEvent("clip-videos-search",{detail:s}));return}throw B}return}if(s==="")return;const W=w();c.push(`${W}?query=${encodeURIComponent(s)}`)},O=N(()=>{const s=a.path;return!s.startsWith("/captures")&&!s.startsWith("/settings")&&!s.startsWith("/login")&&!s.startsWith("/register")});return(s,h)=>{const W=S("router-link"),$=S("Icon");return r(),d("header",on,[f((r(),m(W,{class:"konomitv-logo ml-3 ml-md-6",to:"/tv/"},{default:k(()=>[...h[2]||(h[2]=[b("img",{class:"konomitv-logo__image",src:nn,height:"21"},null,-1)])]),_:1})),[[g]]),u(P),T(s.$slots,"timetable-controls",{},void 0,!0),O.value?(r(),d("div",rn,[f(b("input",{class:"search-input",type:"search",enterkeyhint:"search",placeholder:v.value,"onUpdate:modelValue":h[0]||(h[0]=E=>i.value=E),onKeydown:t},null,40,ln),[[U,i.value]]),u($,{class:"search-input__icon",icon:"fluent:search-20-filled",height:"24px",onClick:_})])):y("",!0),f(u(G,{variant:"flat",class:"pwa-install-button",onClick:h[1]||(h[1]=E=>F(q).install())},{default:k(()=>[u($,{icon:"material-symbols:install-desktop-rounded",height:"20px",class:"mr-1"}),h[3]||(h[3]=J(" アプリとしてインストール ",-1))]),_:1},512),[[M,l.value]]),h[4]||(h[4]=b("div",{class:"mr-3 mr-md-6"},null,-1))])}}}),En=H(cn,[["__scopeId","data-v-7797df8b"]]);class vn{static async fetchServerVersion(l=!1){const i=await L.get("/version");return i.type==="error"?(l===!1&&L.showGenericError(i,"バージョン情報を取得できませんでした。"),null):i.data}}const un=X("version",{state:()=>({server_version_info:null,last_updated_at:0}),getters:{client_version(){return V.version},server_version(){var n;return((n=this.server_version_info)==null?void 0:n.version)??null},latest_version(){var n;return((n=this.server_version_info)==null?void 0:n.latest_version)??null},is_client_develop_version(){return this.client_version.includes("-dev")},is_server_develop_version(){var n;return((n=this.server_version)==null?void 0:n.includes("-dev"))??!1},is_update_available(){return this.server_version===null||this.latest_version===null?!1:this.is_server_develop_version===!1&&this.server_version!==this.latest_version||this.is_server_develop_version===!0&&this.server_version.replace("-dev","")===this.latest_version},is_version_mismatch(){return this.server_version===null?!1:this.client_version!==this.server_version},server_environment(){var n;return((n=this.server_version_info)==null?void 0:n.environment)??null},is_linux_environment(){const n=this.server_environment;return n==="Linux"||n==="Linux-Docker"||n==="Linux-ARM"}},actions:{async fetchServerVersion(n=!1){if(this.server_version_info!==null&&n===!1)return V.time()-this.last_updated_at>60&&this.fetchServerVersion(!0),this.server_version_info;const l=await vn.fetchServerVersion();return l===null?null:(this.server_version_info=l,this.last_updated_at=V.time(),this.server_version_info)}}}),_n=D({name:"Navigation",components:{BottomNavigation:tn},props:{iconOnly:{type:Boolean,default:!1}},computed:{...Z(un)},async created(){await this.versionStore.fetchServerVersion()}}),hn={key:0,class:"navigation__link-text"},dn={key:0,class:"navigation__link-text"},pn={key:0,class:"navigation__link-text"},fn={key:0,class:"navigation__link-text"},yn={key:0,class:"navigation__link-text"},gn={key:0,class:"navigation__link-text"},kn={key:0,class:"navigation__link-text"},mn={key:0,class:"navigation__link-text"},wn={key:0,class:"navigation__link-text"},bn={key:0,class:"navigation__link-text"};function On(n,l,i,c,a,e){const o=S("Icon"),v=S("router-link"),w=S("BottomNavigation"),t=Y("ftooltip");return r(),d("div",null,[b("div",{class:p(["navigation-container elevation-8",{"navigation-container--icon-only":n.iconOnly}])},[b("nav",{class:p(["navigation",{"navigation--icon-only":n.iconOnly}])},[b("div",{class:p(["navigation-scroll",{"navigation-scroll--icon-only":n.iconOnly}])},[f((r(),m(v,{class:p(["navigation__link",{"navigation__link--active":n.$route.path.startsWith("/tv"),"navigation__link--icon-only":n.iconOnly}]),"active-class":"navigation__link--active",to:"/tv/"},{default:k(()=>[u(o,{class:"navigation__link-icon",icon:"fluent:tv-20-regular",width:"26px"}),n.iconOnly?y("",!0):(r(),d("span",hn,"テレビをみる"))]),_:1},8,["class"])),[[g],[t,n.iconOnly?"テレビをみる":"",void 0,{right:!0}]]),f((r(),m(v,{class:p(["navigation__link",{"navigation__link--active":n.$route.path.startsWith("/videos"),"navigation__link--icon-only":n.iconOnly}]),"active-class":"navigation__link--active",to:"/videos/"},{default:k(()=>[u(o,{class:"navigation__link-icon",icon:"fluent:movies-and-tv-20-regular",width:"26px"}),n.iconOnly?y("",!0):(r(),d("span",dn,"ビデオをみる"))]),_:1},8,["class"])),[[g],[t,n.iconOnly?"ビデオをみる":"",void 0,{right:!0}]]),f((r(),m(v,{class:p(["navigation__link",{"navigation__link--active":n.$route.path.startsWith("/clip-videos"),"navigation__link--icon-only":n.iconOnly}]),"active-class":"navigation__link--active",to:"/clip-videos/"},{default:k(()=>[u(o,{class:"navigation__link-icon",icon:"fluent:video-clip-20-regular",width:"26px"}),n.iconOnly?y("",!0):(r(),d("span",pn,"クリップ動画"))]),_:1},8,["class"])),[[g],[t,n.iconOnly?"クリップ動画":"",void 0,{right:!0}]]),f((r(),m(v,{class:p(["navigation__link",{"navigation__link--active":n.$route.path.startsWith("/timetable"),"navigation__link--icon-only":n.iconOnly}]),"active-class":"navigation__link--active",to:"/timetable/"},{default:k(()=>[u(o,{class:"navigation__link-icon",icon:"fluent:calendar-ltr-20-regular",width:"26px"}),n.iconOnly?y("",!0):(r(),d("span",fn,"番組表"))]),_:1},8,["class"])),[[g],[t,n.iconOnly?"番組表":"",void 0,{right:!0}]]),f((r(),m(v,{class:p(["navigation__link",{"navigation__link--active":n.$route.path.startsWith("/reservations"),"navigation__link--icon-only":n.iconOnly}]),"active-class":"navigation__link--active",to:"/reservations/"},{default:k(()=>[u(o,{class:"navigation__link-icon",icon:"fluent:timer-16-regular",width:"26px",style:{padding:"0.5px"}}),n.iconOnly?y("",!0):(r(),d("span",yn,"録画予約"))]),_:1},8,["class"])),[[g],[t,n.iconOnly?"録画予約":"",void 0,{right:!0}]]),f((r(),m(v,{class:p(["navigation__link",{"navigation__link--active":n.$route.path.startsWith("/captures"),"navigation__link--icon-only":n.iconOnly}]),"active-class":"navigation__link--active",to:"/captures/"},{default:k(()=>[u(o,{class:"navigation__link-icon",icon:"fluent:image-multiple-24-regular",width:"26px"}),n.iconOnly?y("",!0):(r(),d("span",gn,"キャプチャ"))]),_:1},8,["class"])),[[g],[t,n.iconOnly?"キャプチャ":"",void 0,{right:!0}]]),f((r(),m(v,{class:p(["navigation__link",{"navigation__link--active":n.$route.path.startsWith("/mylist"),"navigation__link--icon-only":n.iconOnly}]),"active-class":"navigation__link--active",to:"/mylist/"},{default:k(()=>[u(o,{class:"navigation__link-icon",icon:"ic:round-playlist-play",width:"26px"}),n.iconOnly?y("",!0):(r(),d("span",kn,"マイリスト"))]),_:1},8,["class"])),[[g],[t,n.iconOnly?"マイリスト":"",void 0,{right:!0}]]),f((r(),m(v,{class:p(["navigation__link",{"navigation__link--active":n.$route.path.startsWith("/watched-history"),"navigation__link--icon-only":n.iconOnly}]),"active-class":"navigation__link--active",to:"/watched-history/"},{default:k(()=>[u(o,{class:"navigation__link-icon",icon:"fluent:history-20-regular",width:"26px"}),n.iconOnly?y("",!0):(r(),d("span",mn,"視聴履歴"))]),_:1},8,["class"])),[[g],[t,n.iconOnly?"視聴履歴":"",void 0,{right:!0}]]),u(P),f((r(),m(v,{class:p(["navigation__link",{"navigation__link--active":n.$route.path.startsWith("/settings"),"navigation__link--icon-only":n.iconOnly}]),"active-class":"navigation__link--active",to:"/settings/"},{default:k(()=>[u(o,{class:"navigation__link-icon",icon:"fluent:settings-20-regular",width:"26px"}),n.iconOnly?y("",!0):(r(),d("span",wn,"設定"))]),_:1},8,["class"])),[[g],[t,n.iconOnly?"設定":"",void 0,{right:!0}]]),f((r(),d("a",{class:p(["navigation__link",{"navigation__link--develop-version":n.versionStore.is_client_develop_version,"navigation__link--highlight":n.versionStore.is_update_available,"navigation__link--icon-only":n.iconOnly}]),"active-class":"navigation__link--active",href:"https://github.com/tsukumijima/KonomiTV",target:"_blank"},[u(o,{class:"navigation__link-icon",icon:"fluent:info-16-regular",width:"26px"}),n.iconOnly?y("",!0):(r(),d("span",bn,"version "+x(n.versionStore.client_version),1))],2)),[[g],[t,n.iconOnly?n.versionStore.is_update_available?`アップデートがあります (version ${n.versionStore.latest_version})`:`version ${n.versionStore.client_version}`:n.versionStore.is_update_available?`アップデートがあります (version ${n.versionStore.latest_version})`:"",void 0,{right:!0}]])],2)],2)],2),u(w)])}const Vn=H(_n,[["render",On],["__scopeId","data-v-9629ebc2"]]);export{En as H,Vn as N,vn as V,un as u};
