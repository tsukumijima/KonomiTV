import{a7 as _,af as w,U as b,u as C}from"./index-BXhm4dMb.js";class T{static getChannelType(t){var n,e;try{const s=(e=(n=t.match("(?<channel_type>[a-z]+(?:4k)?)\\d+"))==null?void 0:n.groups)==null?void 0:e.channel_type.toUpperCase();if(!s)return null;switch(s){case"GR":return"GR";case"BS":return"BS";case"CS":return"CS";case"CATV":return"CATV";case"SKY":return"SKY";case"BS4K":return"BS4K";default:return null}}catch{return null}}static getChannelForceType(t){return t===null?"normal":t>=500?"festival":t>=200?"so-many":t>=100?"many":"normal"}static getChannelHashtag(t){const n={NHK総合:"#nhk",NHKEテレ:"#etv",HBC:"#hbc",札幌テレビ:"#stv",HTB:"#htb",TVh:"#tvh",北海道文化放送:"#uhb",RAB青森放送:"#rab",青森朝日放送:"#aba",ATV青森テレビ:"#atv",テレビ岩手:"#tvi",岩手朝日テレビ:"#iat",IBCテレビ:"#ibc",めんこいテレビ:"#mit",TBCテレビ:"#tbc",ミヤギテレビ:"#mmt",東日本放送:"#khb",仙台放送:"#oxtv",ABS秋田放送:"#abs",秋田朝日放送:"#aab",AKT秋田テレビ:"#akt",山形放送:"#ybc",山形テレビ:"#yts",TUY:"#tuy",さくらんぼテレビ:"#say",福島中央テレビ:"#fct",KFB福島放送:"#kfb",テレビユー福島:"#tuf",FTV福島テレビ:"#ftv",TeNY:"#TeNY",新潟テレビ21:"#uxtv",BSN:"#bsn",NST:"#nst",KNBテレビ:"#knb",チューリップテレビ:"#tut",富山テレビ放送:"#toyamatv",テレビ金沢:"#tv_kanazawa",HAB:"#hab",MRO:"#mro",石川テレビ:"#ishikawatv",福井放送:"#fbc",福井テレビ:"#fukuitv",山梨放送:"#ybs",UTYテレビ山梨:"#uty",テレビ信州:"#tsb",長野朝日放送:"#abn",SBC信越放送:"#sbc",長野放送:"#nbs","Daiichi-TV":"#sdt",静岡朝日テレビ:"#satv",SBS:"#sbs",テレビ静岡:"#sut",三重テレビ:"#mietv",ぎふチャン:"#gifuchan",BBCびわ湖放送:"#BBC_biwako",奈良テレビ:"#tvn",WTV:"#telewaka",RNC西日本テレビ:"#rnc",瀬戸内海放送:"#ksb",RSKテレビ:"#rsk",TSCテレビせとうち:"#tvsetouchi",OHK:"#ohk",RCCテレビ:"#rcc",広島テレビ:"#htv",広島ホームテレビ:"#hometv",テレビ新広島:"#tss",日本海テレビ:"#nkt",BSSテレビ:"#bss",さんいん中央テレビ:"#tsk",tysテレビ山口:"#tys",山口放送:"#kry",yab山口朝日:"#yab",四国放送:"#jrt",高知放送:"#rkc",テレビ高知:"#kutv",高知さんさんテレビ:"#kss",南海放送:"#rnb",愛媛朝日テレビ:"#eat",あいテレビ:"#itv",テレビ愛媛:"#ebc",KBCテレビ:"#kbc",RKB毎日放送:"#rkb",FBS福岡放送:"#fbs",TVQ九州放送:"#tvq",テレビ西日本:"#tnc",STSサガテレビ:"#sagatv",NBC長崎放送:"#nbc",長崎国際テレビ:"#nib",NCC長崎文化放送:"#ncc",テレビ長崎:"#ktn",RKK熊本放送:"#rkk",くまもと県民:"#kkt",KAB熊本朝日放送:"#kab",テレビ熊本:"#tku",OBS大分放送:"#obs",TOSテレビ大分:"#tos",OAB大分朝日放送:"#oab",MRT宮崎放送:"#mrt",テレビ宮崎:"#umk",MBC南日本放送:"#mbc",鹿児島讀賣テレビ:"#kyt",KKB鹿児島放送:"#kkb",鹿児島テレビ放送:"#kts",RBCテレビ:"#rbc",琉球朝日放送:"#qab",沖縄テレビ:"#otv",日テレ:"#ntv",読売テレビ:"#ytv",中京テレビ:"#chukyotv",テレビ朝日:"#tvasahi",ABCテレビ:"#abc","メ~テレ":"#nagoyatv","メ〜テレ":"#nagoyatv",TBSチャンネル:null,TBS:"#tbs",MBS:"#mbs",CBC:"#cbc",テレビ東京:"#tvtokyo",テレ東:"#tvtokyo",テレビ大阪:"#tvo",テレビ愛知:"#tva",フジテレビ:"#fujitv",関西テレビ:"#kantele",東海テレビ:"#tokaitv","TOKYO MX":"#tokyomx",tvk:"#tvk",チバテレ:"#chibatv",テレ玉:"#teletama",群馬テレビ:"#gtv",とちぎテレビ:"#tochitere",とちテレ:"#tochitere",サンテレビ:"#suntv",KBS京都:"#kbs",NHKBS1:"#nhkbs1",NHKBSプレミアム:"#nhkbsp",NHKBS:"#nhkbs",BS日テレ:"#bsntv",BS朝日:"#bsasahi","BS-TBS":"#bstbs",BSテレ東:"#bstvtokyo",BSフジ:"#bsfuji",BS10スターチャンネル:"#bs10スターチャンネル",BS10:"#bs10",BS11:"#bs11",BS12:"#bs12",BS松竹東急:"#bs260ch",BSJapanext:"#bsjapanext",BSよしもと:"#bsyoshimoto","AT-X":"#at_x"},e=Object.keys(n).find(s=>t.startsWith(s));return e?n[e]:null}}const m={id:"NID0-SID0-EID0",channel_id:"NID0-SID0",network_id:0,service_id:0,event_id:0,title:"取得中…",description:"取得中…",detail:{},start_time:"2000-01-01T00:00:00+09:00",end_time:"2000-01-01T00:00:00+09:00",duration:0,is_free:!0,genres:[],video_type:"映像1080i(1125i)、アスペクト比16:9 パンベクトルなし",video_codec:"MPEG-2",video_resolution:"1080i",primary_audio_type:"2/0モード(ステレオ)",primary_audio_language:"日本語",primary_audio_sampling_rate:"48kHz",secondary_audio_type:null,secondary_audio_language:null,secondary_audio_sampling_rate:null};class I{static async searchPrograms(t){const n=await _.post("/programs/search",t);if(n.type==="error"){switch(n.data.detail){case"This API is only available when the backend is EDCB":_.showGenericError(n,"番組検索機能は EDCB バックエンド選択時のみ利用できます。");break;default:_.showGenericError(n,"番組情報の検索に失敗しました。");break}return null}return n.data}static async fetchTimeTable(t,n,e,s){const c=new URLSearchParams;c.set("start_time",t.format("YYYY-MM-DDTHH:mm:ssZ")),c.set("end_time",n.format("YYYY-MM-DDTHH:mm:ssZ")),e!==void 0&&c.set("channel_type",e),s!==void 0&&s.length>0&&c.set("pinned_channel_ids",s.join(","));const o=await _.get(`/programs/timetable?${c.toString()}`);return o.type==="error"?(_.showGenericError(o,"番組表データの取得に失敗しました。"),null):o.data}}const p={id:"NID0-SID0",display_channel_id:"gr000",network_id:0,service_id:0,transport_stream_id:null,remocon_id:0,channel_number:"---",type:"GR",name:"取得中…",jikkyo_force:null,is_subchannel:!1,is_radiochannel:!1,is_watchable:!0,terrestrial_regions:null,is_display:!0,viewer_count:0,program_present:m,program_following:m};class K{static async fetchAllChannels(){const t=await _.get("/channels");return t.type==="error"?(_.showGenericError(t,"チャンネル情報を取得できませんでした。"),null):t.data}static async fetch(t){const n=await _.get(`/channels/${t}`);return n.type==="error"?(_.showGenericError(n,"チャンネル情報を取得できませんでした。"),null):n.data}static async fetchWebSocketInfo(t){const n=await _.get(`/channels/${t}/jikkyo`);return n.type==="error"?(_.showGenericError(n,"コメント送受信用 WebSocket API の情報を取得できませんでした。"),null):n.data}}const N=w("channels",{state:()=>({channels_list:{GR:[],BS:[],CS:[],CATV:[],SKY:[],BS4K:[]},is_channels_list_initial_updated:!1,last_updated_at:0,display_channel_id:"gr000",viewer_count:null,current_program_present:null,current_program_following:null}),getters:{channel(){if(this.is_channels_list_initial_updated===!1)return{previous:p,current:p,next:p};const a={...m,title:"チャンネル情報取得エラー",description:"このチャンネル ID のチャンネル情報は存在しません。"},t={...p,name:"チャンネル情報取得エラー",program_present:a,program_following:a},n=T.getChannelType(this.display_channel_id);if(n===null)return{previous:t,current:t,next:t};const e=this.channels_list[n],s=e.findIndex(i=>i.display_channel_id===this.display_channel_id);if(s===-1)return{previous:t,current:t,next:t};const c=(()=>{let i=s-1;for(;e.length;){if(i<=-1&&(i=e.length-1),e[i].is_display)return i;i--}return 0})(),o=(()=>{let i=s+1;for(;e.length;){if(i>=e.length&&(i=0),e[i].is_display)return i;i++}return 0})(),d=structuredClone(e[s]);return this.current_program_present!==null&&(d.program_present=this.current_program_present),this.current_program_following!==null&&(d.program_following=this.current_program_following),this.viewer_count!==null&&(d.viewer_count=this.viewer_count),{previous:e[c],current:d,next:e[o]}},channels_list_with_pinned(){var c,o,d,i,g,k,y;const a=C(),t=u=>{const l=u.match(/^(\d+)(?:-(\d+))?$/);return l===null?{main:Number.MAX_SAFE_INTEGER,sub:Number.MAX_SAFE_INTEGER}:{main:Number(l[1]),sub:Number(l[2]??"0")}},n=(u,l)=>{const r=t(u.channel_number),h=t(l.channel_number);return r.main!==h.main?r.main-h.main:r.sub!==h.sub?r.sub-h.sub:u.channel_number.localeCompare(l.channel_number,"ja")},e=new Map;if(e.set("ピン留め",[]),e.set("地デジ",[]),this.is_channels_list_initial_updated===!1)return e;e.set("BS",[]),e.set("CS",[]),e.set("CATV",[]),e.set("SKY",[]),e.set("BS4K",[]);const s=[];for(const[u,l]of Object.entries(this.channels_list))for(const r of l)if(a.settings.pinned_channel_ids.includes(r.id)&&s.push(r),r.is_display!==!1)switch(r.type){case"GR":{(c=e.get("地デジ"))==null||c.push(r);break}case"BS":{(o=e.get("BS"))==null||o.push(r);break}case"CS":{(d=e.get("CS"))==null||d.push(r);break}case"CATV":{(i=e.get("CATV"))==null||i.push(r);break}case"SKY":{(g=e.get("SKY"))==null||g.push(r);break}case"BS4K":{(k=e.get("BS4K"))==null||k.push(r);break}}if((y=e.get("ピン留め"))==null||y.push(...s.sort((u,l)=>{const r=a.settings.pinned_channel_ids.indexOf(u.id),h=a.settings.pinned_channel_ids.indexOf(l.id);return r-h})),a.settings.tv_channel_sort_by_jikkyo_force===!0&&Array.from(e.values()).flat().some(l=>(l.jikkyo_force??0)>0)===!0)for(const[l,r]of e)e.set(l,[...r].sort((h,f)=>{const S=h.jikkyo_force??0,v=f.jikkyo_force??0;if(S!==v)return v-S;const B=n(h,f);return B!==0?B:h.id.localeCompare(f.id,"ja")}));for(const[u,l]of e)u!=="ピン留め"&&l.length===0&&e.delete(u);return e.size===1&&e.has("ピン留め")&&e.delete("ピン留め"),e},channels_list_with_pinned_for_watch(){var t;const a=new Map([...this.channels_list_with_pinned]);return this.is_channels_list_initial_updated===!1||((t=a.get("ピン留め"))==null?void 0:t.length)===0&&a.delete("ピン留め"),a}},actions:{getChannelByRemoconID(a,t){return this.channels_list[a].find(s=>s.remocon_id===t)??null},async update(a=!1){const t=async()=>{const s=await K.fetchAllChannels();return s===null?(console.warn("[ChannelsStore] Failed to fetch channels list. Skip updating cache."),!1):(this.channels_list=b.deepObjectFreeze(s),this.is_channels_list_initial_updated===!1&&(this.is_channels_list_initial_updated=!0),this.last_updated_at=b.time(),!0)};if(this.is_channels_list_initial_updated===!0&&a===!1){b.time()-this.last_updated_at>60&&t();return}if(await t()===!1){console.warn("[ChannelsStore] Failed to update channels list. Skip removing pinned channel IDs.");return}const e=C();e.settings.pinned_channel_ids=e.settings.pinned_channel_ids.filter(s=>{var o;const c=(o=this.channels_list_with_pinned.get("ピン留め"))==null?void 0:o.some(d=>d.id===s);return c===!1&&console.warn("[ChannelsStore] Deleted pinned channel ID:",s),c})}}});export{T as C,p as I,I as P,K as a,m as b,N as u};
