import{A as q,g as V,p as P,i as N,u as g,c as n,m as S,w as O,v as J,R as Q,a as $,b as z,d as x,r as X,V as G,e as R,f as H,I as B,h as Y,j as Z,k as ee,l as L,n as ae,o as te,q as se,s as le,t as ne,x as oe,y as ie,z as u,B as re,C as de,D as ue,E as ce,F as ve,G as C,H as E,J as i,K as p,L as r,M as pe,N as me,O as I,P as fe,Q as xe,S as ye,T as be,U as k,_ as Ve}from"./index-LUcZSfg3.js";import{V as Pe}from"./VSpacer-ChgMJFbm.js";import{V as ge,a as Te,b as Ce,c as ke}from"./VCard-BS7Vnm3K.js";import{V as Se,a as _e}from"./VTextField-BDf-Yp3u.js";import{u as Ee,m as Ie,V as U}from"./lazy-BNtSIMgY.js";import{V as Re}from"./VAlert-CBJrpMiB.js";import"./VAvatar-DFvMdaEn.js";class D{static validateServerURL(o){try{const s=new URL(o);if(!["http:","https:"].includes(s.protocol))return{valid:!1,error:"HTTP または HTTPS のみサポートしています。"};const a=s.port?parseInt(s.port):s.protocol==="https:"?443:80;if(a<1||a>65535)return{valid:!1,error:"ポート番号が不正です (1-65535)。"};const l=s.hostname;return!l||l.length===0?{valid:!1,error:"ホスト名が指定されていません。"}:{valid:!0}}catch{return{valid:!1,error:"URL の形式が不正です。"}}}static async testConnection(o){const s=performance.now();try{const a=await q.get("/version",{baseURL:`${o}/api`,timeout:5e3}),l=Math.round(performance.now()-s);return a.type==="success"?{success:!0,version:a.data.version,latency:l}:{success:!1,error:`接続に失敗しました (HTTP ${a.status})`}}catch(a){let l="サーバーに接続できませんでした。";return a.code==="ECONNABORTED"||a.code==="ERR_NETWORK"?l="サーバーへの接続が切断されました。URL とネットワーク接続を確認してください。":a.code==="ETIMEDOUT"?l="サーバーへの接続がタイムアウトしました。ネットワーク接続を確認してください。":a.response&&(l=`サーバーエラーが発生しました (HTTP ${a.response.status})`),{success:!1,error:l}}}}const b=Symbol.for("vuetify:v-expansion-panel"),K=P({...S(),...Ie()},"VExpansionPanelText"),h=V()({name:"VExpansionPanelText",props:K(),setup(e,o){let{slots:s}=o;const a=N(b);if(!a)throw new Error("[Vuetify] v-expansion-panel-text needs to be placed inside v-expansion-panel");const{hasContent:l,onAfterLeave:m}=Ee(e,a.isSelected);return g(()=>n(Se,{onAfterLeave:m},{default:()=>{var d;return[O(n("div",{class:["v-expansion-panel-text",e.class],style:e.style},[s.default&&l.value&&n("div",{class:"v-expansion-panel-text__wrapper"},[(d=s.default)==null?void 0:d.call(s)])]),[[J,a.isSelected.value]])]}})),{}}}),j=P({color:String,expandIcon:{type:B,default:"$expand"},collapseIcon:{type:B,default:"$collapse"},hideActions:Boolean,focusable:Boolean,static:Boolean,ripple:{type:[Boolean,Object],default:!1},readonly:Boolean,...S(),...H()},"VExpansionPanelTitle"),w=V()({name:"VExpansionPanelTitle",directives:{Ripple:Q},props:j(),setup(e,o){let{slots:s}=o;const a=N(b);if(!a)throw new Error("[Vuetify] v-expansion-panel-title needs to be placed inside v-expansion-panel");const{backgroundColorClasses:l,backgroundColorStyles:m}=$(e,"color"),{dimensionStyles:d}=z(e),t=x(()=>({collapseIcon:e.collapseIcon,disabled:a.disabled.value,expanded:a.isSelected.value,expandIcon:e.expandIcon,readonly:e.readonly})),c=x(()=>a.isSelected.value?e.collapseIcon:e.expandIcon);return g(()=>{var y;return O(n("button",{class:["v-expansion-panel-title",{"v-expansion-panel-title--active":a.isSelected.value,"v-expansion-panel-title--focusable":e.focusable,"v-expansion-panel-title--static":e.static},l.value,e.class],style:[m.value,d.value,e.style],type:"button",tabindex:a.disabled.value?-1:void 0,disabled:a.disabled.value,"aria-expanded":a.isSelected.value,onClick:e.readonly?void 0:a.toggle},[n("span",{class:"v-expansion-panel-title__overlay"},null),(y=s.default)==null?void 0:y.call(s,t.value),!e.hideActions&&n(G,{defaults:{VIcon:{icon:c.value}}},{default:()=>{var T;return[n("span",{class:"v-expansion-panel-title__icon"},[((T=s.actions)==null?void 0:T.call(s,t.value))??n(R,null,null)])]}})]),[[X("ripple"),e.ripple]])}),{}}}),F=P({title:String,text:String,bgColor:String,...se(),...te(),...ae(),...L(),...j(),...K()},"VExpansionPanel"),he=V()({name:"VExpansionPanel",props:F(),emits:{"group:selected":e=>!0},setup(e,o){let{slots:s}=o;const a=Y(e,b),{backgroundColorClasses:l,backgroundColorStyles:m}=$(e,"bgColor"),{elevationClasses:d}=Z(e),{roundedClasses:t}=ee(e),c=x(()=>(a==null?void 0:a.disabled.value)||e.disabled),y=x(()=>a.group.items.value.reduce((f,v,_)=>(a.group.selected.value.includes(v.id)&&f.push(_),f),[])),T=x(()=>{const f=a.group.items.value.findIndex(v=>v.id===a.id);return!a.isSelected.value&&y.value.some(v=>v-f===1)}),M=x(()=>{const f=a.group.items.value.findIndex(v=>v.id===a.id);return!a.isSelected.value&&y.value.some(v=>v-f===-1)});return le(b,a),g(()=>{const f=!!(s.text||e.text),v=!!(s.title||e.title),_=w.filterProps(e),W=h.filterProps(e);return n(e.tag,{class:["v-expansion-panel",{"v-expansion-panel--active":a.isSelected.value,"v-expansion-panel--before-active":T.value,"v-expansion-panel--after-active":M.value,"v-expansion-panel--disabled":c.value},t.value,l.value,e.class],style:[m.value,e.style]},{default:()=>[n("div",{class:["v-expansion-panel__shadow",...d.value]},null),n(G,{defaults:{VExpansionPanelTitle:{..._},VExpansionPanelText:{...W}}},{default:()=>{var A;return[v&&n(w,{key:"title"},{default:()=>[s.title?s.title():e.title]}),f&&n(h,{key:"text"},{default:()=>[s.text?s.text():e.text]}),(A=s.default)==null?void 0:A.call(s)]}})]})}),{groupItem:a}}}),we=["default","accordion","inset","popout"],Le=P({flat:Boolean,...ue(),...de(F(),["bgColor","collapseIcon","color","eager","elevation","expandIcon","focusable","hideActions","readonly","ripple","rounded","tile","static"]),...re(),...S(),...L(),variant:{type:String,default:"default",validator:e=>we.includes(e)}},"VExpansionPanels"),Ae=V()({name:"VExpansionPanels",props:Le(),emits:{"update:modelValue":e=>!0},setup(e,o){let{slots:s}=o;const{next:a,prev:l}=ne(e,b),{themeClasses:m}=oe(e),d=x(()=>e.variant&&`v-expansion-panels--variant-${e.variant}`);return ie({VExpansionPanel:{bgColor:u(e,"bgColor"),collapseIcon:u(e,"collapseIcon"),color:u(e,"color"),eager:u(e,"eager"),elevation:u(e,"elevation"),expandIcon:u(e,"expandIcon"),focusable:u(e,"focusable"),hideActions:u(e,"hideActions"),readonly:u(e,"readonly"),ripple:u(e,"ripple"),rounded:u(e,"rounded"),static:u(e,"static")}}),g(()=>n(e.tag,{class:["v-expansion-panels",{"v-expansion-panels--flat":e.flat,"v-expansion-panels--tile":e.tile},m.value,d.value,e.class],style:e.style},{default:()=>{var t;return[(t=s.default)==null?void 0:t.call(s,{prev:l,next:a})]}})),{next:a,prev:l}}}),Be=P({fluid:{type:Boolean,default:!1},...S(),...H(),...L()},"VContainer"),Ue=V()({name:"VContainer",props:Be(),setup(e,o){let{slots:s}=o;const{rtlClasses:a}=ce(),{dimensionStyles:l}=z(e);return g(()=>n(e.tag,{class:["v-container",{"v-container--fluid":e.fluid},a.value,e.class],style:[l.value,e.style]},s)),{}}}),De={class:"ios-app-setup-container"},Ne={class:"mb-6"},Oe={class:"d-flex flex-wrap ga-2"},$e={key:0},ze={class:"text-body-2"},Ge={class:"text-body-2"},He={key:1},Ke={class:"text-body-2"},je=ve({__name:"IOSAppSetup",setup(e){const o=C(""),s=C(null),a=C(!1),l=C(null);async function m(){const d=D.validateServerURL(o.value);if(!d.valid){s.value=d.error;return}a.value=!0,l.value=null;const t=await D.testConnection(o.value);if(t.success){const c=xe();c.settings.ios_app_server_url=o.value,c.settings.ios_app_initial_setup_completed=!0,l.value={success:!0,message:"接続に成功しました！",version:t.version,latency:t.latency},ye.success("サーバー URL を保存しました。3秒後にメインページへ遷移します。"),setTimeout(()=>{be.push("/")},3e3)}else l.value={success:!1,message:t.error};a.value=!1}return(d,t)=>(k(),E("div",De,[n(Ue,{class:"d-flex align-center justify-center",style:{"min-height":"100vh"}},{default:i(()=>[n(ge,{class:"setup-card","max-width":"600",elevation:"8"},{default:i(()=>[n(Te,{class:"text-h5 pa-6"},{default:i(()=>[n(R,{class:"mr-2"},{default:i(()=>[...t[4]||(t[4]=[p("mdi-server-network",-1)])]),_:1}),t[5]||(t[5]=p(" サーバー URL の設定 ",-1))]),_:1}),n(Ce,{class:"pa-6"},{default:i(()=>[t[14]||(t[14]=r("p",{class:"text-body-1 mb-6"},[p(" KonomiTV サーバーの URL を入力してください。"),r("br"),p(" Tailscale VPN 経由での接続もサポートしています。 ")],-1)),n(_e,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=c=>o.value=c),label:"サーバー URL",placeholder:"https://192-168-1-100.local.konomi.tv:7000",variant:"outlined","error-messages":s.value,disabled:a.value,onInput:t[1]||(t[1]=c=>s.value=null),class:"mb-4","prepend-inner-icon":"mdi-link-variant"},null,8,["modelValue","error-messages","disabled"]),r("div",Ne,[t[8]||(t[8]=r("p",{class:"text-caption mb-2"},"入力例:",-1)),r("div",Oe,[n(U,{size:"small",color:"primary",variant:"outlined",onClick:t[2]||(t[2]=c=>o.value="https://192-168-1-100.local.konomi.tv:7000")},{default:i(()=>[...t[6]||(t[6]=[p(" ローカル IP (Wi-Fi) ",-1)])]),_:1}),n(U,{size:"small",color:"primary",variant:"outlined",onClick:t[3]||(t[3]=c=>o.value="https://100-125-18-21.local.konomi.tv:7000")},{default:i(()=>[...t[7]||(t[7]=[p(" Tailscale VPN ",-1)])]),_:1})])]),l.value?(k(),pe(Re,{key:0,type:l.value.success?"success":"error",icon:l.value.success?"mdi-check-circle":"mdi-alert-circle",class:"mb-4"},{default:i(()=>[l.value.success?(k(),E("div",$e,[t[9]||(t[9]=r("div",{class:"text-body-1 font-weight-bold mb-1"},"接続成功！",-1)),r("div",ze,"サーバーバージョン: "+I(l.value.version),1),r("div",Ge,"応答時間: "+I(l.value.latency)+"ms",1)])):(k(),E("div",He,[t[10]||(t[10]=r("div",{class:"text-body-1 font-weight-bold mb-1"},"接続失敗",-1)),r("div",Ke,I(l.value.message),1)]))]),_:1},8,["type","icon"])):me("",!0),n(Ae,{class:"mb-4"},{default:i(()=>[n(he,null,{default:i(()=>[n(w,null,{default:i(()=>[n(R,{class:"mr-2"},{default:i(()=>[...t[11]||(t[11]=[p("mdi-help-circle-outline",-1)])]),_:1}),t[12]||(t[12]=p(" Tailscale VPN 経由で接続する方法 ",-1))]),_:1}),n(h,null,{default:i(()=>[...t[13]||(t[13]=[r("ol",{class:"text-body-2"},[r("li",{class:"mb-2"},"iOS デバイスと KonomiTV サーバーの両方で Tailscale アプリをインストールし、同じアカウントでログインします。"),r("li",{class:"mb-2"},"KonomiTV サーバーの Tailscale IP アドレス (100.x.y.z 形式) を確認します。"),r("li",{class:"mb-2"},[p("URL を "),r("code",null,"https://100-x-y-z.local.konomi.tv:7000"),p(" の形式で入力します（ピリオドをハイフンに置き換えます）。")])],-1)])]),_:1})]),_:1})]),_:1})]),_:1}),n(ke,{class:"pa-6 pt-0"},{default:i(()=>[n(Pe),n(fe,{color:"primary",size:"large",loading:a.value,disabled:!o.value||o.value.trim()==="",onClick:m,"prepend-icon":"mdi-connection"},{default:i(()=>[...t[15]||(t[15]=[p(" 接続テスト & 保存 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]))}}),Ye=Ve(je,[["__scopeId","data-v-3ecfe17e"]]);export{Ye as default};
